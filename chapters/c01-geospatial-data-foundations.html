<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.5.56">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">


<title>Week 1: Core Tools and Data Access</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { display: inline-block; text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
</style>


<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.5.1/jquery.min.js" integrity="sha512-bLT0Qm9VnAYZDflyKcBaQ2gg0hSYNQrJ8RilYldYQ1FxQYoCLtUjuuRuZo+fjqhx/qtq/1itJ0C2ejDxltZVFg==" crossorigin="anonymous"></script><script src="../site_libs/quarto-nav/quarto-nav.js"></script>
<script src="../site_libs/quarto-nav/headroom.min.js"></script>
<script src="../site_libs/clipboard/clipboard.min.js"></script>
<script src="../site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="../site_libs/quarto-search/fuse.min.js"></script>
<script src="../site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="../">
<script src="../site_libs/quarto-html/quarto.js"></script>
<script src="../site_libs/quarto-html/popper.min.js"></script>
<script src="../site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="../site_libs/quarto-html/anchor.min.js"></script>
<link href="../site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="../site_libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="../site_libs/bootstrap/bootstrap.min.js"></script>
<link href="../site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="../site_libs/bootstrap/bootstrap.min.css" rel="stylesheet" id="quarto-bootstrap" data-mode="light">
<link href="../site_libs/quarto-contrib/fontawesome6-1.2.0/all.min.css" rel="stylesheet">
<link href="../site_libs/quarto-contrib/fontawesome6-1.2.0/latex-fontsize.css" rel="stylesheet">
<script id="quarto-search-options" type="application/json">{
  "location": "navbar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "end",
  "type": "overlay",
  "limit": 50,
  "keyboard-shortcut": [
    "f",
    "/",
    "s"
  ],
  "show-item-context": false,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-text-placeholder": "",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit",
    "search-label": "Search"
  }
}</script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.6/require.min.js" integrity="sha512-c3Nl8+7g4LMSTdrm621y7kf9v3SDPnhxLNhcjFJbKECVnmZHTdo+IRO05sNLTH/D3vA6u1X32ehoLC7WFVdheg==" crossorigin="anonymous"></script>

<script type="application/javascript">define('jquery', [],function() {return window.jQuery;})</script>


</head>

<body class="nav-fixed">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top quarto-banner">
    <nav class="navbar navbar-expand-lg " data-bs-theme="dark">
      <div class="navbar-container container-fluid">
      <div class="navbar-brand-container mx-auto">
    <a class="navbar-brand" href="../index.html">
    <span class="navbar-title">GEOG 288KC</span>
    </a>
  </div>
            <div id="quarto-search" class="" title="Search"></div>
          <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarCollapse" aria-controls="navbarCollapse" role="menu" aria-expanded="false" aria-label="Toggle navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
  <span class="navbar-toggler-icon"></span>
</button>
          <div class="collapse navbar-collapse" id="navbarCollapse">
            <ul class="navbar-nav navbar-nav-scroll ms-auto">
  <li class="nav-item">
    <a class="nav-link" href="../index.html"> 
<span class="menu-text">🏠 home</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="../Syllabus.html"> 
<span class="menu-text">📋 syllabus</span></a>
  </li>  
  <li class="nav-item dropdown ">
    <a class="nav-link dropdown-toggle" href="#" id="nav-menu-weekly-sessions" role="link" data-bs-toggle="dropdown" aria-expanded="false">
 <span class="menu-text">💻 weekly sessions</span>
    </a>
    <ul class="dropdown-menu dropdown-menu-end" aria-labelledby="nav-menu-weekly-sessions">    
        <li>
    <a class="dropdown-item" href="../chapters/c01-geospatial-data-foundations.html">
 <span class="dropdown-text">Week 1 - 🚀 Core Tools and Data Access</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../chapters/c02-spatial-temporal-attention-mechanisms.html">
 <span class="dropdown-text">Week 2 - ⚡ Rapid Remote Sensing Preprocessing</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../chapters/c03-complete-gfm-architecture.html">
 <span class="dropdown-text">Week 3 - 🤖 Machine Learning on Remote Sensing</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../chapters/c04-pretraining-implementation.html">
 <span class="dropdown-text">Week 4 - 🏗️ Foundation Models in Practice</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../chapters/c05-training-loop-optimization.html">
 <span class="dropdown-text">Week 5 - 🔧 Fine-Tuning &amp; Transfer Learning</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../chapters/c06-model-evaluation-analysis.html">
 <span class="dropdown-text">Week 6 - ⏰ Spatiotemporal Modeling &amp; Projects</span></a>
  </li>  
    </ul>
  </li>
  <li class="nav-item">
    <a class="nav-link" href="../cheatsheets.html"> 
<span class="menu-text">👀 Cheatsheets</span></a>
  </li>  
  <li class="nav-item dropdown ">
    <a class="nav-link dropdown-toggle" href="#" id="nav-menu-explainers" role="link" data-bs-toggle="dropdown" aria-expanded="false">
 <span class="menu-text">🧩 explainers</span>
    </a>
    <ul class="dropdown-menu dropdown-menu-end" aria-labelledby="nav-menu-explainers">    
        <li class="dropdown-header">1️⃣ Week 1</li>
        <li>
    <a class="dropdown-item" href="../extras/ai-ml-dl-fm-hierarchy.html">
 <span class="dropdown-text">🤖 AI/ML/DL/FM Hierarchy</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../extras/geospatial-foundation-model-predictions-standalone.html">
 <span class="dropdown-text">🎯 GFM Predictions (Standalone)</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../extras/geospatial-prediction-hierarchy.html">
 <span class="dropdown-text">✅ Geospatial Task/Prediction Types</span></a>
  </li>  
    </ul>
  </li>
  <li class="nav-item dropdown ">
    <a class="nav-link dropdown-toggle" href="#" id="nav-menu-extras" role="link" data-bs-toggle="dropdown" aria-expanded="false">
 <span class="menu-text">📖 extras</span>
    </a>
    <ul class="dropdown-menu dropdown-menu-end" aria-labelledby="nav-menu-extras">    
        <li class="dropdown-header">🎯 Practical Examples</li>
        <li>
    <a class="dropdown-item" href="../extras/examples/normalization_comparison.html">
 <span class="dropdown-text">Normalization Comparison</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../extras/examples/resnet.html">
 <span class="dropdown-text">ResNet Implementation</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../extras/examples/text_encoder.html">
 <span class="dropdown-text">Text Encoder</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../extras/examples/tiling-and-patches.html">
 <span class="dropdown-text">Tiling and Patches</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../extras/examples/terratorch_workflows.html">
 <span class="dropdown-text">TerraTorch Workflows</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../extras/resources/course_resources.html">
 <span class="dropdown-text">📚 Reference Materials</span></a>
  </li>  
        <li class="dropdown-header">📁 Project Templates</li>
        <li>
    <a class="dropdown-item" href="../extras/projects/project-proposal-template.html">
 <span class="dropdown-text">Project Proposal Template</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../extras/projects/mvp-template.html">
 <span class="dropdown-text">Project Results Template</span></a>
  </li>  
    </ul>
  </li>
  <li class="nav-item compact">
    <a class="nav-link" href="https://github.com/gfms-from-scratch/gfms-from-scratch.github.io" target="_blank"> <i class="bi bi-github" role="img">
</i> 
<span class="menu-text"></span></a>
  </li>  
</ul>
          </div> <!-- /navcollapse -->
            <div class="quarto-navbar-tools">
</div>
      </div> <!-- /container-fluid -->
    </nav>
</header>
<!-- content -->
<header id="title-block-header" class="quarto-title-block default page-columns page-full">
  <div class="quarto-title-banner page-columns page-full">
    <div class="quarto-title column-page-left">
      <div class="quarto-title-block"><div><h1 class="title">Week 1: Core Tools and Data Access</h1><button type="button" class="btn code-tools-button" id="quarto-code-tools-source"><i class="bi"></i> Code</button></div></div>
            <p class="subtitle lead">Setting up the geospatial AI toolkit and accessing satellite imagery</p>
                      </div>
  </div>
    
  
  <div class="quarto-title-meta column-page-left">

      
    
      
    </div>
    
  
  </header><div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-full page-navbar">
<!-- sidebar -->
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">On this page</h2>
   
  <ul>
  <li><a href="#introduction" id="toc-introduction" class="nav-link active" data-scroll-target="#introduction">Introduction</a></li>
  <li><a href="#course-structure-overview" id="toc-course-structure-overview" class="nav-link" data-scroll-target="#course-structure-overview">Course Structure Overview</a></li>
  <li><a href="#step-1-environment-setup-and-helper-functions" id="toc-step-1-environment-setup-and-helper-functions" class="nav-link" data-scroll-target="#step-1-environment-setup-and-helper-functions">Step 1: Environment Setup and Helper Functions</a>
  <ul class="collapse">
  <li><a href="#verify-your-environment" id="toc-verify-your-environment" class="nav-link" data-scroll-target="#verify-your-environment">Verify Your Environment</a></li>
  <li><a href="#import-essential-libraries-and-create-helper-functions" id="toc-import-essential-libraries-and-create-helper-functions" class="nav-link" data-scroll-target="#import-essential-libraries-and-create-helper-functions">Import Essential Libraries and Create Helper Functions</a></li>
  <li><a href="#geospatial-ai-toolkit-comprehensive-helper-functions" id="toc-geospatial-ai-toolkit-comprehensive-helper-functions" class="nav-link" data-scroll-target="#geospatial-ai-toolkit-comprehensive-helper-functions">Geospatial AI Toolkit: Comprehensive Helper Functions</a></li>
  </ul></li>
  <li><a href="#section-1-stac-authentication-and-security" id="toc-section-1-stac-authentication-and-security" class="nav-link" data-scroll-target="#section-1-stac-authentication-and-security">Section 1: STAC Authentication and Security 🔐</a>
  <ul class="collapse">
  <li><a href="#why-authentication-matters-in-geospatial-ai" id="toc-why-authentication-matters-in-geospatial-ai" class="nav-link" data-scroll-target="#why-authentication-matters-in-geospatial-ai">Why Authentication Matters in Geospatial AI</a></li>
  </ul></li>
  <li><a href="#section-2-stac-data-discovery" id="toc-section-2-stac-data-discovery" class="nav-link" data-scroll-target="#section-2-stac-data-discovery">Section 2: STAC Data Discovery 🔍</a>
  <ul class="collapse">
  <li><a href="#cloud-native-data-access-architecture" id="toc-cloud-native-data-access-architecture" class="nav-link" data-scroll-target="#cloud-native-data-access-architecture">Cloud-Native Data Access Architecture</a></li>
  </ul></li>
  <li><a href="#section-3-intelligent-data-loading" id="toc-section-3-intelligent-data-loading" class="nav-link" data-scroll-target="#section-3-intelligent-data-loading">Section 3: Intelligent Data Loading 📥</a>
  <ul class="collapse">
  <li><a href="#memory-management-in-satellite-data-processing" id="toc-memory-management-in-satellite-data-processing" class="nav-link" data-scroll-target="#memory-management-in-satellite-data-processing">Memory Management in Satellite Data Processing</a></li>
  </ul></li>
  <li><a href="#section-4-scene-processing-and-subsetting" id="toc-section-4-scene-processing-and-subsetting" class="nav-link" data-scroll-target="#section-4-scene-processing-and-subsetting">Section 4: Scene Processing and Subsetting 📐</a>
  <ul class="collapse">
  <li><a href="#spatial-reasoning-in-satellite-data-analysis" id="toc-spatial-reasoning-in-satellite-data-analysis" class="nav-link" data-scroll-target="#spatial-reasoning-in-satellite-data-analysis">Spatial Reasoning in Satellite Data Analysis</a></li>
  </ul></li>
  <li><a href="#section-5-data-processing-pipelines" id="toc-section-5-data-processing-pipelines" class="nav-link" data-scroll-target="#section-5-data-processing-pipelines">Section 5: Data Processing Pipelines 🔬</a>
  <ul class="collapse">
  <li><a href="#spectral-analysis-fundamentals" id="toc-spectral-analysis-fundamentals" class="nav-link" data-scroll-target="#spectral-analysis-fundamentals">Spectral Analysis Fundamentals</a></li>
  </ul></li>
  <li><a href="#section-6-visualization-functions" id="toc-section-6-visualization-functions" class="nav-link" data-scroll-target="#section-6-visualization-functions">Section 6: Visualization Functions 📊</a>
  <ul class="collapse">
  <li><a href="#scientific-visualization-design-principles" id="toc-scientific-visualization-design-principles" class="nav-link" data-scroll-target="#scientific-visualization-design-principles">Scientific Visualization Design Principles</a></li>
  </ul></li>
  <li><a href="#section-7-data-export-and-interoperability" id="toc-section-7-data-export-and-interoperability" class="nav-link" data-scroll-target="#section-7-data-export-and-interoperability">Section 7: Data Export and Interoperability 💾</a>
  <ul class="collapse">
  <li><a href="#geospatial-data-standards-and-interoperability" id="toc-geospatial-data-standards-and-interoperability" class="nav-link" data-scroll-target="#geospatial-data-standards-and-interoperability">Geospatial Data Standards and Interoperability</a></li>
  </ul></li>
  <li><a href="#section-8-advanced-workflow-patterns" id="toc-section-8-advanced-workflow-patterns" class="nav-link" data-scroll-target="#section-8-advanced-workflow-patterns">Section 8: Advanced Workflow Patterns 🚀</a>
  <ul class="collapse">
  <li><a href="#scalable-geospatial-processing-architectures" id="toc-scalable-geospatial-processing-architectures" class="nav-link" data-scroll-target="#scalable-geospatial-processing-architectures">Scalable Geospatial Processing Architectures</a></li>
  </ul></li>
  <li><a href="#summary-your-geospatial-ai-toolkit" id="toc-summary-your-geospatial-ai-toolkit" class="nav-link" data-scroll-target="#summary-your-geospatial-ai-toolkit">Summary: Your Geospatial AI Toolkit</a>
  <ul class="collapse">
  <li><a href="#core-capabilities" id="toc-core-capabilities" class="nav-link" data-scroll-target="#core-capabilities">Core Capabilities</a></li>
  <li><a href="#design-philosophy" id="toc-design-philosophy" class="nav-link" data-scroll-target="#design-philosophy">Design Philosophy</a></li>
  <li><a href="#ready-for-production" id="toc-ready-for-production" class="nav-link" data-scroll-target="#ready-for-production">Ready for Production</a></li>
  </ul></li>
  <li><a href="#troubleshooting" id="toc-troubleshooting" class="nav-link" data-scroll-target="#troubleshooting">Troubleshooting</a></li>
  <li><a href="#step-2-understanding-stac-apis-and-cloud-native-geospatial-architecture" id="toc-step-2-understanding-stac-apis-and-cloud-native-geospatial-architecture" class="nav-link" data-scroll-target="#step-2-understanding-stac-apis-and-cloud-native-geospatial-architecture">Step 2: Understanding STAC APIs and Cloud-Native Geospatial Architecture</a>
  <ul class="collapse">
  <li><a href="#the-stac-revolution-from-data-downloads-to-cloud-native-discovery" id="toc-the-stac-revolution-from-data-downloads-to-cloud-native-discovery" class="nav-link" data-scroll-target="#the-stac-revolution-from-data-downloads-to-cloud-native-discovery">The STAC Revolution: From Data Downloads to Cloud-Native Discovery</a></li>
  <li><a href="#stac-architecture-components" id="toc-stac-architecture-components" class="nav-link" data-scroll-target="#stac-architecture-components">STAC Architecture Components</a></li>
  <li><a href="#practical-stac-connection-microsoft-planetary-computer" id="toc-practical-stac-connection-microsoft-planetary-computer" class="nav-link" data-scroll-target="#practical-stac-connection-microsoft-planetary-computer">Practical STAC Connection: Microsoft Planetary Computer</a></li>
  </ul></li>
  <li><a href="#connection-troubleshooting" id="toc-connection-troubleshooting" class="nav-link" data-scroll-target="#connection-troubleshooting">Connection Troubleshooting</a>
  <ul class="collapse">
  <li><a href="#understanding-collection-metadata-and-selection-criteria" id="toc-understanding-collection-metadata-and-selection-criteria" class="nav-link" data-scroll-target="#understanding-collection-metadata-and-selection-criteria">Understanding Collection Metadata and Selection Criteria</a></li>
  </ul></li>
  <li><a href="#step-3-spatial-analysis-design---defining-areas-of-interest" id="toc-step-3-spatial-analysis-design---defining-areas-of-interest" class="nav-link" data-scroll-target="#step-3-spatial-analysis-design---defining-areas-of-interest">Step 3: Spatial Analysis Design - Defining Areas of Interest</a>
  <ul class="collapse">
  <li><a href="#learning-objectives-9" id="toc-learning-objectives-9" class="nav-link" data-scroll-target="#learning-objectives-9">Learning Objectives</a></li>
  <li><a href="#the-art-and-science-of-spatial-scope-definition" id="toc-the-art-and-science-of-spatial-scope-definition" class="nav-link" data-scroll-target="#the-art-and-science-of-spatial-scope-definition">The Art and Science of Spatial Scope Definition</a></li>
  <li><a href="#validating-your-aoi-selection" id="toc-validating-your-aoi-selection" class="nav-link" data-scroll-target="#validating-your-aoi-selection">Validating Your AOI Selection</a></li>
  </ul></li>
  <li><a href="#step-4-intelligent-satellite-scene-discovery-and-selection" id="toc-step-4-intelligent-satellite-scene-discovery-and-selection" class="nav-link" data-scroll-target="#step-4-intelligent-satellite-scene-discovery-and-selection">Step 4: Intelligent Satellite Scene Discovery and Selection</a>
  <ul class="collapse">
  <li><a href="#intelligent-satellite-scene-discovery" id="toc-intelligent-satellite-scene-discovery" class="nav-link" data-scroll-target="#intelligent-satellite-scene-discovery">Intelligent Satellite Scene Discovery</a></li>
  </ul></li>
  <li><a href="#sentinel-2-for-ai-applications" id="toc-sentinel-2-for-ai-applications" class="nav-link" data-scroll-target="#sentinel-2-for-ai-applications">Sentinel-2 for AI Applications</a></li>
  <li><a href="#step-5-production-grade-satellite-data-loading-and-processing" id="toc-step-5-production-grade-satellite-data-loading-and-processing" class="nav-link" data-scroll-target="#step-5-production-grade-satellite-data-loading-and-processing">Step 5: Production-Grade Satellite Data Loading and Processing</a>
  <ul class="collapse">
  <li><a href="#learning-objectives-10" id="toc-learning-objectives-10" class="nav-link" data-scroll-target="#learning-objectives-10">Learning Objectives</a></li>
  <li><a href="#the-challenge-of-large-scale-satellite-data-loading" id="toc-the-challenge-of-large-scale-satellite-data-loading" class="nav-link" data-scroll-target="#the-challenge-of-large-scale-satellite-data-loading">The Challenge of Large-Scale Satellite Data Loading</a></li>
  <li><a href="#intelligent-data-loading-architecture" id="toc-intelligent-data-loading-architecture" class="nav-link" data-scroll-target="#intelligent-data-loading-architecture">Intelligent Data Loading Architecture</a></li>
  </ul></li>
  <li><a href="#rasterio-xarray-and-rioxarray" id="toc-rasterio-xarray-and-rioxarray" class="nav-link" data-scroll-target="#rasterio-xarray-and-rioxarray">Rasterio, Xarray, and Rioxarray</a></li>
  <li><a href="#step-6-scientific-visualization-and-spectral-analysis" id="toc-step-6-scientific-visualization-and-spectral-analysis" class="nav-link" data-scroll-target="#step-6-scientific-visualization-and-spectral-analysis">Step 6: Scientific Visualization and Spectral Analysis</a>
  <ul class="collapse">
  <li><a href="#learning-objectives-11" id="toc-learning-objectives-11" class="nav-link" data-scroll-target="#learning-objectives-11">Learning Objectives</a></li>
  <li><a href="#principles-of-scientific-visualization-for-remote-sensing" id="toc-principles-of-scientific-visualization-for-remote-sensing" class="nav-link" data-scroll-target="#principles-of-scientific-visualization-for-remote-sensing">Principles of Scientific Visualization for Remote Sensing</a></li>
  <li><a href="#calculate-vegetation-indices" id="toc-calculate-vegetation-indices" class="nav-link" data-scroll-target="#calculate-vegetation-indices">Calculate Vegetation Indices</a></li>
  </ul></li>
  <li><a href="#understanding-ndvi-values" id="toc-understanding-ndvi-values" class="nav-link" data-scroll-target="#understanding-ndvi-values">Understanding NDVI Values</a></li>
  <li><a href="#step-6-interactive-mapping-and-band-analysis" id="toc-step-6-interactive-mapping-and-band-analysis" class="nav-link" data-scroll-target="#step-6-interactive-mapping-and-band-analysis">Step 6: Interactive Mapping and Band Analysis</a>
  <ul class="collapse">
  <li><a href="#create-interactive-map-with-results" id="toc-create-interactive-map-with-results" class="nav-link" data-scroll-target="#create-interactive-map-with-results">Create Interactive Map with Results</a></li>
  <li><a href="#comprehensive-multi-band-analysis" id="toc-comprehensive-multi-band-analysis" class="nav-link" data-scroll-target="#comprehensive-multi-band-analysis">Comprehensive Multi-band Analysis</a></li>
  </ul></li>
  <li><a href="#step-7-data-export-and-caching" id="toc-step-7-data-export-and-caching" class="nav-link" data-scroll-target="#step-7-data-export-and-caching">Step 7: Data Export and Caching</a>
  <ul class="collapse">
  <li><a href="#export-processed-data-using-helper-functions" id="toc-export-processed-data-using-helper-functions" class="nav-link" data-scroll-target="#export-processed-data-using-helper-functions">Export Processed Data Using Helper Functions</a></li>
  </ul></li>
  <li><a href="#conclusion-from-foundations-to-frontiers" id="toc-conclusion-from-foundations-to-frontiers" class="nav-link" data-scroll-target="#conclusion-from-foundations-to-frontiers">Conclusion: From Foundations to Frontiers</a>
  <ul class="collapse">
  <li><a href="#core-competencies-developed" id="toc-core-competencies-developed" class="nav-link" data-scroll-target="#core-competencies-developed">Core Competencies Developed</a></li>
  <li><a href="#key-technical-skills-gained" id="toc-key-technical-skills-gained" class="nav-link" data-scroll-target="#key-technical-skills-gained">Key Technical Skills Gained:</a></li>
  <li><a href="#real-world-applications" id="toc-real-world-applications" class="nav-link" data-scroll-target="#real-world-applications">Real-World Applications:</a></li>
  <li><a href="#week-2-preview-rapid-preprocessing-pipelines" id="toc-week-2-preview-rapid-preprocessing-pipelines" class="nav-link" data-scroll-target="#week-2-preview-rapid-preprocessing-pipelines">Week 2 Preview: Rapid Preprocessing Pipelines</a></li>
  <li><a href="#practice-assignment" id="toc-practice-assignment" class="nav-link" data-scroll-target="#practice-assignment">Practice Assignment</a></li>
  </ul></li>
  <li><a href="#essential-resources" id="toc-essential-resources" class="nav-link" data-scroll-target="#essential-resources">Essential Resources</a>
  <ul class="collapse">
  <li><a href="#data-sources" id="toc-data-sources" class="nav-link" data-scroll-target="#data-sources">Data Sources</a></li>
  <li><a href="#technical-documentation" id="toc-technical-documentation" class="nav-link" data-scroll-target="#technical-documentation">Technical Documentation</a></li>
  <li><a href="#community" id="toc-community" class="nav-link" data-scroll-target="#community">Community</a></li>
  </ul></li>
  </ul>
</nav>
    </div>
<!-- main -->
<main class="content quarto-banner-title-block column-page-left" id="quarto-document-content">





<section id="introduction" class="level2">
<h2 class="anchored" data-anchor-id="introduction">Introduction</h2>
<p>Welcome to your first hands-on session with geospatial AI! Today we’ll set up the core tools you’ll use throughout this course and get you working with real satellite imagery immediately. No theory-heavy introductions – we’re diving straight into practical data access and exploration.</p>
<div class="callout callout-style-default callout-tip callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Learning Goals
</div>
</div>
<div class="callout-body-container callout-body">
<p>By the end of this session, you will:</p>
<ul>
<li>Have a working geospatial AI environment</li>
<li>Pull real Sentinel-2/Landsat imagery via STAC APIs</li>
<li>Load and explore satellite data with rasterio and xarray</li>
<li>Create interactive maps with folium</li>
<li>Understand the basics of multi-spectral satellite imagery</li>
</ul>
</div>
</div>
</section>
<section id="course-structure-overview" class="level2">
<h2 class="anchored" data-anchor-id="course-structure-overview">Course Structure Overview</h2>
<p>This accelerated seminar follows a hands-on progression:</p>
<table class="caption-top table">
<colgroup>
<col style="width: 12%">
<col style="width: 14%">
<col style="width: 38%">
<col style="width: 22%">
<col style="width: 12%">
</colgroup>
<thead>
<tr class="header">
<th>Week</th>
<th>Focus</th>
<th>Hands-on Activity</th>
<th>Key Tools</th>
<th>Goal</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>1</td>
<td>Core Tools &amp; Data Access</td>
<td>Pull satellite imagery via STAC API</td>
<td>rasterio, xarray, folium, pystac-client</td>
<td>Everyone can load and explore geospatial data</td>
</tr>
<tr class="even">
<td>2</td>
<td>Rapid Preprocessing</td>
<td>Process Sentinel-2 scenes for AOI</td>
<td>rasterio, numpy, dask</td>
<td>Reproducible preprocessing pipeline</td>
</tr>
<tr class="odd">
<td>3</td>
<td>ML on Remote Sensing</td>
<td>Train CNN on land cover patches</td>
<td>PyTorch, torchgeo, sklearn</td>
<td>End-to-end ML workflow</td>
</tr>
<tr class="even">
<td>4</td>
<td>Foundation Models</td>
<td>Use pretrained geospatial models</td>
<td>transformers, torch</td>
<td>Compare FM vs scratch models</td>
</tr>
<tr class="odd">
<td>5</td>
<td>Fine-tuning</td>
<td>Adapt models for new tasks</td>
<td>transformers, torch</td>
<td>Efficient transfer learning</td>
</tr>
<tr class="even">
<td>6</td>
<td>Spatiotemporal &amp; Projects</td>
<td>Time series analysis + project proposals</td>
<td>xarray, matplotlib</td>
<td>Independent project planning</td>
</tr>
</tbody>
</table>
<hr>
</section>
<section id="step-1-environment-setup-and-helper-functions" class="level2">
<h2 class="anchored" data-anchor-id="step-1-environment-setup-and-helper-functions">Step 1: Environment Setup and Helper Functions</h2>
<p>We’ll start by setting up our environment and creating reusable helper functions that you’ll use throughout the course. These functions handle common tasks like data loading, visualization, and processing.</p>
<section id="verify-your-environment" class="level3">
<h3 class="anchored" data-anchor-id="verify-your-environment">Verify Your Environment</h3>
<p><strong>Environment Verification:</strong></p>
<p>Before we begin, let’s verify that your environment is properly configured. Your environment should include the following packages:</p>
<ul>
<li><strong>rasterio, xarray, rioxarray</strong>: Core geospatial data handling</li>
<li><strong>torch, transformers</strong>: Deep learning and foundation models</li>
<li><strong>folium</strong>: Interactive mapping</li>
<li><strong>matplotlib, numpy, pandas</strong>: Data analysis and visualization</li>
<li><strong>pystac-client, planetary-computer</strong>: STAC API access</li>
<li><strong>geopandas</strong>: Vector geospatial data</li>
</ul>
<div id="5b802586" class="cell" data-tangle="geogfm/c01.py" data-execution_count="1">
<div class="sourceCode cell-code" id="cb1"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="co">"""Week 1: Core Tools and Data Access functions for geospatial AI."""</span></span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> sys</span>
<span id="cb1-4"><a href="#cb1-4" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> importlib.metadata</span>
<span id="cb1-5"><a href="#cb1-5" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> warnings</span>
<span id="cb1-6"><a href="#cb1-6" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> os</span>
<span id="cb1-7"><a href="#cb1-7" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> typing <span class="im">import</span> Dict, List, Tuple, Optional, Union</span>
<span id="cb1-8"><a href="#cb1-8" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> pathlib <span class="im">import</span> Path</span>
<span id="cb1-9"><a href="#cb1-9" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> time</span>
<span id="cb1-10"><a href="#cb1-10" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> logging</span>
<span id="cb1-11"><a href="#cb1-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-12"><a href="#cb1-12" aria-hidden="true" tabindex="-1"></a><span class="co"># Core geospatial libraries</span></span>
<span id="cb1-13"><a href="#cb1-13" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> rasterio</span>
<span id="cb1-14"><a href="#cb1-14" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> rasterio.windows <span class="im">import</span> from_bounds</span>
<span id="cb1-15"><a href="#cb1-15" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> rasterio.warp <span class="im">import</span> transform_bounds</span>
<span id="cb1-16"><a href="#cb1-16" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> numpy <span class="im">as</span> np</span>
<span id="cb1-17"><a href="#cb1-17" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> pandas <span class="im">as</span> pd</span>
<span id="cb1-18"><a href="#cb1-18" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> pystac_client <span class="im">import</span> Client</span>
<span id="cb1-19"><a href="#cb1-19" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> planetary_computer <span class="im">as</span> pc</span>
<span id="cb1-20"><a href="#cb1-20" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-21"><a href="#cb1-21" aria-hidden="true" tabindex="-1"></a>warnings.filterwarnings(<span class="st">'ignore'</span>)</span>
<span id="cb1-22"><a href="#cb1-22" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-23"><a href="#cb1-23" aria-hidden="true" tabindex="-1"></a><span class="co"># Configure logging</span></span>
<span id="cb1-24"><a href="#cb1-24" aria-hidden="true" tabindex="-1"></a>logging.basicConfig(level<span class="op">=</span>logging.INFO, <span class="bu">format</span><span class="op">=</span><span class="st">'</span><span class="sc">%(asctime)s</span><span class="st"> - </span><span class="sc">%(levelname)s</span><span class="st"> - </span><span class="sc">%(message)s</span><span class="st">'</span>)</span>
<span id="cb1-25"><a href="#cb1-25" aria-hidden="true" tabindex="-1"></a>logger <span class="op">=</span> logging.getLogger(<span class="va">__name__</span>)</span>
<span id="cb1-26"><a href="#cb1-26" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-27"><a href="#cb1-27" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> verify_environment(required_packages: <span class="bu">list</span>) <span class="op">-&gt;</span> <span class="bu">dict</span>:</span>
<span id="cb1-28"><a href="#cb1-28" aria-hidden="true" tabindex="-1"></a>    <span class="co">"""</span></span>
<span id="cb1-29"><a href="#cb1-29" aria-hidden="true" tabindex="-1"></a><span class="co">    Verify that all required packages are installed.</span></span>
<span id="cb1-30"><a href="#cb1-30" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-31"><a href="#cb1-31" aria-hidden="true" tabindex="-1"></a><span class="co">    Parameters</span></span>
<span id="cb1-32"><a href="#cb1-32" aria-hidden="true" tabindex="-1"></a><span class="co">    ----------</span></span>
<span id="cb1-33"><a href="#cb1-33" aria-hidden="true" tabindex="-1"></a><span class="co">    required_packages : list</span></span>
<span id="cb1-34"><a href="#cb1-34" aria-hidden="true" tabindex="-1"></a><span class="co">        List of package names to verify</span></span>
<span id="cb1-35"><a href="#cb1-35" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-36"><a href="#cb1-36" aria-hidden="true" tabindex="-1"></a><span class="co">    Returns</span></span>
<span id="cb1-37"><a href="#cb1-37" aria-hidden="true" tabindex="-1"></a><span class="co">    -------</span></span>
<span id="cb1-38"><a href="#cb1-38" aria-hidden="true" tabindex="-1"></a><span class="co">    dict</span></span>
<span id="cb1-39"><a href="#cb1-39" aria-hidden="true" tabindex="-1"></a><span class="co">        Dictionary with package names as keys and versions as values</span></span>
<span id="cb1-40"><a href="#cb1-40" aria-hidden="true" tabindex="-1"></a><span class="co">    """</span></span>
<span id="cb1-41"><a href="#cb1-41" aria-hidden="true" tabindex="-1"></a>    results <span class="op">=</span> {}</span>
<span id="cb1-42"><a href="#cb1-42" aria-hidden="true" tabindex="-1"></a>    missing_packages <span class="op">=</span> []</span>
<span id="cb1-43"><a href="#cb1-43" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-44"><a href="#cb1-44" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> package <span class="kw">in</span> required_packages:</span>
<span id="cb1-45"><a href="#cb1-45" aria-hidden="true" tabindex="-1"></a>        <span class="cf">try</span>:</span>
<span id="cb1-46"><a href="#cb1-46" aria-hidden="true" tabindex="-1"></a>            version <span class="op">=</span> importlib.metadata.version(package)</span>
<span id="cb1-47"><a href="#cb1-47" aria-hidden="true" tabindex="-1"></a>            results[package] <span class="op">=</span> version</span>
<span id="cb1-48"><a href="#cb1-48" aria-hidden="true" tabindex="-1"></a>        <span class="cf">except</span> importlib.metadata.PackageNotFoundError:</span>
<span id="cb1-49"><a href="#cb1-49" aria-hidden="true" tabindex="-1"></a>            missing_packages.append(package)</span>
<span id="cb1-50"><a href="#cb1-50" aria-hidden="true" tabindex="-1"></a>            results[package] <span class="op">=</span> <span class="va">None</span></span>
<span id="cb1-51"><a href="#cb1-51" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-52"><a href="#cb1-52" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Report results</span></span>
<span id="cb1-53"><a href="#cb1-53" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> missing_packages:</span>
<span id="cb1-54"><a href="#cb1-54" aria-hidden="true" tabindex="-1"></a>        <span class="bu">print</span>(<span class="ss">f"❌ Missing packages: </span><span class="sc">{</span><span class="st">', '</span><span class="sc">.</span>join(missing_packages)<span class="sc">}</span><span class="ss">"</span>)</span>
<span id="cb1-55"><a href="#cb1-55" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> results</span>
<span id="cb1-56"><a href="#cb1-56" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-57"><a href="#cb1-57" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="ss">f"✅ All </span><span class="sc">{</span><span class="bu">len</span>(required_packages)<span class="sc">}</span><span class="ss"> packages verified"</span>)</span>
<span id="cb1-58"><a href="#cb1-58" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> results</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div id="d141df63" class="cell" data-execution_count="2">
<div class="sourceCode cell-code" id="cb2"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Verify core geospatial AI environment</span></span>
<span id="cb2-2"><a href="#cb2-2" aria-hidden="true" tabindex="-1"></a>required_packages <span class="op">=</span> [</span>
<span id="cb2-3"><a href="#cb2-3" aria-hidden="true" tabindex="-1"></a>    <span class="st">'rasterio'</span>, <span class="st">'xarray'</span>, <span class="st">'torch'</span>, <span class="st">'transformers'</span>,</span>
<span id="cb2-4"><a href="#cb2-4" aria-hidden="true" tabindex="-1"></a>    <span class="st">'folium'</span>, <span class="st">'matplotlib'</span>, <span class="st">'numpy'</span>, <span class="st">'pandas'</span>,</span>
<span id="cb2-5"><a href="#cb2-5" aria-hidden="true" tabindex="-1"></a>    <span class="st">'pystac-client'</span>, <span class="st">'geopandas'</span>, <span class="st">'rioxarray'</span>, <span class="st">'planetary-computer'</span></span>
<span id="cb2-6"><a href="#cb2-6" aria-hidden="true" tabindex="-1"></a>]</span>
<span id="cb2-7"><a href="#cb2-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-8"><a href="#cb2-8" aria-hidden="true" tabindex="-1"></a>package_status <span class="op">=</span> verify_environment(required_packages)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>✅ All 12 packages verified</code></pre>
</div>
</div>
</section>
<section id="import-essential-libraries-and-create-helper-functions" class="level3">
<h3 class="anchored" data-anchor-id="import-essential-libraries-and-create-helper-functions">Import Essential Libraries and Create Helper Functions</h3>
<div id="87e731b4" class="cell" data-execution_count="3">
<div class="sourceCode cell-code" id="cb4"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb4-1"><a href="#cb4-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Core geospatial libraries</span></span>
<span id="cb4-2"><a href="#cb4-2" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> rasterio</span>
<span id="cb4-3"><a href="#cb4-3" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> rasterio.warp <span class="im">import</span> calculate_default_transform, reproject, Resampling</span>
<span id="cb4-4"><a href="#cb4-4" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> xarray <span class="im">as</span> xr</span>
<span id="cb4-5"><a href="#cb4-5" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> rioxarray  <span class="co"># Extends xarray with rasterio functionality</span></span>
<span id="cb4-6"><a href="#cb4-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-7"><a href="#cb4-7" aria-hidden="true" tabindex="-1"></a><span class="co"># Data access and processing</span></span>
<span id="cb4-8"><a href="#cb4-8" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> numpy <span class="im">as</span> np</span>
<span id="cb4-9"><a href="#cb4-9" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> pandas <span class="im">as</span> pd</span>
<span id="cb4-10"><a href="#cb4-10" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> geopandas <span class="im">as</span> gpd</span>
<span id="cb4-11"><a href="#cb4-11" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> pystac_client <span class="im">import</span> Client</span>
<span id="cb4-12"><a href="#cb4-12" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> planetary_computer <span class="im">as</span> pc  <span class="co"># For signing asset URLs</span></span>
<span id="cb4-13"><a href="#cb4-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-14"><a href="#cb4-14" aria-hidden="true" tabindex="-1"></a><span class="co"># Visualization</span></span>
<span id="cb4-15"><a href="#cb4-15" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> matplotlib.pyplot <span class="im">as</span> plt</span>
<span id="cb4-16"><a href="#cb4-16" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> folium</span>
<span id="cb4-17"><a href="#cb4-17" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> folium <span class="im">import</span> plugins</span>
<span id="cb4-18"><a href="#cb4-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-19"><a href="#cb4-19" aria-hidden="true" tabindex="-1"></a><span class="co"># Utilities</span></span>
<span id="cb4-20"><a href="#cb4-20" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> typing <span class="im">import</span> Dict, List, Tuple, Optional, Union</span>
<span id="cb4-21"><a href="#cb4-21" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> pathlib <span class="im">import</span> Path</span>
<span id="cb4-22"><a href="#cb4-22" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> json</span>
<span id="cb4-23"><a href="#cb4-23" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> time</span>
<span id="cb4-24"><a href="#cb4-24" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> datetime <span class="im">import</span> datetime, timedelta</span>
<span id="cb4-25"><a href="#cb4-25" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> logging</span>
<span id="cb4-26"><a href="#cb4-26" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-27"><a href="#cb4-27" aria-hidden="true" tabindex="-1"></a><span class="co"># Deep learning libraries</span></span>
<span id="cb4-28"><a href="#cb4-28" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> torch</span>
<span id="cb4-29"><a href="#cb4-29" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-30"><a href="#cb4-30" aria-hidden="true" tabindex="-1"></a><span class="co"># Configure matplotlib for publication-quality plots</span></span>
<span id="cb4-31"><a href="#cb4-31" aria-hidden="true" tabindex="-1"></a>plt.rcParams.update({</span>
<span id="cb4-32"><a href="#cb4-32" aria-hidden="true" tabindex="-1"></a>    <span class="st">'figure.figsize'</span>: (<span class="dv">10</span>, <span class="dv">6</span>),</span>
<span id="cb4-33"><a href="#cb4-33" aria-hidden="true" tabindex="-1"></a>    <span class="st">'figure.dpi'</span>: <span class="dv">100</span>,</span>
<span id="cb4-34"><a href="#cb4-34" aria-hidden="true" tabindex="-1"></a>    <span class="st">'font.size'</span>: <span class="dv">10</span>,</span>
<span id="cb4-35"><a href="#cb4-35" aria-hidden="true" tabindex="-1"></a>    <span class="st">'axes.titlesize'</span>: <span class="dv">12</span>,</span>
<span id="cb4-36"><a href="#cb4-36" aria-hidden="true" tabindex="-1"></a>    <span class="st">'axes.labelsize'</span>: <span class="dv">10</span>,</span>
<span id="cb4-37"><a href="#cb4-37" aria-hidden="true" tabindex="-1"></a>    <span class="st">'xtick.labelsize'</span>: <span class="dv">9</span>,</span>
<span id="cb4-38"><a href="#cb4-38" aria-hidden="true" tabindex="-1"></a>    <span class="st">'ytick.labelsize'</span>: <span class="dv">9</span>,</span>
<span id="cb4-39"><a href="#cb4-39" aria-hidden="true" tabindex="-1"></a>    <span class="st">'legend.fontsize'</span>: <span class="dv">9</span></span>
<span id="cb4-40"><a href="#cb4-40" aria-hidden="true" tabindex="-1"></a>})</span>
<span id="cb4-41"><a href="#cb4-41" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-42"><a href="#cb4-42" aria-hidden="true" tabindex="-1"></a><span class="co"># Configure logging for production-ready code</span></span>
<span id="cb4-43"><a href="#cb4-43" aria-hidden="true" tabindex="-1"></a>logging.basicConfig(level<span class="op">=</span>logging.INFO, <span class="bu">format</span><span class="op">=</span><span class="st">'</span><span class="sc">%(asctime)s</span><span class="st"> - </span><span class="sc">%(levelname)s</span><span class="st"> - </span><span class="sc">%(message)s</span><span class="st">'</span>)</span>
<span id="cb4-44"><a href="#cb4-44" aria-hidden="true" tabindex="-1"></a>logger <span class="op">=</span> logging.getLogger(<span class="va">__name__</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="geospatial-ai-toolkit-comprehensive-helper-functions" class="level3">
<h3 class="anchored" data-anchor-id="geospatial-ai-toolkit-comprehensive-helper-functions">Geospatial AI Toolkit: Comprehensive Helper Functions</h3>
<p>This chapter is organized to guide you through the essential foundations of geospatial data science and AI. The file is structured into clear sections, each focusing on a key aspect of the geospatial workflow:</p>
<ul>
<li><strong>Library Imports and Setup</strong>: All necessary Python packages are imported and configured for geospatial analysis and visualization.</li>
<li><strong>Helper Functions</strong>: Modular utility functions are introduced to streamline common geospatial tasks.</li>
<li><strong>Sectioned Capabilities</strong>: Each major capability (such as authentication, data access, and processing) is presented in its own section, with explanations of the underlying design patterns and best practices.</li>
<li><strong>Progressive Complexity</strong>: Concepts and code build on each other, moving from foundational tools to more advanced techniques.</li>
</ul>
<p>This structure is designed to help you understand not just how to use the tools, but also why certain architectural and security decisions are made—preparing you for both practical work and deeper learning as you progress through the course.</p>
</section>
</section>
<section id="section-1-stac-authentication-and-security" class="level2">
<h2 class="anchored" data-anchor-id="section-1-stac-authentication-and-security">Section 1: STAC Authentication and Security 🔐</h2>
<div class="callout callout-style-default callout-tip callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Learning Objectives
</div>
</div>
<div class="callout-body-container callout-body">
<ul>
<li>Understand API authentication patterns for production systems</li>
<li>Implement secure credential management for cloud services</li>
<li>Design robust authentication with fallback mechanisms</li>
<li>Apply enterprise security best practices to geospatial workflows</li>
</ul>
</div>
</div>
<section id="why-authentication-matters-in-geospatial-ai" class="level3">
<h3 class="anchored" data-anchor-id="why-authentication-matters-in-geospatial-ai">Why Authentication Matters in Geospatial AI</h3>
<p>Modern satellite data access relies on cloud-native APIs that require proper authentication for:</p>
<ul>
<li><strong>Rate Limit Management</strong>: Authenticated users get higher request quotas</li>
<li><strong>Access Control</strong>: Some datasets require institutional or commercial access</li>
<li><strong>Usage Tracking</strong>: Providers need to monitor and bill for data access</li>
<li><strong>Security</strong>: Prevents abuse and ensures sustainable data sharing</li>
</ul>
<div id="ffef71e0" class="cell" data-tangle="geogfm/c01.py" data-tangle-append="true" data-execution_count="4">
<div class="sourceCode cell-code" id="cb5"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> setup_planetary_computer_auth() <span class="op">-&gt;</span> <span class="bu">bool</span>:</span>
<span id="cb5-2"><a href="#cb5-2" aria-hidden="true" tabindex="-1"></a>    <span class="co">"""</span></span>
<span id="cb5-3"><a href="#cb5-3" aria-hidden="true" tabindex="-1"></a><span class="co">    Configure authentication for Microsoft Planetary Computer.</span></span>
<span id="cb5-4"><a href="#cb5-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-5"><a href="#cb5-5" aria-hidden="true" tabindex="-1"></a><span class="co">    Uses environment variables and .env files for credential discovery,</span></span>
<span id="cb5-6"><a href="#cb5-6" aria-hidden="true" tabindex="-1"></a><span class="co">    with graceful degradation to anonymous access.</span></span>
<span id="cb5-7"><a href="#cb5-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-8"><a href="#cb5-8" aria-hidden="true" tabindex="-1"></a><span class="co">    Returns</span></span>
<span id="cb5-9"><a href="#cb5-9" aria-hidden="true" tabindex="-1"></a><span class="co">    -------</span></span>
<span id="cb5-10"><a href="#cb5-10" aria-hidden="true" tabindex="-1"></a><span class="co">    bool</span></span>
<span id="cb5-11"><a href="#cb5-11" aria-hidden="true" tabindex="-1"></a><span class="co">        True if authenticated, False for anonymous access</span></span>
<span id="cb5-12"><a href="#cb5-12" aria-hidden="true" tabindex="-1"></a><span class="co">    """</span></span>
<span id="cb5-13"><a href="#cb5-13" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Try environment variables first (production)</span></span>
<span id="cb5-14"><a href="#cb5-14" aria-hidden="true" tabindex="-1"></a>    auth_key <span class="op">=</span> os.getenv(<span class="st">'PC_SDK_SUBSCRIPTION_KEY'</span>) <span class="kw">or</span> os.getenv(<span class="st">'PLANETARY_COMPUTER_API_KEY'</span>)</span>
<span id="cb5-15"><a href="#cb5-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-16"><a href="#cb5-16" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Fallback to .env file (development)</span></span>
<span id="cb5-17"><a href="#cb5-17" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> <span class="kw">not</span> auth_key:</span>
<span id="cb5-18"><a href="#cb5-18" aria-hidden="true" tabindex="-1"></a>        env_file <span class="op">=</span> Path(<span class="st">'.env'</span>)</span>
<span id="cb5-19"><a href="#cb5-19" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> env_file.exists():</span>
<span id="cb5-20"><a href="#cb5-20" aria-hidden="true" tabindex="-1"></a>            <span class="cf">try</span>:</span>
<span id="cb5-21"><a href="#cb5-21" aria-hidden="true" tabindex="-1"></a>                <span class="cf">with</span> <span class="bu">open</span>(env_file) <span class="im">as</span> f:</span>
<span id="cb5-22"><a href="#cb5-22" aria-hidden="true" tabindex="-1"></a>                    <span class="cf">for</span> line <span class="kw">in</span> f:</span>
<span id="cb5-23"><a href="#cb5-23" aria-hidden="true" tabindex="-1"></a>                        line <span class="op">=</span> line.strip()</span>
<span id="cb5-24"><a href="#cb5-24" aria-hidden="true" tabindex="-1"></a>                        <span class="cf">if</span> line.startswith((<span class="st">'PC_SDK_SUBSCRIPTION_KEY='</span>, <span class="st">'PLANETARY_COMPUTER_API_KEY='</span>)):</span>
<span id="cb5-25"><a href="#cb5-25" aria-hidden="true" tabindex="-1"></a>                            auth_key <span class="op">=</span> line.split(<span class="st">'='</span>, <span class="dv">1</span>)[<span class="dv">1</span>].strip().strip(<span class="st">'"</span><span class="ch">\'</span><span class="st">'</span>)</span>
<span id="cb5-26"><a href="#cb5-26" aria-hidden="true" tabindex="-1"></a>                            <span class="cf">break</span></span>
<span id="cb5-27"><a href="#cb5-27" aria-hidden="true" tabindex="-1"></a>            <span class="cf">except</span> <span class="pp">Exception</span>:</span>
<span id="cb5-28"><a href="#cb5-28" aria-hidden="true" tabindex="-1"></a>                <span class="cf">pass</span>  <span class="co"># Continue with anonymous access</span></span>
<span id="cb5-29"><a href="#cb5-29" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-30"><a href="#cb5-30" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Configure authentication</span></span>
<span id="cb5-31"><a href="#cb5-31" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> auth_key <span class="kw">and</span> <span class="bu">len</span>(auth_key) <span class="op">&gt;</span> <span class="dv">10</span>:</span>
<span id="cb5-32"><a href="#cb5-32" aria-hidden="true" tabindex="-1"></a>        <span class="cf">try</span>:</span>
<span id="cb5-33"><a href="#cb5-33" aria-hidden="true" tabindex="-1"></a>            pc.set_subscription_key(auth_key)</span>
<span id="cb5-34"><a href="#cb5-34" aria-hidden="true" tabindex="-1"></a>            logger.info(<span class="st">"Planetary Computer authentication successful"</span>)</span>
<span id="cb5-35"><a href="#cb5-35" aria-hidden="true" tabindex="-1"></a>            <span class="cf">return</span> <span class="va">True</span></span>
<span id="cb5-36"><a href="#cb5-36" aria-hidden="true" tabindex="-1"></a>        <span class="cf">except</span> <span class="pp">Exception</span> <span class="im">as</span> e:</span>
<span id="cb5-37"><a href="#cb5-37" aria-hidden="true" tabindex="-1"></a>            logger.warning(<span class="ss">f"Authentication failed: </span><span class="sc">{</span>e<span class="sc">}</span><span class="ss">"</span>)</span>
<span id="cb5-38"><a href="#cb5-38" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-39"><a href="#cb5-39" aria-hidden="true" tabindex="-1"></a>    logger.info(<span class="st">"Using anonymous access (basic rate limits)"</span>)</span>
<span id="cb5-40"><a href="#cb5-40" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> <span class="va">False</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div id="bc6134e7" class="cell" data-execution_count="5">
<div class="sourceCode cell-code" id="cb6"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb6-1"><a href="#cb6-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Initialize authentication</span></span>
<span id="cb6-2"><a href="#cb6-2" aria-hidden="true" tabindex="-1"></a>auth_status <span class="op">=</span> setup_planetary_computer_auth()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>2025-09-21 09:52:45,258 - INFO - Using anonymous access (basic rate limits)</code></pre>
</div>
</div>
<div class="callout callout-style-default callout-note callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Security Best Practices
</div>
</div>
<div class="callout-body-container callout-body">
<ul>
<li><strong>Never hardcode credentials</strong> in source code or notebooks</li>
<li><strong>Use environment variables</strong> for production deployments</li>
</ul>
</div>
</div>
<hr>
</section>
</section>
<section id="section-2-stac-data-discovery" class="level2">
<h2 class="anchored" data-anchor-id="section-2-stac-data-discovery">Section 2: STAC Data Discovery 🔍</h2>
<div class="callout callout-style-default callout-tip callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Learning Objectives
</div>
</div>
<div class="callout-body-container callout-body">
<ul>
<li>Master cloud-native data discovery patterns</li>
<li>Understand STAC query optimization strategies</li>
<li>Implement robust search with intelligent filtering</li>
<li>Design scalable data discovery for large-scale analysis</li>
</ul>
</div>
</div>
<section id="cloud-native-data-access-architecture" class="level3">
<h3 class="anchored" data-anchor-id="cloud-native-data-access-architecture">Cloud-Native Data Access Architecture</h3>
<p>STAC APIs represent a paradigm shift from traditional data distribution:</p>
<ul>
<li><strong>Federated Catalogs</strong>: Multiple providers, unified interface</li>
<li><strong>On-Demand Access</strong>: No need to download entire datasets</li>
<li><strong>Rich Metadata</strong>: Searchable properties for precise discovery</li>
<li><strong>Cloud Optimization</strong>: Direct access to cloud-optimized formats</li>
</ul>
<div id="22cb6b57" class="cell" data-tangle="geogfm/c01.py" data-tangle-append="true" data-execution_count="6">
<div class="sourceCode cell-code" id="cb8"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb8-1"><a href="#cb8-1" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> search_sentinel2_scenes(</span>
<span id="cb8-2"><a href="#cb8-2" aria-hidden="true" tabindex="-1"></a>    bbox: List[<span class="bu">float</span>],</span>
<span id="cb8-3"><a href="#cb8-3" aria-hidden="true" tabindex="-1"></a>    date_range: <span class="bu">str</span>,</span>
<span id="cb8-4"><a href="#cb8-4" aria-hidden="true" tabindex="-1"></a>    cloud_cover_max: <span class="bu">float</span> <span class="op">=</span> <span class="dv">20</span>,</span>
<span id="cb8-5"><a href="#cb8-5" aria-hidden="true" tabindex="-1"></a>    limit: <span class="bu">int</span> <span class="op">=</span> <span class="dv">10</span></span>
<span id="cb8-6"><a href="#cb8-6" aria-hidden="true" tabindex="-1"></a>) <span class="op">-&gt;</span> List:</span>
<span id="cb8-7"><a href="#cb8-7" aria-hidden="true" tabindex="-1"></a>    <span class="co">"""</span></span>
<span id="cb8-8"><a href="#cb8-8" aria-hidden="true" tabindex="-1"></a><span class="co">    Search Sentinel-2 Level 2A scenes using STAC API.</span></span>
<span id="cb8-9"><a href="#cb8-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-10"><a href="#cb8-10" aria-hidden="true" tabindex="-1"></a><span class="co">    Parameters</span></span>
<span id="cb8-11"><a href="#cb8-11" aria-hidden="true" tabindex="-1"></a><span class="co">    ----------</span></span>
<span id="cb8-12"><a href="#cb8-12" aria-hidden="true" tabindex="-1"></a><span class="co">    bbox : List[float]</span></span>
<span id="cb8-13"><a href="#cb8-13" aria-hidden="true" tabindex="-1"></a><span class="co">        Bounding box as [west, south, east, north] in WGS84</span></span>
<span id="cb8-14"><a href="#cb8-14" aria-hidden="true" tabindex="-1"></a><span class="co">    date_range : str</span></span>
<span id="cb8-15"><a href="#cb8-15" aria-hidden="true" tabindex="-1"></a><span class="co">        ISO date range: "YYYY-MM-DD/YYYY-MM-DD"</span></span>
<span id="cb8-16"><a href="#cb8-16" aria-hidden="true" tabindex="-1"></a><span class="co">    cloud_cover_max : float</span></span>
<span id="cb8-17"><a href="#cb8-17" aria-hidden="true" tabindex="-1"></a><span class="co">        Maximum cloud cover percentage</span></span>
<span id="cb8-18"><a href="#cb8-18" aria-hidden="true" tabindex="-1"></a><span class="co">    limit : int</span></span>
<span id="cb8-19"><a href="#cb8-19" aria-hidden="true" tabindex="-1"></a><span class="co">        Maximum scenes to return</span></span>
<span id="cb8-20"><a href="#cb8-20" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-21"><a href="#cb8-21" aria-hidden="true" tabindex="-1"></a><span class="co">    Returns</span></span>
<span id="cb8-22"><a href="#cb8-22" aria-hidden="true" tabindex="-1"></a><span class="co">    -------</span></span>
<span id="cb8-23"><a href="#cb8-23" aria-hidden="true" tabindex="-1"></a><span class="co">    List[pystac.Item]</span></span>
<span id="cb8-24"><a href="#cb8-24" aria-hidden="true" tabindex="-1"></a><span class="co">        List of STAC items sorted by cloud cover (ascending)</span></span>
<span id="cb8-25"><a href="#cb8-25" aria-hidden="true" tabindex="-1"></a><span class="co">    """</span></span>
<span id="cb8-26"><a href="#cb8-26" aria-hidden="true" tabindex="-1"></a>    catalog <span class="op">=</span> Client.<span class="bu">open</span>(</span>
<span id="cb8-27"><a href="#cb8-27" aria-hidden="true" tabindex="-1"></a>        <span class="st">"https://planetarycomputer.microsoft.com/api/stac/v1"</span>,</span>
<span id="cb8-28"><a href="#cb8-28" aria-hidden="true" tabindex="-1"></a>        modifier<span class="op">=</span>pc.sign_inplace</span>
<span id="cb8-29"><a href="#cb8-29" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb8-30"><a href="#cb8-30" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-31"><a href="#cb8-31" aria-hidden="true" tabindex="-1"></a>    search_params <span class="op">=</span> {</span>
<span id="cb8-32"><a href="#cb8-32" aria-hidden="true" tabindex="-1"></a>        <span class="st">"collections"</span>: [<span class="st">"sentinel-2-l2a"</span>],</span>
<span id="cb8-33"><a href="#cb8-33" aria-hidden="true" tabindex="-1"></a>        <span class="st">"bbox"</span>: bbox,</span>
<span id="cb8-34"><a href="#cb8-34" aria-hidden="true" tabindex="-1"></a>        <span class="st">"datetime"</span>: date_range,</span>
<span id="cb8-35"><a href="#cb8-35" aria-hidden="true" tabindex="-1"></a>        <span class="st">"query"</span>: {<span class="st">"eo:cloud_cover"</span>: {<span class="st">"lt"</span>: cloud_cover_max}},</span>
<span id="cb8-36"><a href="#cb8-36" aria-hidden="true" tabindex="-1"></a>        <span class="st">"limit"</span>: limit</span>
<span id="cb8-37"><a href="#cb8-37" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb8-38"><a href="#cb8-38" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-39"><a href="#cb8-39" aria-hidden="true" tabindex="-1"></a>    search_results <span class="op">=</span> catalog.search(<span class="op">**</span>search_params)</span>
<span id="cb8-40"><a href="#cb8-40" aria-hidden="true" tabindex="-1"></a>    items <span class="op">=</span> <span class="bu">list</span>(search_results.items())</span>
<span id="cb8-41"><a href="#cb8-41" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-42"><a href="#cb8-42" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Sort by cloud cover (best quality first)</span></span>
<span id="cb8-43"><a href="#cb8-43" aria-hidden="true" tabindex="-1"></a>    items.sort(key<span class="op">=</span><span class="kw">lambda</span> x: x.properties.get(<span class="st">'eo:cloud_cover'</span>, <span class="dv">100</span>))</span>
<span id="cb8-44"><a href="#cb8-44" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-45"><a href="#cb8-45" aria-hidden="true" tabindex="-1"></a>    logger.info(<span class="ss">f"Found </span><span class="sc">{</span><span class="bu">len</span>(items)<span class="sc">}</span><span class="ss"> Sentinel-2 scenes (cloud cover &lt; </span><span class="sc">{</span>cloud_cover_max<span class="sc">}</span><span class="ss">%)"</span>)</span>
<span id="cb8-46"><a href="#cb8-46" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> items</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="callout callout-style-default callout-note callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Query Optimization Strategies
</div>
</div>
<div class="callout-body-container callout-body">
<ul>
<li><strong>Spatial Indexing</strong>: STAC APIs use spatial indices for fast geographic queries</li>
<li><strong>Temporal Partitioning</strong>: Date-based organization enables efficient time series queries</li>
<li><strong>Property Filtering</strong>: Server-side filtering reduces network transfer</li>
<li><strong>Result Ranking</strong>: Sort by quality metrics (cloud cover, viewing angle) for best-first selection</li>
</ul>
</div>
</div>
<hr>
</section>
</section>
<section id="section-3-intelligent-data-loading" class="level2">
<h2 class="anchored" data-anchor-id="section-3-intelligent-data-loading">Section 3: Intelligent Data Loading 📥</h2>
<div class="callout callout-style-default callout-tip callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Learning Objectives
</div>
</div>
<div class="callout-body-container callout-body">
<ul>
<li>Implement memory-efficient satellite data loading</li>
<li>Master coordinate reference system (CRS) transformations</li>
<li>Design robust error handling for network operations</li>
<li>Optimize data transfer with intelligent subsetting</li>
</ul>
</div>
</div>
<section id="memory-management-in-satellite-data-processing" class="level3">
<h3 class="anchored" data-anchor-id="memory-management-in-satellite-data-processing">Memory Management in Satellite Data Processing</h3>
<p>Satellite scenes can be massive (&gt;1GB per scene), requiring intelligent loading strategies:</p>
<ul>
<li><strong>Lazy Loading</strong>: Load only when needed, not during search</li>
<li><strong>Subset Loading</strong>: Extract regions of interest to reduce memory footprint</li>
<li><strong>Progressive Loading</strong>: Handle multi-resolution data efficiently</li>
<li><strong>Error Recovery</strong>: Robust handling of network interruptions</li>
</ul>
<div id="fbeb44dc" class="cell" data-tangle="geogfm/c01.py" data-tangle-append="true" data-execution_count="7">
<div class="sourceCode cell-code" id="cb9"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb9-1"><a href="#cb9-1" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> load_sentinel2_bands(</span>
<span id="cb9-2"><a href="#cb9-2" aria-hidden="true" tabindex="-1"></a>    item,</span>
<span id="cb9-3"><a href="#cb9-3" aria-hidden="true" tabindex="-1"></a>    bands: List[<span class="bu">str</span>] <span class="op">=</span> [<span class="st">'B04'</span>, <span class="st">'B03'</span>, <span class="st">'B02'</span>, <span class="st">'B08'</span>],</span>
<span id="cb9-4"><a href="#cb9-4" aria-hidden="true" tabindex="-1"></a>    subset_bbox: Optional[List[<span class="bu">float</span>]] <span class="op">=</span> <span class="va">None</span>,</span>
<span id="cb9-5"><a href="#cb9-5" aria-hidden="true" tabindex="-1"></a>    max_retries: <span class="bu">int</span> <span class="op">=</span> <span class="dv">3</span></span>
<span id="cb9-6"><a href="#cb9-6" aria-hidden="true" tabindex="-1"></a>) <span class="op">-&gt;</span> Dict[<span class="bu">str</span>, Union[np.ndarray, <span class="bu">str</span>]]:</span>
<span id="cb9-7"><a href="#cb9-7" aria-hidden="true" tabindex="-1"></a>    <span class="co">"""</span></span>
<span id="cb9-8"><a href="#cb9-8" aria-hidden="true" tabindex="-1"></a><span class="co">    Load Sentinel-2 bands with optional spatial subsetting.</span></span>
<span id="cb9-9"><a href="#cb9-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-10"><a href="#cb9-10" aria-hidden="true" tabindex="-1"></a><span class="co">    Parameters</span></span>
<span id="cb9-11"><a href="#cb9-11" aria-hidden="true" tabindex="-1"></a><span class="co">    ----------</span></span>
<span id="cb9-12"><a href="#cb9-12" aria-hidden="true" tabindex="-1"></a><span class="co">    item : pystac.Item</span></span>
<span id="cb9-13"><a href="#cb9-13" aria-hidden="true" tabindex="-1"></a><span class="co">        STAC item representing the satellite scene</span></span>
<span id="cb9-14"><a href="#cb9-14" aria-hidden="true" tabindex="-1"></a><span class="co">    bands : List[str]</span></span>
<span id="cb9-15"><a href="#cb9-15" aria-hidden="true" tabindex="-1"></a><span class="co">        Spectral bands to load</span></span>
<span id="cb9-16"><a href="#cb9-16" aria-hidden="true" tabindex="-1"></a><span class="co">    subset_bbox : Optional[List[float]]</span></span>
<span id="cb9-17"><a href="#cb9-17" aria-hidden="true" tabindex="-1"></a><span class="co">        Spatial subset as [west, south, east, north] in WGS84</span></span>
<span id="cb9-18"><a href="#cb9-18" aria-hidden="true" tabindex="-1"></a><span class="co">    max_retries : int</span></span>
<span id="cb9-19"><a href="#cb9-19" aria-hidden="true" tabindex="-1"></a><span class="co">        Number of retry attempts per band</span></span>
<span id="cb9-20"><a href="#cb9-20" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-21"><a href="#cb9-21" aria-hidden="true" tabindex="-1"></a><span class="co">    Returns</span></span>
<span id="cb9-22"><a href="#cb9-22" aria-hidden="true" tabindex="-1"></a><span class="co">    -------</span></span>
<span id="cb9-23"><a href="#cb9-23" aria-hidden="true" tabindex="-1"></a><span class="co">    Dict[str, Union[np.ndarray, str]]</span></span>
<span id="cb9-24"><a href="#cb9-24" aria-hidden="true" tabindex="-1"></a><span class="co">        Band arrays plus georeferencing metadata</span></span>
<span id="cb9-25"><a href="#cb9-25" aria-hidden="true" tabindex="-1"></a><span class="co">    """</span></span>
<span id="cb9-26"><a href="#cb9-26" aria-hidden="true" tabindex="-1"></a>    <span class="im">from</span> rasterio.windows <span class="im">import</span> from_bounds</span>
<span id="cb9-27"><a href="#cb9-27" aria-hidden="true" tabindex="-1"></a>    <span class="im">from</span> rasterio.warp <span class="im">import</span> transform_bounds</span>
<span id="cb9-28"><a href="#cb9-28" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-29"><a href="#cb9-29" aria-hidden="true" tabindex="-1"></a>    band_data <span class="op">=</span> {}</span>
<span id="cb9-30"><a href="#cb9-30" aria-hidden="true" tabindex="-1"></a>    successful_bands <span class="op">=</span> []</span>
<span id="cb9-31"><a href="#cb9-31" aria-hidden="true" tabindex="-1"></a>    failed_bands <span class="op">=</span> []</span>
<span id="cb9-32"><a href="#cb9-32" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-33"><a href="#cb9-33" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> band_name <span class="kw">in</span> bands:</span>
<span id="cb9-34"><a href="#cb9-34" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> band_name <span class="kw">not</span> <span class="kw">in</span> item.assets:</span>
<span id="cb9-35"><a href="#cb9-35" aria-hidden="true" tabindex="-1"></a>            failed_bands.append(band_name)</span>
<span id="cb9-36"><a href="#cb9-36" aria-hidden="true" tabindex="-1"></a>            <span class="cf">continue</span></span>
<span id="cb9-37"><a href="#cb9-37" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-38"><a href="#cb9-38" aria-hidden="true" tabindex="-1"></a>        asset_url <span class="op">=</span> item.assets[band_name].href</span>
<span id="cb9-39"><a href="#cb9-39" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-40"><a href="#cb9-40" aria-hidden="true" tabindex="-1"></a>        <span class="co"># Retry logic with exponential backoff</span></span>
<span id="cb9-41"><a href="#cb9-41" aria-hidden="true" tabindex="-1"></a>        <span class="cf">for</span> attempt <span class="kw">in</span> <span class="bu">range</span>(max_retries):</span>
<span id="cb9-42"><a href="#cb9-42" aria-hidden="true" tabindex="-1"></a>            <span class="cf">try</span>:</span>
<span id="cb9-43"><a href="#cb9-43" aria-hidden="true" tabindex="-1"></a>                <span class="co"># URL signing for authenticated access</span></span>
<span id="cb9-44"><a href="#cb9-44" aria-hidden="true" tabindex="-1"></a>                signed_url <span class="op">=</span> pc.sign(asset_url)</span>
<span id="cb9-45"><a href="#cb9-45" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-46"><a href="#cb9-46" aria-hidden="true" tabindex="-1"></a>                <span class="co"># Memory-efficient loading with rasterio</span></span>
<span id="cb9-47"><a href="#cb9-47" aria-hidden="true" tabindex="-1"></a>                <span class="cf">with</span> rasterio.<span class="bu">open</span>(signed_url) <span class="im">as</span> src:</span>
<span id="cb9-48"><a href="#cb9-48" aria-hidden="true" tabindex="-1"></a>                    <span class="co"># Validate data source</span></span>
<span id="cb9-49"><a href="#cb9-49" aria-hidden="true" tabindex="-1"></a>                    <span class="cf">if</span> src.width <span class="op">==</span> <span class="dv">0</span> <span class="kw">or</span> src.height <span class="op">==</span> <span class="dv">0</span>:</span>
<span id="cb9-50"><a href="#cb9-50" aria-hidden="true" tabindex="-1"></a>                        <span class="cf">raise</span> <span class="pp">ValueError</span>(<span class="ss">f"Invalid raster dimensions: </span><span class="sc">{</span>src<span class="sc">.</span>width<span class="sc">}</span><span class="ss">x</span><span class="sc">{</span>src<span class="sc">.</span>height<span class="sc">}</span><span class="ss">"</span>)</span>
<span id="cb9-51"><a href="#cb9-51" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-52"><a href="#cb9-52" aria-hidden="true" tabindex="-1"></a>                    <span class="cf">if</span> subset_bbox:</span>
<span id="cb9-53"><a href="#cb9-53" aria-hidden="true" tabindex="-1"></a>                        <span class="co"># Intelligent subsetting with CRS transformation</span></span>
<span id="cb9-54"><a href="#cb9-54" aria-hidden="true" tabindex="-1"></a>                        <span class="cf">try</span>:</span>
<span id="cb9-55"><a href="#cb9-55" aria-hidden="true" tabindex="-1"></a>                            <span class="co"># Transform bbox to source CRS if needed</span></span>
<span id="cb9-56"><a href="#cb9-56" aria-hidden="true" tabindex="-1"></a>                            <span class="cf">if</span> src.crs <span class="op">!=</span> rasterio.crs.CRS.from_epsg(<span class="dv">4326</span>):</span>
<span id="cb9-57"><a href="#cb9-57" aria-hidden="true" tabindex="-1"></a>                                subset_bbox_src_crs <span class="op">=</span> transform_bounds(</span>
<span id="cb9-58"><a href="#cb9-58" aria-hidden="true" tabindex="-1"></a>                                    rasterio.crs.CRS.from_epsg(<span class="dv">4326</span>), src.crs, <span class="op">*</span>subset_bbox</span>
<span id="cb9-59"><a href="#cb9-59" aria-hidden="true" tabindex="-1"></a>                                )</span>
<span id="cb9-60"><a href="#cb9-60" aria-hidden="true" tabindex="-1"></a>                            <span class="cf">else</span>:</span>
<span id="cb9-61"><a href="#cb9-61" aria-hidden="true" tabindex="-1"></a>                                subset_bbox_src_crs <span class="op">=</span> subset_bbox</span>
<span id="cb9-62"><a href="#cb9-62" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-63"><a href="#cb9-63" aria-hidden="true" tabindex="-1"></a>                            <span class="co"># Calculate reading window</span></span>
<span id="cb9-64"><a href="#cb9-64" aria-hidden="true" tabindex="-1"></a>                            window <span class="op">=</span> from_bounds(<span class="op">*</span>subset_bbox_src_crs, src.transform)</span>
<span id="cb9-65"><a href="#cb9-65" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-66"><a href="#cb9-66" aria-hidden="true" tabindex="-1"></a>                            <span class="co"># Ensure window is within raster bounds</span></span>
<span id="cb9-67"><a href="#cb9-67" aria-hidden="true" tabindex="-1"></a>                            window <span class="op">=</span> window.intersection(</span>
<span id="cb9-68"><a href="#cb9-68" aria-hidden="true" tabindex="-1"></a>                                rasterio.windows.Window(<span class="dv">0</span>, <span class="dv">0</span>, src.width, src.height)</span>
<span id="cb9-69"><a href="#cb9-69" aria-hidden="true" tabindex="-1"></a>                            )</span>
<span id="cb9-70"><a href="#cb9-70" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-71"><a href="#cb9-71" aria-hidden="true" tabindex="-1"></a>                            <span class="cf">if</span> window.width <span class="op">&gt;</span> <span class="dv">0</span> <span class="kw">and</span> window.height <span class="op">&gt;</span> <span class="dv">0</span>:</span>
<span id="cb9-72"><a href="#cb9-72" aria-hidden="true" tabindex="-1"></a>                                data <span class="op">=</span> src.read(<span class="dv">1</span>, window<span class="op">=</span>window)</span>
<span id="cb9-73"><a href="#cb9-73" aria-hidden="true" tabindex="-1"></a>                                transform <span class="op">=</span> src.window_transform(window)</span>
<span id="cb9-74"><a href="#cb9-74" aria-hidden="true" tabindex="-1"></a>                                bounds <span class="op">=</span> rasterio.windows.bounds(window, src.transform)</span>
<span id="cb9-75"><a href="#cb9-75" aria-hidden="true" tabindex="-1"></a>                                <span class="cf">if</span> src.crs <span class="op">!=</span> rasterio.crs.CRS.from_epsg(<span class="dv">4326</span>):</span>
<span id="cb9-76"><a href="#cb9-76" aria-hidden="true" tabindex="-1"></a>                                    bounds <span class="op">=</span> transform_bounds(src.crs, rasterio.crs.CRS.from_epsg(<span class="dv">4326</span>), <span class="op">*</span>bounds)</span>
<span id="cb9-77"><a href="#cb9-77" aria-hidden="true" tabindex="-1"></a>                            <span class="cf">else</span>:</span>
<span id="cb9-78"><a href="#cb9-78" aria-hidden="true" tabindex="-1"></a>                                <span class="co"># Fall back to full scene</span></span>
<span id="cb9-79"><a href="#cb9-79" aria-hidden="true" tabindex="-1"></a>                                data <span class="op">=</span> src.read(<span class="dv">1</span>)</span>
<span id="cb9-80"><a href="#cb9-80" aria-hidden="true" tabindex="-1"></a>                                transform <span class="op">=</span> src.transform</span>
<span id="cb9-81"><a href="#cb9-81" aria-hidden="true" tabindex="-1"></a>                                bounds <span class="op">=</span> src.bounds</span>
<span id="cb9-82"><a href="#cb9-82" aria-hidden="true" tabindex="-1"></a>                        <span class="cf">except</span> <span class="pp">Exception</span>:</span>
<span id="cb9-83"><a href="#cb9-83" aria-hidden="true" tabindex="-1"></a>                            <span class="co"># Fall back to full scene on subset error</span></span>
<span id="cb9-84"><a href="#cb9-84" aria-hidden="true" tabindex="-1"></a>                            data <span class="op">=</span> src.read(<span class="dv">1</span>)</span>
<span id="cb9-85"><a href="#cb9-85" aria-hidden="true" tabindex="-1"></a>                            transform <span class="op">=</span> src.transform</span>
<span id="cb9-86"><a href="#cb9-86" aria-hidden="true" tabindex="-1"></a>                            bounds <span class="op">=</span> src.bounds</span>
<span id="cb9-87"><a href="#cb9-87" aria-hidden="true" tabindex="-1"></a>                    <span class="cf">else</span>:</span>
<span id="cb9-88"><a href="#cb9-88" aria-hidden="true" tabindex="-1"></a>                        <span class="co"># Load full scene</span></span>
<span id="cb9-89"><a href="#cb9-89" aria-hidden="true" tabindex="-1"></a>                        data <span class="op">=</span> src.read(<span class="dv">1</span>)</span>
<span id="cb9-90"><a href="#cb9-90" aria-hidden="true" tabindex="-1"></a>                        transform <span class="op">=</span> src.transform</span>
<span id="cb9-91"><a href="#cb9-91" aria-hidden="true" tabindex="-1"></a>                        bounds <span class="op">=</span> src.bounds</span>
<span id="cb9-92"><a href="#cb9-92" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-93"><a href="#cb9-93" aria-hidden="true" tabindex="-1"></a>                    <span class="cf">if</span> data.size <span class="op">==</span> <span class="dv">0</span>:</span>
<span id="cb9-94"><a href="#cb9-94" aria-hidden="true" tabindex="-1"></a>                        <span class="cf">raise</span> <span class="pp">ValueError</span>(<span class="st">"Loaded data has zero size"</span>)</span>
<span id="cb9-95"><a href="#cb9-95" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-96"><a href="#cb9-96" aria-hidden="true" tabindex="-1"></a>                    <span class="co"># Store band data and metadata</span></span>
<span id="cb9-97"><a href="#cb9-97" aria-hidden="true" tabindex="-1"></a>                    band_data[band_name] <span class="op">=</span> data</span>
<span id="cb9-98"><a href="#cb9-98" aria-hidden="true" tabindex="-1"></a>                    <span class="cf">if</span> <span class="st">'transform'</span> <span class="kw">not</span> <span class="kw">in</span> band_data:</span>
<span id="cb9-99"><a href="#cb9-99" aria-hidden="true" tabindex="-1"></a>                        band_data.update({</span>
<span id="cb9-100"><a href="#cb9-100" aria-hidden="true" tabindex="-1"></a>                            <span class="st">'transform'</span>: transform,</span>
<span id="cb9-101"><a href="#cb9-101" aria-hidden="true" tabindex="-1"></a>                            <span class="st">'crs'</span>: src.crs,</span>
<span id="cb9-102"><a href="#cb9-102" aria-hidden="true" tabindex="-1"></a>                            <span class="st">'bounds'</span>: bounds,</span>
<span id="cb9-103"><a href="#cb9-103" aria-hidden="true" tabindex="-1"></a>                            <span class="st">'scene_id'</span>: item.<span class="bu">id</span>,</span>
<span id="cb9-104"><a href="#cb9-104" aria-hidden="true" tabindex="-1"></a>                            <span class="st">'date'</span>: item.properties[<span class="st">'datetime'</span>].split(<span class="st">'T'</span>)[<span class="dv">0</span>]</span>
<span id="cb9-105"><a href="#cb9-105" aria-hidden="true" tabindex="-1"></a>                        })</span>
<span id="cb9-106"><a href="#cb9-106" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-107"><a href="#cb9-107" aria-hidden="true" tabindex="-1"></a>                    successful_bands.append(band_name)</span>
<span id="cb9-108"><a href="#cb9-108" aria-hidden="true" tabindex="-1"></a>                    <span class="cf">break</span></span>
<span id="cb9-109"><a href="#cb9-109" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-110"><a href="#cb9-110" aria-hidden="true" tabindex="-1"></a>            <span class="cf">except</span> <span class="pp">Exception</span> <span class="im">as</span> e:</span>
<span id="cb9-111"><a href="#cb9-111" aria-hidden="true" tabindex="-1"></a>                <span class="cf">if</span> attempt <span class="op">&lt;</span> max_retries <span class="op">-</span> <span class="dv">1</span>:</span>
<span id="cb9-112"><a href="#cb9-112" aria-hidden="true" tabindex="-1"></a>                    time.sleep(<span class="dv">2</span> <span class="op">**</span> attempt)  <span class="co"># Exponential backoff</span></span>
<span id="cb9-113"><a href="#cb9-113" aria-hidden="true" tabindex="-1"></a>                    <span class="cf">continue</span></span>
<span id="cb9-114"><a href="#cb9-114" aria-hidden="true" tabindex="-1"></a>                <span class="cf">else</span>:</span>
<span id="cb9-115"><a href="#cb9-115" aria-hidden="true" tabindex="-1"></a>                    failed_bands.append(band_name)</span>
<span id="cb9-116"><a href="#cb9-116" aria-hidden="true" tabindex="-1"></a>                    logger.warning(<span class="ss">f"Failed to load band </span><span class="sc">{</span>band_name<span class="sc">}</span><span class="ss">: </span><span class="sc">{</span><span class="bu">str</span>(e)[:<span class="dv">50</span>]<span class="sc">}</span><span class="ss">"</span>)</span>
<span id="cb9-117"><a href="#cb9-117" aria-hidden="true" tabindex="-1"></a>                    <span class="cf">break</span></span>
<span id="cb9-118"><a href="#cb9-118" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-119"><a href="#cb9-119" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Validate results</span></span>
<span id="cb9-120"><a href="#cb9-120" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> <span class="bu">len</span>(successful_bands) <span class="op">==</span> <span class="dv">0</span>:</span>
<span id="cb9-121"><a href="#cb9-121" aria-hidden="true" tabindex="-1"></a>        <span class="cf">raise</span> <span class="pp">Exception</span>(<span class="ss">f"Failed to load any bands from scene </span><span class="sc">{</span>item<span class="sc">.</span><span class="bu">id</span><span class="sc">}</span><span class="ss">"</span>)</span>
<span id="cb9-122"><a href="#cb9-122" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-123"><a href="#cb9-123" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> failed_bands:</span>
<span id="cb9-124"><a href="#cb9-124" aria-hidden="true" tabindex="-1"></a>        logger.warning(<span class="ss">f"Failed to load </span><span class="sc">{</span><span class="bu">len</span>(failed_bands)<span class="sc">}</span><span class="ss"> bands: </span><span class="sc">{</span>failed_bands<span class="sc">}</span><span class="ss">"</span>)</span>
<span id="cb9-125"><a href="#cb9-125" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-126"><a href="#cb9-126" aria-hidden="true" tabindex="-1"></a>    logger.info(<span class="ss">f"Successfully loaded </span><span class="sc">{</span><span class="bu">len</span>(successful_bands)<span class="sc">}</span><span class="ss"> bands: </span><span class="sc">{</span>successful_bands<span class="sc">}</span><span class="ss">"</span>)</span>
<span id="cb9-127"><a href="#cb9-127" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> band_data</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="callout callout-style-default callout-note callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Memory Management Best Practices
</div>
</div>
<div class="callout-body-container callout-body">
<ul>
<li><strong>Use windowed reading</strong> for large rasters to control memory usage</li>
<li><strong>Load bands on-demand</strong> rather than all at once</li>
<li><strong>Implement progress monitoring</strong> for user feedback during long operations</li>
<li><strong>Handle CRS transformations</strong> automatically to ensure spatial consistency</li>
<li><strong>Cache georeferencing metadata</strong> to avoid redundant I/O operations</li>
</ul>
</div>
</div>
<hr>
</section>
</section>
<section id="section-4-scene-processing-and-subsetting" class="level2">
<h2 class="anchored" data-anchor-id="section-4-scene-processing-and-subsetting">Section 4: Scene Processing and Subsetting 📐</h2>
<div class="callout callout-style-default callout-tip callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Learning Objectives
</div>
</div>
<div class="callout-body-container callout-body">
<ul>
<li>Master percentage-based spatial subsetting for reproducible analysis</li>
<li>Understand scene geometry and coordinate system implications</li>
<li>Design scalable spatial partitioning strategies</li>
<li>Implement adaptive processing based on scene characteristics</li>
</ul>
</div>
</div>
<section id="spatial-reasoning-in-satellite-data-analysis" class="level3">
<h3 class="anchored" data-anchor-id="spatial-reasoning-in-satellite-data-analysis">Spatial Reasoning in Satellite Data Analysis</h3>
<p>Satellite scenes come in various sizes and projections, requiring intelligent spatial handling:</p>
<ul>
<li><strong>Percentage-Based Subsetting</strong>: Resolution-independent spatial cropping</li>
<li><strong>Adaptive Processing</strong>: Adjust strategies based on scene characteristics</li>
<li><strong>Spatial Metadata</strong>: Consistent georeferencing across operations</li>
<li><strong>Tiling Strategies</strong>: Partition large scenes for parallel processing</li>
</ul>
<div id="9a891274" class="cell" data-execution_count="8">
<div class="sourceCode cell-code" id="cb10"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb10-1"><a href="#cb10-1" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> get_subset_from_scene(</span>
<span id="cb10-2"><a href="#cb10-2" aria-hidden="true" tabindex="-1"></a>    item,</span>
<span id="cb10-3"><a href="#cb10-3" aria-hidden="true" tabindex="-1"></a>    x_range: Tuple[<span class="bu">float</span>, <span class="bu">float</span>] <span class="op">=</span> (<span class="dv">25</span>, <span class="dv">75</span>),</span>
<span id="cb10-4"><a href="#cb10-4" aria-hidden="true" tabindex="-1"></a>    y_range: Tuple[<span class="bu">float</span>, <span class="bu">float</span>] <span class="op">=</span> (<span class="dv">25</span>, <span class="dv">75</span>)</span>
<span id="cb10-5"><a href="#cb10-5" aria-hidden="true" tabindex="-1"></a>) <span class="op">-&gt;</span> List[<span class="bu">float</span>]:</span>
<span id="cb10-6"><a href="#cb10-6" aria-hidden="true" tabindex="-1"></a>    <span class="co">"""</span></span>
<span id="cb10-7"><a href="#cb10-7" aria-hidden="true" tabindex="-1"></a><span class="co">    Intelligent spatial subsetting using percentage-based coordinates.</span></span>
<span id="cb10-8"><a href="#cb10-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-9"><a href="#cb10-9" aria-hidden="true" tabindex="-1"></a><span class="co">    This approach provides several advantages:</span></span>
<span id="cb10-10"><a href="#cb10-10" aria-hidden="true" tabindex="-1"></a><span class="co">    1. Resolution Independence: Works regardless of scene size or pixel resolution</span></span>
<span id="cb10-11"><a href="#cb10-11" aria-hidden="true" tabindex="-1"></a><span class="co">    2. Reproducibility: Same percentage always gives same relative location</span></span>
<span id="cb10-12"><a href="#cb10-12" aria-hidden="true" tabindex="-1"></a><span class="co">    3. Scalability: Easy to create systematic grids for batch processing</span></span>
<span id="cb10-13"><a href="#cb10-13" aria-hidden="true" tabindex="-1"></a><span class="co">    4. Adaptability: Can adjust subset size based on scene characteristics</span></span>
<span id="cb10-14"><a href="#cb10-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-15"><a href="#cb10-15" aria-hidden="true" tabindex="-1"></a><span class="co">    Parameters</span></span>
<span id="cb10-16"><a href="#cb10-16" aria-hidden="true" tabindex="-1"></a><span class="co">    ----------</span></span>
<span id="cb10-17"><a href="#cb10-17" aria-hidden="true" tabindex="-1"></a><span class="co">    item : pystac.Item</span></span>
<span id="cb10-18"><a href="#cb10-18" aria-hidden="true" tabindex="-1"></a><span class="co">        STAC item containing scene geometry</span></span>
<span id="cb10-19"><a href="#cb10-19" aria-hidden="true" tabindex="-1"></a><span class="co">    x_range : Tuple[float, float]</span></span>
<span id="cb10-20"><a href="#cb10-20" aria-hidden="true" tabindex="-1"></a><span class="co">        Longitude percentage range (0-100)</span></span>
<span id="cb10-21"><a href="#cb10-21" aria-hidden="true" tabindex="-1"></a><span class="co">    y_range : Tuple[float, float]</span></span>
<span id="cb10-22"><a href="#cb10-22" aria-hidden="true" tabindex="-1"></a><span class="co">        Latitude percentage range (0-100)</span></span>
<span id="cb10-23"><a href="#cb10-23" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-24"><a href="#cb10-24" aria-hidden="true" tabindex="-1"></a><span class="co">    Returns</span></span>
<span id="cb10-25"><a href="#cb10-25" aria-hidden="true" tabindex="-1"></a><span class="co">    -------</span></span>
<span id="cb10-26"><a href="#cb10-26" aria-hidden="true" tabindex="-1"></a><span class="co">    List[float]</span></span>
<span id="cb10-27"><a href="#cb10-27" aria-hidden="true" tabindex="-1"></a><span class="co">        Subset bounding box [west, south, east, north] in WGS84</span></span>
<span id="cb10-28"><a href="#cb10-28" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-29"><a href="#cb10-29" aria-hidden="true" tabindex="-1"></a><span class="co">    Design Pattern: Template Method with Spatial Reasoning</span></span>
<span id="cb10-30"><a href="#cb10-30" aria-hidden="true" tabindex="-1"></a><span class="co">    - Provides consistent interface for varied spatial operations</span></span>
<span id="cb10-31"><a href="#cb10-31" aria-hidden="true" tabindex="-1"></a><span class="co">    - Encapsulates coordinate system complexity</span></span>
<span id="cb10-32"><a href="#cb10-32" aria-hidden="true" tabindex="-1"></a><span class="co">    - Enables systematic spatial sampling strategies</span></span>
<span id="cb10-33"><a href="#cb10-33" aria-hidden="true" tabindex="-1"></a><span class="co">    """</span></span>
<span id="cb10-34"><a href="#cb10-34" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Extract scene geometry from STAC metadata</span></span>
<span id="cb10-35"><a href="#cb10-35" aria-hidden="true" tabindex="-1"></a>    scene_bbox <span class="op">=</span> item.bbox  <span class="co"># [west, south, east, north]</span></span>
<span id="cb10-36"><a href="#cb10-36" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-37"><a href="#cb10-37" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Input validation for percentage ranges</span></span>
<span id="cb10-38"><a href="#cb10-38" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> <span class="kw">not</span> (<span class="dv">0</span> <span class="op">&lt;=</span> x_range[<span class="dv">0</span>] <span class="op">&lt;</span> x_range[<span class="dv">1</span>] <span class="op">&lt;=</span> <span class="dv">100</span>):</span>
<span id="cb10-39"><a href="#cb10-39" aria-hidden="true" tabindex="-1"></a>        <span class="cf">raise</span> <span class="pp">ValueError</span>(<span class="ss">f"Invalid x_range: </span><span class="sc">{</span>x_range<span class="sc">}</span><span class="ss">. Must be (min, max) with 0 &lt;= min &lt; max &lt;= 100"</span>)</span>
<span id="cb10-40"><a href="#cb10-40" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> <span class="kw">not</span> (<span class="dv">0</span> <span class="op">&lt;=</span> y_range[<span class="dv">0</span>] <span class="op">&lt;</span> y_range[<span class="dv">1</span>] <span class="op">&lt;=</span> <span class="dv">100</span>):</span>
<span id="cb10-41"><a href="#cb10-41" aria-hidden="true" tabindex="-1"></a>        <span class="cf">raise</span> <span class="pp">ValueError</span>(<span class="ss">f"Invalid y_range: </span><span class="sc">{</span>y_range<span class="sc">}</span><span class="ss">. Must be (min, max) with 0 &lt;= min &lt; max &lt;= 100"</span>)</span>
<span id="cb10-42"><a href="#cb10-42" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-43"><a href="#cb10-43" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Calculate scene dimensions in geographic coordinates</span></span>
<span id="cb10-44"><a href="#cb10-44" aria-hidden="true" tabindex="-1"></a>    scene_width <span class="op">=</span> scene_bbox[<span class="dv">2</span>] <span class="op">-</span> scene_bbox[<span class="dv">0</span>]   <span class="co"># east - west</span></span>
<span id="cb10-45"><a href="#cb10-45" aria-hidden="true" tabindex="-1"></a>    scene_height <span class="op">=</span> scene_bbox[<span class="dv">3</span>] <span class="op">-</span> scene_bbox[<span class="dv">1</span>]  <span class="co"># north - south</span></span>
<span id="cb10-46"><a href="#cb10-46" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-47"><a href="#cb10-47" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Convert percentages to geographic coordinates</span></span>
<span id="cb10-48"><a href="#cb10-48" aria-hidden="true" tabindex="-1"></a>    west <span class="op">=</span> scene_bbox[<span class="dv">0</span>] <span class="op">+</span> (x_range[<span class="dv">0</span>] <span class="op">/</span> <span class="fl">100.0</span>) <span class="op">*</span> scene_width</span>
<span id="cb10-49"><a href="#cb10-49" aria-hidden="true" tabindex="-1"></a>    east <span class="op">=</span> scene_bbox[<span class="dv">0</span>] <span class="op">+</span> (x_range[<span class="dv">1</span>] <span class="op">/</span> <span class="fl">100.0</span>) <span class="op">*</span> scene_width</span>
<span id="cb10-50"><a href="#cb10-50" aria-hidden="true" tabindex="-1"></a>    south <span class="op">=</span> scene_bbox[<span class="dv">1</span>] <span class="op">+</span> (y_range[<span class="dv">0</span>] <span class="op">/</span> <span class="fl">100.0</span>) <span class="op">*</span> scene_height</span>
<span id="cb10-51"><a href="#cb10-51" aria-hidden="true" tabindex="-1"></a>    north <span class="op">=</span> scene_bbox[<span class="dv">1</span>] <span class="op">+</span> (y_range[<span class="dv">1</span>] <span class="op">/</span> <span class="fl">100.0</span>) <span class="op">*</span> scene_height</span>
<span id="cb10-52"><a href="#cb10-52" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-53"><a href="#cb10-53" aria-hidden="true" tabindex="-1"></a>    subset_bbox <span class="op">=</span> [west, south, east, north]</span>
<span id="cb10-54"><a href="#cb10-54" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-55"><a href="#cb10-55" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Calculate subset metrics for reporting</span></span>
<span id="cb10-56"><a href="#cb10-56" aria-hidden="true" tabindex="-1"></a>    subset_area_percent <span class="op">=</span> ((x_range[<span class="dv">1</span>] <span class="op">-</span> x_range[<span class="dv">0</span>]) <span class="op">*</span> (y_range[<span class="dv">1</span>] <span class="op">-</span> y_range[<span class="dv">0</span>])) <span class="op">/</span> <span class="fl">100.0</span></span>
<span id="cb10-57"><a href="#cb10-57" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-58"><a href="#cb10-58" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="ss">f"📐 Calculated subset from scene bounds:"</span>)</span>
<span id="cb10-59"><a href="#cb10-59" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="ss">f"   Scene bbox: [</span><span class="sc">{</span>scene_bbox[<span class="dv">0</span>]<span class="sc">:.4f}</span><span class="ss">, </span><span class="sc">{</span>scene_bbox[<span class="dv">1</span>]<span class="sc">:.4f}</span><span class="ss">, </span><span class="sc">{</span>scene_bbox[<span class="dv">2</span>]<span class="sc">:.4f}</span><span class="ss">, </span><span class="sc">{</span>scene_bbox[<span class="dv">3</span>]<span class="sc">:.4f}</span><span class="ss">]"</span>)</span>
<span id="cb10-60"><a href="#cb10-60" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="ss">f"   Subset bbox: [</span><span class="sc">{</span>west<span class="sc">:.4f}</span><span class="ss">, </span><span class="sc">{</span>south<span class="sc">:.4f}</span><span class="ss">, </span><span class="sc">{</span>east<span class="sc">:.4f}</span><span class="ss">, </span><span class="sc">{</span>north<span class="sc">:.4f}</span><span class="ss">]"</span>)</span>
<span id="cb10-61"><a href="#cb10-61" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="ss">f"   X range: </span><span class="sc">{</span>x_range[<span class="dv">0</span>]<span class="sc">}</span><span class="ss">%-</span><span class="sc">{</span>x_range[<span class="dv">1</span>]<span class="sc">}</span><span class="ss">%, Y range: </span><span class="sc">{</span>y_range[<span class="dv">0</span>]<span class="sc">}</span><span class="ss">%-</span><span class="sc">{</span>y_range[<span class="dv">1</span>]<span class="sc">}</span><span class="ss">%"</span>)</span>
<span id="cb10-62"><a href="#cb10-62" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="ss">f"   Subset area: </span><span class="sc">{</span>subset_area_percent<span class="sc">:.1f}</span><span class="ss">% of original scene"</span>)</span>
<span id="cb10-63"><a href="#cb10-63" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-64"><a href="#cb10-64" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> subset_bbox</span>
<span id="cb10-65"><a href="#cb10-65" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-66"><a href="#cb10-66" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> get_scene_info(item):</span>
<span id="cb10-67"><a href="#cb10-67" aria-hidden="true" tabindex="-1"></a>    <span class="co">"""</span></span>
<span id="cb10-68"><a href="#cb10-68" aria-hidden="true" tabindex="-1"></a><span class="co">    Extract comprehensive scene characteristics for adaptive processing.</span></span>
<span id="cb10-69"><a href="#cb10-69" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-70"><a href="#cb10-70" aria-hidden="true" tabindex="-1"></a><span class="co">    Parameters</span></span>
<span id="cb10-71"><a href="#cb10-71" aria-hidden="true" tabindex="-1"></a><span class="co">    ----------</span></span>
<span id="cb10-72"><a href="#cb10-72" aria-hidden="true" tabindex="-1"></a><span class="co">    item : pystac.Item</span></span>
<span id="cb10-73"><a href="#cb10-73" aria-hidden="true" tabindex="-1"></a><span class="co">        STAC item to analyze</span></span>
<span id="cb10-74"><a href="#cb10-74" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-75"><a href="#cb10-75" aria-hidden="true" tabindex="-1"></a><span class="co">    Returns</span></span>
<span id="cb10-76"><a href="#cb10-76" aria-hidden="true" tabindex="-1"></a><span class="co">    -------</span></span>
<span id="cb10-77"><a href="#cb10-77" aria-hidden="true" tabindex="-1"></a><span class="co">    Dict</span></span>
<span id="cb10-78"><a href="#cb10-78" aria-hidden="true" tabindex="-1"></a><span class="co">        Scene characteristics including dimensions and geographic metrics</span></span>
<span id="cb10-79"><a href="#cb10-79" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-80"><a href="#cb10-80" aria-hidden="true" tabindex="-1"></a><span class="co">    Design Pattern: Information Expert</span></span>
<span id="cb10-81"><a href="#cb10-81" aria-hidden="true" tabindex="-1"></a><span class="co">    - Centralizes scene analysis logic</span></span>
<span id="cb10-82"><a href="#cb10-82" aria-hidden="true" tabindex="-1"></a><span class="co">    - Provides basis for adaptive processing decisions</span></span>
<span id="cb10-83"><a href="#cb10-83" aria-hidden="true" tabindex="-1"></a><span class="co">    - Enables consistent scene characterization across workflows</span></span>
<span id="cb10-84"><a href="#cb10-84" aria-hidden="true" tabindex="-1"></a><span class="co">    """</span></span>
<span id="cb10-85"><a href="#cb10-85" aria-hidden="true" tabindex="-1"></a>    bbox <span class="op">=</span> item.bbox</span>
<span id="cb10-86"><a href="#cb10-86" aria-hidden="true" tabindex="-1"></a>    width_deg <span class="op">=</span> bbox[<span class="dv">2</span>] <span class="op">-</span> bbox[<span class="dv">0</span>]</span>
<span id="cb10-87"><a href="#cb10-87" aria-hidden="true" tabindex="-1"></a>    height_deg <span class="op">=</span> bbox[<span class="dv">3</span>] <span class="op">-</span> bbox[<span class="dv">1</span>]</span>
<span id="cb10-88"><a href="#cb10-88" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-89"><a href="#cb10-89" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Approximate conversion to kilometers (suitable for most latitudes)</span></span>
<span id="cb10-90"><a href="#cb10-90" aria-hidden="true" tabindex="-1"></a>    center_lat <span class="op">=</span> (bbox[<span class="dv">1</span>] <span class="op">+</span> bbox[<span class="dv">3</span>]) <span class="op">/</span> <span class="dv">2</span></span>
<span id="cb10-91"><a href="#cb10-91" aria-hidden="true" tabindex="-1"></a>    width_km <span class="op">=</span> width_deg <span class="op">*</span> <span class="dv">111</span> <span class="op">*</span> np.cos(np.radians(center_lat))</span>
<span id="cb10-92"><a href="#cb10-92" aria-hidden="true" tabindex="-1"></a>    height_km <span class="op">=</span> height_deg <span class="op">*</span> <span class="dv">111</span></span>
<span id="cb10-93"><a href="#cb10-93" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-94"><a href="#cb10-94" aria-hidden="true" tabindex="-1"></a>    info <span class="op">=</span> {</span>
<span id="cb10-95"><a href="#cb10-95" aria-hidden="true" tabindex="-1"></a>        <span class="st">'scene_id'</span>: item.<span class="bu">id</span>,</span>
<span id="cb10-96"><a href="#cb10-96" aria-hidden="true" tabindex="-1"></a>        <span class="st">'date'</span>: item.properties[<span class="st">'datetime'</span>].split(<span class="st">'T'</span>)[<span class="dv">0</span>],</span>
<span id="cb10-97"><a href="#cb10-97" aria-hidden="true" tabindex="-1"></a>        <span class="st">'bbox'</span>: bbox,</span>
<span id="cb10-98"><a href="#cb10-98" aria-hidden="true" tabindex="-1"></a>        <span class="st">'width_deg'</span>: width_deg,</span>
<span id="cb10-99"><a href="#cb10-99" aria-hidden="true" tabindex="-1"></a>        <span class="st">'height_deg'</span>: height_deg,</span>
<span id="cb10-100"><a href="#cb10-100" aria-hidden="true" tabindex="-1"></a>        <span class="st">'width_km'</span>: width_km,</span>
<span id="cb10-101"><a href="#cb10-101" aria-hidden="true" tabindex="-1"></a>        <span class="st">'height_km'</span>: height_km,</span>
<span id="cb10-102"><a href="#cb10-102" aria-hidden="true" tabindex="-1"></a>        <span class="st">'area_km2'</span>: width_km <span class="op">*</span> height_km,</span>
<span id="cb10-103"><a href="#cb10-103" aria-hidden="true" tabindex="-1"></a>        <span class="st">'center_lat'</span>: center_lat,</span>
<span id="cb10-104"><a href="#cb10-104" aria-hidden="true" tabindex="-1"></a>        <span class="st">'center_lon'</span>: (bbox[<span class="dv">0</span>] <span class="op">+</span> bbox[<span class="dv">2</span>]) <span class="op">/</span> <span class="dv">2</span></span>
<span id="cb10-105"><a href="#cb10-105" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb10-106"><a href="#cb10-106" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-107"><a href="#cb10-107" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> info</span>
<span id="cb10-108"><a href="#cb10-108" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-109"><a href="#cb10-109" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"✅ Scene processing and subsetting functions ready"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>✅ Scene processing and subsetting functions ready</code></pre>
</div>
</div>
<div class="callout callout-style-default callout-note callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Spatial Processing Design Patterns
</div>
</div>
<div class="callout-body-container callout-body">
<ul>
<li><strong>Percentage-based coordinates</strong> provide resolution independence</li>
<li><strong>Adaptive processing</strong> adjusts strategies based on scene size</li>
<li><strong>Systematic spatial sampling</strong> enables reproducible analysis</li>
<li><strong>Geographic metrics</strong> support intelligent subset sizing decisions</li>
</ul>
</div>
</div>
<hr>
</section>
</section>
<section id="section-5-data-processing-pipelines" class="level2">
<h2 class="anchored" data-anchor-id="section-5-data-processing-pipelines">Section 5: Data Processing Pipelines 🔬</h2>
<div class="callout callout-style-default callout-tip callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Learning Objectives
</div>
</div>
<div class="callout-body-container callout-body">
<ul>
<li>Master spectral analysis and vegetation index calculations</li>
<li>Implement robust statistical analysis with error handling</li>
<li>Design composable processing functions for workflow flexibility</li>
<li>Understand radiometric enhancement techniques for visualization</li>
</ul>
</div>
</div>
<section id="spectral-analysis-fundamentals" class="level3">
<h3 class="anchored" data-anchor-id="spectral-analysis-fundamentals">Spectral Analysis Fundamentals</h3>
<p>Satellite sensors capture electromagnetic radiation across multiple spectral bands, enabling sophisticated analysis:</p>
<ul>
<li><strong>Radiometric Enhancement</strong>: Optimize visual representation of spectral data</li>
<li><strong>Vegetation Indices</strong>: Combine bands to highlight biological activity</li>
<li><strong>Statistical Analysis</strong>: Characterize data distributions and quality</li>
<li><strong>Composable Functions</strong>: Build complex workflows from simple operations</li>
</ul>
<div id="086e7c96" class="cell" data-execution_count="9">
<div class="sourceCode cell-code" id="cb12"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb12-1"><a href="#cb12-1" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> normalize_band(</span>
<span id="cb12-2"><a href="#cb12-2" aria-hidden="true" tabindex="-1"></a>    band: np.ndarray,</span>
<span id="cb12-3"><a href="#cb12-3" aria-hidden="true" tabindex="-1"></a>    percentiles: Tuple[<span class="bu">float</span>, <span class="bu">float</span>] <span class="op">=</span> (<span class="dv">2</span>, <span class="dv">98</span>),</span>
<span id="cb12-4"><a href="#cb12-4" aria-hidden="true" tabindex="-1"></a>    clip: <span class="bu">bool</span> <span class="op">=</span> <span class="va">True</span></span>
<span id="cb12-5"><a href="#cb12-5" aria-hidden="true" tabindex="-1"></a>) <span class="op">-&gt;</span> np.ndarray:</span>
<span id="cb12-6"><a href="#cb12-6" aria-hidden="true" tabindex="-1"></a>    <span class="co">"""</span></span>
<span id="cb12-7"><a href="#cb12-7" aria-hidden="true" tabindex="-1"></a><span class="co">    Percentile-based radiometric enhancement for optimal visualization.</span></span>
<span id="cb12-8"><a href="#cb12-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-9"><a href="#cb12-9" aria-hidden="true" tabindex="-1"></a><span class="co">    This normalization approach addresses several challenges:</span></span>
<span id="cb12-10"><a href="#cb12-10" aria-hidden="true" tabindex="-1"></a><span class="co">    1. Dynamic Range: Raw satellite data often has poor contrast</span></span>
<span id="cb12-11"><a href="#cb12-11" aria-hidden="true" tabindex="-1"></a><span class="co">    2. Outlier Robustness: Percentiles ignore extreme values</span></span>
<span id="cb12-12"><a href="#cb12-12" aria-hidden="true" tabindex="-1"></a><span class="co">    3. Visual Optimization: Results in pleasing, interpretable images</span></span>
<span id="cb12-13"><a href="#cb12-13" aria-hidden="true" tabindex="-1"></a><span class="co">    4. Statistical Validity: Preserves relative data relationships</span></span>
<span id="cb12-14"><a href="#cb12-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-15"><a href="#cb12-15" aria-hidden="true" tabindex="-1"></a><span class="co">    Parameters</span></span>
<span id="cb12-16"><a href="#cb12-16" aria-hidden="true" tabindex="-1"></a><span class="co">    ----------</span></span>
<span id="cb12-17"><a href="#cb12-17" aria-hidden="true" tabindex="-1"></a><span class="co">    band : np.ndarray</span></span>
<span id="cb12-18"><a href="#cb12-18" aria-hidden="true" tabindex="-1"></a><span class="co">        Raw satellite band values</span></span>
<span id="cb12-19"><a href="#cb12-19" aria-hidden="true" tabindex="-1"></a><span class="co">    percentiles : Tuple[float, float]</span></span>
<span id="cb12-20"><a href="#cb12-20" aria-hidden="true" tabindex="-1"></a><span class="co">        Lower and upper percentiles for stretching</span></span>
<span id="cb12-21"><a href="#cb12-21" aria-hidden="true" tabindex="-1"></a><span class="co">    clip : bool</span></span>
<span id="cb12-22"><a href="#cb12-22" aria-hidden="true" tabindex="-1"></a><span class="co">        Whether to clip values to [0, 1] range</span></span>
<span id="cb12-23"><a href="#cb12-23" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-24"><a href="#cb12-24" aria-hidden="true" tabindex="-1"></a><span class="co">    Returns</span></span>
<span id="cb12-25"><a href="#cb12-25" aria-hidden="true" tabindex="-1"></a><span class="co">    -------</span></span>
<span id="cb12-26"><a href="#cb12-26" aria-hidden="true" tabindex="-1"></a><span class="co">    np.ndarray</span></span>
<span id="cb12-27"><a href="#cb12-27" aria-hidden="true" tabindex="-1"></a><span class="co">        Normalized band values optimized for visualization</span></span>
<span id="cb12-28"><a href="#cb12-28" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-29"><a href="#cb12-29" aria-hidden="true" tabindex="-1"></a><span class="co">    Design Pattern: Strategy Pattern for Enhancement</span></span>
<span id="cb12-30"><a href="#cb12-30" aria-hidden="true" tabindex="-1"></a><span class="co">    - Encapsulates different enhancement algorithms</span></span>
<span id="cb12-31"><a href="#cb12-31" aria-hidden="true" tabindex="-1"></a><span class="co">    - Provides consistent interface for various normalization strategies</span></span>
<span id="cb12-32"><a href="#cb12-32" aria-hidden="true" tabindex="-1"></a><span class="co">    - Handles edge cases (NaN, infinite values) robustly</span></span>
<span id="cb12-33"><a href="#cb12-33" aria-hidden="true" tabindex="-1"></a><span class="co">    """</span></span>
<span id="cb12-34"><a href="#cb12-34" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Handle NaN and infinite values robustly</span></span>
<span id="cb12-35"><a href="#cb12-35" aria-hidden="true" tabindex="-1"></a>    valid_mask <span class="op">=</span> np.isfinite(band)</span>
<span id="cb12-36"><a href="#cb12-36" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> <span class="kw">not</span> np.<span class="bu">any</span>(valid_mask):</span>
<span id="cb12-37"><a href="#cb12-37" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> np.zeros_like(band)</span>
<span id="cb12-38"><a href="#cb12-38" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-39"><a href="#cb12-39" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Calculate percentiles on valid data only</span></span>
<span id="cb12-40"><a href="#cb12-40" aria-hidden="true" tabindex="-1"></a>    p_low, p_high <span class="op">=</span> np.percentile(band[valid_mask], percentiles)</span>
<span id="cb12-41"><a href="#cb12-41" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-42"><a href="#cb12-42" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Avoid division by zero</span></span>
<span id="cb12-43"><a href="#cb12-43" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> p_high <span class="op">==</span> p_low:</span>
<span id="cb12-44"><a href="#cb12-44" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> np.zeros_like(band)</span>
<span id="cb12-45"><a href="#cb12-45" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-46"><a href="#cb12-46" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Linear stretch based on percentiles</span></span>
<span id="cb12-47"><a href="#cb12-47" aria-hidden="true" tabindex="-1"></a>    normalized <span class="op">=</span> (band <span class="op">-</span> p_low) <span class="op">/</span> (p_high <span class="op">-</span> p_low)</span>
<span id="cb12-48"><a href="#cb12-48" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-49"><a href="#cb12-49" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Optional clipping to [0, 1] range</span></span>
<span id="cb12-50"><a href="#cb12-50" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> clip:</span>
<span id="cb12-51"><a href="#cb12-51" aria-hidden="true" tabindex="-1"></a>        normalized <span class="op">=</span> np.clip(normalized, <span class="dv">0</span>, <span class="dv">1</span>)</span>
<span id="cb12-52"><a href="#cb12-52" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-53"><a href="#cb12-53" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> normalized</span>
<span id="cb12-54"><a href="#cb12-54" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-55"><a href="#cb12-55" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> create_rgb_composite(</span>
<span id="cb12-56"><a href="#cb12-56" aria-hidden="true" tabindex="-1"></a>    red: np.ndarray,</span>
<span id="cb12-57"><a href="#cb12-57" aria-hidden="true" tabindex="-1"></a>    green: np.ndarray,</span>
<span id="cb12-58"><a href="#cb12-58" aria-hidden="true" tabindex="-1"></a>    blue: np.ndarray,</span>
<span id="cb12-59"><a href="#cb12-59" aria-hidden="true" tabindex="-1"></a>    enhance: <span class="bu">bool</span> <span class="op">=</span> <span class="va">True</span></span>
<span id="cb12-60"><a href="#cb12-60" aria-hidden="true" tabindex="-1"></a>) <span class="op">-&gt;</span> np.ndarray:</span>
<span id="cb12-61"><a href="#cb12-61" aria-hidden="true" tabindex="-1"></a>    <span class="co">"""</span></span>
<span id="cb12-62"><a href="#cb12-62" aria-hidden="true" tabindex="-1"></a><span class="co">    Create publication-quality RGB composite images.</span></span>
<span id="cb12-63"><a href="#cb12-63" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-64"><a href="#cb12-64" aria-hidden="true" tabindex="-1"></a><span class="co">    Parameters</span></span>
<span id="cb12-65"><a href="#cb12-65" aria-hidden="true" tabindex="-1"></a><span class="co">    ----------</span></span>
<span id="cb12-66"><a href="#cb12-66" aria-hidden="true" tabindex="-1"></a><span class="co">    red, green, blue : np.ndarray</span></span>
<span id="cb12-67"><a href="#cb12-67" aria-hidden="true" tabindex="-1"></a><span class="co">        Individual spectral bands</span></span>
<span id="cb12-68"><a href="#cb12-68" aria-hidden="true" tabindex="-1"></a><span class="co">    enhance : bool</span></span>
<span id="cb12-69"><a href="#cb12-69" aria-hidden="true" tabindex="-1"></a><span class="co">        Apply automatic contrast enhancement</span></span>
<span id="cb12-70"><a href="#cb12-70" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-71"><a href="#cb12-71" aria-hidden="true" tabindex="-1"></a><span class="co">    Returns</span></span>
<span id="cb12-72"><a href="#cb12-72" aria-hidden="true" tabindex="-1"></a><span class="co">    -------</span></span>
<span id="cb12-73"><a href="#cb12-73" aria-hidden="true" tabindex="-1"></a><span class="co">    np.ndarray</span></span>
<span id="cb12-74"><a href="#cb12-74" aria-hidden="true" tabindex="-1"></a><span class="co">        RGB composite with shape (height, width, 3)</span></span>
<span id="cb12-75"><a href="#cb12-75" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-76"><a href="#cb12-76" aria-hidden="true" tabindex="-1"></a><span class="co">    Design Pattern: Composite Pattern for Multi-band Operations</span></span>
<span id="cb12-77"><a href="#cb12-77" aria-hidden="true" tabindex="-1"></a><span class="co">    - Combines multiple bands into unified representation</span></span>
<span id="cb12-78"><a href="#cb12-78" aria-hidden="true" tabindex="-1"></a><span class="co">    - Applies consistent enhancement across all channels</span></span>
<span id="cb12-79"><a href="#cb12-79" aria-hidden="true" tabindex="-1"></a><span class="co">    - Produces standard format for visualization libraries</span></span>
<span id="cb12-80"><a href="#cb12-80" aria-hidden="true" tabindex="-1"></a><span class="co">    """</span></span>
<span id="cb12-81"><a href="#cb12-81" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Apply enhancement to each channel</span></span>
<span id="cb12-82"><a href="#cb12-82" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> enhance:</span>
<span id="cb12-83"><a href="#cb12-83" aria-hidden="true" tabindex="-1"></a>        red_norm <span class="op">=</span> normalize_band(red)</span>
<span id="cb12-84"><a href="#cb12-84" aria-hidden="true" tabindex="-1"></a>        green_norm <span class="op">=</span> normalize_band(green)</span>
<span id="cb12-85"><a href="#cb12-85" aria-hidden="true" tabindex="-1"></a>        blue_norm <span class="op">=</span> normalize_band(blue)</span>
<span id="cb12-86"><a href="#cb12-86" aria-hidden="true" tabindex="-1"></a>    <span class="cf">else</span>:</span>
<span id="cb12-87"><a href="#cb12-87" aria-hidden="true" tabindex="-1"></a>        <span class="co"># Simple linear scaling</span></span>
<span id="cb12-88"><a href="#cb12-88" aria-hidden="true" tabindex="-1"></a>        red_norm <span class="op">=</span> red <span class="op">/</span> np.<span class="bu">max</span>(red) <span class="cf">if</span> np.<span class="bu">max</span>(red) <span class="op">&gt;</span> <span class="dv">0</span> <span class="cf">else</span> red</span>
<span id="cb12-89"><a href="#cb12-89" aria-hidden="true" tabindex="-1"></a>        green_norm <span class="op">=</span> green <span class="op">/</span> np.<span class="bu">max</span>(green) <span class="cf">if</span> np.<span class="bu">max</span>(green) <span class="op">&gt;</span> <span class="dv">0</span> <span class="cf">else</span> green</span>
<span id="cb12-90"><a href="#cb12-90" aria-hidden="true" tabindex="-1"></a>        blue_norm <span class="op">=</span> blue <span class="op">/</span> np.<span class="bu">max</span>(blue) <span class="cf">if</span> np.<span class="bu">max</span>(blue) <span class="op">&gt;</span> <span class="dv">0</span> <span class="cf">else</span> blue</span>
<span id="cb12-91"><a href="#cb12-91" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-92"><a href="#cb12-92" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Stack into RGB composite</span></span>
<span id="cb12-93"><a href="#cb12-93" aria-hidden="true" tabindex="-1"></a>    rgb_composite <span class="op">=</span> np.dstack([red_norm, green_norm, blue_norm])</span>
<span id="cb12-94"><a href="#cb12-94" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-95"><a href="#cb12-95" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> rgb_composite</span>
<span id="cb12-96"><a href="#cb12-96" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-97"><a href="#cb12-97" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> calculate_ndvi(</span>
<span id="cb12-98"><a href="#cb12-98" aria-hidden="true" tabindex="-1"></a>    nir: np.ndarray,</span>
<span id="cb12-99"><a href="#cb12-99" aria-hidden="true" tabindex="-1"></a>    red: np.ndarray,</span>
<span id="cb12-100"><a href="#cb12-100" aria-hidden="true" tabindex="-1"></a>    epsilon: <span class="bu">float</span> <span class="op">=</span> <span class="fl">1e-8</span></span>
<span id="cb12-101"><a href="#cb12-101" aria-hidden="true" tabindex="-1"></a>) <span class="op">-&gt;</span> np.ndarray:</span>
<span id="cb12-102"><a href="#cb12-102" aria-hidden="true" tabindex="-1"></a>    <span class="co">"""</span></span>
<span id="cb12-103"><a href="#cb12-103" aria-hidden="true" tabindex="-1"></a><span class="co">    Calculate Normalized Difference Vegetation Index with robust error handling.</span></span>
<span id="cb12-104"><a href="#cb12-104" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-105"><a href="#cb12-105" aria-hidden="true" tabindex="-1"></a><span class="co">    NDVI = (NIR - Red) / (NIR + Red)</span></span>
<span id="cb12-106"><a href="#cb12-106" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-107"><a href="#cb12-107" aria-hidden="true" tabindex="-1"></a><span class="co">    NDVI is fundamental to vegetation monitoring because:</span></span>
<span id="cb12-108"><a href="#cb12-108" aria-hidden="true" tabindex="-1"></a><span class="co">    1. Physical Basis: Reflects chlorophyll absorption and cellular structure</span></span>
<span id="cb12-109"><a href="#cb12-109" aria-hidden="true" tabindex="-1"></a><span class="co">    2. Standardization: Normalized to [-1, 1] range for comparison</span></span>
<span id="cb12-110"><a href="#cb12-110" aria-hidden="true" tabindex="-1"></a><span class="co">    3. Temporal Stability: Enables change detection across seasons/years</span></span>
<span id="cb12-111"><a href="#cb12-111" aria-hidden="true" tabindex="-1"></a><span class="co">    4. Ecological Meaning: Strong correlation with biomass and health</span></span>
<span id="cb12-112"><a href="#cb12-112" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-113"><a href="#cb12-113" aria-hidden="true" tabindex="-1"></a><span class="co">    Parameters</span></span>
<span id="cb12-114"><a href="#cb12-114" aria-hidden="true" tabindex="-1"></a><span class="co">    ----------</span></span>
<span id="cb12-115"><a href="#cb12-115" aria-hidden="true" tabindex="-1"></a><span class="co">    nir : np.ndarray</span></span>
<span id="cb12-116"><a href="#cb12-116" aria-hidden="true" tabindex="-1"></a><span class="co">        Near-infrared reflectance (Band 8: 842nm)</span></span>
<span id="cb12-117"><a href="#cb12-117" aria-hidden="true" tabindex="-1"></a><span class="co">    red : np.ndarray</span></span>
<span id="cb12-118"><a href="#cb12-118" aria-hidden="true" tabindex="-1"></a><span class="co">        Red reflectance (Band 4: 665nm)</span></span>
<span id="cb12-119"><a href="#cb12-119" aria-hidden="true" tabindex="-1"></a><span class="co">    epsilon : float</span></span>
<span id="cb12-120"><a href="#cb12-120" aria-hidden="true" tabindex="-1"></a><span class="co">        Numerical stability constant</span></span>
<span id="cb12-121"><a href="#cb12-121" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-122"><a href="#cb12-122" aria-hidden="true" tabindex="-1"></a><span class="co">    Returns</span></span>
<span id="cb12-123"><a href="#cb12-123" aria-hidden="true" tabindex="-1"></a><span class="co">    -------</span></span>
<span id="cb12-124"><a href="#cb12-124" aria-hidden="true" tabindex="-1"></a><span class="co">    np.ndarray</span></span>
<span id="cb12-125"><a href="#cb12-125" aria-hidden="true" tabindex="-1"></a><span class="co">        NDVI values in range [-1, 1]</span></span>
<span id="cb12-126"><a href="#cb12-126" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-127"><a href="#cb12-127" aria-hidden="true" tabindex="-1"></a><span class="co">    Design Pattern: Domain-Specific Language for Spectral Indices</span></span>
<span id="cb12-128"><a href="#cb12-128" aria-hidden="true" tabindex="-1"></a><span class="co">    - Encapsulates spectral physics knowledge</span></span>
<span id="cb12-129"><a href="#cb12-129" aria-hidden="true" tabindex="-1"></a><span class="co">    - Provides numerical stability for edge cases</span></span>
<span id="cb12-130"><a href="#cb12-130" aria-hidden="true" tabindex="-1"></a><span class="co">    - Enables consistent index calculation across projects</span></span>
<span id="cb12-131"><a href="#cb12-131" aria-hidden="true" tabindex="-1"></a><span class="co">    """</span></span>
<span id="cb12-132"><a href="#cb12-132" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Convert to float for numerical precision</span></span>
<span id="cb12-133"><a href="#cb12-133" aria-hidden="true" tabindex="-1"></a>    nir_float <span class="op">=</span> nir.astype(np.float32)</span>
<span id="cb12-134"><a href="#cb12-134" aria-hidden="true" tabindex="-1"></a>    red_float <span class="op">=</span> red.astype(np.float32)</span>
<span id="cb12-135"><a href="#cb12-135" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-136"><a href="#cb12-136" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Calculate NDVI with numerical stability</span></span>
<span id="cb12-137"><a href="#cb12-137" aria-hidden="true" tabindex="-1"></a>    numerator <span class="op">=</span> nir_float <span class="op">-</span> red_float</span>
<span id="cb12-138"><a href="#cb12-138" aria-hidden="true" tabindex="-1"></a>    denominator <span class="op">=</span> nir_float <span class="op">+</span> red_float <span class="op">+</span> epsilon</span>
<span id="cb12-139"><a href="#cb12-139" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-140"><a href="#cb12-140" aria-hidden="true" tabindex="-1"></a>    ndvi <span class="op">=</span> numerator <span class="op">/</span> denominator</span>
<span id="cb12-141"><a href="#cb12-141" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-142"><a href="#cb12-142" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Handle edge cases (both bands zero, etc.)</span></span>
<span id="cb12-143"><a href="#cb12-143" aria-hidden="true" tabindex="-1"></a>    ndvi <span class="op">=</span> np.where(np.isfinite(ndvi), ndvi, <span class="dv">0</span>)</span>
<span id="cb12-144"><a href="#cb12-144" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-145"><a href="#cb12-145" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> ndvi</span>
<span id="cb12-146"><a href="#cb12-146" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-147"><a href="#cb12-147" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> calculate_band_statistics(band: np.ndarray, name: <span class="bu">str</span> <span class="op">=</span> <span class="st">"Band"</span>) <span class="op">-&gt;</span> Dict:</span>
<span id="cb12-148"><a href="#cb12-148" aria-hidden="true" tabindex="-1"></a>    <span class="co">"""</span></span>
<span id="cb12-149"><a href="#cb12-149" aria-hidden="true" tabindex="-1"></a><span class="co">    Comprehensive statistical characterization of satellite bands.</span></span>
<span id="cb12-150"><a href="#cb12-150" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-151"><a href="#cb12-151" aria-hidden="true" tabindex="-1"></a><span class="co">    Parameters</span></span>
<span id="cb12-152"><a href="#cb12-152" aria-hidden="true" tabindex="-1"></a><span class="co">    ----------</span></span>
<span id="cb12-153"><a href="#cb12-153" aria-hidden="true" tabindex="-1"></a><span class="co">    band : np.ndarray</span></span>
<span id="cb12-154"><a href="#cb12-154" aria-hidden="true" tabindex="-1"></a><span class="co">        Input band array</span></span>
<span id="cb12-155"><a href="#cb12-155" aria-hidden="true" tabindex="-1"></a><span class="co">    name : str</span></span>
<span id="cb12-156"><a href="#cb12-156" aria-hidden="true" tabindex="-1"></a><span class="co">        Descriptive name for reporting</span></span>
<span id="cb12-157"><a href="#cb12-157" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-158"><a href="#cb12-158" aria-hidden="true" tabindex="-1"></a><span class="co">    Returns</span></span>
<span id="cb12-159"><a href="#cb12-159" aria-hidden="true" tabindex="-1"></a><span class="co">    -------</span></span>
<span id="cb12-160"><a href="#cb12-160" aria-hidden="true" tabindex="-1"></a><span class="co">    Dict</span></span>
<span id="cb12-161"><a href="#cb12-161" aria-hidden="true" tabindex="-1"></a><span class="co">        Complete statistical summary including percentiles and counts</span></span>
<span id="cb12-162"><a href="#cb12-162" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-163"><a href="#cb12-163" aria-hidden="true" tabindex="-1"></a><span class="co">    Design Pattern: Observer Pattern for Data Quality Assessment</span></span>
<span id="cb12-164"><a href="#cb12-164" aria-hidden="true" tabindex="-1"></a><span class="co">    - Provides standardized quality metrics</span></span>
<span id="cb12-165"><a href="#cb12-165" aria-hidden="true" tabindex="-1"></a><span class="co">    - Enables data validation and quality control</span></span>
<span id="cb12-166"><a href="#cb12-166" aria-hidden="true" tabindex="-1"></a><span class="co">    - Supports automated quality assessment workflows</span></span>
<span id="cb12-167"><a href="#cb12-167" aria-hidden="true" tabindex="-1"></a><span class="co">    """</span></span>
<span id="cb12-168"><a href="#cb12-168" aria-hidden="true" tabindex="-1"></a>    valid_mask <span class="op">=</span> np.isfinite(band)</span>
<span id="cb12-169"><a href="#cb12-169" aria-hidden="true" tabindex="-1"></a>    valid_data <span class="op">=</span> band[valid_mask]</span>
<span id="cb12-170"><a href="#cb12-170" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-171"><a href="#cb12-171" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> <span class="bu">len</span>(valid_data) <span class="op">==</span> <span class="dv">0</span>:</span>
<span id="cb12-172"><a href="#cb12-172" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> {</span>
<span id="cb12-173"><a href="#cb12-173" aria-hidden="true" tabindex="-1"></a>            <span class="st">'name'</span>: name,</span>
<span id="cb12-174"><a href="#cb12-174" aria-hidden="true" tabindex="-1"></a>            <span class="st">'min'</span>: np.nan, <span class="st">'max'</span>: np.nan, <span class="st">'mean'</span>: np.nan,</span>
<span id="cb12-175"><a href="#cb12-175" aria-hidden="true" tabindex="-1"></a>            <span class="st">'std'</span>: np.nan, <span class="st">'median'</span>: np.nan,</span>
<span id="cb12-176"><a href="#cb12-176" aria-hidden="true" tabindex="-1"></a>            <span class="st">'valid_pixels'</span>: <span class="dv">0</span>, <span class="st">'total_pixels'</span>: band.size</span>
<span id="cb12-177"><a href="#cb12-177" aria-hidden="true" tabindex="-1"></a>        }</span>
<span id="cb12-178"><a href="#cb12-178" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-179"><a href="#cb12-179" aria-hidden="true" tabindex="-1"></a>    stats <span class="op">=</span> {</span>
<span id="cb12-180"><a href="#cb12-180" aria-hidden="true" tabindex="-1"></a>        <span class="st">'name'</span>: name,</span>
<span id="cb12-181"><a href="#cb12-181" aria-hidden="true" tabindex="-1"></a>        <span class="st">'min'</span>: <span class="bu">float</span>(np.<span class="bu">min</span>(valid_data)),</span>
<span id="cb12-182"><a href="#cb12-182" aria-hidden="true" tabindex="-1"></a>        <span class="st">'max'</span>: <span class="bu">float</span>(np.<span class="bu">max</span>(valid_data)),</span>
<span id="cb12-183"><a href="#cb12-183" aria-hidden="true" tabindex="-1"></a>        <span class="st">'mean'</span>: <span class="bu">float</span>(np.mean(valid_data)),</span>
<span id="cb12-184"><a href="#cb12-184" aria-hidden="true" tabindex="-1"></a>        <span class="st">'std'</span>: <span class="bu">float</span>(np.std(valid_data)),</span>
<span id="cb12-185"><a href="#cb12-185" aria-hidden="true" tabindex="-1"></a>        <span class="st">'median'</span>: <span class="bu">float</span>(np.median(valid_data)),</span>
<span id="cb12-186"><a href="#cb12-186" aria-hidden="true" tabindex="-1"></a>        <span class="st">'valid_pixels'</span>: <span class="bu">int</span>(np.<span class="bu">sum</span>(valid_mask)),</span>
<span id="cb12-187"><a href="#cb12-187" aria-hidden="true" tabindex="-1"></a>        <span class="st">'total_pixels'</span>: <span class="bu">int</span>(band.size),</span>
<span id="cb12-188"><a href="#cb12-188" aria-hidden="true" tabindex="-1"></a>        <span class="st">'percentiles'</span>: {</span>
<span id="cb12-189"><a href="#cb12-189" aria-hidden="true" tabindex="-1"></a>            <span class="st">'p25'</span>: <span class="bu">float</span>(np.percentile(valid_data, <span class="dv">25</span>)),</span>
<span id="cb12-190"><a href="#cb12-190" aria-hidden="true" tabindex="-1"></a>            <span class="st">'p75'</span>: <span class="bu">float</span>(np.percentile(valid_data, <span class="dv">75</span>)),</span>
<span id="cb12-191"><a href="#cb12-191" aria-hidden="true" tabindex="-1"></a>            <span class="st">'p95'</span>: <span class="bu">float</span>(np.percentile(valid_data, <span class="dv">95</span>))</span>
<span id="cb12-192"><a href="#cb12-192" aria-hidden="true" tabindex="-1"></a>        }</span>
<span id="cb12-193"><a href="#cb12-193" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb12-194"><a href="#cb12-194" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-195"><a href="#cb12-195" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> stats</span>
<span id="cb12-196"><a href="#cb12-196" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-197"><a href="#cb12-197" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"✅ Data processing pipeline functions ready"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>✅ Data processing pipeline functions ready</code></pre>
</div>
</div>
<div class="callout callout-style-default callout-note callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Spectral Analysis Best Practices
</div>
</div>
<div class="callout-body-container callout-body">
<ul>
<li><strong>Percentile normalization</strong> provides robust enhancement against outliers</li>
<li><strong>Numerical stability constants</strong> prevent division by zero in index calculations</li>
<li><strong>Type conversion to float32</strong> ensures adequate precision for calculations</li>
<li><strong>Comprehensive statistics</strong> enable quality assessment and validation</li>
</ul>
</div>
</div>
<hr>
</section>
</section>
<section id="section-6-visualization-functions" class="level2">
<h2 class="anchored" data-anchor-id="section-6-visualization-functions">Section 6: Visualization Functions 📊</h2>
<div class="callout callout-style-default callout-tip callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Learning Objectives
</div>
</div>
<div class="callout-body-container callout-body">
<ul>
<li>Design publication-quality visualization systems</li>
<li>Implement adaptive layout algorithms for multi-panel displays</li>
<li>Master colormap selection for scientific data representation</li>
<li>Create interactive and informative visual narratives</li>
</ul>
</div>
</div>
<section id="scientific-visualization-design-principles" class="level3">
<h3 class="anchored" data-anchor-id="scientific-visualization-design-principles">Scientific Visualization Design Principles</h3>
<p>Effective satellite data visualization requires careful consideration of:</p>
<ul>
<li><strong>Perceptual Uniformity</strong>: Colormaps that accurately represent data relationships</li>
<li><strong>Information Density</strong>: Maximum insight per pixel</li>
<li><strong>Adaptive Layout</strong>: Accommodate variable numbers of data layers</li>
<li><strong>Context Preservation</strong>: Maintain spatial and temporal reference information</li>
</ul>
<div id="8d4cf92b" class="cell" data-execution_count="10">
<div class="sourceCode cell-code" id="cb14"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb14-1"><a href="#cb14-1" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> plot_band_comparison(</span>
<span id="cb14-2"><a href="#cb14-2" aria-hidden="true" tabindex="-1"></a>    bands: Dict[<span class="bu">str</span>, np.ndarray],</span>
<span id="cb14-3"><a href="#cb14-3" aria-hidden="true" tabindex="-1"></a>    rgb: Optional[np.ndarray] <span class="op">=</span> <span class="va">None</span>,</span>
<span id="cb14-4"><a href="#cb14-4" aria-hidden="true" tabindex="-1"></a>    ndvi: Optional[np.ndarray] <span class="op">=</span> <span class="va">None</span>,</span>
<span id="cb14-5"><a href="#cb14-5" aria-hidden="true" tabindex="-1"></a>    title: <span class="bu">str</span> <span class="op">=</span> <span class="st">"Multi-band Analysis"</span></span>
<span id="cb14-6"><a href="#cb14-6" aria-hidden="true" tabindex="-1"></a>) <span class="op">-&gt;</span> <span class="va">None</span>:</span>
<span id="cb14-7"><a href="#cb14-7" aria-hidden="true" tabindex="-1"></a>    <span class="co">"""</span></span>
<span id="cb14-8"><a href="#cb14-8" aria-hidden="true" tabindex="-1"></a><span class="co">    Create comprehensive multi-panel visualization for satellite analysis.</span></span>
<span id="cb14-9"><a href="#cb14-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-10"><a href="#cb14-10" aria-hidden="true" tabindex="-1"></a><span class="co">    This function demonstrates several visualization principles:</span></span>
<span id="cb14-11"><a href="#cb14-11" aria-hidden="true" tabindex="-1"></a><span class="co">    1. Adaptive Layout: Automatically adjusts grid based on available data</span></span>
<span id="cb14-12"><a href="#cb14-12" aria-hidden="true" tabindex="-1"></a><span class="co">    2. Consistent Scaling: Uniform treatment of individual bands</span></span>
<span id="cb14-13"><a href="#cb14-13" aria-hidden="true" tabindex="-1"></a><span class="co">    3. Specialized Colormaps: Scientific colormaps for different data types</span></span>
<span id="cb14-14"><a href="#cb14-14" aria-hidden="true" tabindex="-1"></a><span class="co">    4. Context Information: Titles, colorbars, and interpretive text</span></span>
<span id="cb14-15"><a href="#cb14-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-16"><a href="#cb14-16" aria-hidden="true" tabindex="-1"></a><span class="co">    Parameters</span></span>
<span id="cb14-17"><a href="#cb14-17" aria-hidden="true" tabindex="-1"></a><span class="co">    ----------</span></span>
<span id="cb14-18"><a href="#cb14-18" aria-hidden="true" tabindex="-1"></a><span class="co">    bands : Dict[str, np.ndarray]</span></span>
<span id="cb14-19"><a href="#cb14-19" aria-hidden="true" tabindex="-1"></a><span class="co">        Individual spectral bands to visualize</span></span>
<span id="cb14-20"><a href="#cb14-20" aria-hidden="true" tabindex="-1"></a><span class="co">    rgb : Optional[np.ndarray]</span></span>
<span id="cb14-21"><a href="#cb14-21" aria-hidden="true" tabindex="-1"></a><span class="co">        True color composite for context</span></span>
<span id="cb14-22"><a href="#cb14-22" aria-hidden="true" tabindex="-1"></a><span class="co">    ndvi : Optional[np.ndarray]</span></span>
<span id="cb14-23"><a href="#cb14-23" aria-hidden="true" tabindex="-1"></a><span class="co">        Vegetation index with specialized colormap</span></span>
<span id="cb14-24"><a href="#cb14-24" aria-hidden="true" tabindex="-1"></a><span class="co">    title : str</span></span>
<span id="cb14-25"><a href="#cb14-25" aria-hidden="true" tabindex="-1"></a><span class="co">        Overall figure title</span></span>
<span id="cb14-26"><a href="#cb14-26" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-27"><a href="#cb14-27" aria-hidden="true" tabindex="-1"></a><span class="co">    Design Pattern: Facade Pattern for Complex Visualizations</span></span>
<span id="cb14-28"><a href="#cb14-28" aria-hidden="true" tabindex="-1"></a><span class="co">    - Simplifies complex matplotlib operations</span></span>
<span id="cb14-29"><a href="#cb14-29" aria-hidden="true" tabindex="-1"></a><span class="co">    - Provides consistent visualization interface</span></span>
<span id="cb14-30"><a href="#cb14-30" aria-hidden="true" tabindex="-1"></a><span class="co">    - Handles layout complexity automatically</span></span>
<span id="cb14-31"><a href="#cb14-31" aria-hidden="true" tabindex="-1"></a><span class="co">    """</span></span>
<span id="cb14-32"><a href="#cb14-32" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Calculate layout</span></span>
<span id="cb14-33"><a href="#cb14-33" aria-hidden="true" tabindex="-1"></a>    n_panels <span class="op">=</span> <span class="bu">len</span>(bands) <span class="op">+</span> (<span class="dv">1</span> <span class="cf">if</span> rgb <span class="kw">is</span> <span class="kw">not</span> <span class="va">None</span> <span class="cf">else</span> <span class="dv">0</span>) <span class="op">+</span> (<span class="dv">1</span> <span class="cf">if</span> ndvi <span class="kw">is</span> <span class="kw">not</span> <span class="va">None</span> <span class="cf">else</span> <span class="dv">0</span>)</span>
<span id="cb14-34"><a href="#cb14-34" aria-hidden="true" tabindex="-1"></a>    n_cols <span class="op">=</span> <span class="bu">min</span>(<span class="dv">3</span>, n_panels)</span>
<span id="cb14-35"><a href="#cb14-35" aria-hidden="true" tabindex="-1"></a>    n_rows <span class="op">=</span> (n_panels <span class="op">+</span> n_cols <span class="op">-</span> <span class="dv">1</span>) <span class="op">//</span> n_cols</span>
<span id="cb14-36"><a href="#cb14-36" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-37"><a href="#cb14-37" aria-hidden="true" tabindex="-1"></a>    fig, axes <span class="op">=</span> plt.subplots(n_rows, n_cols, figsize<span class="op">=</span>(<span class="dv">5</span><span class="op">*</span>n_cols, <span class="dv">4</span><span class="op">*</span>n_rows))</span>
<span id="cb14-38"><a href="#cb14-38" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> n_panels <span class="op">==</span> <span class="dv">1</span>:</span>
<span id="cb14-39"><a href="#cb14-39" aria-hidden="true" tabindex="-1"></a>        axes <span class="op">=</span> [axes]</span>
<span id="cb14-40"><a href="#cb14-40" aria-hidden="true" tabindex="-1"></a>    <span class="cf">elif</span> n_rows <span class="op">&gt;</span> <span class="dv">1</span>:</span>
<span id="cb14-41"><a href="#cb14-41" aria-hidden="true" tabindex="-1"></a>        axes <span class="op">=</span> axes.flatten()</span>
<span id="cb14-42"><a href="#cb14-42" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-43"><a href="#cb14-43" aria-hidden="true" tabindex="-1"></a>    panel_idx <span class="op">=</span> <span class="dv">0</span></span>
<span id="cb14-44"><a href="#cb14-44" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-45"><a href="#cb14-45" aria-hidden="true" tabindex="-1"></a>    <span class="co"># RGB composite</span></span>
<span id="cb14-46"><a href="#cb14-46" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> rgb <span class="kw">is</span> <span class="kw">not</span> <span class="va">None</span>:</span>
<span id="cb14-47"><a href="#cb14-47" aria-hidden="true" tabindex="-1"></a>        axes[panel_idx].imshow(rgb)</span>
<span id="cb14-48"><a href="#cb14-48" aria-hidden="true" tabindex="-1"></a>        axes[panel_idx].set_title(<span class="st">'RGB Composite'</span>, fontweight<span class="op">=</span><span class="st">'bold'</span>)</span>
<span id="cb14-49"><a href="#cb14-49" aria-hidden="true" tabindex="-1"></a>        axes[panel_idx].axis(<span class="st">'off'</span>)</span>
<span id="cb14-50"><a href="#cb14-50" aria-hidden="true" tabindex="-1"></a>        panel_idx <span class="op">+=</span> <span class="dv">1</span></span>
<span id="cb14-51"><a href="#cb14-51" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-52"><a href="#cb14-52" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Individual bands</span></span>
<span id="cb14-53"><a href="#cb14-53" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> band_name, band_data <span class="kw">in</span> bands.items():</span>
<span id="cb14-54"><a href="#cb14-54" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> panel_idx <span class="op">&lt;</span> <span class="bu">len</span>(axes):</span>
<span id="cb14-55"><a href="#cb14-55" aria-hidden="true" tabindex="-1"></a>            normalized <span class="op">=</span> normalize_band(band_data)</span>
<span id="cb14-56"><a href="#cb14-56" aria-hidden="true" tabindex="-1"></a>            axes[panel_idx].imshow(normalized, cmap<span class="op">=</span><span class="st">'gray'</span>, vmin<span class="op">=</span><span class="dv">0</span>, vmax<span class="op">=</span><span class="dv">1</span>)</span>
<span id="cb14-57"><a href="#cb14-57" aria-hidden="true" tabindex="-1"></a>            axes[panel_idx].set_title(<span class="ss">f'Band: </span><span class="sc">{</span>band_name<span class="sc">}</span><span class="ss">'</span>, fontweight<span class="op">=</span><span class="st">'bold'</span>)</span>
<span id="cb14-58"><a href="#cb14-58" aria-hidden="true" tabindex="-1"></a>            axes[panel_idx].axis(<span class="st">'off'</span>)</span>
<span id="cb14-59"><a href="#cb14-59" aria-hidden="true" tabindex="-1"></a>            panel_idx <span class="op">+=</span> <span class="dv">1</span></span>
<span id="cb14-60"><a href="#cb14-60" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-61"><a href="#cb14-61" aria-hidden="true" tabindex="-1"></a>    <span class="co"># NDVI with colorbar</span></span>
<span id="cb14-62"><a href="#cb14-62" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> ndvi <span class="kw">is</span> <span class="kw">not</span> <span class="va">None</span> <span class="kw">and</span> panel_idx <span class="op">&lt;</span> <span class="bu">len</span>(axes):</span>
<span id="cb14-63"><a href="#cb14-63" aria-hidden="true" tabindex="-1"></a>        im <span class="op">=</span> axes[panel_idx].imshow(ndvi, cmap<span class="op">=</span><span class="st">'RdYlGn'</span>, vmin<span class="op">=-</span><span class="fl">0.5</span>, vmax<span class="op">=</span><span class="fl">1.0</span>)</span>
<span id="cb14-64"><a href="#cb14-64" aria-hidden="true" tabindex="-1"></a>        axes[panel_idx].set_title(<span class="st">'NDVI'</span>, fontweight<span class="op">=</span><span class="st">'bold'</span>)</span>
<span id="cb14-65"><a href="#cb14-65" aria-hidden="true" tabindex="-1"></a>        axes[panel_idx].axis(<span class="st">'off'</span>)</span>
<span id="cb14-66"><a href="#cb14-66" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-67"><a href="#cb14-67" aria-hidden="true" tabindex="-1"></a>        cbar <span class="op">=</span> plt.colorbar(im, ax<span class="op">=</span>axes[panel_idx], shrink<span class="op">=</span><span class="fl">0.6</span>)</span>
<span id="cb14-68"><a href="#cb14-68" aria-hidden="true" tabindex="-1"></a>        cbar.set_label(<span class="st">'NDVI Value'</span>, rotation<span class="op">=</span><span class="dv">270</span>, labelpad<span class="op">=</span><span class="dv">15</span>)</span>
<span id="cb14-69"><a href="#cb14-69" aria-hidden="true" tabindex="-1"></a>        panel_idx <span class="op">+=</span> <span class="dv">1</span></span>
<span id="cb14-70"><a href="#cb14-70" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-71"><a href="#cb14-71" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Hide unused panels</span></span>
<span id="cb14-72"><a href="#cb14-72" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> idx <span class="kw">in</span> <span class="bu">range</span>(panel_idx, <span class="bu">len</span>(axes)):</span>
<span id="cb14-73"><a href="#cb14-73" aria-hidden="true" tabindex="-1"></a>        axes[idx].axis(<span class="st">'off'</span>)</span>
<span id="cb14-74"><a href="#cb14-74" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-75"><a href="#cb14-75" aria-hidden="true" tabindex="-1"></a>    plt.suptitle(title, fontsize<span class="op">=</span><span class="dv">14</span>, fontweight<span class="op">=</span><span class="st">'bold'</span>)</span>
<span id="cb14-76"><a href="#cb14-76" aria-hidden="true" tabindex="-1"></a>    plt.tight_layout()</span>
<span id="cb14-77"><a href="#cb14-77" aria-hidden="true" tabindex="-1"></a>    plt.show()</span>
<span id="cb14-78"><a href="#cb14-78" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-79"><a href="#cb14-79" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"✅ Scientific visualization functions ready"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>✅ Scientific visualization functions ready</code></pre>
</div>
</div>
<div class="callout callout-style-default callout-note callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Visualization Design Principles
</div>
</div>
<div class="callout-body-container callout-body">
<ul>
<li><strong>Adaptive layouts</strong> accommodate varying numbers of data layers</li>
<li><strong>Perceptually uniform colormaps</strong> (like RdYlGn for NDVI) accurately represent data relationships</li>
<li><strong>Consistent normalization</strong> enables fair comparison between bands</li>
<li><strong>Interpretive elements</strong> (colorbars, labels) provide context for non-experts</li>
</ul>
</div>
</div>
<hr>
</section>
</section>
<section id="section-7-data-export-and-interoperability" class="level2">
<h2 class="anchored" data-anchor-id="section-7-data-export-and-interoperability">Section 7: Data Export and Interoperability 💾</h2>
<div class="callout callout-style-default callout-tip callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Learning Objectives
</div>
</div>
<div class="callout-body-container callout-body">
<ul>
<li>Master geospatial data standards (GeoTIFF, CRS, metadata)</li>
<li>Implement cloud-optimized data formats for scalable access</li>
<li>Design interoperable workflows for multi-platform analysis</li>
<li>Ensure data provenance and reproducibility through metadata</li>
</ul>
</div>
</div>
<section id="geospatial-data-standards-and-interoperability" class="level3">
<h3 class="anchored" data-anchor-id="geospatial-data-standards-and-interoperability">Geospatial Data Standards and Interoperability</h3>
<p>Modern geospatial workflows require adherence to established standards:</p>
<ul>
<li><strong>GeoTIFF</strong>: Industry standard for georeferenced raster data</li>
<li><strong>CRS Preservation</strong>: Maintain spatial reference throughout processing</li>
<li><strong>Metadata Standards</strong>: Ensure data provenance and reproducibility</li>
<li><strong>Cloud Optimization</strong>: Structure data for efficient cloud-native access</li>
</ul>
<div id="773dbf2e" class="cell" data-execution_count="11">
<div class="sourceCode cell-code" id="cb16"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb16-1"><a href="#cb16-1" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> save_geotiff(</span>
<span id="cb16-2"><a href="#cb16-2" aria-hidden="true" tabindex="-1"></a>    data: np.ndarray,</span>
<span id="cb16-3"><a href="#cb16-3" aria-hidden="true" tabindex="-1"></a>    output_path: Union[<span class="bu">str</span>, Path],</span>
<span id="cb16-4"><a href="#cb16-4" aria-hidden="true" tabindex="-1"></a>    transform,</span>
<span id="cb16-5"><a href="#cb16-5" aria-hidden="true" tabindex="-1"></a>    crs,</span>
<span id="cb16-6"><a href="#cb16-6" aria-hidden="true" tabindex="-1"></a>    band_names: Optional[List[<span class="bu">str</span>]] <span class="op">=</span> <span class="va">None</span></span>
<span id="cb16-7"><a href="#cb16-7" aria-hidden="true" tabindex="-1"></a>) <span class="op">-&gt;</span> <span class="va">None</span>:</span>
<span id="cb16-8"><a href="#cb16-8" aria-hidden="true" tabindex="-1"></a>    <span class="co">"""</span></span>
<span id="cb16-9"><a href="#cb16-9" aria-hidden="true" tabindex="-1"></a><span class="co">    Export georeferenced data using industry-standard GeoTIFF format.</span></span>
<span id="cb16-10"><a href="#cb16-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-11"><a href="#cb16-11" aria-hidden="true" tabindex="-1"></a><span class="co">    This function embodies several geospatial best practices:</span></span>
<span id="cb16-12"><a href="#cb16-12" aria-hidden="true" tabindex="-1"></a><span class="co">    1. Standards Compliance: Uses OGC-compliant GeoTIFF format</span></span>
<span id="cb16-13"><a href="#cb16-13" aria-hidden="true" tabindex="-1"></a><span class="co">    2. Metadata Preservation: Maintains CRS and transform information</span></span>
<span id="cb16-14"><a href="#cb16-14" aria-hidden="true" tabindex="-1"></a><span class="co">    3. Compression: Applies lossless compression for efficiency</span></span>
<span id="cb16-15"><a href="#cb16-15" aria-hidden="true" tabindex="-1"></a><span class="co">    4. Band Description: Documents spectral band information</span></span>
<span id="cb16-16"><a href="#cb16-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-17"><a href="#cb16-17" aria-hidden="true" tabindex="-1"></a><span class="co">    Parameters</span></span>
<span id="cb16-18"><a href="#cb16-18" aria-hidden="true" tabindex="-1"></a><span class="co">    ----------</span></span>
<span id="cb16-19"><a href="#cb16-19" aria-hidden="true" tabindex="-1"></a><span class="co">    data : np.ndarray</span></span>
<span id="cb16-20"><a href="#cb16-20" aria-hidden="true" tabindex="-1"></a><span class="co">        Data array (2D for single band, 3D for multi-band)</span></span>
<span id="cb16-21"><a href="#cb16-21" aria-hidden="true" tabindex="-1"></a><span class="co">    output_path : Union[str, Path]</span></span>
<span id="cb16-22"><a href="#cb16-22" aria-hidden="true" tabindex="-1"></a><span class="co">        Output file path</span></span>
<span id="cb16-23"><a href="#cb16-23" aria-hidden="true" tabindex="-1"></a><span class="co">    transform : rasterio.transform.Affine</span></span>
<span id="cb16-24"><a href="#cb16-24" aria-hidden="true" tabindex="-1"></a><span class="co">        Geospatial transform matrix</span></span>
<span id="cb16-25"><a href="#cb16-25" aria-hidden="true" tabindex="-1"></a><span class="co">    crs : rasterio.crs.CRS</span></span>
<span id="cb16-26"><a href="#cb16-26" aria-hidden="true" tabindex="-1"></a><span class="co">        Coordinate reference system</span></span>
<span id="cb16-27"><a href="#cb16-27" aria-hidden="true" tabindex="-1"></a><span class="co">    band_names : Optional[List[str]]</span></span>
<span id="cb16-28"><a href="#cb16-28" aria-hidden="true" tabindex="-1"></a><span class="co">        Descriptive names for each band</span></span>
<span id="cb16-29"><a href="#cb16-29" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-30"><a href="#cb16-30" aria-hidden="true" tabindex="-1"></a><span class="co">    Design Pattern: Builder Pattern for Geospatial Data Export</span></span>
<span id="cb16-31"><a href="#cb16-31" aria-hidden="true" tabindex="-1"></a><span class="co">    - Constructs complex geospatial files incrementally</span></span>
<span id="cb16-32"><a href="#cb16-32" aria-hidden="true" tabindex="-1"></a><span class="co">    - Ensures all required metadata is preserved</span></span>
<span id="cb16-33"><a href="#cb16-33" aria-hidden="true" tabindex="-1"></a><span class="co">    - Provides extensible framework for additional metadata</span></span>
<span id="cb16-34"><a href="#cb16-34" aria-hidden="true" tabindex="-1"></a><span class="co">    """</span></span>
<span id="cb16-35"><a href="#cb16-35" aria-hidden="true" tabindex="-1"></a>    output_path <span class="op">=</span> Path(output_path)</span>
<span id="cb16-36"><a href="#cb16-36" aria-hidden="true" tabindex="-1"></a>    output_path.parent.mkdir(parents<span class="op">=</span><span class="va">True</span>, exist_ok<span class="op">=</span><span class="va">True</span>)</span>
<span id="cb16-37"><a href="#cb16-37" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-38"><a href="#cb16-38" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Handle both 2D and 3D arrays</span></span>
<span id="cb16-39"><a href="#cb16-39" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> data.ndim <span class="op">==</span> <span class="dv">2</span>:</span>
<span id="cb16-40"><a href="#cb16-40" aria-hidden="true" tabindex="-1"></a>        count <span class="op">=</span> <span class="dv">1</span></span>
<span id="cb16-41"><a href="#cb16-41" aria-hidden="true" tabindex="-1"></a>        height, width <span class="op">=</span> data.shape</span>
<span id="cb16-42"><a href="#cb16-42" aria-hidden="true" tabindex="-1"></a>    <span class="cf">else</span>:</span>
<span id="cb16-43"><a href="#cb16-43" aria-hidden="true" tabindex="-1"></a>        count, height, width <span class="op">=</span> data.shape</span>
<span id="cb16-44"><a href="#cb16-44" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-45"><a href="#cb16-45" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Write GeoTIFF with comprehensive metadata</span></span>
<span id="cb16-46"><a href="#cb16-46" aria-hidden="true" tabindex="-1"></a>    <span class="cf">with</span> rasterio.<span class="bu">open</span>(</span>
<span id="cb16-47"><a href="#cb16-47" aria-hidden="true" tabindex="-1"></a>        output_path,</span>
<span id="cb16-48"><a href="#cb16-48" aria-hidden="true" tabindex="-1"></a>        <span class="st">'w'</span>,</span>
<span id="cb16-49"><a href="#cb16-49" aria-hidden="true" tabindex="-1"></a>        driver<span class="op">=</span><span class="st">'GTiff'</span>,</span>
<span id="cb16-50"><a href="#cb16-50" aria-hidden="true" tabindex="-1"></a>        height<span class="op">=</span>height,</span>
<span id="cb16-51"><a href="#cb16-51" aria-hidden="true" tabindex="-1"></a>        width<span class="op">=</span>width,</span>
<span id="cb16-52"><a href="#cb16-52" aria-hidden="true" tabindex="-1"></a>        count<span class="op">=</span>count,</span>
<span id="cb16-53"><a href="#cb16-53" aria-hidden="true" tabindex="-1"></a>        dtype<span class="op">=</span>data.dtype,</span>
<span id="cb16-54"><a href="#cb16-54" aria-hidden="true" tabindex="-1"></a>        crs<span class="op">=</span>crs,</span>
<span id="cb16-55"><a href="#cb16-55" aria-hidden="true" tabindex="-1"></a>        transform<span class="op">=</span>transform,</span>
<span id="cb16-56"><a href="#cb16-56" aria-hidden="true" tabindex="-1"></a>        compress<span class="op">=</span><span class="st">'deflate'</span>,  <span class="co"># Lossless compression</span></span>
<span id="cb16-57"><a href="#cb16-57" aria-hidden="true" tabindex="-1"></a>        tiled<span class="op">=</span><span class="va">True</span>,         <span class="co"># Cloud-optimized structure</span></span>
<span id="cb16-58"><a href="#cb16-58" aria-hidden="true" tabindex="-1"></a>        blockxsize<span class="op">=</span><span class="dv">512</span>,     <span class="co"># Optimize for cloud access</span></span>
<span id="cb16-59"><a href="#cb16-59" aria-hidden="true" tabindex="-1"></a>        blockysize<span class="op">=</span><span class="dv">512</span></span>
<span id="cb16-60"><a href="#cb16-60" aria-hidden="true" tabindex="-1"></a>    ) <span class="im">as</span> dst:</span>
<span id="cb16-61"><a href="#cb16-61" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> data.ndim <span class="op">==</span> <span class="dv">2</span>:</span>
<span id="cb16-62"><a href="#cb16-62" aria-hidden="true" tabindex="-1"></a>            dst.write(data, <span class="dv">1</span>)</span>
<span id="cb16-63"><a href="#cb16-63" aria-hidden="true" tabindex="-1"></a>            <span class="cf">if</span> band_names:</span>
<span id="cb16-64"><a href="#cb16-64" aria-hidden="true" tabindex="-1"></a>                dst.set_band_description(<span class="dv">1</span>, band_names[<span class="dv">0</span>])</span>
<span id="cb16-65"><a href="#cb16-65" aria-hidden="true" tabindex="-1"></a>        <span class="cf">else</span>:</span>
<span id="cb16-66"><a href="#cb16-66" aria-hidden="true" tabindex="-1"></a>            <span class="cf">for</span> i <span class="kw">in</span> <span class="bu">range</span>(count):</span>
<span id="cb16-67"><a href="#cb16-67" aria-hidden="true" tabindex="-1"></a>                dst.write(data[i], i <span class="op">+</span> <span class="dv">1</span>)</span>
<span id="cb16-68"><a href="#cb16-68" aria-hidden="true" tabindex="-1"></a>                <span class="cf">if</span> band_names <span class="kw">and</span> i <span class="op">&lt;</span> <span class="bu">len</span>(band_names):</span>
<span id="cb16-69"><a href="#cb16-69" aria-hidden="true" tabindex="-1"></a>                    dst.set_band_description(i <span class="op">+</span> <span class="dv">1</span>, band_names[i])</span>
<span id="cb16-70"><a href="#cb16-70" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-71"><a href="#cb16-71" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="ss">f"💾 Saved GeoTIFF: </span><span class="sc">{</span>output_path<span class="sc">}</span><span class="ss">"</span>)</span>
<span id="cb16-72"><a href="#cb16-72" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="ss">f"   Shape: </span><span class="sc">{</span>data<span class="sc">.</span>shape<span class="sc">}</span><span class="ss">"</span>)</span>
<span id="cb16-73"><a href="#cb16-73" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="ss">f"   CRS: </span><span class="sc">{</span>crs<span class="sc">}</span><span class="ss">"</span>)</span>
<span id="cb16-74"><a href="#cb16-74" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="ss">f"   Compression: deflate, tiled"</span>)</span>
<span id="cb16-75"><a href="#cb16-75" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-76"><a href="#cb16-76" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"✅ Geospatial data export functions ready"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>✅ Geospatial data export functions ready</code></pre>
</div>
</div>
<div class="callout callout-style-default callout-note callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Geospatial Data Standards
</div>
</div>
<div class="callout-body-container callout-body">
<ul>
<li><strong>GeoTIFF with COG optimization</strong> ensures cloud-native accessibility</li>
<li><strong>CRS preservation</strong> maintains spatial accuracy across platforms</li>
<li><strong>Lossless compression</strong> reduces storage costs without data loss</li>
<li><strong>Band descriptions</strong> provide metadata for analysis reproducibility</li>
</ul>
</div>
</div>
<hr>
</section>
</section>
<section id="section-8-advanced-workflow-patterns" class="level2">
<h2 class="anchored" data-anchor-id="section-8-advanced-workflow-patterns">Section 8: Advanced Workflow Patterns 🚀</h2>
<div class="callout callout-style-default callout-tip callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Learning Objectives
</div>
</div>
<div class="callout-body-container callout-body">
<ul>
<li>Design scalable spatial partitioning strategies for large-scale analysis</li>
<li>Implement testing frameworks for geospatial data pipelines</li>
<li>Master parallel processing patterns for satellite data workflows</li>
<li>Create adaptive processing strategies based on scene characteristics</li>
</ul>
</div>
</div>
<section id="scalable-geospatial-processing-architectures" class="level3">
<h3 class="anchored" data-anchor-id="scalable-geospatial-processing-architectures">Scalable Geospatial Processing Architectures</h3>
<p>Large-scale satellite analysis requires sophisticated workflow patterns:</p>
<ul>
<li><strong>Spatial Partitioning</strong>: Divide scenes into manageable processing units</li>
<li><strong>Adaptive Strategies</strong>: Adjust processing based on data characteristics</li>
<li><strong>Quality Assurance</strong>: Automated testing of processing pipelines</li>
<li><strong>Parallel Execution</strong>: Leverage multiple cores/nodes for efficiency</li>
</ul>
<div id="5ca90f72" class="cell" data-execution_count="12">
<div class="sourceCode cell-code" id="cb18"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb18-1"><a href="#cb18-1" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> create_scene_tiles(item, tile_size: Tuple[<span class="bu">int</span>, <span class="bu">int</span>] <span class="op">=</span> (<span class="dv">3</span>, <span class="dv">3</span>)):</span>
<span id="cb18-2"><a href="#cb18-2" aria-hidden="true" tabindex="-1"></a>    <span class="co">"""</span></span>
<span id="cb18-3"><a href="#cb18-3" aria-hidden="true" tabindex="-1"></a><span class="co">    Create systematic spatial partitioning for parallel processing workflows.</span></span>
<span id="cb18-4"><a href="#cb18-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb18-5"><a href="#cb18-5" aria-hidden="true" tabindex="-1"></a><span class="co">    This tiling approach enables several advanced patterns:</span></span>
<span id="cb18-6"><a href="#cb18-6" aria-hidden="true" tabindex="-1"></a><span class="co">    1. Parallel Processing: Independent tiles can be processed simultaneously</span></span>
<span id="cb18-7"><a href="#cb18-7" aria-hidden="true" tabindex="-1"></a><span class="co">    2. Memory Management: Process large scenes without loading entirely</span></span>
<span id="cb18-8"><a href="#cb18-8" aria-hidden="true" tabindex="-1"></a><span class="co">    3. Quality Control: Test processing on representative tiles first</span></span>
<span id="cb18-9"><a href="#cb18-9" aria-hidden="true" tabindex="-1"></a><span class="co">    4. Scalability: Extend to arbitrary scene sizes and processing resources</span></span>
<span id="cb18-10"><a href="#cb18-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb18-11"><a href="#cb18-11" aria-hidden="true" tabindex="-1"></a><span class="co">    Parameters</span></span>
<span id="cb18-12"><a href="#cb18-12" aria-hidden="true" tabindex="-1"></a><span class="co">    ----------</span></span>
<span id="cb18-13"><a href="#cb18-13" aria-hidden="true" tabindex="-1"></a><span class="co">    item : pystac.Item</span></span>
<span id="cb18-14"><a href="#cb18-14" aria-hidden="true" tabindex="-1"></a><span class="co">        STAC item to partition</span></span>
<span id="cb18-15"><a href="#cb18-15" aria-hidden="true" tabindex="-1"></a><span class="co">    tile_size : Tuple[int, int]</span></span>
<span id="cb18-16"><a href="#cb18-16" aria-hidden="true" tabindex="-1"></a><span class="co">        Grid dimensions (nx, ny)</span></span>
<span id="cb18-17"><a href="#cb18-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb18-18"><a href="#cb18-18" aria-hidden="true" tabindex="-1"></a><span class="co">    Returns</span></span>
<span id="cb18-19"><a href="#cb18-19" aria-hidden="true" tabindex="-1"></a><span class="co">    -------</span></span>
<span id="cb18-20"><a href="#cb18-20" aria-hidden="true" tabindex="-1"></a><span class="co">    List[Dict]</span></span>
<span id="cb18-21"><a href="#cb18-21" aria-hidden="true" tabindex="-1"></a><span class="co">        Tile metadata with bounding boxes and processing information</span></span>
<span id="cb18-22"><a href="#cb18-22" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb18-23"><a href="#cb18-23" aria-hidden="true" tabindex="-1"></a><span class="co">    Design Pattern: Strategy Pattern for Spatial Partitioning</span></span>
<span id="cb18-24"><a href="#cb18-24" aria-hidden="true" tabindex="-1"></a><span class="co">    - Provides flexible tiling strategies for different use cases</span></span>
<span id="cb18-25"><a href="#cb18-25" aria-hidden="true" tabindex="-1"></a><span class="co">    - Encapsulates spatial mathematics complexity</span></span>
<span id="cb18-26"><a href="#cb18-26" aria-hidden="true" tabindex="-1"></a><span class="co">    - Enables systematic quality control and testing</span></span>
<span id="cb18-27"><a href="#cb18-27" aria-hidden="true" tabindex="-1"></a><span class="co">    """</span></span>
<span id="cb18-28"><a href="#cb18-28" aria-hidden="true" tabindex="-1"></a>    tiles <span class="op">=</span> []</span>
<span id="cb18-29"><a href="#cb18-29" aria-hidden="true" tabindex="-1"></a>    nx, ny <span class="op">=</span> tile_size</span>
<span id="cb18-30"><a href="#cb18-30" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb18-31"><a href="#cb18-31" aria-hidden="true" tabindex="-1"></a>    scene_info <span class="op">=</span> get_scene_info(item)</span>
<span id="cb18-32"><a href="#cb18-32" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb18-33"><a href="#cb18-33" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="ss">f"🔲 Creating </span><span class="sc">{</span>nx<span class="sc">}</span><span class="ss">×</span><span class="sc">{</span>ny<span class="sc">}</span><span class="ss"> tile grid from scene..."</span>)</span>
<span id="cb18-34"><a href="#cb18-34" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="ss">f"   Total tiles: </span><span class="sc">{</span>nx <span class="op">*</span> ny<span class="sc">}</span><span class="ss">"</span>)</span>
<span id="cb18-35"><a href="#cb18-35" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="ss">f"   Scene area: </span><span class="sc">{</span>scene_info[<span class="st">'area_km2'</span>]<span class="sc">:.0f}</span><span class="ss"> km²"</span>)</span>
<span id="cb18-36"><a href="#cb18-36" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb18-37"><a href="#cb18-37" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> i <span class="kw">in</span> <span class="bu">range</span>(nx):</span>
<span id="cb18-38"><a href="#cb18-38" aria-hidden="true" tabindex="-1"></a>        <span class="cf">for</span> j <span class="kw">in</span> <span class="bu">range</span>(ny):</span>
<span id="cb18-39"><a href="#cb18-39" aria-hidden="true" tabindex="-1"></a>            <span class="co"># Calculate percentage ranges for this tile</span></span>
<span id="cb18-40"><a href="#cb18-40" aria-hidden="true" tabindex="-1"></a>            x_start <span class="op">=</span> (i <span class="op">/</span> nx) <span class="op">*</span> <span class="dv">100</span></span>
<span id="cb18-41"><a href="#cb18-41" aria-hidden="true" tabindex="-1"></a>            x_end <span class="op">=</span> ((i <span class="op">+</span> <span class="dv">1</span>) <span class="op">/</span> nx) <span class="op">*</span> <span class="dv">100</span></span>
<span id="cb18-42"><a href="#cb18-42" aria-hidden="true" tabindex="-1"></a>            y_start <span class="op">=</span> (j <span class="op">/</span> ny) <span class="op">*</span> <span class="dv">100</span></span>
<span id="cb18-43"><a href="#cb18-43" aria-hidden="true" tabindex="-1"></a>            y_end <span class="op">=</span> ((j <span class="op">+</span> <span class="dv">1</span>) <span class="op">/</span> ny) <span class="op">*</span> <span class="dv">100</span></span>
<span id="cb18-44"><a href="#cb18-44" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb18-45"><a href="#cb18-45" aria-hidden="true" tabindex="-1"></a>            <span class="co"># Generate tile bounding box</span></span>
<span id="cb18-46"><a href="#cb18-46" aria-hidden="true" tabindex="-1"></a>            tile_bbox <span class="op">=</span> get_subset_from_scene(</span>
<span id="cb18-47"><a href="#cb18-47" aria-hidden="true" tabindex="-1"></a>                item,</span>
<span id="cb18-48"><a href="#cb18-48" aria-hidden="true" tabindex="-1"></a>                x_range<span class="op">=</span>(x_start, x_end),</span>
<span id="cb18-49"><a href="#cb18-49" aria-hidden="true" tabindex="-1"></a>                y_range<span class="op">=</span>(y_start, y_end)</span>
<span id="cb18-50"><a href="#cb18-50" aria-hidden="true" tabindex="-1"></a>            )</span>
<span id="cb18-51"><a href="#cb18-51" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb18-52"><a href="#cb18-52" aria-hidden="true" tabindex="-1"></a>            <span class="co"># Package tile metadata for processing</span></span>
<span id="cb18-53"><a href="#cb18-53" aria-hidden="true" tabindex="-1"></a>            tile_info <span class="op">=</span> {</span>
<span id="cb18-54"><a href="#cb18-54" aria-hidden="true" tabindex="-1"></a>                <span class="st">'tile_id'</span>: <span class="ss">f"</span><span class="sc">{</span>i<span class="sc">}</span><span class="ss">_</span><span class="sc">{</span>j<span class="sc">}</span><span class="ss">"</span>,</span>
<span id="cb18-55"><a href="#cb18-55" aria-hidden="true" tabindex="-1"></a>                <span class="st">'row'</span>: j,</span>
<span id="cb18-56"><a href="#cb18-56" aria-hidden="true" tabindex="-1"></a>                <span class="st">'col'</span>: i,</span>
<span id="cb18-57"><a href="#cb18-57" aria-hidden="true" tabindex="-1"></a>                <span class="st">'bbox'</span>: tile_bbox,</span>
<span id="cb18-58"><a href="#cb18-58" aria-hidden="true" tabindex="-1"></a>                <span class="st">'x_range'</span>: (x_start, x_end),</span>
<span id="cb18-59"><a href="#cb18-59" aria-hidden="true" tabindex="-1"></a>                <span class="st">'y_range'</span>: (y_start, y_end),</span>
<span id="cb18-60"><a href="#cb18-60" aria-hidden="true" tabindex="-1"></a>                <span class="st">'area_percent'</span>: ((x_end <span class="op">-</span> x_start) <span class="op">*</span> (y_end <span class="op">-</span> y_start)) <span class="op">/</span> <span class="fl">100.0</span>,</span>
<span id="cb18-61"><a href="#cb18-61" aria-hidden="true" tabindex="-1"></a>                <span class="st">'processing_priority'</span>: <span class="st">'high'</span> <span class="cf">if</span> (i <span class="op">==</span> nx<span class="op">//</span><span class="dv">2</span> <span class="kw">and</span> j <span class="op">==</span> ny<span class="op">//</span><span class="dv">2</span>) <span class="cf">else</span> <span class="st">'normal'</span>  <span class="co"># Center tile first</span></span>
<span id="cb18-62"><a href="#cb18-62" aria-hidden="true" tabindex="-1"></a>            }</span>
<span id="cb18-63"><a href="#cb18-63" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb18-64"><a href="#cb18-64" aria-hidden="true" tabindex="-1"></a>            tiles.append(tile_info)</span>
<span id="cb18-65"><a href="#cb18-65" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb18-66"><a href="#cb18-66" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="ss">f"   ✅ Created </span><span class="sc">{</span><span class="bu">len</span>(tiles)<span class="sc">}</span><span class="ss"> tiles, each covering </span><span class="sc">{</span>tiles[<span class="dv">0</span>][<span class="st">'area_percent'</span>]<span class="sc">:.1f}</span><span class="ss">% of scene"</span>)</span>
<span id="cb18-67"><a href="#cb18-67" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> tiles</span>
<span id="cb18-68"><a href="#cb18-68" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb18-69"><a href="#cb18-69" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> test_subset_functionality(item):</span>
<span id="cb18-70"><a href="#cb18-70" aria-hidden="true" tabindex="-1"></a>    <span class="co">"""</span></span>
<span id="cb18-71"><a href="#cb18-71" aria-hidden="true" tabindex="-1"></a><span class="co">    Automated quality assurance for data loading pipelines.</span></span>
<span id="cb18-72"><a href="#cb18-72" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb18-73"><a href="#cb18-73" aria-hidden="true" tabindex="-1"></a><span class="co">    This testing approach demonstrates:</span></span>
<span id="cb18-74"><a href="#cb18-74" aria-hidden="true" tabindex="-1"></a><span class="co">    1. Smoke Testing: Verify basic functionality before full processing</span></span>
<span id="cb18-75"><a href="#cb18-75" aria-hidden="true" tabindex="-1"></a><span class="co">    2. Representative Sampling: Test with manageable data subset</span></span>
<span id="cb18-76"><a href="#cb18-76" aria-hidden="true" tabindex="-1"></a><span class="co">    3. Error Detection: Identify issues early in processing pipeline</span></span>
<span id="cb18-77"><a href="#cb18-77" aria-hidden="true" tabindex="-1"></a><span class="co">    4. Performance Validation: Ensure acceptable loading performance</span></span>
<span id="cb18-78"><a href="#cb18-78" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb18-79"><a href="#cb18-79" aria-hidden="true" tabindex="-1"></a><span class="co">    Parameters</span></span>
<span id="cb18-80"><a href="#cb18-80" aria-hidden="true" tabindex="-1"></a><span class="co">    ----------</span></span>
<span id="cb18-81"><a href="#cb18-81" aria-hidden="true" tabindex="-1"></a><span class="co">    item : pystac.Item</span></span>
<span id="cb18-82"><a href="#cb18-82" aria-hidden="true" tabindex="-1"></a><span class="co">        STAC item to test</span></span>
<span id="cb18-83"><a href="#cb18-83" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb18-84"><a href="#cb18-84" aria-hidden="true" tabindex="-1"></a><span class="co">    Returns</span></span>
<span id="cb18-85"><a href="#cb18-85" aria-hidden="true" tabindex="-1"></a><span class="co">    -------</span></span>
<span id="cb18-86"><a href="#cb18-86" aria-hidden="true" tabindex="-1"></a><span class="co">    bool</span></span>
<span id="cb18-87"><a href="#cb18-87" aria-hidden="true" tabindex="-1"></a><span class="co">        True if subset functionality is working correctly</span></span>
<span id="cb18-88"><a href="#cb18-88" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb18-89"><a href="#cb18-89" aria-hidden="true" tabindex="-1"></a><span class="co">    Design Pattern: Chain of Responsibility for Quality Assurance</span></span>
<span id="cb18-90"><a href="#cb18-90" aria-hidden="true" tabindex="-1"></a><span class="co">    - Implements systematic testing hierarchy</span></span>
<span id="cb18-91"><a href="#cb18-91" aria-hidden="true" tabindex="-1"></a><span class="co">    - Provides early failure detection</span></span>
<span id="cb18-92"><a href="#cb18-92" aria-hidden="true" tabindex="-1"></a><span class="co">    - Validates core functionality before expensive operations</span></span>
<span id="cb18-93"><a href="#cb18-93" aria-hidden="true" tabindex="-1"></a><span class="co">    """</span></span>
<span id="cb18-94"><a href="#cb18-94" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="ss">f"🧪 Testing subset functionality..."</span>)</span>
<span id="cb18-95"><a href="#cb18-95" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb18-96"><a href="#cb18-96" aria-hidden="true" tabindex="-1"></a>    <span class="cf">try</span>:</span>
<span id="cb18-97"><a href="#cb18-97" aria-hidden="true" tabindex="-1"></a>        <span class="co"># Test with small central area (minimal data transfer)</span></span>
<span id="cb18-98"><a href="#cb18-98" aria-hidden="true" tabindex="-1"></a>        test_bbox <span class="op">=</span> get_subset_from_scene(item, x_range<span class="op">=</span>(<span class="dv">40</span>, <span class="dv">60</span>), y_range<span class="op">=</span>(<span class="dv">40</span>, <span class="dv">60</span>))</span>
<span id="cb18-99"><a href="#cb18-99" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb18-100"><a href="#cb18-100" aria-hidden="true" tabindex="-1"></a>        <span class="co"># Load minimal data for testing</span></span>
<span id="cb18-101"><a href="#cb18-101" aria-hidden="true" tabindex="-1"></a>        test_data <span class="op">=</span> load_sentinel2_bands(</span>
<span id="cb18-102"><a href="#cb18-102" aria-hidden="true" tabindex="-1"></a>            item,</span>
<span id="cb18-103"><a href="#cb18-103" aria-hidden="true" tabindex="-1"></a>            bands<span class="op">=</span>[<span class="st">'B04'</span>],  <span class="co"># Single band reduces test time</span></span>
<span id="cb18-104"><a href="#cb18-104" aria-hidden="true" tabindex="-1"></a>            subset_bbox<span class="op">=</span>test_bbox,</span>
<span id="cb18-105"><a href="#cb18-105" aria-hidden="true" tabindex="-1"></a>            max_retries<span class="op">=</span><span class="dv">2</span></span>
<span id="cb18-106"><a href="#cb18-106" aria-hidden="true" tabindex="-1"></a>        )</span>
<span id="cb18-107"><a href="#cb18-107" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb18-108"><a href="#cb18-108" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> <span class="st">'B04'</span> <span class="kw">in</span> test_data:</span>
<span id="cb18-109"><a href="#cb18-109" aria-hidden="true" tabindex="-1"></a>            shape <span class="op">=</span> test_data[<span class="st">'B04'</span>].shape</span>
<span id="cb18-110"><a href="#cb18-110" aria-hidden="true" tabindex="-1"></a>            has_data <span class="op">=</span> test_data[<span class="st">'B04'</span>].size <span class="op">&gt;</span> <span class="dv">0</span></span>
<span id="cb18-111"><a href="#cb18-111" aria-hidden="true" tabindex="-1"></a>            <span class="bu">print</span>(<span class="ss">f"   ✅ Subset test successful: </span><span class="sc">{</span>shape<span class="sc">}</span><span class="ss"> pixels, </span><span class="sc">{</span>test_data[<span class="st">'B04'</span>]<span class="sc">.</span>size<span class="sc">}</span><span class="ss"> total"</span>)</span>
<span id="cb18-112"><a href="#cb18-112" aria-hidden="true" tabindex="-1"></a>            <span class="cf">return</span> <span class="va">True</span></span>
<span id="cb18-113"><a href="#cb18-113" aria-hidden="true" tabindex="-1"></a>        <span class="cf">else</span>:</span>
<span id="cb18-114"><a href="#cb18-114" aria-hidden="true" tabindex="-1"></a>            <span class="bu">print</span>(<span class="ss">f"   ❌ Subset test failed: no data returned"</span>)</span>
<span id="cb18-115"><a href="#cb18-115" aria-hidden="true" tabindex="-1"></a>            <span class="cf">return</span> <span class="va">False</span></span>
<span id="cb18-116"><a href="#cb18-116" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb18-117"><a href="#cb18-117" aria-hidden="true" tabindex="-1"></a>    <span class="cf">except</span> <span class="pp">Exception</span> <span class="im">as</span> e:</span>
<span id="cb18-118"><a href="#cb18-118" aria-hidden="true" tabindex="-1"></a>        <span class="bu">print</span>(<span class="ss">f"   ❌ Subset test failed: </span><span class="sc">{</span><span class="bu">str</span>(e)[:<span class="dv">50</span>]<span class="sc">}</span><span class="ss">..."</span>)</span>
<span id="cb18-119"><a href="#cb18-119" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> <span class="va">False</span></span>
<span id="cb18-120"><a href="#cb18-120" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb18-121"><a href="#cb18-121" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"✅ Advanced workflow pattern functions ready"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>✅ Advanced workflow pattern functions ready</code></pre>
</div>
</div>
<div class="callout callout-style-default callout-note callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Scalable Processing Patterns
</div>
</div>
<div class="callout-body-container callout-body">
<ul>
<li><strong>Systematic tiling</strong> enables parallel processing of large datasets</li>
<li><strong>Quality assurance testing</strong> prevents failures in production workflows</li>
<li><strong>Adaptive processing priorities</strong> optimize resource utilization</li>
<li><strong>Metadata packaging</strong> supports complex workflow orchestration</li>
</ul>
</div>
</div>
</section>
</section>
<section id="summary-your-geospatial-ai-toolkit" class="level2">
<h2 class="anchored" data-anchor-id="summary-your-geospatial-ai-toolkit">Summary: Your Geospatial AI Toolkit</h2>
<p>You now have a comprehensive, production-ready toolkit with:</p>
<section id="core-capabilities" class="level3">
<h3 class="anchored" data-anchor-id="core-capabilities">Core Capabilities</h3>
<ol type="1">
<li><strong>🔐 Enterprise Authentication</strong>: Secure, scalable API access patterns</li>
<li><strong>🔍 Intelligent Data Discovery</strong>: Cloud-native search with optimization</li>
<li><strong>📥 Memory-Efficient Loading</strong>: Robust data access with subsetting</li>
<li><strong>📐 Spatial Processing</strong>: Percentage-based, reproducible operations</li>
<li><strong>🔬 Spectral Analysis</strong>: Publication-quality processing pipelines</li>
<li><strong>📊 Scientific Visualization</strong>: Adaptive, informative displays</li>
<li><strong>💾 Standards-Compliant Export</strong>: Interoperable data formats</li>
<li><strong>🚀 Scalable Workflows</strong>: Parallel processing and quality assurance</li>
</ol>
</section>
<section id="design-philosophy" class="level3">
<h3 class="anchored" data-anchor-id="design-philosophy">Design Philosophy</h3>
<p>Each function embodies software engineering best practices:</p>
<ul>
<li><strong>Error Handling</strong>: Graceful degradation and informative error messages</li>
<li><strong>Composability</strong>: Functions work together in complex workflows</li>
<li><strong>Extensibility</strong>: Easy to modify and extend for new requirements</li>
<li><strong>Documentation</strong>: Clear examples and architectural reasoning</li>
</ul>
</section>
<section id="ready-for-production" class="level3">
<h3 class="anchored" data-anchor-id="ready-for-production">Ready for Production</h3>
<p>These functions are designed for real-world deployment:</p>
<ul>
<li><strong>Scalability</strong>: Handle datasets from small studies to global analysis</li>
<li><strong>Reliability</strong>: Robust error handling and recovery mechanisms</li>
<li><strong>Performance</strong>: Memory-efficient algorithms and cloud optimization</li>
<li><strong>Maintainability</strong>: Clear code structure and comprehensive documentation</li>
</ul>
</section>
</section>
<section id="troubleshooting" class="level2">
<h2 class="anchored" data-anchor-id="troubleshooting">Troubleshooting</h2>
<ul>
<li><strong>Systematic tiling</strong> enables parallel processing of large datasets</li>
<li><strong>Quality assurance testing</strong> prevents failures in production workflows</li>
<li><strong>Adaptive processing priorities</strong> optimize resource utilization</li>
<li><strong>Metadata packaging</strong> supports complex workflow orchestration</li>
</ul>
<hr>
</section>
<section id="step-2-understanding-stac-apis-and-cloud-native-geospatial-architecture" class="level2">
<h2 class="anchored" data-anchor-id="step-2-understanding-stac-apis-and-cloud-native-geospatial-architecture">Step 2: Understanding STAC APIs and Cloud-Native Geospatial Architecture</h2>
<div class="callout callout-style-default callout-tip callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Learning Objectives
</div>
</div>
<div class="callout-body-container callout-body">
<p>By the end of this section, you will:</p>
<p>Understand the STAC specification and its role in modern geospatial architecture Connect to cloud-native data catalogs with proper authentication Explore available satellite datasets and their characteristics Design robust data discovery workflows for production systems</p>
</div>
</div>
<section id="the-stac-revolution-from-data-downloads-to-cloud-native-discovery" class="level3">
<h3 class="anchored" data-anchor-id="the-stac-revolution-from-data-downloads-to-cloud-native-discovery">The STAC Revolution: From Data Downloads to Cloud-Native Discovery</h3>
<p><strong>STAC (SpatioTemporal Asset Catalog)</strong> represents a fundamental shift in how we access geospatial data. Instead of downloading entire datasets (often terabytes), STAC enables intelligent, on-demand access to exactly the data you need.</p>
<section id="why-stac-matters-for-geospatial-ai" class="level4">
<h4 class="anchored" data-anchor-id="why-stac-matters-for-geospatial-ai">Why STAC Matters for Geospatial AI</h4>
<p>Traditional satellite data distribution faced several challenges. Users were required to download and store massive datasets locally, leading to significant storage bottlenecks. There was no standardized way to search across different providers, making data discovery difficult. Before analysis could begin, heavy preprocessing was often necessary, creating additional barriers. Furthermore, tracking data lineage and updates was challenging, complicating version control.</p>
<p>STAC addresses these issues by enabling federated discovery, allowing users to search across multiple data providers through a unified interface. It supports lazy loading, so only the necessary spatial and temporal subsets are accessed. The use of rich, standardized metadata enables intelligent filtering of data. Additionally, STAC is optimized for the cloud, providing direct access to analysis-ready data stored remotely.</p>
</section>
</section>
<section id="stac-architecture-components" class="level3">
<h3 class="anchored" data-anchor-id="stac-architecture-components">STAC Architecture Components</h3>
<p>The STAC architecture is composed of several key elements. STAC Items represent individual scenes or data granules, each described with standardized metadata. These items are grouped into STAC Collections, which organize related items, such as all Sentinel-2 data. Collections and items are further structured within STAC Catalogs, creating a hierarchical organization that enables efficient navigation and discovery. Access to these resources is provided through STAC APIs, which are RESTful interfaces designed for searching and retrieving geospatial data.</p>
</section>
<section id="practical-stac-connection-microsoft-planetary-computer" class="level3">
<h3 class="anchored" data-anchor-id="practical-stac-connection-microsoft-planetary-computer">Practical STAC Connection: Microsoft Planetary Computer</h3>
<p>Microsoft Planetary Computer hosts one of the world’s largest STAC catalogs, providing free access to petabytes of environmental data. Let’s establish a robust connection and explore available datasets.</p>
<section id="testing-stac-connectivity-and-catalog-discovery" class="level4">
<h4 class="anchored" data-anchor-id="testing-stac-connectivity-and-catalog-discovery">Testing STAC Connectivity and Catalog Discovery</h4>
<p>This connection test demonstrates several important concepts for production geospatial systems:</p>
<div id="fcc109ed" class="cell" data-execution_count="13">
<div class="sourceCode cell-code" id="cb20"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb20-1"><a href="#cb20-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Connect to STAC catalog</span></span>
<span id="cb20-2"><a href="#cb20-2" aria-hidden="true" tabindex="-1"></a><span class="cf">try</span>:</span>
<span id="cb20-3"><a href="#cb20-3" aria-hidden="true" tabindex="-1"></a>    catalog <span class="op">=</span> Client.<span class="bu">open</span>(</span>
<span id="cb20-4"><a href="#cb20-4" aria-hidden="true" tabindex="-1"></a>        <span class="st">"https://planetarycomputer.microsoft.com/api/stac/v1"</span>,</span>
<span id="cb20-5"><a href="#cb20-5" aria-hidden="true" tabindex="-1"></a>        modifier<span class="op">=</span>pc.sign_inplace</span>
<span id="cb20-6"><a href="#cb20-6" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb20-7"><a href="#cb20-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-8"><a href="#cb20-8" aria-hidden="true" tabindex="-1"></a>    logger.info(<span class="st">"Connected to Planetary Computer STAC API"</span>)</span>
<span id="cb20-9"><a href="#cb20-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-10"><a href="#cb20-10" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Get catalog information</span></span>
<span id="cb20-11"><a href="#cb20-11" aria-hidden="true" tabindex="-1"></a>    <span class="cf">try</span>:</span>
<span id="cb20-12"><a href="#cb20-12" aria-hidden="true" tabindex="-1"></a>        catalog_info <span class="op">=</span> catalog.get_self()</span>
<span id="cb20-13"><a href="#cb20-13" aria-hidden="true" tabindex="-1"></a>        logger.info(<span class="ss">f"Catalog: </span><span class="sc">{</span>catalog_info<span class="sc">.</span>title<span class="sc">}</span><span class="ss">"</span>)</span>
<span id="cb20-14"><a href="#cb20-14" aria-hidden="true" tabindex="-1"></a>    <span class="cf">except</span> <span class="pp">Exception</span>:</span>
<span id="cb20-15"><a href="#cb20-15" aria-hidden="true" tabindex="-1"></a>        logger.info(<span class="st">"Basic connection successful"</span>)</span>
<span id="cb20-16"><a href="#cb20-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-17"><a href="#cb20-17" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Explore key satellite datasets</span></span>
<span id="cb20-18"><a href="#cb20-18" aria-hidden="true" tabindex="-1"></a>    satellite_collections <span class="op">=</span> {</span>
<span id="cb20-19"><a href="#cb20-19" aria-hidden="true" tabindex="-1"></a>        <span class="st">'sentinel-2-l2a'</span>: <span class="st">'Sentinel-2 Level 2A (10m optical)'</span>,</span>
<span id="cb20-20"><a href="#cb20-20" aria-hidden="true" tabindex="-1"></a>        <span class="st">'landsat-c2-l2'</span>: <span class="st">'Landsat Collection 2 Level 2 (30m optical)'</span>,</span>
<span id="cb20-21"><a href="#cb20-21" aria-hidden="true" tabindex="-1"></a>        <span class="st">'sentinel-1-grd'</span>: <span class="st">'Sentinel-1 SAR (radar)'</span>,</span>
<span id="cb20-22"><a href="#cb20-22" aria-hidden="true" tabindex="-1"></a>        <span class="st">'naip'</span>: <span class="st">'NAIP (1m aerial imagery)'</span></span>
<span id="cb20-23"><a href="#cb20-23" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb20-24"><a href="#cb20-24" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-25"><a href="#cb20-25" aria-hidden="true" tabindex="-1"></a>    available_collections <span class="op">=</span> []</span>
<span id="cb20-26"><a href="#cb20-26" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> collection_id, description <span class="kw">in</span> satellite_collections.items():</span>
<span id="cb20-27"><a href="#cb20-27" aria-hidden="true" tabindex="-1"></a>        <span class="cf">try</span>:</span>
<span id="cb20-28"><a href="#cb20-28" aria-hidden="true" tabindex="-1"></a>            collection <span class="op">=</span> catalog.get_collection(collection_id)</span>
<span id="cb20-29"><a href="#cb20-29" aria-hidden="true" tabindex="-1"></a>            available_collections.append(collection_id)</span>
<span id="cb20-30"><a href="#cb20-30" aria-hidden="true" tabindex="-1"></a>            logger.info(<span class="ss">f"Available: </span><span class="sc">{</span>description<span class="sc">}</span><span class="ss">"</span>)</span>
<span id="cb20-31"><a href="#cb20-31" aria-hidden="true" tabindex="-1"></a>        <span class="cf">except</span> <span class="pp">Exception</span>:</span>
<span id="cb20-32"><a href="#cb20-32" aria-hidden="true" tabindex="-1"></a>            logger.warning(<span class="ss">f"Not accessible: </span><span class="sc">{</span>description<span class="sc">}</span><span class="ss">"</span>)</span>
<span id="cb20-33"><a href="#cb20-33" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-34"><a href="#cb20-34" aria-hidden="true" tabindex="-1"></a>    logger.info(<span class="ss">f"Accessible collections: </span><span class="sc">{</span><span class="bu">len</span>(available_collections)<span class="sc">}</span><span class="ss">/</span><span class="sc">{</span><span class="bu">len</span>(satellite_collections)<span class="sc">}</span><span class="ss">"</span>)</span>
<span id="cb20-35"><a href="#cb20-35" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-36"><a href="#cb20-36" aria-hidden="true" tabindex="-1"></a><span class="cf">except</span> <span class="pp">Exception</span> <span class="im">as</span> e:</span>
<span id="cb20-37"><a href="#cb20-37" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="ss">f"</span><span class="ch">\n</span><span class="ss">❌ STAC connection failed: </span><span class="sc">{</span><span class="bu">str</span>(e)<span class="sc">}</span><span class="ss">"</span>)</span>
<span id="cb20-38"><a href="#cb20-38" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="ss">f"</span><span class="ch">\n</span><span class="ss">🔧 Troubleshooting steps:"</span>)</span>
<span id="cb20-39"><a href="#cb20-39" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="ss">f"   1. Verify internet connectivity"</span>)</span>
<span id="cb20-40"><a href="#cb20-40" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="ss">f"   2. Check Planetary Computer API status: https://planetarycomputer.microsoft.com/"</span>)</span>
<span id="cb20-41"><a href="#cb20-41" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="ss">f"   3. Ensure pystac-client is installed: pip install pystac-client"</span>)</span>
<span id="cb20-42"><a href="#cb20-42" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="ss">f"   4. Verify planetary-computer package: pip install planetary-computer"</span>)</span>
<span id="cb20-43"><a href="#cb20-43" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="ss">f"   5. Try again in a few minutes (temporary API issues)"</span>)</span>
<span id="cb20-44"><a href="#cb20-44" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-45"><a href="#cb20-45" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Provide fallback information for educational purposes</span></span>
<span id="cb20-46"><a href="#cb20-46" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="ss">f"</span><span class="ch">\n</span><span class="ss">📚 Educational Note: Even without connection, you now understand:"</span>)</span>
<span id="cb20-47"><a href="#cb20-47" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="ss">f"   • STAC APIs provide standardized geospatial data access"</span>)</span>
<span id="cb20-48"><a href="#cb20-48" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="ss">f"   • Cloud-native architectures eliminate data download requirements"</span>)</span>
<span id="cb20-49"><a href="#cb20-49" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="ss">f"   • Federated catalogs enable multi-provider data discovery"</span>)</span>
<span id="cb20-50"><a href="#cb20-50" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="ss">f"   • Authentication enables enhanced rate limits and access control"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>2025-09-21 09:52:46,135 - INFO - Connected to Planetary Computer STAC API
2025-09-21 09:52:46,136 - INFO - Basic connection successful
2025-09-21 09:52:47,234 - INFO - Available: Sentinel-2 Level 2A (10m optical)
2025-09-21 09:52:47,723 - INFO - Available: Landsat Collection 2 Level 2 (30m optical)
2025-09-21 09:52:48,182 - INFO - Available: Sentinel-1 SAR (radar)
2025-09-21 09:52:48,392 - INFO - Available: NAIP (1m aerial imagery)
2025-09-21 09:52:48,393 - INFO - Accessible collections: 4/4</code></pre>
</div>
</div>
</section>
</section>
</section>
<section id="connection-troubleshooting" class="level2">
<h2 class="anchored" data-anchor-id="connection-troubleshooting">Connection Troubleshooting</h2>
<p>If you encounter connection issues, first verify your internet connectivity and check your firewall settings. Keep in mind that anonymous users have lower API rate limits than authenticated users, which can also cause problems. You should also check the <a href="https://planetarycomputer.microsoft.com/">Planetary Computer status page</a> to see if there are any ongoing outages. Finally, make sure you have the latest versions of both the <code>pystac-client</code> and <code>planetary-computer</code> packages installed.</p>
<p>The connection process demonstrates real-world challenges in building production geospatial systems.</p>
<section id="understanding-collection-metadata-and-selection-criteria" class="level3">
<h3 class="anchored" data-anchor-id="understanding-collection-metadata-and-selection-criteria">Understanding Collection Metadata and Selection Criteria</h3>
<p>Each STAC collection contains rich metadata that helps you choose the right dataset for your analysis. Let’s explore how to make informed decisions about which satellite data to use:</p>
<hr>
</section>
</section>
<section id="step-3-spatial-analysis-design---defining-areas-of-interest" class="level2">
<h2 class="anchored" data-anchor-id="step-3-spatial-analysis-design---defining-areas-of-interest">Step 3: Spatial Analysis Design - Defining Areas of Interest</h2>
<section id="learning-objectives-9" class="level3">
<h3 class="anchored" data-anchor-id="learning-objectives-9">Learning Objectives</h3>
<p>By the end of this section, you will be able to understand coordinate systems and bounding box conventions in geospatial analysis, design effective study areas based on analysis objectives and data characteristics, create interactive maps for spatial context and validation, and apply best practices for reproducible spatial analysis workflows. :::</p>
</section>
<section id="the-art-and-science-of-spatial-scope-definition" class="level3">
<h3 class="anchored" data-anchor-id="the-art-and-science-of-spatial-scope-definition">The Art and Science of Spatial Scope Definition</h3>
<p>Defining your Area of Interest (AOI) is a critical design decision that influences several aspects of your analysis. The size of the area determines the amount of data you need to process and store. The validity of your analysis depends on how well your study boundaries align with relevant ecological or administrative regions. The location of your AOI affects satellite revisit patterns and data availability, and the way you define your area can impact processing efficiency, such as the choice of optimal tile sizes for your workflow.</p>
<section id="coordinate-systems-and-bounding-box-conventions" class="level4">
<h4 class="anchored" data-anchor-id="coordinate-systems-and-bounding-box-conventions">Coordinate Systems and Bounding Box Conventions</h4>
<p>For our AOI definition, we will use the WGS84 geographic coordinate system (EPSG:4326). In this system, longitude (X) represents the east-west position and ranges from -180° to +180°, with negative values indicating west. Latitude (Y) represents the north-south position and ranges from -90° to +90°, with negative values indicating south. Bounding boxes are formatted as [west, south, east, north], corresponding to (min_x, min_y, max_x, max_y).</p>
</section>
<section id="study-area-selection-san-francisco-bay-area" class="level4">
<h4 class="anchored" data-anchor-id="study-area-selection-san-francisco-bay-area">Study Area Selection: San Francisco Bay Area</h4>
<p>We’ll use the San Francisco Bay Area as our exemplar study region because it features a mix of urban, water, agricultural, and natural environments. The region is characterized by dynamic processes such as urban growth, vegetation changes, and water level fluctuations. It also benefits from frequent satellite coverage with minimal cloud interference and presents geographic complexity, including islands, peninsulas, and varied topography.</p>
<p><strong>Designing Area of Interest (AOI) for Geospatial Analysis</strong></p>
<p>This demonstrates spatial scope definition for satellite-based studies. We’ll work with the San Francisco Bay Area as our primary study area.</p>
<div id="4178b415" class="cell" data-execution_count="14">
<div class="sourceCode cell-code" id="cb22"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb22-1"><a href="#cb22-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Step 3A: Define Area of Interest with Geographic Reasoning</span></span>
<span id="cb22-2"><a href="#cb22-2" aria-hidden="true" tabindex="-1"></a><span class="co"># Primary study area: San Francisco Bay Area</span></span>
<span id="cb22-3"><a href="#cb22-3" aria-hidden="true" tabindex="-1"></a><span class="co"># Coordinates chosen to encompass the greater metropolitan region</span></span>
<span id="cb22-4"><a href="#cb22-4" aria-hidden="true" tabindex="-1"></a>sf_bay_bbox <span class="op">=</span> [<span class="op">-</span><span class="fl">122.5</span>, <span class="fl">37.3</span>, <span class="op">-</span><span class="fl">121.8</span>, <span class="fl">38.0</span>]  <span class="co"># [west, south, east, north]</span></span>
<span id="cb22-5"><a href="#cb22-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb22-6"><a href="#cb22-6" aria-hidden="true" tabindex="-1"></a><span class="co"># Import required libraries for spatial calculations</span></span>
<span id="cb22-7"><a href="#cb22-7" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> shapely.geometry <span class="im">import</span> box</span>
<span id="cb22-8"><a href="#cb22-8" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> os</span>
<span id="cb22-9"><a href="#cb22-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb22-10"><a href="#cb22-10" aria-hidden="true" tabindex="-1"></a><span class="co"># Create geometry object for area calculations</span></span>
<span id="cb22-11"><a href="#cb22-11" aria-hidden="true" tabindex="-1"></a>aoi_geom <span class="op">=</span> box(<span class="op">*</span>sf_bay_bbox)</span>
<span id="cb22-12"><a href="#cb22-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb22-13"><a href="#cb22-13" aria-hidden="true" tabindex="-1"></a><span class="co"># Calculate basic spatial metrics</span></span>
<span id="cb22-14"><a href="#cb22-14" aria-hidden="true" tabindex="-1"></a>area_degrees <span class="op">=</span> aoi_geom.area</span>
<span id="cb22-15"><a href="#cb22-15" aria-hidden="true" tabindex="-1"></a><span class="co"># Approximate conversion to kilometers (valid for mid-latitudes)</span></span>
<span id="cb22-16"><a href="#cb22-16" aria-hidden="true" tabindex="-1"></a>center_lat <span class="op">=</span> (sf_bay_bbox[<span class="dv">1</span>] <span class="op">+</span> sf_bay_bbox[<span class="dv">3</span>]) <span class="op">/</span> <span class="dv">2</span></span>
<span id="cb22-17"><a href="#cb22-17" aria-hidden="true" tabindex="-1"></a>lat_correction <span class="op">=</span> np.cos(np.radians(center_lat))</span>
<span id="cb22-18"><a href="#cb22-18" aria-hidden="true" tabindex="-1"></a>area_km2 <span class="op">=</span> area_degrees <span class="op">*</span> (<span class="fl">111.32</span> <span class="op">**</span> <span class="dv">2</span>) <span class="op">*</span> lat_correction  <span class="co"># 1 degree ≈ 111.32 km</span></span>
<span id="cb22-19"><a href="#cb22-19" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb22-20"><a href="#cb22-20" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"</span><span class="ch">\n</span><span class="ss">📊 AOI Spatial Characteristics:"</span>)</span>
<span id="cb22-21"><a href="#cb22-21" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"   📍 Region: San Francisco Bay Area"</span>)</span>
<span id="cb22-22"><a href="#cb22-22" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"   🗺️ Bounding box: </span><span class="sc">{</span>sf_bay_bbox<span class="sc">}</span><span class="ss">"</span>)</span>
<span id="cb22-23"><a href="#cb22-23" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"   📐 Dimensions: </span><span class="sc">{</span>(sf_bay_bbox[<span class="dv">2</span>] <span class="op">-</span> sf_bay_bbox[<span class="dv">0</span>])<span class="sc">:.2f}</span><span class="ss">° × </span><span class="sc">{</span>(sf_bay_bbox[<span class="dv">3</span>] <span class="op">-</span> sf_bay_bbox[<span class="dv">1</span>])<span class="sc">:.2f}</span><span class="ss">°"</span>)</span>
<span id="cb22-24"><a href="#cb22-24" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"   📏 Approximate area: </span><span class="sc">{</span>area_km2<span class="sc">:.0f}</span><span class="ss"> km²"</span>)</span>
<span id="cb22-25"><a href="#cb22-25" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"   🏙️ Population: ~8 million (Bay Area metropolitan region)"</span>)</span>
<span id="cb22-26"><a href="#cb22-26" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb22-27"><a href="#cb22-27" aria-hidden="true" tabindex="-1"></a><span class="co"># Provide alternative study areas for different research interests</span></span>
<span id="cb22-28"><a href="#cb22-28" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"</span><span class="ch">\n</span><span class="ss">🌐 Alternative AOI Options for Different Study Objectives:"</span>)</span>
<span id="cb22-29"><a href="#cb22-29" aria-hidden="true" tabindex="-1"></a>alternative_aois <span class="op">=</span> {</span>
<span id="cb22-30"><a href="#cb22-30" aria-hidden="true" tabindex="-1"></a>    <span class="st">"Los Angeles Basin"</span>: {</span>
<span id="cb22-31"><a href="#cb22-31" aria-hidden="true" tabindex="-1"></a>        <span class="st">"bbox"</span>: [<span class="op">-</span><span class="fl">118.7</span>, <span class="fl">33.7</span>, <span class="op">-</span><span class="fl">118.1</span>, <span class="fl">34.3</span>],</span>
<span id="cb22-32"><a href="#cb22-32" aria-hidden="true" tabindex="-1"></a>        <span class="st">"focus"</span>: <span class="st">"Urban heat islands, air quality, sprawl patterns"</span>,</span>
<span id="cb22-33"><a href="#cb22-33" aria-hidden="true" tabindex="-1"></a>        <span class="st">"challenges"</span>: <span class="st">"Frequent clouds, complex topography"</span></span>
<span id="cb22-34"><a href="#cb22-34" aria-hidden="true" tabindex="-1"></a>    },</span>
<span id="cb22-35"><a href="#cb22-35" aria-hidden="true" tabindex="-1"></a>    <span class="st">"New York City"</span>: {</span>
<span id="cb22-36"><a href="#cb22-36" aria-hidden="true" tabindex="-1"></a>        <span class="st">"bbox"</span>: [<span class="op">-</span><span class="fl">74.3</span>, <span class="fl">40.5</span>, <span class="op">-</span><span class="fl">73.7</span>, <span class="fl">40.9</span>],</span>
<span id="cb22-37"><a href="#cb22-37" aria-hidden="true" tabindex="-1"></a>        <span class="st">"focus"</span>: <span class="st">"Dense urban analysis, coastal processes"</span>,</span>
<span id="cb22-38"><a href="#cb22-38" aria-hidden="true" tabindex="-1"></a>        <span class="st">"challenges"</span>: <span class="st">"Seasonal cloud cover, urban shadows"</span></span>
<span id="cb22-39"><a href="#cb22-39" aria-hidden="true" tabindex="-1"></a>    },</span>
<span id="cb22-40"><a href="#cb22-40" aria-hidden="true" tabindex="-1"></a>    <span class="st">"Central Valley Agriculture"</span>: {</span>
<span id="cb22-41"><a href="#cb22-41" aria-hidden="true" tabindex="-1"></a>        <span class="st">"bbox"</span>: [<span class="op">-</span><span class="fl">121.5</span>, <span class="fl">36.0</span>, <span class="op">-</span><span class="fl">120.0</span>, <span class="fl">37.5</span>],</span>
<span id="cb22-42"><a href="#cb22-42" aria-hidden="true" tabindex="-1"></a>        <span class="st">"focus"</span>: <span class="st">"Crop monitoring, irrigation patterns, drought"</span>,</span>
<span id="cb22-43"><a href="#cb22-43" aria-hidden="true" tabindex="-1"></a>        <span class="st">"challenges"</span>: <span class="st">"Seasonal variations, haze"</span></span>
<span id="cb22-44"><a href="#cb22-44" aria-hidden="true" tabindex="-1"></a>    },</span>
<span id="cb22-45"><a href="#cb22-45" aria-hidden="true" tabindex="-1"></a>    <span class="st">"Florida Everglades"</span>: {</span>
<span id="cb22-46"><a href="#cb22-46" aria-hidden="true" tabindex="-1"></a>        <span class="st">"bbox"</span>: [<span class="op">-</span><span class="fl">81.5</span>, <span class="fl">25.0</span>, <span class="op">-</span><span class="fl">80.0</span>, <span class="fl">26.5</span>],</span>
<span id="cb22-47"><a href="#cb22-47" aria-hidden="true" tabindex="-1"></a>        <span class="st">"focus"</span>: <span class="st">"Wetland monitoring, water levels, restoration"</span>,</span>
<span id="cb22-48"><a href="#cb22-48" aria-hidden="true" tabindex="-1"></a>        <span class="st">"challenges"</span>: <span class="st">"Frequent clouds, seasonal flooding"</span></span>
<span id="cb22-49"><a href="#cb22-49" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb22-50"><a href="#cb22-50" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb22-51"><a href="#cb22-51" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb22-52"><a href="#cb22-52" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> region, info <span class="kw">in</span> alternative_aois.items():</span>
<span id="cb22-53"><a href="#cb22-53" aria-hidden="true" tabindex="-1"></a>    bbox <span class="op">=</span> info[<span class="st">"bbox"</span>]</span>
<span id="cb22-54"><a href="#cb22-54" aria-hidden="true" tabindex="-1"></a>    area_alt <span class="op">=</span> ((bbox[<span class="dv">2</span>] <span class="op">-</span> bbox[<span class="dv">0</span>]) <span class="op">*</span> (bbox[<span class="dv">3</span>] <span class="op">-</span> bbox[<span class="dv">1</span>]) <span class="op">*</span></span>
<span id="cb22-55"><a href="#cb22-55" aria-hidden="true" tabindex="-1"></a>                (<span class="fl">111.32</span> <span class="op">**</span> <span class="dv">2</span>) <span class="op">*</span> np.cos(np.radians((bbox[<span class="dv">1</span>] <span class="op">+</span> bbox[<span class="dv">3</span>]) <span class="op">/</span> <span class="dv">2</span>)))</span>
<span id="cb22-56"><a href="#cb22-56" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="ss">f"   🗺️ </span><span class="sc">{</span>region<span class="sc">}</span><span class="ss">: </span><span class="sc">{</span>info[<span class="st">'bbox'</span>]<span class="sc">}</span><span class="ss"> (</span><span class="sc">{</span>area_alt<span class="sc">:.0f}</span><span class="ss"> km²)"</span>)</span>
<span id="cb22-57"><a href="#cb22-57" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="ss">f"      🎯 Research focus: </span><span class="sc">{</span>info[<span class="st">'focus'</span>]<span class="sc">}</span><span class="ss">"</span>)</span>
<span id="cb22-58"><a href="#cb22-58" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="ss">f"      ⚠️ Considerations: </span><span class="sc">{</span>info[<span class="st">'challenges'</span>]<span class="sc">}</span><span class="ss">"</span>)</span>
<span id="cb22-59"><a href="#cb22-59" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb22-60"><a href="#cb22-60" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"</span><span class="ch">\n</span><span class="ss">💡 Pro Tip: Choose AOI based on:"</span>)</span>
<span id="cb22-61"><a href="#cb22-61" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"   1. Research objectives and required spatial resolution"</span>)</span>
<span id="cb22-62"><a href="#cb22-62" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"   2. Data availability and typical cloud cover patterns"</span>)</span>
<span id="cb22-63"><a href="#cb22-63" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"   3. Computational resources and processing time constraints"</span>)</span>
<span id="cb22-64"><a href="#cb22-64" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"   4. Ecological or administrative boundary alignment"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
📊 AOI Spatial Characteristics:
   📍 Region: San Francisco Bay Area
   🗺️ Bounding box: [-122.5, 37.3, -121.8, 38.0]
   📐 Dimensions: 0.70° × 0.70°
   📏 Approximate area: 4808 km²
   🏙️ Population: ~8 million (Bay Area metropolitan region)

🌐 Alternative AOI Options for Different Study Objectives:
   🗺️ Los Angeles Basin: [-118.7, 33.7, -118.1, 34.3] (3698 km²)
      🎯 Research focus: Urban heat islands, air quality, sprawl patterns
      ⚠️ Considerations: Frequent clouds, complex topography
   🗺️ New York City: [-74.3, 40.5, -73.7, 40.9] (2255 km²)
      🎯 Research focus: Dense urban analysis, coastal processes
      ⚠️ Considerations: Seasonal cloud cover, urban shadows
   🗺️ Central Valley Agriculture: [-121.5, 36.0, -120.0, 37.5] (22341 km²)
      🎯 Research focus: Crop monitoring, irrigation patterns, drought
      ⚠️ Considerations: Seasonal variations, haze
   🗺️ Florida Everglades: [-81.5, 25.0, -80.0, 26.5] (25114 km²)
      🎯 Research focus: Wetland monitoring, water levels, restoration
      ⚠️ Considerations: Frequent clouds, seasonal flooding

💡 Pro Tip: Choose AOI based on:
   1. Research objectives and required spatial resolution
   2. Data availability and typical cloud cover patterns
   3. Computational resources and processing time constraints
   4. Ecological or administrative boundary alignment</code></pre>
</div>
</div>
</section>
<section id="interactive-mapping-for-spatial-context-and-validation" class="level4">
<h4 class="anchored" data-anchor-id="interactive-mapping-for-spatial-context-and-validation">Interactive Mapping for Spatial Context and Validation</h4>
<p>Creating interactive maps serves several important purposes in geospatial analysis, such as providing spatial context to understand the geographic setting and features, validating that the area of interest (AOI) encompasses the intended study features, supporting stakeholder communication through visual representation for project discussions, and enabling quality assurance by helping to detect coordinate errors or unrealistic extents.</p>
<p><strong>Creating Interactive Map for Spatial Context:</strong></p>
<p>This demonstrates best practices for geospatial visualization with multiple basemap options.</p>
<div id="02e0b3dc" class="cell" data-execution_count="15">
<div class="sourceCode cell-code" id="cb24"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb24-1"><a href="#cb24-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Step 3B: Create Interactive Map with Multiple Basemap Options</span></span>
<span id="cb24-2"><a href="#cb24-2" aria-hidden="true" tabindex="-1"></a><span class="co"># Calculate map center for optimal display</span></span>
<span id="cb24-3"><a href="#cb24-3" aria-hidden="true" tabindex="-1"></a>center_lat <span class="op">=</span> (sf_bay_bbox[<span class="dv">1</span>] <span class="op">+</span> sf_bay_bbox[<span class="dv">3</span>]) <span class="op">/</span> <span class="dv">2</span></span>
<span id="cb24-4"><a href="#cb24-4" aria-hidden="true" tabindex="-1"></a>center_lon <span class="op">=</span> (sf_bay_bbox[<span class="dv">0</span>] <span class="op">+</span> sf_bay_bbox[<span class="dv">2</span>]) <span class="op">/</span> <span class="dv">2</span></span>
<span id="cb24-5"><a href="#cb24-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-6"><a href="#cb24-6" aria-hidden="true" tabindex="-1"></a><span class="co"># Initialize folium map with appropriate zoom level</span></span>
<span id="cb24-7"><a href="#cb24-7" aria-hidden="true" tabindex="-1"></a><span class="co"># Zoom level chosen to show entire AOI while maintaining detail</span></span>
<span id="cb24-8"><a href="#cb24-8" aria-hidden="true" tabindex="-1"></a>m <span class="op">=</span> folium.Map(</span>
<span id="cb24-9"><a href="#cb24-9" aria-hidden="true" tabindex="-1"></a>    location<span class="op">=</span>[center_lat, center_lon],</span>
<span id="cb24-10"><a href="#cb24-10" aria-hidden="true" tabindex="-1"></a>    zoom_start<span class="op">=</span><span class="dv">9</span>,  <span class="co"># Optimal for metropolitan area viewing</span></span>
<span id="cb24-11"><a href="#cb24-11" aria-hidden="true" tabindex="-1"></a>    tiles<span class="op">=</span><span class="st">'OpenStreetMap'</span></span>
<span id="cb24-12"><a href="#cb24-12" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb24-13"><a href="#cb24-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-14"><a href="#cb24-14" aria-hidden="true" tabindex="-1"></a><span class="co"># Add diverse basemap options for different analysis contexts</span></span>
<span id="cb24-15"><a href="#cb24-15" aria-hidden="true" tabindex="-1"></a>basemap_options <span class="op">=</span> {</span>
<span id="cb24-16"><a href="#cb24-16" aria-hidden="true" tabindex="-1"></a>    <span class="st">'CartoDB positron'</span>: {</span>
<span id="cb24-17"><a href="#cb24-17" aria-hidden="true" tabindex="-1"></a>        <span class="st">'layer'</span>: folium.TileLayer(<span class="st">'CartoDB positron'</span>, name<span class="op">=</span><span class="st">'Clean Basemap'</span>),</span>
<span id="cb24-18"><a href="#cb24-18" aria-hidden="true" tabindex="-1"></a>        <span class="st">'use_case'</span>: <span class="st">'Data overlay visualization, presentations'</span></span>
<span id="cb24-19"><a href="#cb24-19" aria-hidden="true" tabindex="-1"></a>    },</span>
<span id="cb24-20"><a href="#cb24-20" aria-hidden="true" tabindex="-1"></a>    <span class="st">'CartoDB dark_matter'</span>: {</span>
<span id="cb24-21"><a href="#cb24-21" aria-hidden="true" tabindex="-1"></a>        <span class="st">'layer'</span>: folium.TileLayer(<span class="st">'CartoDB dark_matter'</span>, name<span class="op">=</span><span class="st">'Dark Theme'</span>),</span>
<span id="cb24-22"><a href="#cb24-22" aria-hidden="true" tabindex="-1"></a>        <span class="st">'use_case'</span>: <span class="st">'Night mode, reducing eye strain'</span></span>
<span id="cb24-23"><a href="#cb24-23" aria-hidden="true" tabindex="-1"></a>    },</span>
<span id="cb24-24"><a href="#cb24-24" aria-hidden="true" tabindex="-1"></a>    <span class="st">'Esri World Imagery'</span>: {</span>
<span id="cb24-25"><a href="#cb24-25" aria-hidden="true" tabindex="-1"></a>        <span class="st">'layer'</span>: folium.TileLayer(</span>
<span id="cb24-26"><a href="#cb24-26" aria-hidden="true" tabindex="-1"></a>            tiles<span class="op">=</span><span class="st">'https://server.arcgisonline.com/ArcGIS/rest/services/World_Imagery/MapServer/tile/</span><span class="sc">{z}</span><span class="st">/</span><span class="sc">{y}</span><span class="st">/</span><span class="sc">{x}</span><span class="st">'</span>,</span>
<span id="cb24-27"><a href="#cb24-27" aria-hidden="true" tabindex="-1"></a>            attr<span class="op">=</span><span class="st">'Esri'</span>, name<span class="op">=</span><span class="st">'Satellite Imagery'</span>, overlay<span class="op">=</span><span class="va">False</span>, control<span class="op">=</span><span class="va">True</span></span>
<span id="cb24-28"><a href="#cb24-28" aria-hidden="true" tabindex="-1"></a>        ),</span>
<span id="cb24-29"><a href="#cb24-29" aria-hidden="true" tabindex="-1"></a>        <span class="st">'use_case'</span>: <span class="st">'Ground truth validation, visual interpretation'</span></span>
<span id="cb24-30"><a href="#cb24-30" aria-hidden="true" tabindex="-1"></a>    },</span>
<span id="cb24-31"><a href="#cb24-31" aria-hidden="true" tabindex="-1"></a>    <span class="st">'Stamen Terrain'</span>: {</span>
<span id="cb24-32"><a href="#cb24-32" aria-hidden="true" tabindex="-1"></a>        <span class="st">'layer'</span>: folium.TileLayer(</span>
<span id="cb24-33"><a href="#cb24-33" aria-hidden="true" tabindex="-1"></a>            <span class="st">'Stamen Terrain'</span>,</span>
<span id="cb24-34"><a href="#cb24-34" aria-hidden="true" tabindex="-1"></a>            name<span class="op">=</span><span class="st">'Topographic'</span>,</span>
<span id="cb24-35"><a href="#cb24-35" aria-hidden="true" tabindex="-1"></a>            attr<span class="op">=</span><span class="st">'Map tiles by Stamen Design, CC BY 3.0 — Map data © OpenStreetMap contributors'</span></span>
<span id="cb24-36"><a href="#cb24-36" aria-hidden="true" tabindex="-1"></a>        ),</span>
<span id="cb24-37"><a href="#cb24-37" aria-hidden="true" tabindex="-1"></a>        <span class="st">'use_case'</span>: <span class="st">'Elevation context, watershed analysis'</span></span>
<span id="cb24-38"><a href="#cb24-38" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb24-39"><a href="#cb24-39" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb24-40"><a href="#cb24-40" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-41"><a href="#cb24-41" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"   📚 Adding </span><span class="sc">{</span><span class="bu">len</span>(basemap_options)<span class="sc">}</span><span class="ss"> basemap options:"</span>)</span>
<span id="cb24-42"><a href="#cb24-42" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> name, info <span class="kw">in</span> basemap_options.items():</span>
<span id="cb24-43"><a href="#cb24-43" aria-hidden="true" tabindex="-1"></a>    info[<span class="st">'layer'</span>].add_to(m)</span>
<span id="cb24-44"><a href="#cb24-44" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="ss">f"     • </span><span class="sc">{</span>name<span class="sc">}</span><span class="ss">: </span><span class="sc">{</span>info[<span class="st">'use_case'</span>]<span class="sc">}</span><span class="ss">"</span>)</span>
<span id="cb24-45"><a href="#cb24-45" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-46"><a href="#cb24-46" aria-hidden="true" tabindex="-1"></a><span class="co"># Add AOI boundary with informative styling</span></span>
<span id="cb24-47"><a href="#cb24-47" aria-hidden="true" tabindex="-1"></a>aoi_bounds <span class="op">=</span> [[sf_bay_bbox[<span class="dv">1</span>], sf_bay_bbox[<span class="dv">0</span>]],  <span class="co"># southwest corner</span></span>
<span id="cb24-48"><a href="#cb24-48" aria-hidden="true" tabindex="-1"></a>              [sf_bay_bbox[<span class="dv">3</span>], sf_bay_bbox[<span class="dv">2</span>]]]  <span class="co"># northeast corner</span></span>
<span id="cb24-49"><a href="#cb24-49" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-50"><a href="#cb24-50" aria-hidden="true" tabindex="-1"></a>folium.Rectangle(</span>
<span id="cb24-51"><a href="#cb24-51" aria-hidden="true" tabindex="-1"></a>    bounds<span class="op">=</span>aoi_bounds,</span>
<span id="cb24-52"><a href="#cb24-52" aria-hidden="true" tabindex="-1"></a>    color<span class="op">=</span><span class="st">'red'</span>,</span>
<span id="cb24-53"><a href="#cb24-53" aria-hidden="true" tabindex="-1"></a>    weight<span class="op">=</span><span class="dv">3</span>,</span>
<span id="cb24-54"><a href="#cb24-54" aria-hidden="true" tabindex="-1"></a>    fill<span class="op">=</span><span class="va">True</span>,</span>
<span id="cb24-55"><a href="#cb24-55" aria-hidden="true" tabindex="-1"></a>    fillOpacity<span class="op">=</span><span class="fl">0.1</span>,</span>
<span id="cb24-56"><a href="#cb24-56" aria-hidden="true" tabindex="-1"></a>    popup<span class="op">=</span>folium.Popup(</span>
<span id="cb24-57"><a href="#cb24-57" aria-hidden="true" tabindex="-1"></a>        <span class="ss">f"""</span></span>
<span id="cb24-58"><a href="#cb24-58" aria-hidden="true" tabindex="-1"></a><span class="ss">        &lt;div style="font-family: Arial; width: 300px;"&gt;</span></span>
<span id="cb24-59"><a href="#cb24-59" aria-hidden="true" tabindex="-1"></a><span class="ss">        &lt;h4&gt;📊 Study Area Details&lt;/h4&gt;</span></span>
<span id="cb24-60"><a href="#cb24-60" aria-hidden="true" tabindex="-1"></a><span class="ss">        &lt;b&gt;Region:&lt;/b&gt; San Francisco Bay Area&lt;br&gt;</span></span>
<span id="cb24-61"><a href="#cb24-61" aria-hidden="true" tabindex="-1"></a><span class="ss">        &lt;b&gt;Coordinates:&lt;/b&gt; </span><span class="sc">{</span>sf_bay_bbox<span class="sc">}</span><span class="ss">&lt;br&gt;</span></span>
<span id="cb24-62"><a href="#cb24-62" aria-hidden="true" tabindex="-1"></a><span class="ss">        &lt;b&gt;Area:&lt;/b&gt; </span><span class="sc">{</span>area_km2<span class="sc">:.0f}</span><span class="ss"> km²&lt;br&gt;</span></span>
<span id="cb24-63"><a href="#cb24-63" aria-hidden="true" tabindex="-1"></a><span class="ss">        &lt;b&gt;Purpose:&lt;/b&gt; Geospatial AI Training&lt;br&gt;</span></span>
<span id="cb24-64"><a href="#cb24-64" aria-hidden="true" tabindex="-1"></a><span class="ss">        &lt;b&gt;Data Type:&lt;/b&gt; Sentinel-2 Optical&lt;br&gt;</span></span>
<span id="cb24-65"><a href="#cb24-65" aria-hidden="true" tabindex="-1"></a><span class="ss">        &lt;/div&gt;</span></span>
<span id="cb24-66"><a href="#cb24-66" aria-hidden="true" tabindex="-1"></a><span class="ss">        """</span>,</span>
<span id="cb24-67"><a href="#cb24-67" aria-hidden="true" tabindex="-1"></a>        max_width<span class="op">=</span><span class="dv">350</span></span>
<span id="cb24-68"><a href="#cb24-68" aria-hidden="true" tabindex="-1"></a>    ),</span>
<span id="cb24-69"><a href="#cb24-69" aria-hidden="true" tabindex="-1"></a>    tooltip<span class="op">=</span><span class="st">"Study Area Boundary - Click for details"</span></span>
<span id="cb24-70"><a href="#cb24-70" aria-hidden="true" tabindex="-1"></a>).add_to(m)</span>
<span id="cb24-71"><a href="#cb24-71" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-72"><a href="#cb24-72" aria-hidden="true" tabindex="-1"></a><span class="co"># Add geographic reference points with contextual information</span></span>
<span id="cb24-73"><a href="#cb24-73" aria-hidden="true" tabindex="-1"></a>reference_locations <span class="op">=</span> [</span>
<span id="cb24-74"><a href="#cb24-74" aria-hidden="true" tabindex="-1"></a>    {</span>
<span id="cb24-75"><a href="#cb24-75" aria-hidden="true" tabindex="-1"></a>        <span class="st">"name"</span>: <span class="st">"San Francisco"</span>,</span>
<span id="cb24-76"><a href="#cb24-76" aria-hidden="true" tabindex="-1"></a>        <span class="st">"coords"</span>: [<span class="fl">37.7749</span>, <span class="op">-</span><span class="fl">122.4194</span>],</span>
<span id="cb24-77"><a href="#cb24-77" aria-hidden="true" tabindex="-1"></a>        <span class="st">"description"</span>: <span class="st">"Urban core, dense development"</span>,</span>
<span id="cb24-78"><a href="#cb24-78" aria-hidden="true" tabindex="-1"></a>        <span class="st">"icon"</span>: <span class="st">"building"</span>,</span>
<span id="cb24-79"><a href="#cb24-79" aria-hidden="true" tabindex="-1"></a>        <span class="st">"color"</span>: <span class="st">"blue"</span></span>
<span id="cb24-80"><a href="#cb24-80" aria-hidden="true" tabindex="-1"></a>    },</span>
<span id="cb24-81"><a href="#cb24-81" aria-hidden="true" tabindex="-1"></a>    {</span>
<span id="cb24-82"><a href="#cb24-82" aria-hidden="true" tabindex="-1"></a>        <span class="st">"name"</span>: <span class="st">"Oakland"</span>,</span>
<span id="cb24-83"><a href="#cb24-83" aria-hidden="true" tabindex="-1"></a>        <span class="st">"coords"</span>: [<span class="fl">37.8044</span>, <span class="op">-</span><span class="fl">122.2712</span>],</span>
<span id="cb24-84"><a href="#cb24-84" aria-hidden="true" tabindex="-1"></a>        <span class="st">"description"</span>: <span class="st">"Port city, mixed urban-industrial"</span>,</span>
<span id="cb24-85"><a href="#cb24-85" aria-hidden="true" tabindex="-1"></a>        <span class="st">"icon"</span>: <span class="st">"ship"</span>,</span>
<span id="cb24-86"><a href="#cb24-86" aria-hidden="true" tabindex="-1"></a>        <span class="st">"color"</span>: <span class="st">"green"</span></span>
<span id="cb24-87"><a href="#cb24-87" aria-hidden="true" tabindex="-1"></a>    },</span>
<span id="cb24-88"><a href="#cb24-88" aria-hidden="true" tabindex="-1"></a>    {</span>
<span id="cb24-89"><a href="#cb24-89" aria-hidden="true" tabindex="-1"></a>        <span class="st">"name"</span>: <span class="st">"San Jose"</span>,</span>
<span id="cb24-90"><a href="#cb24-90" aria-hidden="true" tabindex="-1"></a>        <span class="st">"coords"</span>: [<span class="fl">37.3382</span>, <span class="op">-</span><span class="fl">121.8863</span>],</span>
<span id="cb24-91"><a href="#cb24-91" aria-hidden="true" tabindex="-1"></a>        <span class="st">"description"</span>: <span class="st">"Silicon Valley, tech corridors"</span>,</span>
<span id="cb24-92"><a href="#cb24-92" aria-hidden="true" tabindex="-1"></a>        <span class="st">"icon"</span>: <span class="st">"microchip"</span>,</span>
<span id="cb24-93"><a href="#cb24-93" aria-hidden="true" tabindex="-1"></a>        <span class="st">"color"</span>: <span class="st">"purple"</span></span>
<span id="cb24-94"><a href="#cb24-94" aria-hidden="true" tabindex="-1"></a>    },</span>
<span id="cb24-95"><a href="#cb24-95" aria-hidden="true" tabindex="-1"></a>    {</span>
<span id="cb24-96"><a href="#cb24-96" aria-hidden="true" tabindex="-1"></a>        <span class="st">"name"</span>: <span class="st">"Palo Alto"</span>,</span>
<span id="cb24-97"><a href="#cb24-97" aria-hidden="true" tabindex="-1"></a>        <span class="st">"coords"</span>: [<span class="fl">37.4419</span>, <span class="op">-</span><span class="fl">122.1430</span>],</span>
<span id="cb24-98"><a href="#cb24-98" aria-hidden="true" tabindex="-1"></a>        <span class="st">"description"</span>: <span class="st">"University town, research facilities"</span>,</span>
<span id="cb24-99"><a href="#cb24-99" aria-hidden="true" tabindex="-1"></a>        <span class="st">"icon"</span>: <span class="st">"graduation-cap"</span>,</span>
<span id="cb24-100"><a href="#cb24-100" aria-hidden="true" tabindex="-1"></a>        <span class="st">"color"</span>: <span class="st">"orange"</span></span>
<span id="cb24-101"><a href="#cb24-101" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb24-102"><a href="#cb24-102" aria-hidden="true" tabindex="-1"></a>]</span>
<span id="cb24-103"><a href="#cb24-103" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-104"><a href="#cb24-104" aria-hidden="true" tabindex="-1"></a>logger.info(<span class="ss">f"Adding </span><span class="sc">{</span><span class="bu">len</span>(reference_locations)<span class="sc">}</span><span class="ss"> geographic reference points"</span>)</span>
<span id="cb24-105"><a href="#cb24-105" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> location <span class="kw">in</span> reference_locations:</span>
<span id="cb24-106"><a href="#cb24-106" aria-hidden="true" tabindex="-1"></a>    logger.debug(<span class="ss">f"</span><span class="sc">{</span>location[<span class="st">'name'</span>]<span class="sc">}</span><span class="ss">: </span><span class="sc">{</span>location[<span class="st">'description'</span>]<span class="sc">}</span><span class="ss">"</span>)</span>
<span id="cb24-107"><a href="#cb24-107" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-108"><a href="#cb24-108" aria-hidden="true" tabindex="-1"></a>    folium.Marker(</span>
<span id="cb24-109"><a href="#cb24-109" aria-hidden="true" tabindex="-1"></a>        location<span class="op">=</span>location[<span class="st">"coords"</span>],</span>
<span id="cb24-110"><a href="#cb24-110" aria-hidden="true" tabindex="-1"></a>        popup<span class="op">=</span>folium.Popup(</span>
<span id="cb24-111"><a href="#cb24-111" aria-hidden="true" tabindex="-1"></a>            <span class="ss">f"""</span></span>
<span id="cb24-112"><a href="#cb24-112" aria-hidden="true" tabindex="-1"></a><span class="ss">            &lt;div style="font-family: Arial;"&gt;</span></span>
<span id="cb24-113"><a href="#cb24-113" aria-hidden="true" tabindex="-1"></a><span class="ss">            &lt;h4&gt;</span><span class="sc">{</span>location[<span class="st">'name'</span>]<span class="sc">}</span><span class="ss">&lt;/h4&gt;</span></span>
<span id="cb24-114"><a href="#cb24-114" aria-hidden="true" tabindex="-1"></a><span class="ss">            &lt;b&gt;Coordinates:&lt;/b&gt; </span><span class="sc">{</span>location[<span class="st">'coords'</span>][<span class="dv">0</span>]<span class="sc">:.4f}</span><span class="ss">, </span><span class="sc">{</span>location[<span class="st">'coords'</span>][<span class="dv">1</span>]<span class="sc">:.4f}</span><span class="ss">&lt;br&gt;</span></span>
<span id="cb24-115"><a href="#cb24-115" aria-hidden="true" tabindex="-1"></a><span class="ss">            &lt;b&gt;Context:&lt;/b&gt; </span><span class="sc">{</span>location[<span class="st">'description'</span>]<span class="sc">}</span><span class="ss">&lt;br&gt;</span></span>
<span id="cb24-116"><a href="#cb24-116" aria-hidden="true" tabindex="-1"></a><span class="ss">            &lt;b&gt;Role in Analysis:&lt;/b&gt; Geographic reference point</span></span>
<span id="cb24-117"><a href="#cb24-117" aria-hidden="true" tabindex="-1"></a><span class="ss">            &lt;/div&gt;</span></span>
<span id="cb24-118"><a href="#cb24-118" aria-hidden="true" tabindex="-1"></a><span class="ss">            """</span>,</span>
<span id="cb24-119"><a href="#cb24-119" aria-hidden="true" tabindex="-1"></a>            max_width<span class="op">=</span><span class="dv">250</span></span>
<span id="cb24-120"><a href="#cb24-120" aria-hidden="true" tabindex="-1"></a>        ),</span>
<span id="cb24-121"><a href="#cb24-121" aria-hidden="true" tabindex="-1"></a>        tooltip<span class="op">=</span><span class="ss">f"</span><span class="sc">{</span>location[<span class="st">'name'</span>]<span class="sc">}</span><span class="ss"> - </span><span class="sc">{</span>location[<span class="st">'description'</span>]<span class="sc">}</span><span class="ss">"</span>,</span>
<span id="cb24-122"><a href="#cb24-122" aria-hidden="true" tabindex="-1"></a>        icon<span class="op">=</span>folium.Icon(</span>
<span id="cb24-123"><a href="#cb24-123" aria-hidden="true" tabindex="-1"></a>            color<span class="op">=</span>location[<span class="st">'color'</span>],</span>
<span id="cb24-124"><a href="#cb24-124" aria-hidden="true" tabindex="-1"></a>            icon<span class="op">=</span>location[<span class="st">'icon'</span>],</span>
<span id="cb24-125"><a href="#cb24-125" aria-hidden="true" tabindex="-1"></a>            prefix<span class="op">=</span><span class="st">'fa'</span></span>
<span id="cb24-126"><a href="#cb24-126" aria-hidden="true" tabindex="-1"></a>        )</span>
<span id="cb24-127"><a href="#cb24-127" aria-hidden="true" tabindex="-1"></a>    ).add_to(m)</span>
<span id="cb24-128"><a href="#cb24-128" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-129"><a href="#cb24-129" aria-hidden="true" tabindex="-1"></a><span class="co"># Add measurement and interaction tools for analysis</span></span>
<span id="cb24-130"><a href="#cb24-130" aria-hidden="true" tabindex="-1"></a>logger.info(<span class="st">"Adding interactive analysis tools"</span>)</span>
<span id="cb24-131"><a href="#cb24-131" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-132"><a href="#cb24-132" aria-hidden="true" tabindex="-1"></a><span class="co"># Measurement tool for distance/area calculations</span></span>
<span id="cb24-133"><a href="#cb24-133" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> folium.plugins <span class="im">import</span> MeasureControl</span>
<span id="cb24-134"><a href="#cb24-134" aria-hidden="true" tabindex="-1"></a>measure_control <span class="op">=</span> MeasureControl(</span>
<span id="cb24-135"><a href="#cb24-135" aria-hidden="true" tabindex="-1"></a>    primary_length_unit<span class="op">=</span><span class="st">'kilometers'</span>,</span>
<span id="cb24-136"><a href="#cb24-136" aria-hidden="true" tabindex="-1"></a>    primary_area_unit<span class="op">=</span><span class="st">'sqkilometers'</span>,</span>
<span id="cb24-137"><a href="#cb24-137" aria-hidden="true" tabindex="-1"></a>    secondary_length_unit<span class="op">=</span><span class="st">'miles'</span>,</span>
<span id="cb24-138"><a href="#cb24-138" aria-hidden="true" tabindex="-1"></a>    secondary_area_unit<span class="op">=</span><span class="st">'sqmiles'</span></span>
<span id="cb24-139"><a href="#cb24-139" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb24-140"><a href="#cb24-140" aria-hidden="true" tabindex="-1"></a>m.add_child(measure_control)</span>
<span id="cb24-141"><a href="#cb24-141" aria-hidden="true" tabindex="-1"></a>logger.debug(<span class="st">"Added measurement tool for distance/area calculations"</span>)</span>
<span id="cb24-142"><a href="#cb24-142" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-143"><a href="#cb24-143" aria-hidden="true" tabindex="-1"></a><span class="co"># Fullscreen capability for detailed examination</span></span>
<span id="cb24-144"><a href="#cb24-144" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> folium.plugins <span class="im">import</span> Fullscreen</span>
<span id="cb24-145"><a href="#cb24-145" aria-hidden="true" tabindex="-1"></a>Fullscreen(</span>
<span id="cb24-146"><a href="#cb24-146" aria-hidden="true" tabindex="-1"></a>    position<span class="op">=</span><span class="st">'topright'</span>,</span>
<span id="cb24-147"><a href="#cb24-147" aria-hidden="true" tabindex="-1"></a>    title<span class="op">=</span><span class="st">'Full Screen Mode'</span>,</span>
<span id="cb24-148"><a href="#cb24-148" aria-hidden="true" tabindex="-1"></a>    title_cancel<span class="op">=</span><span class="st">'Exit Full Screen'</span>,</span>
<span id="cb24-149"><a href="#cb24-149" aria-hidden="true" tabindex="-1"></a>    force_separate_button<span class="op">=</span><span class="va">True</span></span>
<span id="cb24-150"><a href="#cb24-150" aria-hidden="true" tabindex="-1"></a>).add_to(m)</span>
<span id="cb24-151"><a href="#cb24-151" aria-hidden="true" tabindex="-1"></a>logger.debug(<span class="st">"Added fullscreen mode capability"</span>)</span>
<span id="cb24-152"><a href="#cb24-152" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-153"><a href="#cb24-153" aria-hidden="true" tabindex="-1"></a><span class="co"># Layer control for basemap switching</span></span>
<span id="cb24-154"><a href="#cb24-154" aria-hidden="true" tabindex="-1"></a>layer_control <span class="op">=</span> folium.LayerControl(</span>
<span id="cb24-155"><a href="#cb24-155" aria-hidden="true" tabindex="-1"></a>    position<span class="op">=</span><span class="st">'topright'</span>,</span>
<span id="cb24-156"><a href="#cb24-156" aria-hidden="true" tabindex="-1"></a>    collapsed<span class="op">=</span><span class="va">False</span></span>
<span id="cb24-157"><a href="#cb24-157" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb24-158"><a href="#cb24-158" aria-hidden="true" tabindex="-1"></a>layer_control.add_to(m)</span>
<span id="cb24-159"><a href="#cb24-159" aria-hidden="true" tabindex="-1"></a>logger.debug(<span class="st">"Added layer control for basemap switching"</span>)</span>
<span id="cb24-160"><a href="#cb24-160" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-161"><a href="#cb24-161" aria-hidden="true" tabindex="-1"></a>logger.info(<span class="st">"Interactive map created with comprehensive spatial context"</span>)</span>
<span id="cb24-162"><a href="#cb24-162" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-163"><a href="#cb24-163" aria-hidden="true" tabindex="-1"></a><span class="co"># Display the map</span></span>
<span id="cb24-164"><a href="#cb24-164" aria-hidden="true" tabindex="-1"></a>m</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>2025-09-21 09:52:48,430 - INFO - Adding 4 geographic reference points
2025-09-21 09:52:48,431 - INFO - Adding interactive analysis tools
2025-09-21 09:52:48,432 - INFO - Interactive map created with comprehensive spatial context</code></pre>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>   📚 Adding 4 basemap options:
     • CartoDB positron: Data overlay visualization, presentations
     • CartoDB dark_matter: Night mode, reducing eye strain
     • Esri World Imagery: Ground truth validation, visual interpretation
     • Stamen Terrain: Elevation context, watershed analysis</code></pre>
</div>
<div class="cell-output cell-output-display" data-execution_count="15">
<div style="width:100%;"><div style="position:relative;width:100%;height:0;padding-bottom:60%;"><span style="color:#565656">Make this Notebook Trusted to load map: File -&gt; Trust Notebook</span><iframe srcdoc="<!DOCTYPE html>
<html>
<head>
    
    <meta http-equiv=&quot;content-type&quot; content=&quot;text/html; charset=UTF-8&quot; />
    <script src=&quot;https://cdn.jsdelivr.net/npm/leaflet@1.9.3/dist/leaflet.js&quot;></script>
    <script src=&quot;https://code.jquery.com/jquery-3.7.1.min.js&quot;></script>
    <script src=&quot;https://cdn.jsdelivr.net/npm/bootstrap@5.2.2/dist/js/bootstrap.bundle.min.js&quot;></script>
    <script src=&quot;https://cdnjs.cloudflare.com/ajax/libs/Leaflet.awesome-markers/2.0.2/leaflet.awesome-markers.js&quot;></script>
    <link rel=&quot;stylesheet&quot; href=&quot;https://cdn.jsdelivr.net/npm/leaflet@1.9.3/dist/leaflet.css&quot;/>
    <link rel=&quot;stylesheet&quot; href=&quot;https://cdn.jsdelivr.net/npm/bootstrap@5.2.2/dist/css/bootstrap.min.css&quot;/>
    <link rel=&quot;stylesheet&quot; href=&quot;https://netdna.bootstrapcdn.com/bootstrap/3.0.0/css/bootstrap-glyphicons.css&quot;/>
    <link rel=&quot;stylesheet&quot; href=&quot;https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@6.2.0/css/all.min.css&quot;/>
    <link rel=&quot;stylesheet&quot; href=&quot;https://cdnjs.cloudflare.com/ajax/libs/Leaflet.awesome-markers/2.0.2/leaflet.awesome-markers.css&quot;/>
    <link rel=&quot;stylesheet&quot; href=&quot;https://cdn.jsdelivr.net/gh/python-visualization/folium/folium/templates/leaflet.awesome.rotate.min.css&quot;/>
    
            <meta name=&quot;viewport&quot; content=&quot;width=device-width,
                initial-scale=1.0, maximum-scale=1.0, user-scalable=no&quot; />
            <style>
                #map_e8513b69c6b43febf54eda493815d522 {
                    position: relative;
                    width: 100.0%;
                    height: 100.0%;
                    left: 0.0%;
                    top: 0.0%;
                }
                .leaflet-container { font-size: 1rem; }
            </style>

            <style>html, body {
                width: 100%;
                height: 100%;
                margin: 0;
                padding: 0;
            }
            </style>

            <style>#map {
                position:absolute;
                top:0;
                bottom:0;
                right:0;
                left:0;
                }
            </style>

            <script>
                L_NO_TOUCH = false;
                L_DISABLE_3D = false;
            </script>

        
    <script src=&quot;https://cdn.jsdelivr.net/gh/ljagis/leaflet-measure@2.1.7/dist/leaflet-measure.min.js&quot;></script>
    <link rel=&quot;stylesheet&quot; href=&quot;https://cdn.jsdelivr.net/gh/ljagis/leaflet-measure@2.1.7/dist/leaflet-measure.min.css&quot;/>
    <script src=&quot;https://cdn.jsdelivr.net/npm/leaflet.fullscreen@3.0.0/Control.FullScreen.min.js&quot;></script>
    <link rel=&quot;stylesheet&quot; href=&quot;https://cdn.jsdelivr.net/npm/leaflet.fullscreen@3.0.0/Control.FullScreen.css&quot;/>
</head>
<body>
    
    
            <div class=&quot;folium-map&quot; id=&quot;map_e8513b69c6b43febf54eda493815d522&quot; ></div>
        
</body>
<script>
    
    
            var map_e8513b69c6b43febf54eda493815d522 = L.map(
                &quot;map_e8513b69c6b43febf54eda493815d522&quot;,
                {
                    center: [37.65, -122.15],
                    crs: L.CRS.EPSG3857,
                    ...{
  &quot;zoom&quot;: 9,
  &quot;zoomControl&quot;: true,
  &quot;preferCanvas&quot;: false,
}

                }
            );

            

        
    
            var tile_layer_2ec00b9398e4a9b263137d615cd5f21f = L.tileLayer(
                &quot;https://tile.openstreetmap.org/{z}/{x}/{y}.png&quot;,
                {
  &quot;minZoom&quot;: 0,
  &quot;maxZoom&quot;: 19,
  &quot;maxNativeZoom&quot;: 19,
  &quot;noWrap&quot;: false,
  &quot;attribution&quot;: &quot;\u0026copy; \u003ca href=\&quot;https://www.openstreetmap.org/copyright\&quot;\u003eOpenStreetMap\u003c/a\u003e contributors&quot;,
  &quot;subdomains&quot;: &quot;abc&quot;,
  &quot;detectRetina&quot;: false,
  &quot;tms&quot;: false,
  &quot;opacity&quot;: 1,
}

            );
        
    
            tile_layer_2ec00b9398e4a9b263137d615cd5f21f.addTo(map_e8513b69c6b43febf54eda493815d522);
        
    
            var tile_layer_c82f35607d90be033613cd50bf70c8ab = L.tileLayer(
                &quot;https://{s}.basemaps.cartocdn.com/light_all/{z}/{x}/{y}{r}.png&quot;,
                {
  &quot;minZoom&quot;: 0,
  &quot;maxZoom&quot;: 20,
  &quot;maxNativeZoom&quot;: 20,
  &quot;noWrap&quot;: false,
  &quot;attribution&quot;: &quot;\u0026copy; \u003ca href=\&quot;https://www.openstreetmap.org/copyright\&quot;\u003eOpenStreetMap\u003c/a\u003e contributors \u0026copy; \u003ca href=\&quot;https://carto.com/attributions\&quot;\u003eCARTO\u003c/a\u003e&quot;,
  &quot;subdomains&quot;: &quot;abcd&quot;,
  &quot;detectRetina&quot;: false,
  &quot;tms&quot;: false,
  &quot;opacity&quot;: 1,
}

            );
        
    
            tile_layer_c82f35607d90be033613cd50bf70c8ab.addTo(map_e8513b69c6b43febf54eda493815d522);
        
    
            var tile_layer_0aab5a7ee405badba842d984a0a086b2 = L.tileLayer(
                &quot;https://{s}.basemaps.cartocdn.com/dark_all/{z}/{x}/{y}{r}.png&quot;,
                {
  &quot;minZoom&quot;: 0,
  &quot;maxZoom&quot;: 20,
  &quot;maxNativeZoom&quot;: 20,
  &quot;noWrap&quot;: false,
  &quot;attribution&quot;: &quot;\u0026copy; \u003ca href=\&quot;https://www.openstreetmap.org/copyright\&quot;\u003eOpenStreetMap\u003c/a\u003e contributors \u0026copy; \u003ca href=\&quot;https://carto.com/attributions\&quot;\u003eCARTO\u003c/a\u003e&quot;,
  &quot;subdomains&quot;: &quot;abcd&quot;,
  &quot;detectRetina&quot;: false,
  &quot;tms&quot;: false,
  &quot;opacity&quot;: 1,
}

            );
        
    
            tile_layer_0aab5a7ee405badba842d984a0a086b2.addTo(map_e8513b69c6b43febf54eda493815d522);
        
    
            var tile_layer_1783e94cd80463efafe93e2943a00013 = L.tileLayer(
                &quot;https://server.arcgisonline.com/ArcGIS/rest/services/World_Imagery/MapServer/tile/{z}/{y}/{x}&quot;,
                {
  &quot;minZoom&quot;: 0,
  &quot;maxZoom&quot;: 18,
  &quot;maxNativeZoom&quot;: 18,
  &quot;noWrap&quot;: false,
  &quot;attribution&quot;: &quot;Esri&quot;,
  &quot;subdomains&quot;: &quot;abc&quot;,
  &quot;detectRetina&quot;: false,
  &quot;tms&quot;: false,
  &quot;opacity&quot;: 1,
}

            );
        
    
            tile_layer_1783e94cd80463efafe93e2943a00013.addTo(map_e8513b69c6b43febf54eda493815d522);
        
    
            var tile_layer_13fa56454307423711c63490200db4e5 = L.tileLayer(
                &quot;Stamen Terrain&quot;,
                {
  &quot;minZoom&quot;: 0,
  &quot;maxZoom&quot;: 18,
  &quot;maxNativeZoom&quot;: 18,
  &quot;noWrap&quot;: false,
  &quot;attribution&quot;: &quot;Map tiles by Stamen Design, CC BY 3.0 \u2014 Map data \u00a9 OpenStreetMap contributors&quot;,
  &quot;subdomains&quot;: &quot;abc&quot;,
  &quot;detectRetina&quot;: false,
  &quot;tms&quot;: false,
  &quot;opacity&quot;: 1,
}

            );
        
    
            tile_layer_13fa56454307423711c63490200db4e5.addTo(map_e8513b69c6b43febf54eda493815d522);
        
    
            var rectangle_5f158391d57c40e41820ffc5e0c2487a = L.rectangle(
                [[37.3, -122.5], [38.0, -121.8]],
                {&quot;bubblingMouseEvents&quot;: true, &quot;color&quot;: &quot;red&quot;, &quot;dashArray&quot;: null, &quot;dashOffset&quot;: null, &quot;fill&quot;: true, &quot;fillColor&quot;: &quot;red&quot;, &quot;fillOpacity&quot;: 0.1, &quot;fillRule&quot;: &quot;evenodd&quot;, &quot;lineCap&quot;: &quot;round&quot;, &quot;lineJoin&quot;: &quot;round&quot;, &quot;noClip&quot;: false, &quot;opacity&quot;: 1.0, &quot;smoothFactor&quot;: 1.0, &quot;stroke&quot;: true, &quot;weight&quot;: 3}
            ).addTo(map_e8513b69c6b43febf54eda493815d522);
        
    
        var popup_a765083fc9bbecd47c388f0a05a3a123 = L.popup({
  &quot;maxWidth&quot;: 350,
});

        
            
                var html_a342d6c3cdad48beb847f4e4cc0a72d7 = $(`<div id=&quot;html_a342d6c3cdad48beb847f4e4cc0a72d7&quot; style=&quot;width: 100.0%; height: 100.0%;&quot;>         <div style=&quot;font-family: Arial; width: 300px;&quot;>         <h4>📊 Study Area Details</h4>         <b>Region:</b> San Francisco Bay Area<br>         <b>Coordinates:</b> [-122.5, 37.3, -121.8, 38.0]<br>         <b>Area:</b> 4808 km²<br>         <b>Purpose:</b> Geospatial AI Training<br>         <b>Data Type:</b> Sentinel-2 Optical<br>         </div>         </div>`)[0];
                popup_a765083fc9bbecd47c388f0a05a3a123.setContent(html_a342d6c3cdad48beb847f4e4cc0a72d7);
            
        

        rectangle_5f158391d57c40e41820ffc5e0c2487a.bindPopup(popup_a765083fc9bbecd47c388f0a05a3a123)
        ;

        
    
    
            rectangle_5f158391d57c40e41820ffc5e0c2487a.bindTooltip(
                `<div>
                     Study Area Boundary - Click for details
                 </div>`,
                {
  &quot;sticky&quot;: true,
}
            );
        
    
            var marker_076b82ae6a73184b7240003ade8bc4f7 = L.marker(
                [37.7749, -122.4194],
                {
}
            ).addTo(map_e8513b69c6b43febf54eda493815d522);
        
    
            var icon_2619a65e01421826c9d5600c185377f3 = L.AwesomeMarkers.icon(
                {
  &quot;markerColor&quot;: &quot;blue&quot;,
  &quot;iconColor&quot;: &quot;white&quot;,
  &quot;icon&quot;: &quot;building&quot;,
  &quot;prefix&quot;: &quot;fa&quot;,
  &quot;extraClasses&quot;: &quot;fa-rotate-0&quot;,
}
            );
        
    
        var popup_144735993d4b7259c678bcf46d8b126b = L.popup({
  &quot;maxWidth&quot;: 250,
});

        
            
                var html_f70be8476092f7053464303d9183373d = $(`<div id=&quot;html_f70be8476092f7053464303d9183373d&quot; style=&quot;width: 100.0%; height: 100.0%;&quot;>             <div style=&quot;font-family: Arial;&quot;>             <h4>San Francisco</h4>             <b>Coordinates:</b> 37.7749, -122.4194<br>             <b>Context:</b> Urban core, dense development<br>             <b>Role in Analysis:</b> Geographic reference point             </div>             </div>`)[0];
                popup_144735993d4b7259c678bcf46d8b126b.setContent(html_f70be8476092f7053464303d9183373d);
            
        

        marker_076b82ae6a73184b7240003ade8bc4f7.bindPopup(popup_144735993d4b7259c678bcf46d8b126b)
        ;

        
    
    
            marker_076b82ae6a73184b7240003ade8bc4f7.bindTooltip(
                `<div>
                     San Francisco - Urban core, dense development
                 </div>`,
                {
  &quot;sticky&quot;: true,
}
            );
        
    
                marker_076b82ae6a73184b7240003ade8bc4f7.setIcon(icon_2619a65e01421826c9d5600c185377f3);
            
    
            var marker_40db4717dc2d325280e2a37ac285fc16 = L.marker(
                [37.8044, -122.2712],
                {
}
            ).addTo(map_e8513b69c6b43febf54eda493815d522);
        
    
            var icon_248507775ad650707e9fecfd36c19999 = L.AwesomeMarkers.icon(
                {
  &quot;markerColor&quot;: &quot;green&quot;,
  &quot;iconColor&quot;: &quot;white&quot;,
  &quot;icon&quot;: &quot;ship&quot;,
  &quot;prefix&quot;: &quot;fa&quot;,
  &quot;extraClasses&quot;: &quot;fa-rotate-0&quot;,
}
            );
        
    
        var popup_fbb26130782e83d19662eb604a1f02c6 = L.popup({
  &quot;maxWidth&quot;: 250,
});

        
            
                var html_fed156b77ee7f80a17745d84979bab3e = $(`<div id=&quot;html_fed156b77ee7f80a17745d84979bab3e&quot; style=&quot;width: 100.0%; height: 100.0%;&quot;>             <div style=&quot;font-family: Arial;&quot;>             <h4>Oakland</h4>             <b>Coordinates:</b> 37.8044, -122.2712<br>             <b>Context:</b> Port city, mixed urban-industrial<br>             <b>Role in Analysis:</b> Geographic reference point             </div>             </div>`)[0];
                popup_fbb26130782e83d19662eb604a1f02c6.setContent(html_fed156b77ee7f80a17745d84979bab3e);
            
        

        marker_40db4717dc2d325280e2a37ac285fc16.bindPopup(popup_fbb26130782e83d19662eb604a1f02c6)
        ;

        
    
    
            marker_40db4717dc2d325280e2a37ac285fc16.bindTooltip(
                `<div>
                     Oakland - Port city, mixed urban-industrial
                 </div>`,
                {
  &quot;sticky&quot;: true,
}
            );
        
    
                marker_40db4717dc2d325280e2a37ac285fc16.setIcon(icon_248507775ad650707e9fecfd36c19999);
            
    
            var marker_51ae195ee3ea4008389e3ee14b5a6468 = L.marker(
                [37.3382, -121.8863],
                {
}
            ).addTo(map_e8513b69c6b43febf54eda493815d522);
        
    
            var icon_a5958a483554e9bde9e5d471a5bee8ee = L.AwesomeMarkers.icon(
                {
  &quot;markerColor&quot;: &quot;purple&quot;,
  &quot;iconColor&quot;: &quot;white&quot;,
  &quot;icon&quot;: &quot;microchip&quot;,
  &quot;prefix&quot;: &quot;fa&quot;,
  &quot;extraClasses&quot;: &quot;fa-rotate-0&quot;,
}
            );
        
    
        var popup_670b2ae5e3d21405df8c83c9a1bf5a62 = L.popup({
  &quot;maxWidth&quot;: 250,
});

        
            
                var html_a6633b20cee4a61d94baac4c34ba51f2 = $(`<div id=&quot;html_a6633b20cee4a61d94baac4c34ba51f2&quot; style=&quot;width: 100.0%; height: 100.0%;&quot;>             <div style=&quot;font-family: Arial;&quot;>             <h4>San Jose</h4>             <b>Coordinates:</b> 37.3382, -121.8863<br>             <b>Context:</b> Silicon Valley, tech corridors<br>             <b>Role in Analysis:</b> Geographic reference point             </div>             </div>`)[0];
                popup_670b2ae5e3d21405df8c83c9a1bf5a62.setContent(html_a6633b20cee4a61d94baac4c34ba51f2);
            
        

        marker_51ae195ee3ea4008389e3ee14b5a6468.bindPopup(popup_670b2ae5e3d21405df8c83c9a1bf5a62)
        ;

        
    
    
            marker_51ae195ee3ea4008389e3ee14b5a6468.bindTooltip(
                `<div>
                     San Jose - Silicon Valley, tech corridors
                 </div>`,
                {
  &quot;sticky&quot;: true,
}
            );
        
    
                marker_51ae195ee3ea4008389e3ee14b5a6468.setIcon(icon_a5958a483554e9bde9e5d471a5bee8ee);
            
    
            var marker_b8dbb3f3204de9ef5847ccf7e455685a = L.marker(
                [37.4419, -122.143],
                {
}
            ).addTo(map_e8513b69c6b43febf54eda493815d522);
        
    
            var icon_eb1dc56d4aa50c4e2e6f683b5deafe64 = L.AwesomeMarkers.icon(
                {
  &quot;markerColor&quot;: &quot;orange&quot;,
  &quot;iconColor&quot;: &quot;white&quot;,
  &quot;icon&quot;: &quot;graduation-cap&quot;,
  &quot;prefix&quot;: &quot;fa&quot;,
  &quot;extraClasses&quot;: &quot;fa-rotate-0&quot;,
}
            );
        
    
        var popup_7611a01b993dcd41d79b98ed50060e2a = L.popup({
  &quot;maxWidth&quot;: 250,
});

        
            
                var html_05ad59f11e541174579b71a3c8b39cd2 = $(`<div id=&quot;html_05ad59f11e541174579b71a3c8b39cd2&quot; style=&quot;width: 100.0%; height: 100.0%;&quot;>             <div style=&quot;font-family: Arial;&quot;>             <h4>Palo Alto</h4>             <b>Coordinates:</b> 37.4419, -122.1430<br>             <b>Context:</b> University town, research facilities<br>             <b>Role in Analysis:</b> Geographic reference point             </div>             </div>`)[0];
                popup_7611a01b993dcd41d79b98ed50060e2a.setContent(html_05ad59f11e541174579b71a3c8b39cd2);
            
        

        marker_b8dbb3f3204de9ef5847ccf7e455685a.bindPopup(popup_7611a01b993dcd41d79b98ed50060e2a)
        ;

        
    
    
            marker_b8dbb3f3204de9ef5847ccf7e455685a.bindTooltip(
                `<div>
                     Palo Alto - University town, research facilities
                 </div>`,
                {
  &quot;sticky&quot;: true,
}
            );
        
    
                marker_b8dbb3f3204de9ef5847ccf7e455685a.setIcon(icon_eb1dc56d4aa50c4e2e6f683b5deafe64);
            
    
            var measure_control_c293749f666a8d331d653d0769c813e3 = new L.Control.Measure(
                {
  &quot;position&quot;: &quot;topright&quot;,
  &quot;primaryLengthUnit&quot;: &quot;kilometers&quot;,
  &quot;secondaryLengthUnit&quot;: &quot;miles&quot;,
  &quot;primaryAreaUnit&quot;: &quot;sqkilometers&quot;,
  &quot;secondaryAreaUnit&quot;: &quot;sqmiles&quot;,
});
            map_e8513b69c6b43febf54eda493815d522.addControl(measure_control_c293749f666a8d331d653d0769c813e3);

            // Workaround for using this plugin with Leaflet>=1.8.0
            // https://github.com/ljagis/leaflet-measure/issues/171
            L.Control.Measure.include({
                _setCaptureMarkerIcon: function () {
                    // disable autopan
                    this._captureMarker.options.autoPanOnFocus = false;
                    // default function
                    this._captureMarker.setIcon(
                        L.divIcon({
                            iconSize: this._map.getSize().multiplyBy(2)
                        })
                    );
                },
            });

        
    
            L.control.fullscreen(
                {
  &quot;position&quot;: &quot;topright&quot;,
  &quot;title&quot;: &quot;Full Screen Mode&quot;,
  &quot;titleCancel&quot;: &quot;Exit Full Screen&quot;,
  &quot;forceSeparateButton&quot;: true,
}
            ).addTo(map_e8513b69c6b43febf54eda493815d522);
        
    
            var layer_control_38441a4ee75ef01693e0a63c37d3fe4a_layers = {
                base_layers : {
                    &quot;openstreetmap&quot; : tile_layer_2ec00b9398e4a9b263137d615cd5f21f,
                    &quot;Clean Basemap&quot; : tile_layer_c82f35607d90be033613cd50bf70c8ab,
                    &quot;Dark Theme&quot; : tile_layer_0aab5a7ee405badba842d984a0a086b2,
                    &quot;Satellite Imagery&quot; : tile_layer_1783e94cd80463efafe93e2943a00013,
                    &quot;Topographic&quot; : tile_layer_13fa56454307423711c63490200db4e5,
                },
                overlays :  {
                },
            };
            let layer_control_38441a4ee75ef01693e0a63c37d3fe4a = L.control.layers(
                layer_control_38441a4ee75ef01693e0a63c37d3fe4a_layers.base_layers,
                layer_control_38441a4ee75ef01693e0a63c37d3fe4a_layers.overlays,
                {
  &quot;position&quot;: &quot;topright&quot;,
  &quot;collapsed&quot;: false,
  &quot;autoZIndex&quot;: true,
}
            ).addTo(map_e8513b69c6b43febf54eda493815d522);

        
</script>
</html>" style="position:absolute;width:100%;height:100%;left:0;top:0;border:none !important;" allowfullscreen="" webkitallowfullscreen="" mozallowfullscreen=""></iframe></div></div>
</div>
</div>
<div class="callout callout-style-default callout-note callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
AOI Design Best Practices
</div>
</div>
<div class="callout-body-container callout-body">
<p><strong>Size Considerations:</strong><br>
When defining your Area of Interest (AOI), consider that an area too small may miss important spatial patterns or edge effects, while an area too large can increase processing time and may include irrelevant regions. Aim for a balance that ensures computational efficiency without sacrificing analytical completeness.</p>
<p><strong>Boundary Alignment:</strong><br>
AOI boundaries can be aligned with ecological features such as watersheds, ecoregions, or habitat boundaries; with administrative units like counties, states, or protected areas; or with sensor-based divisions such as satellite tile boundaries and processing units. Choose the alignment that best fits your study objectives.</p>
<p><strong>Temporal Considerations:</strong><br>
Ensure your AOI captures relevant seasonal dynamics and accounts for both historical and projected changes in the study area. Also, verify that data coverage is consistent across your intended temporal study period.</p>
</div>
</div>
</section>
</section>
<section id="validating-your-aoi-selection" class="level3">
<h3 class="anchored" data-anchor-id="validating-your-aoi-selection">Validating Your AOI Selection</h3>
<p>Before proceeding with data acquisition, confirm that your AOI is well-matched to your analysis objectives.</p>
<hr>
</section>
</section>
<section id="step-4-intelligent-satellite-scene-discovery-and-selection" class="level2">
<h2 class="anchored" data-anchor-id="step-4-intelligent-satellite-scene-discovery-and-selection">Step 4: Intelligent Satellite Scene Discovery and Selection</h2>
<section id="intelligent-satellite-scene-discovery" class="level3">
<h3 class="anchored" data-anchor-id="intelligent-satellite-scene-discovery">Intelligent Satellite Scene Discovery</h3>
<p>Selecting appropriate satellite imagery is a multi-faceted challenge that requires balancing several key factors: temporal coverage (recent vs.&nbsp;historical data), data quality (cloud cover, sensor conditions, processing artifacts), spatial coverage (ensuring your AOI is fully captured), and the processing level of the data (raw vs.&nbsp;analysis-ready products). Relying on a single search strategy often leads to missed opportunities or suboptimal results, especially when data availability is limited by weather or acquisition schedules.</p>
<p>To address these challenges, a robust approach involves designing and implementing multi-strategy search patterns. This means systematically applying a sequence of search strategies, each with progressively relaxed criteria—such as expanding the temporal window or increasing the allowable cloud cover. By doing so, you maximize the chances of finding suitable imagery while still prioritizing the highest quality data available. This method is widely used in operational geospatial systems to ensure reliable and efficient satellite scene discovery, even under less-than-ideal conditions.</p>
<p>By the end of this section, you will be able to design robust, multi-strategy search workflows for satellite data discovery, understand how quality filters and temporal windows affect data availability, implement fallback mechanisms to guarantee reliable data access, and evaluate scene metadata to select the most appropriate imagery for your analysis.</p>
<div id="05ab9d14" class="cell" data-execution_count="16">
<div class="sourceCode cell-code" id="cb27"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb27-1"><a href="#cb27-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Step 4A: Implement Robust Multi-Strategy Scene Discovery</span></span>
<span id="cb27-2"><a href="#cb27-2" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> datetime <span class="im">import</span> datetime, timedelta</span>
<span id="cb27-3"><a href="#cb27-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-4"><a href="#cb27-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Strategy 1: Dynamic temporal window based on current date</span></span>
<span id="cb27-5"><a href="#cb27-5" aria-hidden="true" tabindex="-1"></a>current_date <span class="op">=</span> datetime.now()</span>
<span id="cb27-6"><a href="#cb27-6" aria-hidden="true" tabindex="-1"></a>logger.info(<span class="ss">f"Calculating optimal temporal search windows (current date: </span><span class="sc">{</span>current_date<span class="sc">.</span>strftime(<span class="st">'%Y-%m-</span><span class="sc">%d</span><span class="st">'</span>)<span class="sc">}</span><span class="ss">)"</span>)</span>
<span id="cb27-7"><a href="#cb27-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-8"><a href="#cb27-8" aria-hidden="true" tabindex="-1"></a><span class="co"># Define multiple search strategies with different trade-offs</span></span>
<span id="cb27-9"><a href="#cb27-9" aria-hidden="true" tabindex="-1"></a><span class="co"># Each strategy balances data quality against data availability</span></span>
<span id="cb27-10"><a href="#cb27-10" aria-hidden="true" tabindex="-1"></a>search_strategies <span class="op">=</span> [</span>
<span id="cb27-11"><a href="#cb27-11" aria-hidden="true" tabindex="-1"></a>    {</span>
<span id="cb27-12"><a href="#cb27-12" aria-hidden="true" tabindex="-1"></a>        <span class="st">"name"</span>: <span class="st">"Optimal Quality"</span>,</span>
<span id="cb27-13"><a href="#cb27-13" aria-hidden="true" tabindex="-1"></a>        <span class="st">"date_range"</span>: <span class="st">"2024-06-01/2024-09-30"</span>,</span>
<span id="cb27-14"><a href="#cb27-14" aria-hidden="true" tabindex="-1"></a>        <span class="st">"cloud_max"</span>: <span class="dv">20</span>,</span>
<span id="cb27-15"><a href="#cb27-15" aria-hidden="true" tabindex="-1"></a>        <span class="st">"description"</span>: <span class="st">"Recent summer data with excellent atmospheric conditions"</span>,</span>
<span id="cb27-16"><a href="#cb27-16" aria-hidden="true" tabindex="-1"></a>        <span class="st">"priority"</span>: <span class="st">"Best for analysis quality"</span>,</span>
<span id="cb27-17"><a href="#cb27-17" aria-hidden="true" tabindex="-1"></a>        <span class="st">"trade_offs"</span>: <span class="st">"May have limited availability"</span></span>
<span id="cb27-18"><a href="#cb27-18" aria-hidden="true" tabindex="-1"></a>    },</span>
<span id="cb27-19"><a href="#cb27-19" aria-hidden="true" tabindex="-1"></a>    {</span>
<span id="cb27-20"><a href="#cb27-20" aria-hidden="true" tabindex="-1"></a>        <span class="st">"name"</span>: <span class="st">"Good Quality"</span>,</span>
<span id="cb27-21"><a href="#cb27-21" aria-hidden="true" tabindex="-1"></a>        <span class="st">"date_range"</span>: <span class="st">"2024-03-01/2024-08-31"</span>,</span>
<span id="cb27-22"><a href="#cb27-22" aria-hidden="true" tabindex="-1"></a>        <span class="st">"cloud_max"</span>: <span class="dv">35</span>,</span>
<span id="cb27-23"><a href="#cb27-23" aria-hidden="true" tabindex="-1"></a>        <span class="st">"description"</span>: <span class="st">"Extended seasonal window with good conditions"</span>,</span>
<span id="cb27-24"><a href="#cb27-24" aria-hidden="true" tabindex="-1"></a>        <span class="st">"priority"</span>: <span class="st">"Balance of quality and availability"</span>,</span>
<span id="cb27-25"><a href="#cb27-25" aria-hidden="true" tabindex="-1"></a>        <span class="st">"trade_offs"</span>: <span class="st">"Some atmospheric interference"</span></span>
<span id="cb27-26"><a href="#cb27-26" aria-hidden="true" tabindex="-1"></a>    },</span>
<span id="cb27-27"><a href="#cb27-27" aria-hidden="true" tabindex="-1"></a>    {</span>
<span id="cb27-28"><a href="#cb27-28" aria-hidden="true" tabindex="-1"></a>        <span class="st">"name"</span>: <span class="st">"Acceptable Quality"</span>,</span>
<span id="cb27-29"><a href="#cb27-29" aria-hidden="true" tabindex="-1"></a>        <span class="st">"date_range"</span>: <span class="st">"2023-09-01/2024-11-30"</span>,</span>
<span id="cb27-30"><a href="#cb27-30" aria-hidden="true" tabindex="-1"></a>        <span class="st">"cloud_max"</span>: <span class="dv">50</span>,</span>
<span id="cb27-31"><a href="#cb27-31" aria-hidden="true" tabindex="-1"></a>        <span class="st">"description"</span>: <span class="st">"Broader temporal and quality window"</span>,</span>
<span id="cb27-32"><a href="#cb27-32" aria-hidden="true" tabindex="-1"></a>        <span class="st">"priority"</span>: <span class="st">"Reliable data availability"</span>,</span>
<span id="cb27-33"><a href="#cb27-33" aria-hidden="true" tabindex="-1"></a>        <span class="st">"trade_offs"</span>: <span class="st">"May require additional preprocessing"</span></span>
<span id="cb27-34"><a href="#cb27-34" aria-hidden="true" tabindex="-1"></a>    },</span>
<span id="cb27-35"><a href="#cb27-35" aria-hidden="true" tabindex="-1"></a>    {</span>
<span id="cb27-36"><a href="#cb27-36" aria-hidden="true" tabindex="-1"></a>        <span class="st">"name"</span>: <span class="st">"Fallback Option"</span>,</span>
<span id="cb27-37"><a href="#cb27-37" aria-hidden="true" tabindex="-1"></a>        <span class="st">"date_range"</span>: <span class="st">"2023-01-01/2024-12-31"</span>,</span>
<span id="cb27-38"><a href="#cb27-38" aria-hidden="true" tabindex="-1"></a>        <span class="st">"cloud_max"</span>: <span class="dv">75</span>,</span>
<span id="cb27-39"><a href="#cb27-39" aria-hidden="true" tabindex="-1"></a>        <span class="st">"description"</span>: <span class="st">"Maximum temporal window, relaxed quality constraints"</span>,</span>
<span id="cb27-40"><a href="#cb27-40" aria-hidden="true" tabindex="-1"></a>        <span class="st">"priority"</span>: <span class="st">"Guaranteed data access"</span>,</span>
<span id="cb27-41"><a href="#cb27-41" aria-hidden="true" tabindex="-1"></a>        <span class="st">"trade_offs"</span>: <span class="st">"Significant cloud contamination possible"</span></span>
<span id="cb27-42"><a href="#cb27-42" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb27-43"><a href="#cb27-43" aria-hidden="true" tabindex="-1"></a>]</span>
<span id="cb27-44"><a href="#cb27-44" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-45"><a href="#cb27-45" aria-hidden="true" tabindex="-1"></a>logger.info(<span class="ss">f"Defined </span><span class="sc">{</span><span class="bu">len</span>(search_strategies)<span class="sc">}</span><span class="ss"> search strategies"</span>)</span>
<span id="cb27-46"><a href="#cb27-46" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> i, strategy <span class="kw">in</span> <span class="bu">enumerate</span>(search_strategies, <span class="dv">1</span>):</span>
<span id="cb27-47"><a href="#cb27-47" aria-hidden="true" tabindex="-1"></a>    logger.debug(<span class="ss">f"Strategy </span><span class="sc">{</span>i<span class="sc">}</span><span class="ss">: </span><span class="sc">{</span>strategy[<span class="st">'name'</span>]<span class="sc">}</span><span class="ss"> - </span><span class="sc">{</span>strategy[<span class="st">'description'</span>]<span class="sc">}</span><span class="ss">"</span>)</span>
<span id="cb27-48"><a href="#cb27-48" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-49"><a href="#cb27-49" aria-hidden="true" tabindex="-1"></a><span class="co"># Execute search strategies in order of preference</span></span>
<span id="cb27-50"><a href="#cb27-50" aria-hidden="true" tabindex="-1"></a>scenes <span class="op">=</span> []</span>
<span id="cb27-51"><a href="#cb27-51" aria-hidden="true" tabindex="-1"></a>successful_strategy <span class="op">=</span> <span class="va">None</span></span>
<span id="cb27-52"><a href="#cb27-52" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-53"><a href="#cb27-53" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> i, strategy <span class="kw">in</span> <span class="bu">enumerate</span>(search_strategies, <span class="dv">1</span>):</span>
<span id="cb27-54"><a href="#cb27-54" aria-hidden="true" tabindex="-1"></a>    logger.info(<span class="ss">f"Executing Strategy </span><span class="sc">{</span>i<span class="sc">}</span><span class="ss">: </span><span class="sc">{</span>strategy[<span class="st">'name'</span>]<span class="sc">}</span><span class="ss"> (dates: </span><span class="sc">{</span>strategy[<span class="st">'date_range'</span>]<span class="sc">}</span><span class="ss">, cloud &lt; </span><span class="sc">{</span>strategy[<span class="st">'cloud_max'</span>]<span class="sc">}</span><span class="ss">%)"</span>)</span>
<span id="cb27-55"><a href="#cb27-55" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-56"><a href="#cb27-56" aria-hidden="true" tabindex="-1"></a>    <span class="cf">try</span>:</span>
<span id="cb27-57"><a href="#cb27-57" aria-hidden="true" tabindex="-1"></a>        <span class="co"># Use our optimized search function with current strategy parameters</span></span>
<span id="cb27-58"><a href="#cb27-58" aria-hidden="true" tabindex="-1"></a>        temp_scenes <span class="op">=</span> search_sentinel2_scenes(</span>
<span id="cb27-59"><a href="#cb27-59" aria-hidden="true" tabindex="-1"></a>            bbox<span class="op">=</span>sf_bay_bbox,</span>
<span id="cb27-60"><a href="#cb27-60" aria-hidden="true" tabindex="-1"></a>            date_range<span class="op">=</span>strategy[<span class="st">"date_range"</span>],</span>
<span id="cb27-61"><a href="#cb27-61" aria-hidden="true" tabindex="-1"></a>            cloud_cover_max<span class="op">=</span>strategy[<span class="st">"cloud_max"</span>],</span>
<span id="cb27-62"><a href="#cb27-62" aria-hidden="true" tabindex="-1"></a>            limit<span class="op">=</span><span class="dv">100</span>  <span class="co"># Generous limit for selection flexibility</span></span>
<span id="cb27-63"><a href="#cb27-63" aria-hidden="true" tabindex="-1"></a>        )</span>
<span id="cb27-64"><a href="#cb27-64" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-65"><a href="#cb27-65" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> temp_scenes:</span>
<span id="cb27-66"><a href="#cb27-66" aria-hidden="true" tabindex="-1"></a>            scenes <span class="op">=</span> temp_scenes</span>
<span id="cb27-67"><a href="#cb27-67" aria-hidden="true" tabindex="-1"></a>            successful_strategy <span class="op">=</span> strategy</span>
<span id="cb27-68"><a href="#cb27-68" aria-hidden="true" tabindex="-1"></a>            logger.info(<span class="ss">f"SUCCESS! Found </span><span class="sc">{</span><span class="bu">len</span>(scenes)<span class="sc">}</span><span class="ss"> qualifying scenes with </span><span class="sc">{</span>strategy[<span class="st">'name'</span>]<span class="sc">}</span><span class="ss"> strategy"</span>)</span>
<span id="cb27-69"><a href="#cb27-69" aria-hidden="true" tabindex="-1"></a>            <span class="cf">break</span></span>
<span id="cb27-70"><a href="#cb27-70" aria-hidden="true" tabindex="-1"></a>        <span class="cf">else</span>:</span>
<span id="cb27-71"><a href="#cb27-71" aria-hidden="true" tabindex="-1"></a>            logger.warning(<span class="ss">f"No scenes found with </span><span class="sc">{</span>strategy[<span class="st">'name'</span>]<span class="sc">}</span><span class="ss"> strategy, proceeding to next"</span>)</span>
<span id="cb27-72"><a href="#cb27-72" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-73"><a href="#cb27-73" aria-hidden="true" tabindex="-1"></a>    <span class="cf">except</span> <span class="pp">Exception</span> <span class="im">as</span> e:</span>
<span id="cb27-74"><a href="#cb27-74" aria-hidden="true" tabindex="-1"></a>        logger.warning(<span class="ss">f"Search execution failed for </span><span class="sc">{</span>strategy[<span class="st">'name'</span>]<span class="sc">}</span><span class="ss">: </span><span class="sc">{</span><span class="bu">str</span>(e)[:<span class="dv">80</span>]<span class="sc">}</span><span class="ss">"</span>)</span>
<span id="cb27-75"><a href="#cb27-75" aria-hidden="true" tabindex="-1"></a>        <span class="cf">continue</span></span>
<span id="cb27-76"><a href="#cb27-76" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-77"><a href="#cb27-77" aria-hidden="true" tabindex="-1"></a><span class="co"># Validate search results and provide detailed feedback</span></span>
<span id="cb27-78"><a href="#cb27-78" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span> <span class="kw">not</span> scenes:</span>
<span id="cb27-79"><a href="#cb27-79" aria-hidden="true" tabindex="-1"></a>    logger.error(<span class="ss">f"Scene discovery failed after trying all </span><span class="sc">{</span><span class="bu">len</span>(search_strategies)<span class="sc">}</span><span class="ss"> strategies"</span>)</span>
<span id="cb27-80"><a href="#cb27-80" aria-hidden="true" tabindex="-1"></a>    logger.info(<span class="st">"Diagnostic steps: 1) Check network connectivity, 2) Verify API status, 3) Confirm AOI coverage, 4) Try broader date ranges, 5) Check authentication"</span>)</span>
<span id="cb27-81"><a href="#cb27-81" aria-hidden="true" tabindex="-1"></a>    <span class="cf">raise</span> <span class="pp">Exception</span>(<span class="st">"Critical failure in scene discovery. Review diagnostic steps and retry."</span>)</span>
<span id="cb27-82"><a href="#cb27-82" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-83"><a href="#cb27-83" aria-hidden="true" tabindex="-1"></a>logger.info(<span class="ss">f"Scene discovery completed: </span><span class="sc">{</span>successful_strategy[<span class="st">'name'</span>]<span class="sc">}</span><span class="ss"> strategy found </span><span class="sc">{</span><span class="bu">len</span>(scenes)<span class="sc">}</span><span class="ss"> scenes (attempt </span><span class="sc">{</span>search_strategies<span class="sc">.</span>index(successful_strategy) <span class="op">+</span> <span class="dv">1</span><span class="sc">}</span><span class="ss">/</span><span class="sc">{</span><span class="bu">len</span>(search_strategies)<span class="sc">}</span><span class="ss">)"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>2025-09-21 09:52:48,451 - INFO - Calculating optimal temporal search windows (current date: 2025-09-21)
2025-09-21 09:52:48,452 - INFO - Defined 4 search strategies
2025-09-21 09:52:48,452 - INFO - Executing Strategy 1: Optimal Quality (dates: 2024-06-01/2024-09-30, cloud &lt; 20%)
2025-09-21 09:52:50,586 - INFO - Found 68 Sentinel-2 scenes (cloud cover &lt; 20%)
2025-09-21 09:52:50,586 - INFO - SUCCESS! Found 68 qualifying scenes with Optimal Quality strategy
2025-09-21 09:52:50,587 - INFO - Scene discovery completed: Optimal Quality strategy found 68 scenes (attempt 1/4)</code></pre>
</div>
</div>
<section id="scene-quality-assessment-and-selection" class="level4">
<h4 class="anchored" data-anchor-id="scene-quality-assessment-and-selection">Scene Quality Assessment and Selection</h4>
<p>Once we have candidate scenes, we need to systematically evaluate and select the best option:</p>
<p><strong>Performing Comprehensive Scene Quality Assessment:</strong></p>
<p>This demonstrates multi-criteria decision making for satellite data selection using cloud cover, acquisition date, and other quality metrics.</p>
<div id="0f86f24b" class="cell" data-execution_count="17">
<div class="sourceCode cell-code" id="cb29"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb29-1"><a href="#cb29-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Step 4B: Intelligent Scene Selection Based on Multiple Quality Criteria</span></span>
<span id="cb29-2"><a href="#cb29-2" aria-hidden="true" tabindex="-1"></a><span class="co"># Sort scenes by multiple quality criteria</span></span>
<span id="cb29-3"><a href="#cb29-3" aria-hidden="true" tabindex="-1"></a><span class="co"># Primary: cloud cover (lower is better)</span></span>
<span id="cb29-4"><a href="#cb29-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Secondary: date (more recent is better)</span></span>
<span id="cb29-5"><a href="#cb29-5" aria-hidden="true" tabindex="-1"></a>scenes_with_scores <span class="op">=</span> []</span>
<span id="cb29-6"><a href="#cb29-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb29-7"><a href="#cb29-7" aria-hidden="true" tabindex="-1"></a>logger.info(<span class="ss">f"Evaluating </span><span class="sc">{</span><span class="bu">len</span>(scenes)<span class="sc">}</span><span class="ss"> candidate scenes for quality assessment"</span>)</span>
<span id="cb29-8"><a href="#cb29-8" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> scene <span class="kw">in</span> scenes:</span>
<span id="cb29-9"><a href="#cb29-9" aria-hidden="true" tabindex="-1"></a>    props <span class="op">=</span> scene.properties</span>
<span id="cb29-10"><a href="#cb29-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb29-11"><a href="#cb29-11" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Extract key quality metrics</span></span>
<span id="cb29-12"><a href="#cb29-12" aria-hidden="true" tabindex="-1"></a>    cloud_cover <span class="op">=</span> props.get(<span class="st">'eo:cloud_cover'</span>, <span class="dv">100</span>)</span>
<span id="cb29-13"><a href="#cb29-13" aria-hidden="true" tabindex="-1"></a>    date_str <span class="op">=</span> props.get(<span class="st">'datetime'</span>, <span class="st">''</span>).split(<span class="st">'T'</span>)[<span class="dv">0</span>]</span>
<span id="cb29-14"><a href="#cb29-14" aria-hidden="true" tabindex="-1"></a>    scene_date <span class="op">=</span> datetime.strptime(date_str, <span class="st">'%Y-%m-</span><span class="sc">%d</span><span class="st">'</span>)</span>
<span id="cb29-15"><a href="#cb29-15" aria-hidden="true" tabindex="-1"></a>    days_old <span class="op">=</span> (current_date <span class="op">-</span> scene_date).days</span>
<span id="cb29-16"><a href="#cb29-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb29-17"><a href="#cb29-17" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Calculate composite quality score (lower is better)</span></span>
<span id="cb29-18"><a href="#cb29-18" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Weight factors: cloud cover (70%), recency (30%)</span></span>
<span id="cb29-19"><a href="#cb29-19" aria-hidden="true" tabindex="-1"></a>    cloud_score <span class="op">=</span> cloud_cover  <span class="co"># 0-100 scale</span></span>
<span id="cb29-20"><a href="#cb29-20" aria-hidden="true" tabindex="-1"></a>    recency_score <span class="op">=</span> <span class="bu">min</span>(days_old <span class="op">/</span> <span class="dv">30</span>, <span class="dv">100</span>)  <span class="co"># Normalize to 0-100, cap at 100</span></span>
<span id="cb29-21"><a href="#cb29-21" aria-hidden="true" tabindex="-1"></a>    quality_score <span class="op">=</span> (<span class="fl">0.7</span> <span class="op">*</span> cloud_score) <span class="op">+</span> (<span class="fl">0.3</span> <span class="op">*</span> recency_score)</span>
<span id="cb29-22"><a href="#cb29-22" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb29-23"><a href="#cb29-23" aria-hidden="true" tabindex="-1"></a>    scene_info <span class="op">=</span> {</span>
<span id="cb29-24"><a href="#cb29-24" aria-hidden="true" tabindex="-1"></a>        <span class="st">'scene'</span>: scene,</span>
<span id="cb29-25"><a href="#cb29-25" aria-hidden="true" tabindex="-1"></a>        <span class="st">'date'</span>: date_str,</span>
<span id="cb29-26"><a href="#cb29-26" aria-hidden="true" tabindex="-1"></a>        <span class="st">'cloud_cover'</span>: cloud_cover,</span>
<span id="cb29-27"><a href="#cb29-27" aria-hidden="true" tabindex="-1"></a>        <span class="st">'days_old'</span>: days_old,</span>
<span id="cb29-28"><a href="#cb29-28" aria-hidden="true" tabindex="-1"></a>        <span class="st">'quality_score'</span>: quality_score,</span>
<span id="cb29-29"><a href="#cb29-29" aria-hidden="true" tabindex="-1"></a>        <span class="st">'tile_id'</span>: props.get(<span class="st">'sentinel:grid_square'</span>, <span class="st">'Unknown'</span>),</span>
<span id="cb29-30"><a href="#cb29-30" aria-hidden="true" tabindex="-1"></a>        <span class="st">'platform'</span>: props.get(<span class="st">'platform'</span>, <span class="st">'Sentinel-2'</span>)</span>
<span id="cb29-31"><a href="#cb29-31" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb29-32"><a href="#cb29-32" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb29-33"><a href="#cb29-33" aria-hidden="true" tabindex="-1"></a>    scenes_with_scores.append(scene_info)</span>
<span id="cb29-34"><a href="#cb29-34" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb29-35"><a href="#cb29-35" aria-hidden="true" tabindex="-1"></a><span class="co"># Sort by quality score (best first)</span></span>
<span id="cb29-36"><a href="#cb29-36" aria-hidden="true" tabindex="-1"></a>scenes_with_scores.sort(key<span class="op">=</span><span class="kw">lambda</span> x: x[<span class="st">'quality_score'</span>])</span>
<span id="cb29-37"><a href="#cb29-37" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb29-38"><a href="#cb29-38" aria-hidden="true" tabindex="-1"></a><span class="co"># Display top candidates for educational purposes</span></span>
<span id="cb29-39"><a href="#cb29-39" aria-hidden="true" tabindex="-1"></a>logger.info(<span class="st">"Top 5 Scene Candidates (ranked by quality score):"</span>)</span>
<span id="cb29-40"><a href="#cb29-40" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> i, scene_info <span class="kw">in</span> <span class="bu">enumerate</span>(scenes_with_scores[:<span class="dv">5</span>], <span class="dv">1</span>):</span>
<span id="cb29-41"><a href="#cb29-41" aria-hidden="true" tabindex="-1"></a>    logger.debug(<span class="ss">f"</span><span class="sc">{</span>i<span class="sc">}</span><span class="ss">. </span><span class="sc">{</span>scene_info[<span class="st">'date'</span>]<span class="sc">}</span><span class="ss"> - Cloud: </span><span class="sc">{</span>scene_info[<span class="st">'cloud_cover'</span>]<span class="sc">:.1f}</span><span class="ss">%, Age: </span><span class="sc">{</span>scene_info[<span class="st">'days_old'</span>]<span class="sc">}</span><span class="ss"> days, Score: </span><span class="sc">{</span>scene_info[<span class="st">'quality_score'</span>]<span class="sc">:.1f}</span><span class="ss">"</span>)</span>
<span id="cb29-42"><a href="#cb29-42" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> i <span class="op">==</span> <span class="dv">1</span>:</span>
<span id="cb29-43"><a href="#cb29-43" aria-hidden="true" tabindex="-1"></a>        logger.info(<span class="ss">f"Selected optimal scene: </span><span class="sc">{</span>scene_info[<span class="st">'date'</span>]<span class="sc">}</span><span class="ss">"</span>)</span>
<span id="cb29-44"><a href="#cb29-44" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb29-45"><a href="#cb29-45" aria-hidden="true" tabindex="-1"></a><span class="co"># Select the best scene</span></span>
<span id="cb29-46"><a href="#cb29-46" aria-hidden="true" tabindex="-1"></a>best_scene_info <span class="op">=</span> scenes_with_scores[<span class="dv">0</span>]</span>
<span id="cb29-47"><a href="#cb29-47" aria-hidden="true" tabindex="-1"></a>best_scene <span class="op">=</span> best_scene_info[<span class="st">'scene'</span>]</span>
<span id="cb29-48"><a href="#cb29-48" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb29-49"><a href="#cb29-49" aria-hidden="true" tabindex="-1"></a>logger.info(<span class="ss">f"Optimal scene selected: </span><span class="sc">{</span>best_scene_info[<span class="st">'date'</span>]<span class="sc">}</span><span class="ss"> (</span><span class="sc">{</span>best_scene_info[<span class="st">'cloud_cover'</span>]<span class="sc">:.1f}</span><span class="ss">% cloud cover, </span><span class="sc">{</span>best_scene_info[<span class="st">'platform'</span>]<span class="sc">}</span><span class="ss">, Tile: </span><span class="sc">{</span>best_scene_info[<span class="st">'tile_id'</span>]<span class="sc">}</span><span class="ss">)"</span>)</span>
<span id="cb29-50"><a href="#cb29-50" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb29-51"><a href="#cb29-51" aria-hidden="true" tabindex="-1"></a><span class="co"># Validate scene completeness for required analysis</span></span>
<span id="cb29-52"><a href="#cb29-52" aria-hidden="true" tabindex="-1"></a>logger.info(<span class="st">"Validating scene data completeness"</span>)</span>
<span id="cb29-53"><a href="#cb29-53" aria-hidden="true" tabindex="-1"></a>required_bands <span class="op">=</span> [<span class="st">'B02'</span>, <span class="st">'B03'</span>, <span class="st">'B04'</span>, <span class="st">'B08'</span>]  <span class="co"># Blue, Green, Red, NIR</span></span>
<span id="cb29-54"><a href="#cb29-54" aria-hidden="true" tabindex="-1"></a>available_bands <span class="op">=</span> <span class="bu">list</span>(best_scene.assets.keys())</span>
<span id="cb29-55"><a href="#cb29-55" aria-hidden="true" tabindex="-1"></a>spectral_bands <span class="op">=</span> [b <span class="cf">for</span> b <span class="kw">in</span> available_bands <span class="cf">if</span> b.startswith(<span class="st">'B'</span>) <span class="kw">and</span> <span class="bu">len</span>(b) <span class="op">&lt;=</span> <span class="dv">3</span>]</span>
<span id="cb29-56"><a href="#cb29-56" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb29-57"><a href="#cb29-57" aria-hidden="true" tabindex="-1"></a>logger.debug(<span class="ss">f"Available spectral bands: </span><span class="sc">{</span><span class="bu">len</span>(spectral_bands)<span class="sc">}</span><span class="ss">, Required: </span><span class="sc">{</span>required_bands<span class="sc">}</span><span class="ss">"</span>)</span>
<span id="cb29-58"><a href="#cb29-58" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb29-59"><a href="#cb29-59" aria-hidden="true" tabindex="-1"></a>missing_bands <span class="op">=</span> [b <span class="cf">for</span> b <span class="kw">in</span> required_bands <span class="cf">if</span> b <span class="kw">not</span> <span class="kw">in</span> available_bands]</span>
<span id="cb29-60"><a href="#cb29-60" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span> missing_bands:</span>
<span id="cb29-61"><a href="#cb29-61" aria-hidden="true" tabindex="-1"></a>    logger.warning(<span class="ss">f"Missing critical bands: </span><span class="sc">{</span>missing_bands<span class="sc">}</span><span class="ss"> - this may limit analysis capabilities"</span>)</span>
<span id="cb29-62"><a href="#cb29-62" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb29-63"><a href="#cb29-63" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Check for alternative bands</span></span>
<span id="cb29-64"><a href="#cb29-64" aria-hidden="true" tabindex="-1"></a>    alternative_mapping <span class="op">=</span> {<span class="st">'B02'</span>: <span class="st">'blue'</span>, <span class="st">'B03'</span>: <span class="st">'green'</span>, <span class="st">'B04'</span>: <span class="st">'red'</span>, <span class="st">'B08'</span>: <span class="st">'nir'</span>}</span>
<span id="cb29-65"><a href="#cb29-65" aria-hidden="true" tabindex="-1"></a>    alternatives_found <span class="op">=</span> []</span>
<span id="cb29-66"><a href="#cb29-66" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> missing <span class="kw">in</span> missing_bands:</span>
<span id="cb29-67"><a href="#cb29-67" aria-hidden="true" tabindex="-1"></a>        alt_name <span class="op">=</span> alternative_mapping.get(missing, missing.lower())</span>
<span id="cb29-68"><a href="#cb29-68" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> alt_name <span class="kw">in</span> available_bands:</span>
<span id="cb29-69"><a href="#cb29-69" aria-hidden="true" tabindex="-1"></a>            alternatives_found.append((missing, alt_name))</span>
<span id="cb29-70"><a href="#cb29-70" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb29-71"><a href="#cb29-71" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> alternatives_found:</span>
<span id="cb29-72"><a href="#cb29-72" aria-hidden="true" tabindex="-1"></a>        logger.info(<span class="ss">f"Found alternative band names: </span><span class="sc">{</span>alternatives_found<span class="sc">}</span><span class="ss">"</span>)</span>
<span id="cb29-73"><a href="#cb29-73" aria-hidden="true" tabindex="-1"></a><span class="cf">else</span>:</span>
<span id="cb29-74"><a href="#cb29-74" aria-hidden="true" tabindex="-1"></a>    logger.info(<span class="st">"All required bands available"</span>)</span>
<span id="cb29-75"><a href="#cb29-75" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb29-76"><a href="#cb29-76" aria-hidden="true" tabindex="-1"></a><span class="co"># Additional quality checks</span></span>
<span id="cb29-77"><a href="#cb29-77" aria-hidden="true" tabindex="-1"></a>extra_bands <span class="op">=</span> [b <span class="cf">for</span> b <span class="kw">in</span> spectral_bands <span class="cf">if</span> b <span class="kw">not</span> <span class="kw">in</span> required_bands]</span>
<span id="cb29-78"><a href="#cb29-78" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span> extra_bands:</span>
<span id="cb29-79"><a href="#cb29-79" aria-hidden="true" tabindex="-1"></a>    logger.debug(<span class="ss">f"Bonus bands available: </span><span class="sc">{</span>extra_bands[:<span class="dv">5</span>]<span class="sc">}{</span><span class="st">'...'</span> <span class="cf">if</span> <span class="bu">len</span>(extra_bands) <span class="op">&gt;</span> <span class="dv">5</span> <span class="cf">else</span> <span class="st">''</span><span class="sc">}</span><span class="ss"> (enable advanced spectral analysis)"</span>)</span>
<span id="cb29-80"><a href="#cb29-80" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb29-81"><a href="#cb29-81" aria-hidden="true" tabindex="-1"></a>logger.info(<span class="st">"Scene validation complete - ready for data loading"</span>)</span>
<span id="cb29-82"><a href="#cb29-82" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb29-83"><a href="#cb29-83" aria-hidden="true" tabindex="-1"></a><span class="co"># Quick connectivity test using our helper function</span></span>
<span id="cb29-84"><a href="#cb29-84" aria-hidden="true" tabindex="-1"></a>logger.info(<span class="st">"Performing pre-flight connectivity test"</span>)</span>
<span id="cb29-85"><a href="#cb29-85" aria-hidden="true" tabindex="-1"></a>connectivity_test <span class="op">=</span> test_subset_functionality(best_scene)</span>
<span id="cb29-86"><a href="#cb29-86" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb29-87"><a href="#cb29-87" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span> connectivity_test:</span>
<span id="cb29-88"><a href="#cb29-88" aria-hidden="true" tabindex="-1"></a>    logger.info(<span class="st">"Data access confirmed - all systems ready"</span>)</span>
<span id="cb29-89"><a href="#cb29-89" aria-hidden="true" tabindex="-1"></a><span class="cf">else</span>:</span>
<span id="cb29-90"><a href="#cb29-90" aria-hidden="true" tabindex="-1"></a>    logger.warning(<span class="st">"Connectivity issues detected - will attempt full download with fallback mechanisms"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>2025-09-21 09:52:50,597 - INFO - Evaluating 68 candidate scenes for quality assessment
2025-09-21 09:52:50,598 - INFO - Top 5 Scene Candidates (ranked by quality score):
2025-09-21 09:52:50,599 - INFO - Selected optimal scene: 2024-09-30
2025-09-21 09:52:50,599 - INFO - Optimal scene selected: 2024-09-30 (0.0% cloud cover, Sentinel-2A, Tile: Unknown)
2025-09-21 09:52:50,599 - INFO - Validating scene data completeness
2025-09-21 09:52:50,600 - INFO - All required bands available
2025-09-21 09:52:50,600 - INFO - Scene validation complete - ready for data loading
2025-09-21 09:52:50,601 - INFO - Performing pre-flight connectivity test</code></pre>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>🧪 Testing subset functionality...
📐 Calculated subset from scene bounds:
   Scene bbox: [-121.8633, 37.8353, -120.5833, 38.8433]
   Subset bbox: [-121.3513, 38.2385, -121.0953, 38.4401]
   X range: 40%-60%, Y range: 40%-60%
   Subset area: 4.0% of original scene</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>2025-09-21 09:52:58,754 - INFO - Successfully loaded 1 bands: ['B04']
2025-09-21 09:52:58,754 - INFO - Data access confirmed - all systems ready</code></pre>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>   ✅ Subset test successful: (2280, 2281) pixels, 5200680 total</code></pre>
</div>
</div>
<p>Scene selection for geospatial analysis should prioritize several key quality criteria. Cloud cover is the most important factor, as it directly affects data usability. Temporal relevance is also critical; more recent data better reflects current conditions. The processing level matters as well—Level 2A data, for example, provides atmospheric correction, which is often preferred. Finally, consider spatial coverage, ensuring that the selected scene fully covers the area of interest rather than only partially.</p>
<p>In production workflows, it is important to have fallback strategies in place, such as using multiple search approaches to ensure data availability. Automated selection can be improved by applying standardized quality scoring metrics. Always validate metadata to confirm that all required bands and assets are present, and test connectivity to the data source before starting major processing tasks.</p>
<p>Before loading data, it is helpful to examine the characteristics of the selected Sentinel-2 scene. For example, you can use the <code>eo:cloud_cover</code> property to filter scenes by cloud coverage. Sentinel-2 satellites revisit the same location every five days, so multiple scenes are usually available for a given area. Level 2A data is already atmospherically corrected, which simplifies preprocessing. Be aware that different satellites may use different naming conventions and have varying properties.</p>
<p>A thorough analysis of scene metadata is essential for designing effective workflows. By systematically inventorying available assets and understanding sensor characteristics, you can take full advantage of the rich metadata provided in STAC items and ensure your analysis is both robust and reliable.</p>
<div id="62828ac1" class="cell" data-execution_count="18">
<div class="sourceCode cell-code" id="cb34"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb34-1"><a href="#cb34-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Step 4C: Comprehensive Scene and Sensor Characterization</span></span>
<span id="cb34-2"><a href="#cb34-2" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span> <span class="st">'best_scene'</span> <span class="kw">in</span> <span class="bu">locals</span>():</span>
<span id="cb34-3"><a href="#cb34-3" aria-hidden="true" tabindex="-1"></a>    scene_props <span class="op">=</span> best_scene.properties</span>
<span id="cb34-4"><a href="#cb34-4" aria-hidden="true" tabindex="-1"></a>    scene_assets <span class="op">=</span> best_scene.assets</span>
<span id="cb34-5"><a href="#cb34-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-6"><a href="#cb34-6" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Sentinel-2 spectral band specifications with AI applications</span></span>
<span id="cb34-7"><a href="#cb34-7" aria-hidden="true" tabindex="-1"></a>    sentinel2_bands <span class="op">=</span> {</span>
<span id="cb34-8"><a href="#cb34-8" aria-hidden="true" tabindex="-1"></a>        <span class="st">'B01'</span>: {</span>
<span id="cb34-9"><a href="#cb34-9" aria-hidden="true" tabindex="-1"></a>            <span class="st">'name'</span>: <span class="st">'Coastal/Aerosol'</span>,</span>
<span id="cb34-10"><a href="#cb34-10" aria-hidden="true" tabindex="-1"></a>            <span class="st">'wavelength'</span>: <span class="st">'443 nm'</span>,</span>
<span id="cb34-11"><a href="#cb34-11" aria-hidden="true" tabindex="-1"></a>            <span class="st">'resolution'</span>: <span class="st">'60m'</span>,</span>
<span id="cb34-12"><a href="#cb34-12" aria-hidden="true" tabindex="-1"></a>            <span class="st">'ai_applications'</span>: <span class="st">'Atmospheric correction, aerosol detection'</span></span>
<span id="cb34-13"><a href="#cb34-13" aria-hidden="true" tabindex="-1"></a>        },</span>
<span id="cb34-14"><a href="#cb34-14" aria-hidden="true" tabindex="-1"></a>        <span class="st">'B02'</span>: {</span>
<span id="cb34-15"><a href="#cb34-15" aria-hidden="true" tabindex="-1"></a>            <span class="st">'name'</span>: <span class="st">'Blue'</span>,</span>
<span id="cb34-16"><a href="#cb34-16" aria-hidden="true" tabindex="-1"></a>            <span class="st">'wavelength'</span>: <span class="st">'490 nm'</span>,</span>
<span id="cb34-17"><a href="#cb34-17" aria-hidden="true" tabindex="-1"></a>            <span class="st">'resolution'</span>: <span class="st">'10m'</span>,</span>
<span id="cb34-18"><a href="#cb34-18" aria-hidden="true" tabindex="-1"></a>            <span class="st">'ai_applications'</span>: <span class="st">'Water body detection, urban classification'</span></span>
<span id="cb34-19"><a href="#cb34-19" aria-hidden="true" tabindex="-1"></a>        },</span>
<span id="cb34-20"><a href="#cb34-20" aria-hidden="true" tabindex="-1"></a>        <span class="st">'B03'</span>: {</span>
<span id="cb34-21"><a href="#cb34-21" aria-hidden="true" tabindex="-1"></a>            <span class="st">'name'</span>: <span class="st">'Green'</span>,</span>
<span id="cb34-22"><a href="#cb34-22" aria-hidden="true" tabindex="-1"></a>            <span class="st">'wavelength'</span>: <span class="st">'560 nm'</span>,</span>
<span id="cb34-23"><a href="#cb34-23" aria-hidden="true" tabindex="-1"></a>            <span class="st">'resolution'</span>: <span class="st">'10m'</span>,</span>
<span id="cb34-24"><a href="#cb34-24" aria-hidden="true" tabindex="-1"></a>            <span class="st">'ai_applications'</span>: <span class="st">'Vegetation health, true color composites'</span></span>
<span id="cb34-25"><a href="#cb34-25" aria-hidden="true" tabindex="-1"></a>        },</span>
<span id="cb34-26"><a href="#cb34-26" aria-hidden="true" tabindex="-1"></a>        <span class="st">'B04'</span>: {</span>
<span id="cb34-27"><a href="#cb34-27" aria-hidden="true" tabindex="-1"></a>            <span class="st">'name'</span>: <span class="st">'Red'</span>,</span>
<span id="cb34-28"><a href="#cb34-28" aria-hidden="true" tabindex="-1"></a>            <span class="st">'wavelength'</span>: <span class="st">'665 nm'</span>,</span>
<span id="cb34-29"><a href="#cb34-29" aria-hidden="true" tabindex="-1"></a>            <span class="st">'resolution'</span>: <span class="st">'10m'</span>,</span>
<span id="cb34-30"><a href="#cb34-30" aria-hidden="true" tabindex="-1"></a>            <span class="st">'ai_applications'</span>: <span class="st">'Vegetation stress, NDVI calculation'</span></span>
<span id="cb34-31"><a href="#cb34-31" aria-hidden="true" tabindex="-1"></a>        },</span>
<span id="cb34-32"><a href="#cb34-32" aria-hidden="true" tabindex="-1"></a>        <span class="st">'B05'</span>: {</span>
<span id="cb34-33"><a href="#cb34-33" aria-hidden="true" tabindex="-1"></a>            <span class="st">'name'</span>: <span class="st">'Red Edge 1'</span>,</span>
<span id="cb34-34"><a href="#cb34-34" aria-hidden="true" tabindex="-1"></a>            <span class="st">'wavelength'</span>: <span class="st">'705 nm'</span>,</span>
<span id="cb34-35"><a href="#cb34-35" aria-hidden="true" tabindex="-1"></a>            <span class="st">'resolution'</span>: <span class="st">'20m'</span>,</span>
<span id="cb34-36"><a href="#cb34-36" aria-hidden="true" tabindex="-1"></a>            <span class="st">'ai_applications'</span>: <span class="st">'Vegetation analysis, crop type classification'</span></span>
<span id="cb34-37"><a href="#cb34-37" aria-hidden="true" tabindex="-1"></a>        },</span>
<span id="cb34-38"><a href="#cb34-38" aria-hidden="true" tabindex="-1"></a>        <span class="st">'B06'</span>: {</span>
<span id="cb34-39"><a href="#cb34-39" aria-hidden="true" tabindex="-1"></a>            <span class="st">'name'</span>: <span class="st">'Red Edge 2'</span>,</span>
<span id="cb34-40"><a href="#cb34-40" aria-hidden="true" tabindex="-1"></a>            <span class="st">'wavelength'</span>: <span class="st">'740 nm'</span>,</span>
<span id="cb34-41"><a href="#cb34-41" aria-hidden="true" tabindex="-1"></a>            <span class="st">'resolution'</span>: <span class="st">'20m'</span>,</span>
<span id="cb34-42"><a href="#cb34-42" aria-hidden="true" tabindex="-1"></a>            <span class="st">'ai_applications'</span>: <span class="st">'Advanced vegetation indices, stress detection'</span></span>
<span id="cb34-43"><a href="#cb34-43" aria-hidden="true" tabindex="-1"></a>        },</span>
<span id="cb34-44"><a href="#cb34-44" aria-hidden="true" tabindex="-1"></a>        <span class="st">'B07'</span>: {</span>
<span id="cb34-45"><a href="#cb34-45" aria-hidden="true" tabindex="-1"></a>            <span class="st">'name'</span>: <span class="st">'Red Edge 3'</span>,</span>
<span id="cb34-46"><a href="#cb34-46" aria-hidden="true" tabindex="-1"></a>            <span class="st">'wavelength'</span>: <span class="st">'783 nm'</span>,</span>
<span id="cb34-47"><a href="#cb34-47" aria-hidden="true" tabindex="-1"></a>            <span class="st">'resolution'</span>: <span class="st">'20m'</span>,</span>
<span id="cb34-48"><a href="#cb34-48" aria-hidden="true" tabindex="-1"></a>            <span class="st">'ai_applications'</span>: <span class="st">'Vegetation biophysical parameters'</span></span>
<span id="cb34-49"><a href="#cb34-49" aria-hidden="true" tabindex="-1"></a>        },</span>
<span id="cb34-50"><a href="#cb34-50" aria-hidden="true" tabindex="-1"></a>        <span class="st">'B08'</span>: {</span>
<span id="cb34-51"><a href="#cb34-51" aria-hidden="true" tabindex="-1"></a>            <span class="st">'name'</span>: <span class="st">'NIR (Near Infrared)'</span>,</span>
<span id="cb34-52"><a href="#cb34-52" aria-hidden="true" tabindex="-1"></a>            <span class="st">'wavelength'</span>: <span class="st">'842 nm'</span>,</span>
<span id="cb34-53"><a href="#cb34-53" aria-hidden="true" tabindex="-1"></a>            <span class="st">'resolution'</span>: <span class="st">'10m'</span>,</span>
<span id="cb34-54"><a href="#cb34-54" aria-hidden="true" tabindex="-1"></a>            <span class="st">'ai_applications'</span>: <span class="st">'Biomass estimation, water/land separation'</span></span>
<span id="cb34-55"><a href="#cb34-55" aria-hidden="true" tabindex="-1"></a>        },</span>
<span id="cb34-56"><a href="#cb34-56" aria-hidden="true" tabindex="-1"></a>        <span class="st">'B8A'</span>: {</span>
<span id="cb34-57"><a href="#cb34-57" aria-hidden="true" tabindex="-1"></a>            <span class="st">'name'</span>: <span class="st">'NIR Narrow'</span>,</span>
<span id="cb34-58"><a href="#cb34-58" aria-hidden="true" tabindex="-1"></a>            <span class="st">'wavelength'</span>: <span class="st">'865 nm'</span>,</span>
<span id="cb34-59"><a href="#cb34-59" aria-hidden="true" tabindex="-1"></a>            <span class="st">'resolution'</span>: <span class="st">'20m'</span>,</span>
<span id="cb34-60"><a href="#cb34-60" aria-hidden="true" tabindex="-1"></a>            <span class="st">'ai_applications'</span>: <span class="st">'Refined vegetation analysis'</span></span>
<span id="cb34-61"><a href="#cb34-61" aria-hidden="true" tabindex="-1"></a>        },</span>
<span id="cb34-62"><a href="#cb34-62" aria-hidden="true" tabindex="-1"></a>        <span class="st">'B09'</span>: {</span>
<span id="cb34-63"><a href="#cb34-63" aria-hidden="true" tabindex="-1"></a>            <span class="st">'name'</span>: <span class="st">'Water Vapor'</span>,</span>
<span id="cb34-64"><a href="#cb34-64" aria-hidden="true" tabindex="-1"></a>            <span class="st">'wavelength'</span>: <span class="st">'945 nm'</span>,</span>
<span id="cb34-65"><a href="#cb34-65" aria-hidden="true" tabindex="-1"></a>            <span class="st">'resolution'</span>: <span class="st">'60m'</span>,</span>
<span id="cb34-66"><a href="#cb34-66" aria-hidden="true" tabindex="-1"></a>            <span class="st">'ai_applications'</span>: <span class="st">'Atmospheric water vapor correction'</span></span>
<span id="cb34-67"><a href="#cb34-67" aria-hidden="true" tabindex="-1"></a>        },</span>
<span id="cb34-68"><a href="#cb34-68" aria-hidden="true" tabindex="-1"></a>        <span class="st">'B11'</span>: {</span>
<span id="cb34-69"><a href="#cb34-69" aria-hidden="true" tabindex="-1"></a>            <span class="st">'name'</span>: <span class="st">'SWIR 1'</span>,</span>
<span id="cb34-70"><a href="#cb34-70" aria-hidden="true" tabindex="-1"></a>            <span class="st">'wavelength'</span>: <span class="st">'1610 nm'</span>,</span>
<span id="cb34-71"><a href="#cb34-71" aria-hidden="true" tabindex="-1"></a>            <span class="st">'resolution'</span>: <span class="st">'20m'</span>,</span>
<span id="cb34-72"><a href="#cb34-72" aria-hidden="true" tabindex="-1"></a>            <span class="st">'ai_applications'</span>: <span class="st">'Fire detection, soil moisture, geology'</span></span>
<span id="cb34-73"><a href="#cb34-73" aria-hidden="true" tabindex="-1"></a>        },</span>
<span id="cb34-74"><a href="#cb34-74" aria-hidden="true" tabindex="-1"></a>        <span class="st">'B12'</span>: {</span>
<span id="cb34-75"><a href="#cb34-75" aria-hidden="true" tabindex="-1"></a>            <span class="st">'name'</span>: <span class="st">'SWIR 2'</span>,</span>
<span id="cb34-76"><a href="#cb34-76" aria-hidden="true" tabindex="-1"></a>            <span class="st">'wavelength'</span>: <span class="st">'2190 nm'</span>,</span>
<span id="cb34-77"><a href="#cb34-77" aria-hidden="true" tabindex="-1"></a>            <span class="st">'resolution'</span>: <span class="st">'20m'</span>,</span>
<span id="cb34-78"><a href="#cb34-78" aria-hidden="true" tabindex="-1"></a>            <span class="st">'ai_applications'</span>: <span class="st">'Burn area mapping, mineral detection'</span></span>
<span id="cb34-79"><a href="#cb34-79" aria-hidden="true" tabindex="-1"></a>        }</span>
<span id="cb34-80"><a href="#cb34-80" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb34-81"><a href="#cb34-81" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-82"><a href="#cb34-82" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Additional data products available in Level 2A</span></span>
<span id="cb34-83"><a href="#cb34-83" aria-hidden="true" tabindex="-1"></a>    additional_products <span class="op">=</span> {</span>
<span id="cb34-84"><a href="#cb34-84" aria-hidden="true" tabindex="-1"></a>        <span class="st">'SCL'</span>: {</span>
<span id="cb34-85"><a href="#cb34-85" aria-hidden="true" tabindex="-1"></a>            <span class="st">'name'</span>: <span class="st">'Scene Classification Layer'</span>,</span>
<span id="cb34-86"><a href="#cb34-86" aria-hidden="true" tabindex="-1"></a>            <span class="st">'description'</span>: <span class="st">'Pixel-level land cover classification'</span>,</span>
<span id="cb34-87"><a href="#cb34-87" aria-hidden="true" tabindex="-1"></a>            <span class="st">'ai_applications'</span>: <span class="st">'Cloud masking, quality assessment'</span></span>
<span id="cb34-88"><a href="#cb34-88" aria-hidden="true" tabindex="-1"></a>        },</span>
<span id="cb34-89"><a href="#cb34-89" aria-hidden="true" tabindex="-1"></a>        <span class="st">'AOT'</span>: {</span>
<span id="cb34-90"><a href="#cb34-90" aria-hidden="true" tabindex="-1"></a>            <span class="st">'name'</span>: <span class="st">'Aerosol Optical Thickness'</span>,</span>
<span id="cb34-91"><a href="#cb34-91" aria-hidden="true" tabindex="-1"></a>            <span class="st">'description'</span>: <span class="st">'Atmospheric aerosol content'</span>,</span>
<span id="cb34-92"><a href="#cb34-92" aria-hidden="true" tabindex="-1"></a>            <span class="st">'ai_applications'</span>: <span class="st">'Atmospheric correction validation'</span></span>
<span id="cb34-93"><a href="#cb34-93" aria-hidden="true" tabindex="-1"></a>        },</span>
<span id="cb34-94"><a href="#cb34-94" aria-hidden="true" tabindex="-1"></a>        <span class="st">'WVP'</span>: {</span>
<span id="cb34-95"><a href="#cb34-95" aria-hidden="true" tabindex="-1"></a>            <span class="st">'name'</span>: <span class="st">'Water Vapor Pressure'</span>,</span>
<span id="cb34-96"><a href="#cb34-96" aria-hidden="true" tabindex="-1"></a>            <span class="st">'description'</span>: <span class="st">'Columnar water vapor content'</span>,</span>
<span id="cb34-97"><a href="#cb34-97" aria-hidden="true" tabindex="-1"></a>            <span class="st">'ai_applications'</span>: <span class="st">'Atmospheric correction, weather analysis'</span></span>
<span id="cb34-98"><a href="#cb34-98" aria-hidden="true" tabindex="-1"></a>        },</span>
<span id="cb34-99"><a href="#cb34-99" aria-hidden="true" tabindex="-1"></a>        <span class="st">'visual'</span>: {</span>
<span id="cb34-100"><a href="#cb34-100" aria-hidden="true" tabindex="-1"></a>            <span class="st">'name'</span>: <span class="st">'True Color Preview'</span>,</span>
<span id="cb34-101"><a href="#cb34-101" aria-hidden="true" tabindex="-1"></a>            <span class="st">'description'</span>: <span class="st">'RGB composite for visualization'</span>,</span>
<span id="cb34-102"><a href="#cb34-102" aria-hidden="true" tabindex="-1"></a>            <span class="st">'ai_applications'</span>: <span class="st">'Quick visual assessment, presentation'</span></span>
<span id="cb34-103"><a href="#cb34-103" aria-hidden="true" tabindex="-1"></a>        },</span>
<span id="cb34-104"><a href="#cb34-104" aria-hidden="true" tabindex="-1"></a>        <span class="st">'thumbnail'</span>: {</span>
<span id="cb34-105"><a href="#cb34-105" aria-hidden="true" tabindex="-1"></a>            <span class="st">'name'</span>: <span class="st">'Scene Thumbnail'</span>,</span>
<span id="cb34-106"><a href="#cb34-106" aria-hidden="true" tabindex="-1"></a>            <span class="st">'description'</span>: <span class="st">'Low-resolution preview image'</span>,</span>
<span id="cb34-107"><a href="#cb34-107" aria-hidden="true" tabindex="-1"></a>            <span class="st">'ai_applications'</span>: <span class="st">'Rapid quality screening'</span></span>
<span id="cb34-108"><a href="#cb34-108" aria-hidden="true" tabindex="-1"></a>        }</span>
<span id="cb34-109"><a href="#cb34-109" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb34-110"><a href="#cb34-110" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-111"><a href="#cb34-111" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Scene technical specifications</span></span>
<span id="cb34-112"><a href="#cb34-112" aria-hidden="true" tabindex="-1"></a>    acquisition_date <span class="op">=</span> scene_props.get(<span class="st">'datetime'</span>, <span class="st">'Unknown'</span>).split(<span class="st">'T'</span>)[<span class="dv">0</span>]</span>
<span id="cb34-113"><a href="#cb34-113" aria-hidden="true" tabindex="-1"></a>    platform <span class="op">=</span> scene_props.get(<span class="st">'platform'</span>, <span class="st">'Unknown'</span>)</span>
<span id="cb34-114"><a href="#cb34-114" aria-hidden="true" tabindex="-1"></a>    cloud_cover <span class="op">=</span> scene_props.get(<span class="st">'eo:cloud_cover'</span>, <span class="dv">0</span>)</span>
<span id="cb34-115"><a href="#cb34-115" aria-hidden="true" tabindex="-1"></a>    tile_id <span class="op">=</span> scene_props.get(<span class="st">'sentinel:grid_square'</span>, <span class="st">'Unknown'</span>)</span>
<span id="cb34-116"><a href="#cb34-116" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-117"><a href="#cb34-117" aria-hidden="true" tabindex="-1"></a>    logger.info(<span class="ss">f"Scene: </span><span class="sc">{</span>platform<span class="sc">}</span><span class="ss"> </span><span class="sc">{</span>acquisition_date<span class="sc">}</span><span class="ss">, Cloud: </span><span class="sc">{</span>cloud_cover<span class="sc">:.1f}</span><span class="ss">%, Tile: </span><span class="sc">{</span>tile_id<span class="sc">}</span><span class="ss">"</span>)</span>
<span id="cb34-118"><a href="#cb34-118" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-119"><a href="#cb34-119" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Inventory available spectral bands</span></span>
<span id="cb34-120"><a href="#cb34-120" aria-hidden="true" tabindex="-1"></a>    available_spectral <span class="op">=</span> []</span>
<span id="cb34-121"><a href="#cb34-121" aria-hidden="true" tabindex="-1"></a>    available_products <span class="op">=</span> []</span>
<span id="cb34-122"><a href="#cb34-122" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-123"><a href="#cb34-123" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> band_id, info <span class="kw">in</span> sentinel2_bands.items():</span>
<span id="cb34-124"><a href="#cb34-124" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> band_id <span class="kw">in</span> scene_assets:</span>
<span id="cb34-125"><a href="#cb34-125" aria-hidden="true" tabindex="-1"></a>            available_spectral.append(band_id)</span>
<span id="cb34-126"><a href="#cb34-126" aria-hidden="true" tabindex="-1"></a>            logger.debug(<span class="ss">f"Available: </span><span class="sc">{</span>band_id<span class="sc">}</span><span class="ss"> (</span><span class="sc">{</span>info[<span class="st">'name'</span>]<span class="sc">}</span><span class="ss">, </span><span class="sc">{</span>info[<span class="st">'resolution'</span>]<span class="sc">}</span><span class="ss">)"</span>)</span>
<span id="cb34-127"><a href="#cb34-127" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-128"><a href="#cb34-128" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> product_id, info <span class="kw">in</span> additional_products.items():</span>
<span id="cb34-129"><a href="#cb34-129" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> product_id <span class="kw">in</span> scene_assets:</span>
<span id="cb34-130"><a href="#cb34-130" aria-hidden="true" tabindex="-1"></a>            available_products.append(product_id)</span>
<span id="cb34-131"><a href="#cb34-131" aria-hidden="true" tabindex="-1"></a>            logger.debug(<span class="ss">f"Available product: </span><span class="sc">{</span>product_id<span class="sc">}</span><span class="ss"> - </span><span class="sc">{</span>info[<span class="st">'name'</span>]<span class="sc">}</span><span class="ss">"</span>)</span>
<span id="cb34-132"><a href="#cb34-132" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-133"><a href="#cb34-133" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Analysis readiness assessment</span></span>
<span id="cb34-134"><a href="#cb34-134" aria-hidden="true" tabindex="-1"></a>    core_bands <span class="op">=</span> [<span class="st">'B02'</span>, <span class="st">'B03'</span>, <span class="st">'B04'</span>, <span class="st">'B08'</span>]  <span class="co"># Essential for basic analysis</span></span>
<span id="cb34-135"><a href="#cb34-135" aria-hidden="true" tabindex="-1"></a>    advanced_bands <span class="op">=</span> [<span class="st">'B05'</span>, <span class="st">'B06'</span>, <span class="st">'B07'</span>, <span class="st">'B8A'</span>, <span class="st">'B11'</span>, <span class="st">'B12'</span>]  <span class="co"># For advanced analysis</span></span>
<span id="cb34-136"><a href="#cb34-136" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-137"><a href="#cb34-137" aria-hidden="true" tabindex="-1"></a>    core_available <span class="op">=</span> <span class="bu">sum</span>(<span class="dv">1</span> <span class="cf">for</span> band <span class="kw">in</span> core_bands <span class="cf">if</span> band <span class="kw">in</span> available_spectral)</span>
<span id="cb34-138"><a href="#cb34-138" aria-hidden="true" tabindex="-1"></a>    advanced_available <span class="op">=</span> <span class="bu">sum</span>(<span class="dv">1</span> <span class="cf">for</span> band <span class="kw">in</span> advanced_bands <span class="cf">if</span> band <span class="kw">in</span> available_spectral)</span>
<span id="cb34-139"><a href="#cb34-139" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-140"><a href="#cb34-140" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Analysis readiness assessment</span></span>
<span id="cb34-141"><a href="#cb34-141" aria-hidden="true" tabindex="-1"></a>    logger.info(<span class="ss">f"Bands available: </span><span class="sc">{</span>core_available<span class="sc">}</span><span class="ss">/</span><span class="sc">{</span><span class="bu">len</span>(core_bands)<span class="sc">}</span><span class="ss"> core, </span><span class="sc">{</span>advanced_available<span class="sc">}</span><span class="ss">/</span><span class="sc">{</span><span class="bu">len</span>(advanced_bands)<span class="sc">}</span><span class="ss"> advanced"</span>)</span>
<span id="cb34-142"><a href="#cb34-142" aria-hidden="true" tabindex="-1"></a>    logger.info(<span class="ss">f"Additional products: </span><span class="sc">{</span><span class="bu">len</span>(available_products)<span class="sc">}</span><span class="ss">"</span>)</span>
<span id="cb34-143"><a href="#cb34-143" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-144"><a href="#cb34-144" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Determine analysis capabilities</span></span>
<span id="cb34-145"><a href="#cb34-145" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> core_available <span class="op">==</span> <span class="bu">len</span>(core_bands):</span>
<span id="cb34-146"><a href="#cb34-146" aria-hidden="true" tabindex="-1"></a>        analysis_capabilities <span class="op">=</span> [<span class="st">"NDVI calculation"</span>, <span class="st">"True color visualization"</span>, <span class="st">"Basic land cover classification"</span>]</span>
<span id="cb34-147"><a href="#cb34-147" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-148"><a href="#cb34-148" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> <span class="st">'B11'</span> <span class="kw">in</span> available_spectral <span class="kw">and</span> <span class="st">'B12'</span> <span class="kw">in</span> available_spectral:</span>
<span id="cb34-149"><a href="#cb34-149" aria-hidden="true" tabindex="-1"></a>            analysis_capabilities.extend([<span class="st">"Fire detection"</span>, <span class="st">"Soil moisture analysis"</span>])</span>
<span id="cb34-150"><a href="#cb34-150" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> advanced_available <span class="op">&gt;=</span> <span class="dv">4</span>:</span>
<span id="cb34-151"><a href="#cb34-151" aria-hidden="true" tabindex="-1"></a>            analysis_capabilities.extend([<span class="st">"Advanced vegetation indices"</span>, <span class="st">"Crop type classification"</span>])</span>
<span id="cb34-152"><a href="#cb34-152" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> <span class="st">'SCL'</span> <span class="kw">in</span> available_products:</span>
<span id="cb34-153"><a href="#cb34-153" aria-hidden="true" tabindex="-1"></a>            analysis_capabilities.append(<span class="st">"Automated cloud masking"</span>)</span>
<span id="cb34-154"><a href="#cb34-154" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-155"><a href="#cb34-155" aria-hidden="true" tabindex="-1"></a>        logger.info(<span class="ss">f"Analysis ready: </span><span class="sc">{</span><span class="bu">len</span>(analysis_capabilities)<span class="sc">}</span><span class="ss"> capabilities enabled"</span>)</span>
<span id="cb34-156"><a href="#cb34-156" aria-hidden="true" tabindex="-1"></a>    <span class="cf">else</span>:</span>
<span id="cb34-157"><a href="#cb34-157" aria-hidden="true" tabindex="-1"></a>        missing_core <span class="op">=</span> [band <span class="cf">for</span> band <span class="kw">in</span> core_bands <span class="cf">if</span> band <span class="kw">not</span> <span class="kw">in</span> available_spectral]</span>
<span id="cb34-158"><a href="#cb34-158" aria-hidden="true" tabindex="-1"></a>        logger.warning(<span class="ss">f"Limited analysis: missing core bands </span><span class="sc">{</span>missing_core<span class="sc">}</span><span class="ss">"</span>)</span>
<span id="cb34-159"><a href="#cb34-159" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-160"><a href="#cb34-160" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Store technical metadata</span></span>
<span id="cb34-161"><a href="#cb34-161" aria-hidden="true" tabindex="-1"></a>    crs_info <span class="op">=</span> <span class="ss">f"EPSG:</span><span class="sc">{</span>scene_props[<span class="st">'proj:epsg'</span>]<span class="sc">}</span><span class="ss">"</span> <span class="cf">if</span> <span class="st">'proj:epsg'</span> <span class="kw">in</span> scene_props <span class="cf">else</span> <span class="st">"UTM"</span></span>
<span id="cb34-162"><a href="#cb34-162" aria-hidden="true" tabindex="-1"></a>    utm_zone <span class="op">=</span> scene_props.get(<span class="st">'sentinel:utm_zone'</span>, <span class="st">'Unknown'</span>)</span>
<span id="cb34-163"><a href="#cb34-163" aria-hidden="true" tabindex="-1"></a>    logger.info(<span class="ss">f"Metadata: </span><span class="sc">{</span>crs_info<span class="sc">}</span><span class="ss">, UTM zone </span><span class="sc">{</span>utm_zone<span class="sc">}</span><span class="ss">, 16-bit COG format"</span>)</span>
<span id="cb34-164"><a href="#cb34-164" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-165"><a href="#cb34-165" aria-hidden="true" tabindex="-1"></a><span class="cf">else</span>:</span>
<span id="cb34-166"><a href="#cb34-166" aria-hidden="true" tabindex="-1"></a>    logger.warning(<span class="st">"No optimal scene selected - cannot perform metadata analysis"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>2025-09-21 09:52:58,766 - INFO - Scene: Sentinel-2A 2024-09-30, Cloud: 0.0%, Tile: Unknown
2025-09-21 09:52:58,766 - INFO - Bands available: 4/4 core, 6/6 advanced
2025-09-21 09:52:58,767 - INFO - Additional products: 4
2025-09-21 09:52:58,767 - INFO - Analysis ready: 8 capabilities enabled
2025-09-21 09:52:58,767 - INFO - Metadata: UTM, UTM zone Unknown, 16-bit COG format</code></pre>
</div>
</div>
</section>
</section>
</section>
<section id="sentinel-2-for-ai-applications" class="level2">
<h2 class="anchored" data-anchor-id="sentinel-2-for-ai-applications">Sentinel-2 for AI Applications</h2>
<p>Sentinel-2 is well-suited for geospatial AI due to its 13 multi-spectral bands spanning the visible to shortwave infrared range. The satellite offers a high revisit frequency of every 5 days, enabling temporal analysis. Its moderate spatial resolution of 10 to 20 meters is optimal for landscape-scale AI tasks. Sentinel-2 data is freely accessible under an open data policy, which supports large-scale model training. The standardized Level 2A processing ensures consistent data quality, and global coverage provides uniform data characteristics worldwide.</p>
<p>For AI applications, Sentinel-2 offers several advantages. The large data volume supports robust model development and training. The scene classification layer can be used as ground truth for validation. Time series data enables the development of sequence models, and the availability of multiple spatial resolutions allows for hierarchical learning approaches.</p>
<p>Now let’s examine the scene’s geographic characteristics and proceed to data loading.</p>
<hr>
</section>
<section id="step-5-production-grade-satellite-data-loading-and-processing" class="level2">
<h2 class="anchored" data-anchor-id="step-5-production-grade-satellite-data-loading-and-processing">Step 5: Production-Grade Satellite Data Loading and Processing</h2>
<section id="learning-objectives-10" class="level3">
<h3 class="anchored" data-anchor-id="learning-objectives-10">Learning Objectives</h3>
<p>By the end of this section, you will be able to implement memory-efficient satellite data loading with intelligent subsetting, design adaptive processing strategies based on scene characteristics, create robust error handling for network-dependent data workflows, and build multi-dimensional datasets suitable for AI and machine learning applications.</p>
</section>
<section id="the-challenge-of-large-scale-satellite-data-loading" class="level3">
<h3 class="anchored" data-anchor-id="the-challenge-of-large-scale-satellite-data-loading">The Challenge of Large-Scale Satellite Data Loading</h3>
<p>Modern satellite scenes can exceed 1GB in size, which requires careful planning for data loading and processing. Efficient memory management is necessary to avoid loading unnecessary data into RAM. Network efficiency is also important to minimize data transfer while maintaining analysis quality. Processing strategies should be adaptive, adjusting to the size and characteristics of each scene. Additionally, workflows must be resilient to network interruptions and data access failures.</p>
</section>
<section id="intelligent-data-loading-architecture" class="level3">
<h3 class="anchored" data-anchor-id="intelligent-data-loading-architecture">Intelligent Data Loading Architecture</h3>
<p>The following approach demonstrates production-ready patterns used in operational systems. It implements an intelligent satellite data loading pipeline that adapts processing based on scene characteristics, selecting optimal loading strategies according to the scene size and analysis requirements.</p>
<div id="835a7dbf" class="cell" data-execution_count="19">
<div class="sourceCode cell-code" id="cb36"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb36-1"><a href="#cb36-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Step 5A: Scene Analysis and Adaptive Subset Strategy Selection</span></span>
<span id="cb36-2"><a href="#cb36-2" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span> <span class="st">'best_scene'</span> <span class="kw">in</span> <span class="bu">locals</span>():</span>
<span id="cb36-3"><a href="#cb36-3" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Comprehensive scene analysis for optimal loading strategy</span></span>
<span id="cb36-4"><a href="#cb36-4" aria-hidden="true" tabindex="-1"></a>    scene_info <span class="op">=</span> get_scene_info(best_scene)</span>
<span id="cb36-5"><a href="#cb36-5" aria-hidden="true" tabindex="-1"></a>    logger.info(<span class="ss">f"Scene extent: </span><span class="sc">{</span>scene_info[<span class="st">'width_km'</span>]<span class="sc">:.1f}</span><span class="ss">×</span><span class="sc">{</span>scene_info[<span class="st">'height_km'</span>]<span class="sc">:.1f}</span><span class="ss"> km (</span><span class="sc">{</span>scene_info[<span class="st">'area_km2'</span>]<span class="sc">:.0f}</span><span class="ss"> km²)"</span>)</span>
<span id="cb36-6"><a href="#cb36-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb36-7"><a href="#cb36-7" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Adaptive subset strategy based on scene characteristics</span></span>
<span id="cb36-8"><a href="#cb36-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb36-9"><a href="#cb36-9" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Decision matrix for subset sizing</span></span>
<span id="cb36-10"><a href="#cb36-10" aria-hidden="true" tabindex="-1"></a>    subset_strategies <span class="op">=</span> {</span>
<span id="cb36-11"><a href="#cb36-11" aria-hidden="true" tabindex="-1"></a>        <span class="st">"large_scene"</span>: {</span>
<span id="cb36-12"><a href="#cb36-12" aria-hidden="true" tabindex="-1"></a>            <span class="st">"condition"</span>: scene_info[<span class="st">'area_km2'</span>] <span class="op">&gt;</span> <span class="dv">5000</span>,</span>
<span id="cb36-13"><a href="#cb36-13" aria-hidden="true" tabindex="-1"></a>            <span class="st">"x_range"</span>: (<span class="dv">30</span>, <span class="dv">70</span>),</span>
<span id="cb36-14"><a href="#cb36-14" aria-hidden="true" tabindex="-1"></a>            <span class="st">"y_range"</span>: (<span class="dv">30</span>, <span class="dv">70</span>),</span>
<span id="cb36-15"><a href="#cb36-15" aria-hidden="true" tabindex="-1"></a>            <span class="st">"coverage"</span>: <span class="dv">16</span>,  <span class="co"># 40% × 40%</span></span>
<span id="cb36-16"><a href="#cb36-16" aria-hidden="true" tabindex="-1"></a>            <span class="st">"rationale"</span>: <span class="st">"Conservative subset for large scenes to manage memory usage"</span>,</span>
<span id="cb36-17"><a href="#cb36-17" aria-hidden="true" tabindex="-1"></a>            <span class="st">"description"</span>: <span class="st">"middle 40% (large scene optimization)"</span></span>
<span id="cb36-18"><a href="#cb36-18" aria-hidden="true" tabindex="-1"></a>        },</span>
<span id="cb36-19"><a href="#cb36-19" aria-hidden="true" tabindex="-1"></a>        <span class="st">"medium_scene"</span>: {</span>
<span id="cb36-20"><a href="#cb36-20" aria-hidden="true" tabindex="-1"></a>            <span class="st">"condition"</span>: scene_info[<span class="st">'area_km2'</span>] <span class="op">&gt;</span> <span class="dv">1000</span>,</span>
<span id="cb36-21"><a href="#cb36-21" aria-hidden="true" tabindex="-1"></a>            <span class="st">"x_range"</span>: (<span class="dv">20</span>, <span class="dv">80</span>),</span>
<span id="cb36-22"><a href="#cb36-22" aria-hidden="true" tabindex="-1"></a>            <span class="st">"y_range"</span>: (<span class="dv">20</span>, <span class="dv">80</span>),</span>
<span id="cb36-23"><a href="#cb36-23" aria-hidden="true" tabindex="-1"></a>            <span class="st">"coverage"</span>: <span class="dv">36</span>,  <span class="co"># 60% × 60%</span></span>
<span id="cb36-24"><a href="#cb36-24" aria-hidden="true" tabindex="-1"></a>            <span class="st">"rationale"</span>: <span class="st">"Balanced subset for medium scenes"</span>,</span>
<span id="cb36-25"><a href="#cb36-25" aria-hidden="true" tabindex="-1"></a>            <span class="st">"description"</span>: <span class="st">"middle 60% (balanced approach)"</span></span>
<span id="cb36-26"><a href="#cb36-26" aria-hidden="true" tabindex="-1"></a>        },</span>
<span id="cb36-27"><a href="#cb36-27" aria-hidden="true" tabindex="-1"></a>        <span class="st">"small_scene"</span>: {</span>
<span id="cb36-28"><a href="#cb36-28" aria-hidden="true" tabindex="-1"></a>            <span class="st">"condition"</span>: scene_info[<span class="st">'area_km2'</span>] <span class="op">&lt;=</span> <span class="dv">1000</span>,</span>
<span id="cb36-29"><a href="#cb36-29" aria-hidden="true" tabindex="-1"></a>            <span class="st">"x_range"</span>: (<span class="dv">10</span>, <span class="dv">90</span>),</span>
<span id="cb36-30"><a href="#cb36-30" aria-hidden="true" tabindex="-1"></a>            <span class="st">"y_range"</span>: (<span class="dv">10</span>, <span class="dv">90</span>),</span>
<span id="cb36-31"><a href="#cb36-31" aria-hidden="true" tabindex="-1"></a>            <span class="st">"coverage"</span>: <span class="dv">64</span>,  <span class="co"># 80% × 80%</span></span>
<span id="cb36-32"><a href="#cb36-32" aria-hidden="true" tabindex="-1"></a>            <span class="st">"rationale"</span>: <span class="st">"Maximum coverage for small scenes"</span>,</span>
<span id="cb36-33"><a href="#cb36-33" aria-hidden="true" tabindex="-1"></a>            <span class="st">"description"</span>: <span class="st">"most of scene (small scene - maximize coverage)"</span></span>
<span id="cb36-34"><a href="#cb36-34" aria-hidden="true" tabindex="-1"></a>        }</span>
<span id="cb36-35"><a href="#cb36-35" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb36-36"><a href="#cb36-36" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb36-37"><a href="#cb36-37" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Select optimal strategy</span></span>
<span id="cb36-38"><a href="#cb36-38" aria-hidden="true" tabindex="-1"></a>    selected_strategy <span class="op">=</span> <span class="va">None</span></span>
<span id="cb36-39"><a href="#cb36-39" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> strategy_name, strategy <span class="kw">in</span> subset_strategies.items():</span>
<span id="cb36-40"><a href="#cb36-40" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> strategy[<span class="st">"condition"</span>]:</span>
<span id="cb36-41"><a href="#cb36-41" aria-hidden="true" tabindex="-1"></a>            selected_strategy <span class="op">=</span> strategy</span>
<span id="cb36-42"><a href="#cb36-42" aria-hidden="true" tabindex="-1"></a>            strategy_name_selected <span class="op">=</span> strategy_name</span>
<span id="cb36-43"><a href="#cb36-43" aria-hidden="true" tabindex="-1"></a>            logger.info(<span class="ss">f"Selected strategy: </span><span class="sc">{</span>strategy_name<span class="sc">}</span><span class="ss"> (</span><span class="sc">{</span>strategy[<span class="st">'coverage'</span>]<span class="sc">}</span><span class="ss">% coverage)"</span>)</span>
<span id="cb36-44"><a href="#cb36-44" aria-hidden="true" tabindex="-1"></a>            <span class="cf">break</span></span>
<span id="cb36-45"><a href="#cb36-45" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb36-46"><a href="#cb36-46" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Apply selected subset strategy</span></span>
<span id="cb36-47"><a href="#cb36-47" aria-hidden="true" tabindex="-1"></a>    x_range, y_range <span class="op">=</span> selected_strategy[<span class="st">"x_range"</span>], selected_strategy[<span class="st">"y_range"</span>]</span>
<span id="cb36-48"><a href="#cb36-48" aria-hidden="true" tabindex="-1"></a>    subset_bbox <span class="op">=</span> get_subset_from_scene(best_scene, x_range<span class="op">=</span>x_range, y_range<span class="op">=</span>y_range)</span>
<span id="cb36-49"><a href="#cb36-49" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb36-50"><a href="#cb36-50" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Calculate expected data characteristics</span></span>
<span id="cb36-51"><a href="#cb36-51" aria-hidden="true" tabindex="-1"></a>    subset_area_km2 <span class="op">=</span> scene_info[<span class="st">'area_km2'</span>] <span class="op">*</span> (selected_strategy[<span class="st">'coverage'</span>] <span class="op">/</span> <span class="dv">100</span>)</span>
<span id="cb36-52"><a href="#cb36-52" aria-hidden="true" tabindex="-1"></a>    estimated_pixels_10m <span class="op">=</span> subset_area_km2 <span class="op">*</span> <span class="fl">1e6</span> <span class="op">/</span> (<span class="dv">10</span> <span class="op">*</span> <span class="dv">10</span>)  <span class="co"># 10m pixel size</span></span>
<span id="cb36-53"><a href="#cb36-53" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb36-54"><a href="#cb36-54" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Log subset characteristics</span></span>
<span id="cb36-55"><a href="#cb36-55" aria-hidden="true" tabindex="-1"></a>    logger.info(<span class="ss">f"Subset: </span><span class="sc">{</span>subset_area_km2<span class="sc">:.0f}</span><span class="ss"> km², </span><span class="sc">{</span>estimated_pixels_10m<span class="sc">:,.0f}</span><span class="ss"> pixels, ~</span><span class="sc">{</span>estimated_pixels_10m <span class="op">*</span> <span class="dv">4</span> <span class="op">*</span> <span class="dv">2</span> <span class="op">/</span> <span class="fl">1e6</span><span class="sc">:.1f}</span><span class="ss"> MB"</span>)</span>
<span id="cb36-56"><a href="#cb36-56" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb36-57"><a href="#cb36-57" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Alternative subset strategies available for experimentation</span></span>
<span id="cb36-58"><a href="#cb36-58" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb36-59"><a href="#cb36-59" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Core bands for essential analysis</span></span>
<span id="cb36-60"><a href="#cb36-60" aria-hidden="true" tabindex="-1"></a>    core_bands <span class="op">=</span> [<span class="st">'B04'</span>, <span class="st">'B03'</span>, <span class="st">'B02'</span>, <span class="st">'B08'</span>]  <span class="co"># Red, Green, Blue, NIR</span></span>
<span id="cb36-61"><a href="#cb36-61" aria-hidden="true" tabindex="-1"></a>    logger.info(<span class="ss">f"Selected </span><span class="sc">{</span><span class="bu">len</span>(core_bands)<span class="sc">}</span><span class="ss"> core bands for RGB and NDVI analysis"</span>)</span>
<span id="cb36-62"><a href="#cb36-62" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb36-63"><a href="#cb36-63" aria-hidden="true" tabindex="-1"></a><span class="cf">else</span>:</span>
<span id="cb36-64"><a href="#cb36-64" aria-hidden="true" tabindex="-1"></a>    logger.warning(<span class="st">"No optimal scene available - using default configuration"</span>)</span>
<span id="cb36-65"><a href="#cb36-65" aria-hidden="true" tabindex="-1"></a>    core_bands <span class="op">=</span> [<span class="st">'B04'</span>, <span class="st">'B03'</span>, <span class="st">'B02'</span>, <span class="st">'B08'</span>]  <span class="co"># Default selection</span></span>
<span id="cb36-66"><a href="#cb36-66" aria-hidden="true" tabindex="-1"></a>    subset_bbox <span class="op">=</span> <span class="va">None</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>2025-09-21 09:52:58,775 - INFO - Scene extent: 111.4×111.9 km (12469 km²)
2025-09-21 09:52:58,775 - INFO - Selected strategy: large_scene (16% coverage)
2025-09-21 09:52:58,776 - INFO - Subset: 1995 km², 19,950,658 pixels, ~159.6 MB
2025-09-21 09:52:58,776 - INFO - Selected 4 core bands for RGB and NDVI analysis</code></pre>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>📐 Calculated subset from scene bounds:
   Scene bbox: [-121.8633, 37.8353, -120.5833, 38.8433]
   Subset bbox: [-121.4793, 38.1377, -120.9673, 38.5409]
   X range: 30%-70%, Y range: 30%-70%
   Subset area: 16.0% of original scene</code></pre>
</div>
</div>
<section id="high-performance-data-loading-implementation" class="level4">
<h4 class="anchored" data-anchor-id="high-performance-data-loading-implementation">High-Performance Data Loading Implementation</h4>
<p>Now we’ll implement the actual data loading with comprehensive error handling and performance monitoring:</p>
<p><strong>Executing Production-Grade Data Loading:</strong></p>
<p>This demonstrates enterprise-level error handling and performance optimization with comprehensive pre-loading validation.</p>
<div id="9101821e" class="cell" data-execution_count="20">
<div class="sourceCode cell-code" id="cb39"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb39-1"><a href="#cb39-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Step 5B: Execute Robust Data Loading with Performance Monitoring</span></span>
<span id="cb39-2"><a href="#cb39-2" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span> <span class="st">'best_scene'</span> <span class="kw">in</span> <span class="bu">locals</span>() <span class="kw">and</span> <span class="st">'subset_bbox'</span> <span class="kw">in</span> <span class="bu">locals</span>():</span>
<span id="cb39-3"><a href="#cb39-3" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Pre-loading validation and preparation</span></span>
<span id="cb39-4"><a href="#cb39-4" aria-hidden="true" tabindex="-1"></a>    logger.info(<span class="ss">f"Loading scene </span><span class="sc">{</span>best_scene<span class="sc">.</span><span class="bu">id</span><span class="sc">}</span><span class="ss">: </span><span class="sc">{</span><span class="bu">len</span>(core_bands)<span class="sc">}</span><span class="ss"> bands, ~</span><span class="sc">{</span>estimated_pixels_10m <span class="op">*</span> <span class="bu">len</span>(core_bands) <span class="op">*</span> <span class="dv">2</span> <span class="op">/</span> <span class="fl">1e6</span><span class="sc">:.1f}</span><span class="ss"> MB"</span>)</span>
<span id="cb39-5"><a href="#cb39-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-6"><a href="#cb39-6" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Enhanced loading with comprehensive monitoring</span></span>
<span id="cb39-7"><a href="#cb39-7" aria-hidden="true" tabindex="-1"></a>    loading_start_time <span class="op">=</span> time.time()</span>
<span id="cb39-8"><a href="#cb39-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-9"><a href="#cb39-9" aria-hidden="true" tabindex="-1"></a>    <span class="cf">try</span>:</span>
<span id="cb39-10"><a href="#cb39-10" aria-hidden="true" tabindex="-1"></a>        band_data <span class="op">=</span> load_sentinel2_bands(</span>
<span id="cb39-11"><a href="#cb39-11" aria-hidden="true" tabindex="-1"></a>            best_scene,</span>
<span id="cb39-12"><a href="#cb39-12" aria-hidden="true" tabindex="-1"></a>            bands<span class="op">=</span>core_bands,</span>
<span id="cb39-13"><a href="#cb39-13" aria-hidden="true" tabindex="-1"></a>            subset_bbox<span class="op">=</span>subset_bbox,</span>
<span id="cb39-14"><a href="#cb39-14" aria-hidden="true" tabindex="-1"></a>            max_retries<span class="op">=</span><span class="dv">5</span></span>
<span id="cb39-15"><a href="#cb39-15" aria-hidden="true" tabindex="-1"></a>        )</span>
<span id="cb39-16"><a href="#cb39-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-17"><a href="#cb39-17" aria-hidden="true" tabindex="-1"></a>        loading_duration <span class="op">=</span> time.time() <span class="op">-</span> loading_start_time</span>
<span id="cb39-18"><a href="#cb39-18" aria-hidden="true" tabindex="-1"></a>        transfer_rate <span class="op">=</span> (estimated_pixels_10m <span class="op">*</span> <span class="bu">len</span>(core_bands) <span class="op">*</span> <span class="dv">2</span> <span class="op">/</span> <span class="fl">1e6</span>) <span class="op">/</span> loading_duration</span>
<span id="cb39-19"><a href="#cb39-19" aria-hidden="true" tabindex="-1"></a>        logger.info(<span class="ss">f"Data loading successful: </span><span class="sc">{</span>loading_duration<span class="sc">:.1f}</span><span class="ss">s, </span><span class="sc">{</span>transfer_rate<span class="sc">:.1f}</span><span class="ss"> MB/s"</span>)</span>
<span id="cb39-20"><a href="#cb39-20" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-21"><a href="#cb39-21" aria-hidden="true" tabindex="-1"></a>    <span class="cf">except</span> <span class="pp">Exception</span> <span class="im">as</span> loading_error:</span>
<span id="cb39-22"><a href="#cb39-22" aria-hidden="true" tabindex="-1"></a>        loading_duration <span class="op">=</span> time.time() <span class="op">-</span> loading_start_time</span>
<span id="cb39-23"><a href="#cb39-23" aria-hidden="true" tabindex="-1"></a>        logger.error(<span class="ss">f"Data loading failed after </span><span class="sc">{</span>loading_duration<span class="sc">:.1f}</span><span class="ss">s: </span><span class="sc">{</span><span class="bu">str</span>(loading_error)[:<span class="dv">80</span>]<span class="sc">}</span><span class="ss">"</span>)</span>
<span id="cb39-24"><a href="#cb39-24" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-25"><a href="#cb39-25" aria-hidden="true" tabindex="-1"></a>        <span class="co"># Fallback 1: Try without subset</span></span>
<span id="cb39-26"><a href="#cb39-26" aria-hidden="true" tabindex="-1"></a>        <span class="cf">try</span>:</span>
<span id="cb39-27"><a href="#cb39-27" aria-hidden="true" tabindex="-1"></a>            band_data <span class="op">=</span> load_sentinel2_bands(</span>
<span id="cb39-28"><a href="#cb39-28" aria-hidden="true" tabindex="-1"></a>                best_scene,</span>
<span id="cb39-29"><a href="#cb39-29" aria-hidden="true" tabindex="-1"></a>                bands<span class="op">=</span>core_bands,</span>
<span id="cb39-30"><a href="#cb39-30" aria-hidden="true" tabindex="-1"></a>                subset_bbox<span class="op">=</span><span class="va">None</span>,</span>
<span id="cb39-31"><a href="#cb39-31" aria-hidden="true" tabindex="-1"></a>                max_retries<span class="op">=</span><span class="dv">3</span></span>
<span id="cb39-32"><a href="#cb39-32" aria-hidden="true" tabindex="-1"></a>            )</span>
<span id="cb39-33"><a href="#cb39-33" aria-hidden="true" tabindex="-1"></a>            logger.info(<span class="st">"Full scene loading successful"</span>)</span>
<span id="cb39-34"><a href="#cb39-34" aria-hidden="true" tabindex="-1"></a>            subset_bbox <span class="op">=</span> <span class="va">None</span></span>
<span id="cb39-35"><a href="#cb39-35" aria-hidden="true" tabindex="-1"></a>        <span class="cf">except</span> <span class="pp">Exception</span> <span class="im">as</span> full_scene_error:</span>
<span id="cb39-36"><a href="#cb39-36" aria-hidden="true" tabindex="-1"></a>            logger.warning(<span class="ss">f"Full scene loading failed: </span><span class="sc">{</span><span class="bu">str</span>(full_scene_error)[:<span class="dv">80</span>]<span class="sc">}</span><span class="ss">"</span>)</span>
<span id="cb39-37"><a href="#cb39-37" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-38"><a href="#cb39-38" aria-hidden="true" tabindex="-1"></a>            <span class="co"># Fallback 2: Reduce band count</span></span>
<span id="cb39-39"><a href="#cb39-39" aria-hidden="true" tabindex="-1"></a>            <span class="cf">try</span>:</span>
<span id="cb39-40"><a href="#cb39-40" aria-hidden="true" tabindex="-1"></a>                essential_bands <span class="op">=</span> [<span class="st">'B04'</span>, <span class="st">'B08'</span>]  <span class="co"># Minimum for NDVI</span></span>
<span id="cb39-41"><a href="#cb39-41" aria-hidden="true" tabindex="-1"></a>                band_data <span class="op">=</span> load_sentinel2_bands(</span>
<span id="cb39-42"><a href="#cb39-42" aria-hidden="true" tabindex="-1"></a>                    best_scene,</span>
<span id="cb39-43"><a href="#cb39-43" aria-hidden="true" tabindex="-1"></a>                    bands<span class="op">=</span>essential_bands,</span>
<span id="cb39-44"><a href="#cb39-44" aria-hidden="true" tabindex="-1"></a>                    subset_bbox<span class="op">=</span>subset_bbox,</span>
<span id="cb39-45"><a href="#cb39-45" aria-hidden="true" tabindex="-1"></a>                    max_retries<span class="op">=</span><span class="dv">3</span></span>
<span id="cb39-46"><a href="#cb39-46" aria-hidden="true" tabindex="-1"></a>                )</span>
<span id="cb39-47"><a href="#cb39-47" aria-hidden="true" tabindex="-1"></a>                core_bands <span class="op">=</span> essential_bands</span>
<span id="cb39-48"><a href="#cb39-48" aria-hidden="true" tabindex="-1"></a>                logger.info(<span class="ss">f"Reduced band loading successful (</span><span class="sc">{</span><span class="bu">len</span>(essential_bands)<span class="sc">}</span><span class="ss"> bands)"</span>)</span>
<span id="cb39-49"><a href="#cb39-49" aria-hidden="true" tabindex="-1"></a>            <span class="cf">except</span> <span class="pp">Exception</span> <span class="im">as</span> reduced_error:</span>
<span id="cb39-50"><a href="#cb39-50" aria-hidden="true" tabindex="-1"></a>                logger.error(<span class="st">"All loading strategies failed - creating synthetic data"</span>)</span>
<span id="cb39-51"><a href="#cb39-51" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-52"><a href="#cb39-52" aria-hidden="true" tabindex="-1"></a>                <span class="co"># Create realistic synthetic data for educational continuity</span></span>
<span id="cb39-53"><a href="#cb39-53" aria-hidden="true" tabindex="-1"></a>                synthetic_size <span class="op">=</span> (<span class="dv">1000</span>, <span class="dv">1000</span>)</span>
<span id="cb39-54"><a href="#cb39-54" aria-hidden="true" tabindex="-1"></a>                band_data <span class="op">=</span> {</span>
<span id="cb39-55"><a href="#cb39-55" aria-hidden="true" tabindex="-1"></a>                    <span class="st">'B04'</span>: np.random.randint(<span class="dv">1000</span>, <span class="dv">4000</span>, synthetic_size, dtype<span class="op">=</span>np.uint16),</span>
<span id="cb39-56"><a href="#cb39-56" aria-hidden="true" tabindex="-1"></a>                    <span class="st">'B03'</span>: np.random.randint(<span class="dv">1000</span>, <span class="dv">4000</span>, synthetic_size, dtype<span class="op">=</span>np.uint16),</span>
<span id="cb39-57"><a href="#cb39-57" aria-hidden="true" tabindex="-1"></a>                    <span class="st">'B02'</span>: np.random.randint(<span class="dv">1000</span>, <span class="dv">4000</span>, synthetic_size, dtype<span class="op">=</span>np.uint16),</span>
<span id="cb39-58"><a href="#cb39-58" aria-hidden="true" tabindex="-1"></a>                    <span class="st">'B08'</span>: np.random.randint(<span class="dv">2000</span>, <span class="dv">6000</span>, synthetic_size, dtype<span class="op">=</span>np.uint16),</span>
<span id="cb39-59"><a href="#cb39-59" aria-hidden="true" tabindex="-1"></a>                    <span class="st">'transform'</span>: <span class="va">None</span>,</span>
<span id="cb39-60"><a href="#cb39-60" aria-hidden="true" tabindex="-1"></a>                    <span class="st">'crs'</span>: <span class="va">None</span>,</span>
<span id="cb39-61"><a href="#cb39-61" aria-hidden="true" tabindex="-1"></a>                    <span class="st">'bounds'</span>: subset_bbox <span class="cf">if</span> subset_bbox <span class="cf">else</span> sf_bay_bbox,</span>
<span id="cb39-62"><a href="#cb39-62" aria-hidden="true" tabindex="-1"></a>                    <span class="st">'scene_id'</span>: <span class="st">'SYNTHETIC_DEMO'</span>,</span>
<span id="cb39-63"><a href="#cb39-63" aria-hidden="true" tabindex="-1"></a>                    <span class="st">'date'</span>: <span class="st">'2024-01-01'</span></span>
<span id="cb39-64"><a href="#cb39-64" aria-hidden="true" tabindex="-1"></a>                }</span>
<span id="cb39-65"><a href="#cb39-65" aria-hidden="true" tabindex="-1"></a>                logger.info(<span class="ss">f"Synthetic data created: </span><span class="sc">{</span>synthetic_size[<span class="dv">0</span>]<span class="sc">}</span><span class="ss">×</span><span class="sc">{</span>synthetic_size[<span class="dv">1</span>]<span class="sc">}</span><span class="ss"> pixels"</span>)</span>
<span id="cb39-66"><a href="#cb39-66" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-67"><a href="#cb39-67" aria-hidden="true" tabindex="-1"></a><span class="cf">else</span>:</span>
<span id="cb39-68"><a href="#cb39-68" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Fallback for educational purposes</span></span>
<span id="cb39-69"><a href="#cb39-69" aria-hidden="true" tabindex="-1"></a>    logger.info(<span class="st">"No scene available - creating educational synthetic dataset"</span>)</span>
<span id="cb39-70"><a href="#cb39-70" aria-hidden="true" tabindex="-1"></a>    synthetic_size <span class="op">=</span> (<span class="dv">800</span>, <span class="dv">800</span>)</span>
<span id="cb39-71"><a href="#cb39-71" aria-hidden="true" tabindex="-1"></a>    band_data <span class="op">=</span> {</span>
<span id="cb39-72"><a href="#cb39-72" aria-hidden="true" tabindex="-1"></a>        <span class="st">'B04'</span>: np.random.randint(<span class="dv">1000</span>, <span class="dv">4000</span>, synthetic_size, dtype<span class="op">=</span>np.uint16),</span>
<span id="cb39-73"><a href="#cb39-73" aria-hidden="true" tabindex="-1"></a>        <span class="st">'B03'</span>: np.random.randint(<span class="dv">1000</span>, <span class="dv">4000</span>, synthetic_size, dtype<span class="op">=</span>np.uint16),</span>
<span id="cb39-74"><a href="#cb39-74" aria-hidden="true" tabindex="-1"></a>        <span class="st">'B02'</span>: np.random.randint(<span class="dv">1000</span>, <span class="dv">4000</span>, synthetic_size, dtype<span class="op">=</span>np.uint16),</span>
<span id="cb39-75"><a href="#cb39-75" aria-hidden="true" tabindex="-1"></a>        <span class="st">'B08'</span>: np.random.randint(<span class="dv">2000</span>, <span class="dv">6000</span>, synthetic_size, dtype<span class="op">=</span>np.uint16),</span>
<span id="cb39-76"><a href="#cb39-76" aria-hidden="true" tabindex="-1"></a>        <span class="st">'transform'</span>: <span class="va">None</span>,</span>
<span id="cb39-77"><a href="#cb39-77" aria-hidden="true" tabindex="-1"></a>        <span class="st">'crs'</span>: <span class="va">None</span>,</span>
<span id="cb39-78"><a href="#cb39-78" aria-hidden="true" tabindex="-1"></a>        <span class="st">'bounds'</span>: [<span class="op">-</span><span class="fl">122.5</span>, <span class="fl">37.7</span>, <span class="op">-</span><span class="fl">122.35</span>, <span class="fl">37.85</span>],</span>
<span id="cb39-79"><a href="#cb39-79" aria-hidden="true" tabindex="-1"></a>        <span class="st">'scene_id'</span>: <span class="st">'EDUCATIONAL_DEMO'</span>,</span>
<span id="cb39-80"><a href="#cb39-80" aria-hidden="true" tabindex="-1"></a>        <span class="st">'date'</span>: <span class="st">'2024-01-01'</span></span>
<span id="cb39-81"><a href="#cb39-81" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb39-82"><a href="#cb39-82" aria-hidden="true" tabindex="-1"></a>    core_bands <span class="op">=</span> [<span class="st">'B04'</span>, <span class="st">'B03'</span>, <span class="st">'B02'</span>, <span class="st">'B08'</span>]</span>
<span id="cb39-83"><a href="#cb39-83" aria-hidden="true" tabindex="-1"></a>    subset_bbox <span class="op">=</span> <span class="va">None</span></span>
<span id="cb39-84"><a href="#cb39-84" aria-hidden="true" tabindex="-1"></a>    logger.info(<span class="ss">f"Educational dataset ready: </span><span class="sc">{</span>synthetic_size[<span class="dv">0</span>]<span class="sc">}</span><span class="ss">×</span><span class="sc">{</span>synthetic_size[<span class="dv">1</span>]<span class="sc">}</span><span class="ss"> pixels"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>2025-09-21 09:52:58,785 - INFO - Loading scene S2A_MSIL2A_20240930T185211_R113_T10SFH_20241001T005349: 4 bands, ~159.6 MB
2025-09-21 09:54:17,781 - INFO - Successfully loaded 4 bands: ['B04', 'B03', 'B02', 'B08']
2025-09-21 09:54:17,781 - INFO - Data loading successful: 79.0s, 2.0 MB/s</code></pre>
</div>
</div>
</section>
<section id="comprehensive-data-validation-and-quality-assessment" class="level4">
<h4 class="anchored" data-anchor-id="comprehensive-data-validation-and-quality-assessment">Comprehensive Data Validation and Quality Assessment</h4>
<p>After loading, we must validate data quality and completeness before proceeding with analysis:</p>
<p><strong>Performing Comprehensive Data Validation:</strong></p>
<p>This demonstrates production-level quality assurance for satellite data including validation of data loading success and quality metrics.</p>
<div id="349fa96f" class="cell" data-execution_count="21">
<div class="sourceCode cell-code" id="cb41"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb41-1"><a href="#cb41-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Step 5C: Comprehensive Data Validation and Quality Assessment</span></span>
<span id="cb41-2"><a href="#cb41-2" aria-hidden="true" tabindex="-1"></a><span class="co"># Validate successful data loading</span></span>
<span id="cb41-3"><a href="#cb41-3" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span> <span class="st">'band_data'</span> <span class="kw">in</span> <span class="bu">locals</span>() <span class="kw">and</span> band_data:</span>
<span id="cb41-4"><a href="#cb41-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-5"><a href="#cb41-5" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Extract loaded bands and metadata</span></span>
<span id="cb41-6"><a href="#cb41-6" aria-hidden="true" tabindex="-1"></a>    available_bands <span class="op">=</span> [b <span class="cf">for</span> b <span class="kw">in</span> core_bands <span class="cf">if</span> b <span class="kw">in</span> band_data <span class="kw">and</span> <span class="bu">isinstance</span>(band_data[b], np.ndarray)]</span>
<span id="cb41-7"><a href="#cb41-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-8"><a href="#cb41-8" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Extract georeferencing information</span></span>
<span id="cb41-9"><a href="#cb41-9" aria-hidden="true" tabindex="-1"></a>    transform <span class="op">=</span> band_data.get(<span class="st">'transform'</span>, <span class="va">None</span>)</span>
<span id="cb41-10"><a href="#cb41-10" aria-hidden="true" tabindex="-1"></a>    crs <span class="op">=</span> band_data.get(<span class="st">'crs'</span>, <span class="va">None</span>)</span>
<span id="cb41-11"><a href="#cb41-11" aria-hidden="true" tabindex="-1"></a>    bounds <span class="op">=</span> band_data.get(<span class="st">'bounds'</span>, subset_bbox <span class="cf">if</span> <span class="st">'subset_bbox'</span> <span class="kw">in</span> <span class="bu">locals</span>() <span class="cf">else</span> sf_bay_bbox)</span>
<span id="cb41-12"><a href="#cb41-12" aria-hidden="true" tabindex="-1"></a>    scene_id <span class="op">=</span> band_data.get(<span class="st">'scene_id'</span>, <span class="st">'Unknown'</span>)</span>
<span id="cb41-13"><a href="#cb41-13" aria-hidden="true" tabindex="-1"></a>    acquisition_date <span class="op">=</span> band_data.get(<span class="st">'date'</span>, <span class="st">'Unknown'</span>)</span>
<span id="cb41-14"><a href="#cb41-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-15"><a href="#cb41-15" aria-hidden="true" tabindex="-1"></a>    logger.info(<span class="ss">f"Loaded </span><span class="sc">{</span><span class="bu">len</span>(available_bands)<span class="sc">}</span><span class="ss">/</span><span class="sc">{</span><span class="bu">len</span>(core_bands)<span class="sc">}</span><span class="ss"> bands: </span><span class="sc">{</span>available_bands<span class="sc">}</span><span class="ss">"</span>)</span>
<span id="cb41-16"><a href="#cb41-16" aria-hidden="true" tabindex="-1"></a>    logger.info(<span class="ss">f"Scene: </span><span class="sc">{</span>scene_id<span class="sc">}</span><span class="ss"> (</span><span class="sc">{</span>acquisition_date<span class="sc">}</span><span class="ss">)"</span>)</span>
<span id="cb41-17"><a href="#cb41-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-18"><a href="#cb41-18" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Quality assessment</span></span>
<span id="cb41-19"><a href="#cb41-19" aria-hidden="true" tabindex="-1"></a>    band_stats_summary <span class="op">=</span> {}</span>
<span id="cb41-20"><a href="#cb41-20" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> band_name <span class="kw">in</span> available_bands:</span>
<span id="cb41-21"><a href="#cb41-21" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> band_name <span class="kw">in</span> band_data:</span>
<span id="cb41-22"><a href="#cb41-22" aria-hidden="true" tabindex="-1"></a>            stats <span class="op">=</span> calculate_band_statistics(band_data[band_name], band_name)</span>
<span id="cb41-23"><a href="#cb41-23" aria-hidden="true" tabindex="-1"></a>            band_stats_summary[band_name] <span class="op">=</span> stats</span>
<span id="cb41-24"><a href="#cb41-24" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-25"><a href="#cb41-25" aria-hidden="true" tabindex="-1"></a>            <span class="co"># Quality flags</span></span>
<span id="cb41-26"><a href="#cb41-26" aria-hidden="true" tabindex="-1"></a>            quality_flags <span class="op">=</span> []</span>
<span id="cb41-27"><a href="#cb41-27" aria-hidden="true" tabindex="-1"></a>            <span class="cf">if</span> stats[<span class="st">'valid_pixels'</span>] <span class="op">&lt;</span> stats[<span class="st">'total_pixels'</span>] <span class="op">*</span> <span class="fl">0.95</span>:</span>
<span id="cb41-28"><a href="#cb41-28" aria-hidden="true" tabindex="-1"></a>                quality_flags.append(<span class="st">"invalid pixels"</span>)</span>
<span id="cb41-29"><a href="#cb41-29" aria-hidden="true" tabindex="-1"></a>            <span class="cf">if</span> stats[<span class="st">'std'</span>] <span class="op">&lt;</span> <span class="dv">10</span>:</span>
<span id="cb41-30"><a href="#cb41-30" aria-hidden="true" tabindex="-1"></a>                quality_flags.append(<span class="st">"low variance"</span>)</span>
<span id="cb41-31"><a href="#cb41-31" aria-hidden="true" tabindex="-1"></a>            <span class="cf">if</span> stats[<span class="st">'max'</span>] <span class="op">&gt;</span> <span class="dv">10000</span>:</span>
<span id="cb41-32"><a href="#cb41-32" aria-hidden="true" tabindex="-1"></a>                quality_flags.append(<span class="st">"possible saturation"</span>)</span>
<span id="cb41-33"><a href="#cb41-33" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-34"><a href="#cb41-34" aria-hidden="true" tabindex="-1"></a>            quality_status <span class="op">=</span> <span class="st">"; "</span>.join(quality_flags) <span class="cf">if</span> quality_flags <span class="cf">else</span> <span class="st">"normal"</span></span>
<span id="cb41-35"><a href="#cb41-35" aria-hidden="true" tabindex="-1"></a>            logger.info(<span class="ss">f"</span><span class="sc">{</span>band_name<span class="sc">}</span><span class="ss">: range [</span><span class="sc">{</span>stats[<span class="st">'min'</span>]<span class="sc">:.0f}</span><span class="ss">, </span><span class="sc">{</span>stats[<span class="st">'max'</span>]<span class="sc">:.0f}</span><span class="ss">], quality: </span><span class="sc">{</span>quality_status<span class="sc">}</span><span class="ss">"</span>)</span>
<span id="cb41-36"><a href="#cb41-36" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-37"><a href="#cb41-37" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Cross-band validation</span></span>
<span id="cb41-38"><a href="#cb41-38" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> <span class="bu">len</span>(available_bands) <span class="op">&gt;=</span> <span class="dv">2</span>:</span>
<span id="cb41-39"><a href="#cb41-39" aria-hidden="true" tabindex="-1"></a>        shapes <span class="op">=</span> [band_data[band].shape <span class="cf">for</span> band <span class="kw">in</span> available_bands]</span>
<span id="cb41-40"><a href="#cb41-40" aria-hidden="true" tabindex="-1"></a>        consistent_shape <span class="op">=</span> <span class="bu">all</span>(shape <span class="op">==</span> shapes[<span class="dv">0</span>] <span class="cf">for</span> shape <span class="kw">in</span> shapes)</span>
<span id="cb41-41"><a href="#cb41-41" aria-hidden="true" tabindex="-1"></a>        logger.info(<span class="ss">f"Spatial consistency: </span><span class="sc">{</span><span class="st">'✓'</span> <span class="cf">if</span> consistent_shape <span class="cf">else</span> <span class="st">'⚠'</span><span class="sc">}</span><span class="ss"> shape </span><span class="sc">{</span>shapes[<span class="dv">0</span>] <span class="cf">if</span> consistent_shape <span class="cf">else</span> <span class="st">'mixed'</span><span class="sc">}</span><span class="ss">"</span>)</span>
<span id="cb41-42"><a href="#cb41-42" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-43"><a href="#cb41-43" aria-hidden="true" tabindex="-1"></a>        <span class="co"># Check for reasonable spectral relationships</span></span>
<span id="cb41-44"><a href="#cb41-44" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> <span class="st">'B04'</span> <span class="kw">in</span> available_bands <span class="kw">and</span> <span class="st">'B08'</span> <span class="kw">in</span> available_bands:</span>
<span id="cb41-45"><a href="#cb41-45" aria-hidden="true" tabindex="-1"></a>            ndvi_sample <span class="op">=</span> calculate_ndvi(band_data[<span class="st">'B08'</span>][:<span class="dv">100</span>, :<span class="dv">100</span>], band_data[<span class="st">'B04'</span>][:<span class="dv">100</span>, :<span class="dv">100</span>])</span>
<span id="cb41-46"><a href="#cb41-46" aria-hidden="true" tabindex="-1"></a>            ndvi_mean <span class="op">=</span> np.nanmean(ndvi_sample)</span>
<span id="cb41-47"><a href="#cb41-47" aria-hidden="true" tabindex="-1"></a>            <span class="co"># NDVI sanity check</span></span>
<span id="cb41-48"><a href="#cb41-48" aria-hidden="true" tabindex="-1"></a>            <span class="cf">if</span> <span class="op">-</span><span class="dv">1</span> <span class="op">&lt;=</span> ndvi_mean <span class="op">&lt;=</span> <span class="dv">1</span>:</span>
<span id="cb41-49"><a href="#cb41-49" aria-hidden="true" tabindex="-1"></a>                logger.info(<span class="ss">f"NDVI validation passed: mean = </span><span class="sc">{</span>ndvi_mean<span class="sc">:.3f}</span><span class="ss">"</span>)</span>
<span id="cb41-50"><a href="#cb41-50" aria-hidden="true" tabindex="-1"></a>            <span class="cf">else</span>:</span>
<span id="cb41-51"><a href="#cb41-51" aria-hidden="true" tabindex="-1"></a>                logger.warning(<span class="ss">f"NDVI anomaly detected: mean = </span><span class="sc">{</span>ndvi_mean<span class="sc">:.3f}</span><span class="ss">"</span>)</span>
<span id="cb41-52"><a href="#cb41-52" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-53"><a href="#cb41-53" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Overall data readiness assessment</span></span>
<span id="cb41-54"><a href="#cb41-54" aria-hidden="true" tabindex="-1"></a>    readiness_score <span class="op">=</span> <span class="dv">0</span></span>
<span id="cb41-55"><a href="#cb41-55" aria-hidden="true" tabindex="-1"></a>    readiness_criteria <span class="op">=</span> {</span>
<span id="cb41-56"><a href="#cb41-56" aria-hidden="true" tabindex="-1"></a>        <span class="st">'bands_available'</span>: <span class="bu">len</span>(available_bands) <span class="op">&gt;=</span> <span class="dv">3</span>,  <span class="co"># Minimum for RGB</span></span>
<span id="cb41-57"><a href="#cb41-57" aria-hidden="true" tabindex="-1"></a>        <span class="st">'spatial_consistency'</span>: <span class="st">'consistent_shape'</span> <span class="kw">in</span> <span class="bu">locals</span>() <span class="kw">and</span> consistent_shape,</span>
<span id="cb41-58"><a href="#cb41-58" aria-hidden="true" tabindex="-1"></a>        <span class="st">'valid_pixels'</span>: <span class="bu">all</span>(stats[<span class="st">'valid_pixels'</span>] <span class="op">&gt;</span> stats[<span class="st">'total_pixels'</span>] <span class="op">*</span> <span class="fl">0.9</span> <span class="cf">for</span> stats <span class="kw">in</span> band_stats_summary.values()),</span>
<span id="cb41-59"><a href="#cb41-59" aria-hidden="true" tabindex="-1"></a>        <span class="st">'spectral_sanity'</span>: <span class="st">'ndvi_mean'</span> <span class="kw">in</span> <span class="bu">locals</span>() <span class="kw">and</span> <span class="op">-</span><span class="dv">1</span> <span class="op">&lt;=</span> ndvi_mean <span class="op">&lt;=</span> <span class="dv">1</span></span>
<span id="cb41-60"><a href="#cb41-60" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb41-61"><a href="#cb41-61" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-62"><a href="#cb41-62" aria-hidden="true" tabindex="-1"></a>    readiness_score <span class="op">=</span> <span class="bu">sum</span>(readiness_criteria.values())</span>
<span id="cb41-63"><a href="#cb41-63" aria-hidden="true" tabindex="-1"></a>    max_score <span class="op">=</span> <span class="bu">len</span>(readiness_criteria)</span>
<span id="cb41-64"><a href="#cb41-64" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-65"><a href="#cb41-65" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Overall data readiness assessment</span></span>
<span id="cb41-66"><a href="#cb41-66" aria-hidden="true" tabindex="-1"></a>    logger.info(<span class="ss">f"Data readiness: </span><span class="sc">{</span>readiness_score<span class="sc">}</span><span class="ss">/</span><span class="sc">{</span>max_score<span class="sc">}</span><span class="ss"> criteria passed"</span>)</span>
<span id="cb41-67"><a href="#cb41-67" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-68"><a href="#cb41-68" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> readiness_score <span class="op">&gt;=</span> max_score <span class="op">*</span> <span class="fl">0.75</span>:</span>
<span id="cb41-69"><a href="#cb41-69" aria-hidden="true" tabindex="-1"></a>        logger.info(<span class="st">"STATUS: READY for analysis - High quality data confirmed"</span>)</span>
<span id="cb41-70"><a href="#cb41-70" aria-hidden="true" tabindex="-1"></a>    <span class="cf">elif</span> readiness_score <span class="op">&gt;=</span> max_score <span class="op">*</span> <span class="fl">0.5</span>:</span>
<span id="cb41-71"><a href="#cb41-71" aria-hidden="true" tabindex="-1"></a>        logger.warning(<span class="st">"STATUS: PROCEED WITH CAUTION - Some quality issues detected"</span>)</span>
<span id="cb41-72"><a href="#cb41-72" aria-hidden="true" tabindex="-1"></a>    <span class="cf">else</span>:</span>
<span id="cb41-73"><a href="#cb41-73" aria-hidden="true" tabindex="-1"></a>        logger.error(<span class="st">"STATUS: QUALITY ISSUES - Consider alternative data sources"</span>)</span>
<span id="cb41-74"><a href="#cb41-74" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-75"><a href="#cb41-75" aria-hidden="true" tabindex="-1"></a><span class="cf">else</span>:</span>
<span id="cb41-76"><a href="#cb41-76" aria-hidden="true" tabindex="-1"></a>    logger.error(<span class="st">"Data validation failed - no valid satellite data available"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>2025-09-21 09:54:17,791 - INFO - Loaded 4/4 bands: ['B04', 'B03', 'B02', 'B08']
2025-09-21 09:54:17,792 - INFO - Scene: S2A_MSIL2A_20240930T185211_R113_T10SFH_20241001T005349 (2024-09-30)
2025-09-21 09:54:18,322 - INFO - B04: range [0, 15256], quality: possible saturation
2025-09-21 09:54:18,818 - INFO - B03: range [0, 18400], quality: possible saturation
2025-09-21 09:54:19,316 - INFO - B02: range [0, 19536], quality: possible saturation
2025-09-21 09:54:19,807 - INFO - B08: range [0, 15073], quality: possible saturation
2025-09-21 09:54:19,807 - INFO - Spatial consistency: ✓ shape (4561, 4561)
2025-09-21 09:54:19,808 - INFO - NDVI validation passed: mean = 0.230
2025-09-21 09:54:19,809 - INFO - Data readiness: 4/4 criteria passed
2025-09-21 09:54:19,809 - INFO - STATUS: READY for analysis - High quality data confirmed</code></pre>
</div>
</div>
</section>
<section id="creating-ai-ready-multi-dimensional-datasets" class="level4">
<h4 class="anchored" data-anchor-id="creating-ai-ready-multi-dimensional-datasets">Creating AI-Ready Multi-Dimensional Datasets</h4>
<p>Transform loaded bands into analysis-ready xarray datasets optimized for AI/ML workflows:</p>
<p><strong>Creating AI-Ready Multi-Dimensional Dataset:</strong></p>
<p>This demonstrates data structuring for machine learning applications, transforming raw satellite bands into analysis-ready xarray datasets.</p>
<div id="ad5b516e" class="cell" data-execution_count="22">
<div class="sourceCode cell-code" id="cb43"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb43-1"><a href="#cb43-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Step 5D: Build AI-Ready Multi-Dimensional Dataset</span></span>
<span id="cb43-2"><a href="#cb43-2" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span> <span class="st">'band_data'</span> <span class="kw">in</span> <span class="bu">locals</span>() <span class="kw">and</span> band_data <span class="kw">and</span> available_bands:</span>
<span id="cb43-3"><a href="#cb43-3" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Get spatial dimensions from first available band</span></span>
<span id="cb43-4"><a href="#cb43-4" aria-hidden="true" tabindex="-1"></a>    sample_band <span class="op">=</span> band_data[available_bands[<span class="dv">0</span>]]</span>
<span id="cb43-5"><a href="#cb43-5" aria-hidden="true" tabindex="-1"></a>    height, width <span class="op">=</span> sample_band.shape</span>
<span id="cb43-6"><a href="#cb43-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb43-7"><a href="#cb43-7" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Dataset characteristics</span></span>
<span id="cb43-8"><a href="#cb43-8" aria-hidden="true" tabindex="-1"></a>    total_elements <span class="op">=</span> height <span class="op">*</span> width <span class="op">*</span> <span class="bu">len</span>(available_bands)</span>
<span id="cb43-9"><a href="#cb43-9" aria-hidden="true" tabindex="-1"></a>    logger.info(<span class="ss">f"Dataset: </span><span class="sc">{</span>height<span class="sc">}</span><span class="ss">×</span><span class="sc">{</span>width<span class="sc">}</span><span class="ss"> pixels, </span><span class="sc">{</span><span class="bu">len</span>(available_bands)<span class="sc">}</span><span class="ss"> bands, </span><span class="sc">{</span>total_elements<span class="sc">:,}</span><span class="ss"> elements"</span>)</span>
<span id="cb43-10"><a href="#cb43-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb43-11"><a href="#cb43-11" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Create sophisticated coordinate system</span></span>
<span id="cb43-12"><a href="#cb43-12" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> bounds <span class="kw">and</span> <span class="bu">len</span>(bounds) <span class="op">==</span> <span class="dv">4</span>:</span>
<span id="cb43-13"><a href="#cb43-13" aria-hidden="true" tabindex="-1"></a>        <span class="co"># Geographic coordinates (WGS84)</span></span>
<span id="cb43-14"><a href="#cb43-14" aria-hidden="true" tabindex="-1"></a>        x_coords <span class="op">=</span> np.linspace(bounds[<span class="dv">0</span>], bounds[<span class="dv">2</span>], width)   <span class="co"># Longitude</span></span>
<span id="cb43-15"><a href="#cb43-15" aria-hidden="true" tabindex="-1"></a>        y_coords <span class="op">=</span> np.linspace(bounds[<span class="dv">3</span>], bounds[<span class="dv">1</span>], height)  <span class="co"># Latitude (north to south)</span></span>
<span id="cb43-16"><a href="#cb43-16" aria-hidden="true" tabindex="-1"></a>        coord_system <span class="op">=</span> <span class="st">"geographic"</span></span>
<span id="cb43-17"><a href="#cb43-17" aria-hidden="true" tabindex="-1"></a>    <span class="cf">else</span>:</span>
<span id="cb43-18"><a href="#cb43-18" aria-hidden="true" tabindex="-1"></a>        <span class="co"># Pixel coordinates</span></span>
<span id="cb43-19"><a href="#cb43-19" aria-hidden="true" tabindex="-1"></a>        x_coords <span class="op">=</span> np.arange(width)</span>
<span id="cb43-20"><a href="#cb43-20" aria-hidden="true" tabindex="-1"></a>        y_coords <span class="op">=</span> np.arange(height)</span>
<span id="cb43-21"><a href="#cb43-21" aria-hidden="true" tabindex="-1"></a>        coord_system <span class="op">=</span> <span class="st">"pixel"</span></span>
<span id="cb43-22"><a href="#cb43-22" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb43-23"><a href="#cb43-23" aria-hidden="true" tabindex="-1"></a>    logger.debug(<span class="ss">f"Coordinates: </span><span class="sc">{</span>coord_system<span class="sc">}</span><span class="ss">, X: </span><span class="sc">{</span>x_coords[<span class="dv">0</span>]<span class="sc">:.4f}</span><span class="ss"> to </span><span class="sc">{</span>x_coords[<span class="op">-</span><span class="dv">1</span>]<span class="sc">:.4f}</span><span class="ss">, Y: </span><span class="sc">{</span>y_coords[<span class="dv">0</span>]<span class="sc">:.4f}</span><span class="ss"> to </span><span class="sc">{</span>y_coords[<span class="op">-</span><span class="dv">1</span>]<span class="sc">:.4f}</span><span class="ss">"</span>)</span>
<span id="cb43-24"><a href="#cb43-24" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb43-25"><a href="#cb43-25" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Build xarray DataArrays with comprehensive metadata</span></span>
<span id="cb43-26"><a href="#cb43-26" aria-hidden="true" tabindex="-1"></a>    data_arrays <span class="op">=</span> {}</span>
<span id="cb43-27"><a href="#cb43-27" aria-hidden="true" tabindex="-1"></a>    band_metadata <span class="op">=</span> {</span>
<span id="cb43-28"><a href="#cb43-28" aria-hidden="true" tabindex="-1"></a>        <span class="st">'B02'</span>: {<span class="st">'name'</span>: <span class="st">'blue'</span>, <span class="st">'wavelength'</span>: <span class="dv">490</span>, <span class="st">'description'</span>: <span class="st">'Blue band (coastal/aerosol)'</span>},</span>
<span id="cb43-29"><a href="#cb43-29" aria-hidden="true" tabindex="-1"></a>        <span class="st">'B03'</span>: {<span class="st">'name'</span>: <span class="st">'green'</span>, <span class="st">'wavelength'</span>: <span class="dv">560</span>, <span class="st">'description'</span>: <span class="st">'Green band (vegetation)'</span>},</span>
<span id="cb43-30"><a href="#cb43-30" aria-hidden="true" tabindex="-1"></a>        <span class="st">'B04'</span>: {<span class="st">'name'</span>: <span class="st">'red'</span>, <span class="st">'wavelength'</span>: <span class="dv">665</span>, <span class="st">'description'</span>: <span class="st">'Red band (chlorophyll absorption)'</span>},</span>
<span id="cb43-31"><a href="#cb43-31" aria-hidden="true" tabindex="-1"></a>        <span class="st">'B08'</span>: {<span class="st">'name'</span>: <span class="st">'nir'</span>, <span class="st">'wavelength'</span>: <span class="dv">842</span>, <span class="st">'description'</span>: <span class="st">'Near-infrared (biomass/structure)'</span>}</span>
<span id="cb43-32"><a href="#cb43-32" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb43-33"><a href="#cb43-33" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb43-34"><a href="#cb43-34" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Build spectral data arrays</span></span>
<span id="cb43-35"><a href="#cb43-35" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> band_id <span class="kw">in</span> available_bands:</span>
<span id="cb43-36"><a href="#cb43-36" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> band_id <span class="kw">in</span> band_metadata:</span>
<span id="cb43-37"><a href="#cb43-37" aria-hidden="true" tabindex="-1"></a>            metadata <span class="op">=</span> band_metadata[band_id]</span>
<span id="cb43-38"><a href="#cb43-38" aria-hidden="true" tabindex="-1"></a>            band_name <span class="op">=</span> metadata[<span class="st">'name'</span>]</span>
<span id="cb43-39"><a href="#cb43-39" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb43-40"><a href="#cb43-40" aria-hidden="true" tabindex="-1"></a>            <span class="co"># Create DataArray with rich metadata</span></span>
<span id="cb43-41"><a href="#cb43-41" aria-hidden="true" tabindex="-1"></a>            data_arrays[band_name] <span class="op">=</span> xr.DataArray(</span>
<span id="cb43-42"><a href="#cb43-42" aria-hidden="true" tabindex="-1"></a>                band_data[band_id],</span>
<span id="cb43-43"><a href="#cb43-43" aria-hidden="true" tabindex="-1"></a>                dims<span class="op">=</span>[<span class="st">'y'</span>, <span class="st">'x'</span>],</span>
<span id="cb43-44"><a href="#cb43-44" aria-hidden="true" tabindex="-1"></a>                coords<span class="op">=</span>{</span>
<span id="cb43-45"><a href="#cb43-45" aria-hidden="true" tabindex="-1"></a>                    <span class="st">'y'</span>: (<span class="st">'y'</span>, y_coords, {<span class="st">'long_name'</span>: <span class="st">'Latitude'</span> <span class="cf">if</span> coord_system <span class="op">==</span> <span class="st">'geographic'</span> <span class="cf">else</span> <span class="st">'Y coordinate'</span>,</span>
<span id="cb43-46"><a href="#cb43-46" aria-hidden="true" tabindex="-1"></a>                                         <span class="st">'units'</span>: <span class="st">'degrees_north'</span> <span class="cf">if</span> coord_system <span class="op">==</span> <span class="st">'geographic'</span> <span class="cf">else</span> <span class="st">'pixels'</span>}),</span>
<span id="cb43-47"><a href="#cb43-47" aria-hidden="true" tabindex="-1"></a>                    <span class="st">'x'</span>: (<span class="st">'x'</span>, x_coords, {<span class="st">'long_name'</span>: <span class="st">'Longitude'</span> <span class="cf">if</span> coord_system <span class="op">==</span> <span class="st">'geographic'</span> <span class="cf">else</span> <span class="st">'X coordinate'</span>,</span>
<span id="cb43-48"><a href="#cb43-48" aria-hidden="true" tabindex="-1"></a>                                         <span class="st">'units'</span>: <span class="st">'degrees_east'</span> <span class="cf">if</span> coord_system <span class="op">==</span> <span class="st">'geographic'</span> <span class="cf">else</span> <span class="st">'pixels'</span>})</span>
<span id="cb43-49"><a href="#cb43-49" aria-hidden="true" tabindex="-1"></a>                },</span>
<span id="cb43-50"><a href="#cb43-50" aria-hidden="true" tabindex="-1"></a>                attrs<span class="op">=</span>{</span>
<span id="cb43-51"><a href="#cb43-51" aria-hidden="true" tabindex="-1"></a>                    <span class="st">'band_id'</span>: band_id,</span>
<span id="cb43-52"><a href="#cb43-52" aria-hidden="true" tabindex="-1"></a>                    <span class="st">'long_name'</span>: metadata[<span class="st">'description'</span>],</span>
<span id="cb43-53"><a href="#cb43-53" aria-hidden="true" tabindex="-1"></a>                    <span class="st">'wavelength'</span>: metadata[<span class="st">'wavelength'</span>],</span>
<span id="cb43-54"><a href="#cb43-54" aria-hidden="true" tabindex="-1"></a>                    <span class="st">'wavelength_units'</span>: <span class="st">'nanometers'</span>,</span>
<span id="cb43-55"><a href="#cb43-55" aria-hidden="true" tabindex="-1"></a>                    <span class="st">'units'</span>: <span class="st">'DN'</span>,</span>
<span id="cb43-56"><a href="#cb43-56" aria-hidden="true" tabindex="-1"></a>                    <span class="st">'valid_range'</span>: [<span class="dv">0</span>, <span class="dv">10000</span>],</span>
<span id="cb43-57"><a href="#cb43-57" aria-hidden="true" tabindex="-1"></a>                    <span class="st">'scale_factor'</span>: <span class="fl">1.0</span>,</span>
<span id="cb43-58"><a href="#cb43-58" aria-hidden="true" tabindex="-1"></a>                    <span class="st">'add_offset'</span>: <span class="fl">0.0</span></span>
<span id="cb43-59"><a href="#cb43-59" aria-hidden="true" tabindex="-1"></a>                }</span>
<span id="cb43-60"><a href="#cb43-60" aria-hidden="true" tabindex="-1"></a>            )</span>
<span id="cb43-61"><a href="#cb43-61" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb43-62"><a href="#cb43-62" aria-hidden="true" tabindex="-1"></a>            logger.debug(<span class="ss">f"Created DataArray: </span><span class="sc">{</span>band_name<span class="sc">}</span><span class="ss"> (</span><span class="sc">{</span>metadata[<span class="st">'wavelength'</span>]<span class="sc">}</span><span class="ss">nm)"</span>)</span>
<span id="cb43-63"><a href="#cb43-63" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb43-64"><a href="#cb43-64" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Create comprehensive Dataset</span></span>
<span id="cb43-65"><a href="#cb43-65" aria-hidden="true" tabindex="-1"></a>    satellite_ds <span class="op">=</span> xr.Dataset(</span>
<span id="cb43-66"><a href="#cb43-66" aria-hidden="true" tabindex="-1"></a>        data_arrays,</span>
<span id="cb43-67"><a href="#cb43-67" aria-hidden="true" tabindex="-1"></a>        attrs<span class="op">=</span>{</span>
<span id="cb43-68"><a href="#cb43-68" aria-hidden="true" tabindex="-1"></a>            <span class="st">'title'</span>: <span class="st">'Sentinel-2 Level 2A Surface Reflectance'</span>,</span>
<span id="cb43-69"><a href="#cb43-69" aria-hidden="true" tabindex="-1"></a>            <span class="st">'source'</span>: <span class="ss">f'Scene: </span><span class="sc">{</span>scene_id<span class="sc">}</span><span class="ss">'</span>,</span>
<span id="cb43-70"><a href="#cb43-70" aria-hidden="true" tabindex="-1"></a>            <span class="st">'acquisition_date'</span>: acquisition_date,</span>
<span id="cb43-71"><a href="#cb43-71" aria-hidden="true" tabindex="-1"></a>            <span class="st">'processing_level'</span>: <span class="st">'L2A'</span>,</span>
<span id="cb43-72"><a href="#cb43-72" aria-hidden="true" tabindex="-1"></a>            <span class="st">'crs'</span>: <span class="bu">str</span>(crs) <span class="cf">if</span> crs <span class="cf">else</span> <span class="st">'WGS84 (assumed)'</span>,</span>
<span id="cb43-73"><a href="#cb43-73" aria-hidden="true" tabindex="-1"></a>            <span class="st">'spatial_resolution'</span>: <span class="st">'10 meters'</span>,</span>
<span id="cb43-74"><a href="#cb43-74" aria-hidden="true" tabindex="-1"></a>            <span class="st">'coordinate_system'</span>: coord_system,</span>
<span id="cb43-75"><a href="#cb43-75" aria-hidden="true" tabindex="-1"></a>            <span class="st">'creation_date'</span>: pd.Timestamp.now().isoformat(),</span>
<span id="cb43-76"><a href="#cb43-76" aria-hidden="true" tabindex="-1"></a>            <span class="st">'processing_software'</span>: <span class="st">'Geospatial AI Toolkit'</span>,</span>
<span id="cb43-77"><a href="#cb43-77" aria-hidden="true" tabindex="-1"></a>            <span class="st">'data_access'</span>: <span class="st">'Microsoft Planetary Computer via STAC'</span></span>
<span id="cb43-78"><a href="#cb43-78" aria-hidden="true" tabindex="-1"></a>        }</span>
<span id="cb43-79"><a href="#cb43-79" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb43-80"><a href="#cb43-80" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb43-81"><a href="#cb43-81" aria-hidden="true" tabindex="-1"></a>    logger.info(<span class="ss">f"Created xarray Dataset with </span><span class="sc">{</span><span class="bu">len</span>(data_arrays)<span class="sc">}</span><span class="ss"> bands: </span><span class="sc">{</span><span class="bu">list</span>(satellite_ds.data_vars)<span class="sc">}</span><span class="ss">"</span>)</span>
<span id="cb43-82"><a href="#cb43-82" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(satellite_ds)  <span class="co"># Display dataset structure</span></span>
<span id="cb43-83"><a href="#cb43-83" aria-hidden="true" tabindex="-1"></a><span class="cf">else</span>:</span>
<span id="cb43-84"><a href="#cb43-84" aria-hidden="true" tabindex="-1"></a>    logger.warning(<span class="st">"No band data available for xarray Dataset creation"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>2025-09-21 09:54:19,818 - INFO - Dataset: 4561×4561 pixels, 4 bands, 83,210,884 elements
2025-09-21 09:54:19,823 - INFO - Created xarray Dataset with 4 bands: ['red', 'green', 'blue', 'nir']</code></pre>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>&lt;xarray.Dataset&gt; Size: 166MB
Dimensions:  (y: 4561, x: 4561)
Coordinates:
  * y        (y) float64 36kB 38.55 38.55 38.55 38.55 ... 38.13 38.13 38.13
  * x        (x) float64 36kB -121.5 -121.5 -121.5 ... -121.0 -121.0 -121.0
Data variables:
    red      (y, x) uint16 42MB 1865 2052 2178 2564 2252 ... 3026 2946 2862 2806
    green    (y, x) uint16 42MB 2040 2012 1917 2286 2268 ... 2222 2148 2042 2013
    blue     (y, x) uint16 42MB 1566 1712 1732 2212 1994 ... 1755 1700 1618 1584
    nir      (y, x) uint16 42MB 3592 3178 3216 3128 3342 ... 3980 3898 3818 3823
Attributes:
    title:                Sentinel-2 Level 2A Surface Reflectance
    source:               Scene: S2A_MSIL2A_20240930T185211_R113_T10SFH_20241...
    acquisition_date:     2024-09-30
    processing_level:     L2A
    crs:                  EPSG:32610
    spatial_resolution:   10 meters
    coordinate_system:    geographic
    creation_date:        2025-09-21T09:54:19.821651
    processing_software:  Geospatial AI Toolkit
    data_access:          Microsoft Planetary Computer via STAC</code></pre>
</div>
</div>
</section>
</section>
</section>
<section id="rasterio-xarray-and-rioxarray" class="level2">
<h2 class="anchored" data-anchor-id="rasterio-xarray-and-rioxarray">Rasterio, Xarray, and Rioxarray</h2>
<p>Rasterio provides lower-level, direct file access and is well-suited for basic geospatial raster operations. Xarray offers a higher-level interface, making it easier to handle metadata and perform advanced analysis. Rioxarray extends xarray by adding geospatial capabilities, effectively bridging the gap between the two approaches.</p>
<hr>
</section>
<section id="step-6-scientific-visualization-and-spectral-analysis" class="level2">
<h2 class="anchored" data-anchor-id="step-6-scientific-visualization-and-spectral-analysis">Step 6: Scientific Visualization and Spectral Analysis</h2>
<section id="learning-objectives-11" class="level3">
<h3 class="anchored" data-anchor-id="learning-objectives-11">Learning Objectives</h3>
<p>By the end of this section, you will be able to design publication-quality visualizations for satellite data analysis, understand the importance of perceptually uniform colormaps in scientific visualization, create informative multi-panel displays with appropriate context and interpretation, and calculate as well as visualize spectral indices for environmental monitoring.</p>
</section>
<section id="principles-of-scientific-visualization-for-remote-sensing" class="level3">
<h3 class="anchored" data-anchor-id="principles-of-scientific-visualization-for-remote-sensing">Principles of Scientific Visualization for Remote Sensing</h3>
<p>Effective satellite data visualization requires attention to perceptual accuracy, ensuring that colors accurately represent data relationships. It is important to maximize information density to provide insight with minimal cognitive load, while also preserving spatial and temporal context. Additionally, visualizations should be accessible and interpretable by a wide range of audiences.</p>
<section id="advanced-color-composite-creation" class="level4">
<h4 class="anchored" data-anchor-id="advanced-color-composite-creation">Advanced Color Composite Creation</h4>
<div id="b2c94298" class="cell" data-execution_count="23">
<div class="sourceCode cell-code" id="cb46"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb46-1"><a href="#cb46-1" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span> band_data <span class="kw">and</span> <span class="bu">all</span>(k <span class="kw">in</span> band_data <span class="cf">for</span> k <span class="kw">in</span> [<span class="st">'B04'</span>, <span class="st">'B03'</span>, <span class="st">'B02'</span>]):</span>
<span id="cb46-2"><a href="#cb46-2" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Create true color RGB composite using our helper function</span></span>
<span id="cb46-3"><a href="#cb46-3" aria-hidden="true" tabindex="-1"></a>    rgb_composite <span class="op">=</span> create_rgb_composite(</span>
<span id="cb46-4"><a href="#cb46-4" aria-hidden="true" tabindex="-1"></a>        red<span class="op">=</span>band_data[<span class="st">'B04'</span>],</span>
<span id="cb46-5"><a href="#cb46-5" aria-hidden="true" tabindex="-1"></a>        green<span class="op">=</span>band_data[<span class="st">'B03'</span>],</span>
<span id="cb46-6"><a href="#cb46-6" aria-hidden="true" tabindex="-1"></a>        blue<span class="op">=</span>band_data[<span class="st">'B02'</span>],</span>
<span id="cb46-7"><a href="#cb46-7" aria-hidden="true" tabindex="-1"></a>        enhance<span class="op">=</span><span class="va">True</span>  <span class="co"># Apply contrast enhancement</span></span>
<span id="cb46-8"><a href="#cb46-8" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb46-9"><a href="#cb46-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb46-10"><a href="#cb46-10" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="ss">f"   RGB composite shape: </span><span class="sc">{</span>rgb_composite<span class="sc">.</span>shape<span class="sc">}</span><span class="ss">"</span>)</span>
<span id="cb46-11"><a href="#cb46-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb46-12"><a href="#cb46-12" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Create false color composite if NIR band is available</span></span>
<span id="cb46-13"><a href="#cb46-13" aria-hidden="true" tabindex="-1"></a>    false_color_composite <span class="op">=</span> <span class="va">None</span></span>
<span id="cb46-14"><a href="#cb46-14" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> <span class="st">'B08'</span> <span class="kw">in</span> band_data:</span>
<span id="cb46-15"><a href="#cb46-15" aria-hidden="true" tabindex="-1"></a>        false_color_composite <span class="op">=</span> create_rgb_composite(</span>
<span id="cb46-16"><a href="#cb46-16" aria-hidden="true" tabindex="-1"></a>            red<span class="op">=</span>band_data[<span class="st">'B08'</span>],   <span class="co"># NIR in red channel</span></span>
<span id="cb46-17"><a href="#cb46-17" aria-hidden="true" tabindex="-1"></a>            green<span class="op">=</span>band_data[<span class="st">'B04'</span>],  <span class="co"># Red in green channel</span></span>
<span id="cb46-18"><a href="#cb46-18" aria-hidden="true" tabindex="-1"></a>            blue<span class="op">=</span>band_data[<span class="st">'B03'</span>],   <span class="co"># Green in blue channel</span></span>
<span id="cb46-19"><a href="#cb46-19" aria-hidden="true" tabindex="-1"></a>            enhance<span class="op">=</span><span class="va">True</span></span>
<span id="cb46-20"><a href="#cb46-20" aria-hidden="true" tabindex="-1"></a>        )</span>
<span id="cb46-21"><a href="#cb46-21" aria-hidden="true" tabindex="-1"></a>        <span class="bu">print</span>(<span class="ss">f"   False color composite created"</span>)</span>
<span id="cb46-22"><a href="#cb46-22" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb46-23"><a href="#cb46-23" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Visualize the composites</span></span>
<span id="cb46-24"><a href="#cb46-24" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> <span class="st">'B08'</span> <span class="kw">in</span> band_data:</span>
<span id="cb46-25"><a href="#cb46-25" aria-hidden="true" tabindex="-1"></a>        fig, (ax1, ax2) <span class="op">=</span> plt.subplots(<span class="dv">1</span>, <span class="dv">2</span>, figsize<span class="op">=</span>(<span class="dv">14</span>, <span class="dv">6</span>))</span>
<span id="cb46-26"><a href="#cb46-26" aria-hidden="true" tabindex="-1"></a>    <span class="cf">else</span>:</span>
<span id="cb46-27"><a href="#cb46-27" aria-hidden="true" tabindex="-1"></a>        fig, ax1 <span class="op">=</span> plt.subplots(<span class="dv">1</span>, <span class="dv">1</span>, figsize<span class="op">=</span>(<span class="dv">8</span>, <span class="dv">6</span>))</span>
<span id="cb46-28"><a href="#cb46-28" aria-hidden="true" tabindex="-1"></a>        ax2 <span class="op">=</span> <span class="va">None</span></span>
<span id="cb46-29"><a href="#cb46-29" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb46-30"><a href="#cb46-30" aria-hidden="true" tabindex="-1"></a>    <span class="co"># True color</span></span>
<span id="cb46-31"><a href="#cb46-31" aria-hidden="true" tabindex="-1"></a>    ax1.imshow(rgb_composite)</span>
<span id="cb46-32"><a href="#cb46-32" aria-hidden="true" tabindex="-1"></a>    ax1.set_title(<span class="st">'True Color (RGB)'</span>, fontsize<span class="op">=</span><span class="dv">12</span>, fontweight<span class="op">=</span><span class="st">'bold'</span>)</span>
<span id="cb46-33"><a href="#cb46-33" aria-hidden="true" tabindex="-1"></a>    ax1.axis(<span class="st">'off'</span>)</span>
<span id="cb46-34"><a href="#cb46-34" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb46-35"><a href="#cb46-35" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Add scale bar</span></span>
<span id="cb46-36"><a href="#cb46-36" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> <span class="st">'transform'</span> <span class="kw">in</span> <span class="bu">locals</span>() <span class="kw">and</span> transform:</span>
<span id="cb46-37"><a href="#cb46-37" aria-hidden="true" tabindex="-1"></a>        <span class="co"># Calculate pixel size in meters (approximate)</span></span>
<span id="cb46-38"><a href="#cb46-38" aria-hidden="true" tabindex="-1"></a>        pixel_size <span class="op">=</span> <span class="bu">abs</span>(transform.a)  <span class="co"># Assuming square pixels</span></span>
<span id="cb46-39"><a href="#cb46-39" aria-hidden="true" tabindex="-1"></a>        scalebar_pixels <span class="op">=</span> <span class="bu">int</span>(<span class="dv">1000</span> <span class="op">/</span> pixel_size)  <span class="co"># 1km scale bar</span></span>
<span id="cb46-40"><a href="#cb46-40" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> scalebar_pixels <span class="op">&lt;</span> rgb_composite.shape[<span class="dv">1</span>] <span class="op">/</span> <span class="dv">4</span>:</span>
<span id="cb46-41"><a href="#cb46-41" aria-hidden="true" tabindex="-1"></a>            ax1.plot([<span class="dv">10</span>, <span class="dv">10</span> <span class="op">+</span> scalebar_pixels],</span>
<span id="cb46-42"><a href="#cb46-42" aria-hidden="true" tabindex="-1"></a>                    [rgb_composite.shape[<span class="dv">0</span>] <span class="op">-</span> <span class="dv">20</span>, rgb_composite.shape[<span class="dv">0</span>] <span class="op">-</span> <span class="dv">20</span>],</span>
<span id="cb46-43"><a href="#cb46-43" aria-hidden="true" tabindex="-1"></a>                    <span class="st">'w-'</span>, linewidth<span class="op">=</span><span class="dv">3</span>)</span>
<span id="cb46-44"><a href="#cb46-44" aria-hidden="true" tabindex="-1"></a>            ax1.text(<span class="dv">10</span> <span class="op">+</span> scalebar_pixels<span class="op">/</span><span class="dv">2</span>, rgb_composite.shape[<span class="dv">0</span>] <span class="op">-</span> <span class="dv">30</span>,</span>
<span id="cb46-45"><a href="#cb46-45" aria-hidden="true" tabindex="-1"></a>                    <span class="st">'1 km'</span>, color<span class="op">=</span><span class="st">'white'</span>, ha<span class="op">=</span><span class="st">'center'</span>, fontweight<span class="op">=</span><span class="st">'bold'</span>)</span>
<span id="cb46-46"><a href="#cb46-46" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb46-47"><a href="#cb46-47" aria-hidden="true" tabindex="-1"></a>    <span class="co"># False color if available</span></span>
<span id="cb46-48"><a href="#cb46-48" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> ax2 <span class="kw">and</span> false_color_composite <span class="kw">is</span> <span class="kw">not</span> <span class="va">None</span>:</span>
<span id="cb46-49"><a href="#cb46-49" aria-hidden="true" tabindex="-1"></a>        ax2.imshow(false_color_composite)</span>
<span id="cb46-50"><a href="#cb46-50" aria-hidden="true" tabindex="-1"></a>        ax2.set_title(<span class="st">'False Color (NIR-R-G)'</span>, fontsize<span class="op">=</span><span class="dv">12</span>, fontweight<span class="op">=</span><span class="st">'bold'</span>)</span>
<span id="cb46-51"><a href="#cb46-51" aria-hidden="true" tabindex="-1"></a>        ax2.axis(<span class="st">'off'</span>)</span>
<span id="cb46-52"><a href="#cb46-52" aria-hidden="true" tabindex="-1"></a>        ax2.text(<span class="fl">0.02</span>, <span class="fl">0.98</span>, <span class="st">'Vegetation appears red'</span>,</span>
<span id="cb46-53"><a href="#cb46-53" aria-hidden="true" tabindex="-1"></a>                transform<span class="op">=</span>ax2.transAxes, color<span class="op">=</span><span class="st">'white'</span>,</span>
<span id="cb46-54"><a href="#cb46-54" aria-hidden="true" tabindex="-1"></a>                fontsize<span class="op">=</span><span class="dv">10</span>, va<span class="op">=</span><span class="st">'top'</span>,</span>
<span id="cb46-55"><a href="#cb46-55" aria-hidden="true" tabindex="-1"></a>                bbox<span class="op">=</span><span class="bu">dict</span>(boxstyle<span class="op">=</span><span class="st">'round'</span>, facecolor<span class="op">=</span><span class="st">'black'</span>, alpha<span class="op">=</span><span class="fl">0.5</span>))</span>
<span id="cb46-56"><a href="#cb46-56" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb46-57"><a href="#cb46-57" aria-hidden="true" tabindex="-1"></a>    plt.suptitle(<span class="st">'Sentinel-2 Composites'</span>, fontsize<span class="op">=</span><span class="dv">14</span>, fontweight<span class="op">=</span><span class="st">'bold'</span>, y<span class="op">=</span><span class="fl">1.02</span>)</span>
<span id="cb46-58"><a href="#cb46-58" aria-hidden="true" tabindex="-1"></a>    plt.tight_layout()</span>
<span id="cb46-59"><a href="#cb46-59" aria-hidden="true" tabindex="-1"></a>    plt.show()</span>
<span id="cb46-60"><a href="#cb46-60" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb46-61"><a href="#cb46-61" aria-hidden="true" tabindex="-1"></a>    logger.info(<span class="st">"RGB composites created successfully"</span>)</span>
<span id="cb46-62"><a href="#cb46-62" aria-hidden="true" tabindex="-1"></a><span class="cf">else</span>:</span>
<span id="cb46-63"><a href="#cb46-63" aria-hidden="true" tabindex="-1"></a>    logger.warning(<span class="st">"Insufficient bands for RGB composite"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>   RGB composite shape: (4561, 4561, 3)
   False color composite created</code></pre>
</div>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="c01-geospatial-data-foundations_files/figure-html/cell-24-output-2.png" class="img-fluid figure-img"></p>
</figure>
</div>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>2025-09-21 09:54:23,567 - INFO - RGB composites created successfully</code></pre>
</div>
</div>
</section>
</section>
<section id="calculate-vegetation-indices" class="level3">
<h3 class="anchored" data-anchor-id="calculate-vegetation-indices">Calculate Vegetation Indices</h3>
<div id="3261f406" class="cell" data-execution_count="24">
<div class="sourceCode cell-code" id="cb49"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb49-1"><a href="#cb49-1" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span> band_data <span class="kw">and</span> <span class="st">'B08'</span> <span class="kw">in</span> band_data <span class="kw">and</span> <span class="st">'B04'</span> <span class="kw">in</span> band_data:</span>
<span id="cb49-2"><a href="#cb49-2" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Calculate NDVI using our helper function</span></span>
<span id="cb49-3"><a href="#cb49-3" aria-hidden="true" tabindex="-1"></a>    ndvi <span class="op">=</span> calculate_ndvi(</span>
<span id="cb49-4"><a href="#cb49-4" aria-hidden="true" tabindex="-1"></a>        nir<span class="op">=</span>band_data[<span class="st">'B08'</span>],</span>
<span id="cb49-5"><a href="#cb49-5" aria-hidden="true" tabindex="-1"></a>        red<span class="op">=</span>band_data[<span class="st">'B04'</span>]</span>
<span id="cb49-6"><a href="#cb49-6" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb49-7"><a href="#cb49-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb49-8"><a href="#cb49-8" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Get NDVI statistics</span></span>
<span id="cb49-9"><a href="#cb49-9" aria-hidden="true" tabindex="-1"></a>    ndvi_stats <span class="op">=</span> calculate_band_statistics(ndvi, <span class="st">"NDVI"</span>)</span>
<span id="cb49-10"><a href="#cb49-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb49-11"><a href="#cb49-11" aria-hidden="true" tabindex="-1"></a>    <span class="co"># NDVI statistics</span></span>
<span id="cb49-12"><a href="#cb49-12" aria-hidden="true" tabindex="-1"></a>    logger.info(<span class="ss">f"NDVI stats - Range: [</span><span class="sc">{</span>ndvi_stats[<span class="st">'min'</span>]<span class="sc">:.3f}</span><span class="ss">, </span><span class="sc">{</span>ndvi_stats[<span class="st">'max'</span>]<span class="sc">:.3f}</span><span class="ss">], Mean: </span><span class="sc">{</span>ndvi_stats[<span class="st">'mean'</span>]<span class="sc">:.3f}</span><span class="ss">"</span>)</span>
<span id="cb49-13"><a href="#cb49-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb49-14"><a href="#cb49-14" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Interpret NDVI values</span></span>
<span id="cb49-15"><a href="#cb49-15" aria-hidden="true" tabindex="-1"></a>    vegetation_pixels <span class="op">=</span> np.<span class="bu">sum</span>(ndvi <span class="op">&gt;</span> <span class="fl">0.3</span>)</span>
<span id="cb49-16"><a href="#cb49-16" aria-hidden="true" tabindex="-1"></a>    water_pixels <span class="op">=</span> np.<span class="bu">sum</span>(ndvi <span class="op">&lt;</span> <span class="dv">0</span>)</span>
<span id="cb49-17"><a href="#cb49-17" aria-hidden="true" tabindex="-1"></a>    urban_pixels <span class="op">=</span> np.<span class="bu">sum</span>((ndvi <span class="op">&gt;=</span> <span class="dv">0</span>) <span class="op">&amp;</span> (ndvi <span class="op">&lt;=</span> <span class="fl">0.2</span>))</span>
<span id="cb49-18"><a href="#cb49-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb49-19"><a href="#cb49-19" aria-hidden="true" tabindex="-1"></a>    total_valid <span class="op">=</span> ndvi_stats[<span class="st">'valid_pixels'</span>]</span>
<span id="cb49-20"><a href="#cb49-20" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Land cover interpretation</span></span>
<span id="cb49-21"><a href="#cb49-21" aria-hidden="true" tabindex="-1"></a>    veg_pct <span class="op">=</span> vegetation_pixels<span class="op">/</span>total_valid<span class="op">*</span><span class="dv">100</span></span>
<span id="cb49-22"><a href="#cb49-22" aria-hidden="true" tabindex="-1"></a>    urban_pct <span class="op">=</span> urban_pixels<span class="op">/</span>total_valid<span class="op">*</span><span class="dv">100</span></span>
<span id="cb49-23"><a href="#cb49-23" aria-hidden="true" tabindex="-1"></a>    water_pct <span class="op">=</span> water_pixels<span class="op">/</span>total_valid<span class="op">*</span><span class="dv">100</span></span>
<span id="cb49-24"><a href="#cb49-24" aria-hidden="true" tabindex="-1"></a>    logger.info(<span class="ss">f"Land cover - Vegetation: </span><span class="sc">{</span>veg_pct<span class="sc">:.1f}</span><span class="ss">%, Urban: </span><span class="sc">{</span>urban_pct<span class="sc">:.1f}</span><span class="ss">%, Water: </span><span class="sc">{</span>water_pct<span class="sc">:.1f}</span><span class="ss">%"</span>)</span>
<span id="cb49-25"><a href="#cb49-25" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb49-26"><a href="#cb49-26" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Create a detailed NDVI visualization</span></span>
<span id="cb49-27"><a href="#cb49-27" aria-hidden="true" tabindex="-1"></a>    fig, (ax1, ax2) <span class="op">=</span> plt.subplots(<span class="dv">1</span>, <span class="dv">2</span>, figsize<span class="op">=</span>(<span class="dv">14</span>, <span class="dv">6</span>))</span>
<span id="cb49-28"><a href="#cb49-28" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb49-29"><a href="#cb49-29" aria-hidden="true" tabindex="-1"></a>    <span class="co"># NDVI map</span></span>
<span id="cb49-30"><a href="#cb49-30" aria-hidden="true" tabindex="-1"></a>    im <span class="op">=</span> ax1.imshow(ndvi, cmap<span class="op">=</span><span class="st">'RdYlGn'</span>, vmin<span class="op">=-</span><span class="fl">0.5</span>, vmax<span class="op">=</span><span class="fl">1.0</span>)</span>
<span id="cb49-31"><a href="#cb49-31" aria-hidden="true" tabindex="-1"></a>    ax1.set_title(<span class="st">'NDVI (Normalized Difference Vegetation Index)'</span>, fontweight<span class="op">=</span><span class="st">'bold'</span>)</span>
<span id="cb49-32"><a href="#cb49-32" aria-hidden="true" tabindex="-1"></a>    ax1.axis(<span class="st">'off'</span>)</span>
<span id="cb49-33"><a href="#cb49-33" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb49-34"><a href="#cb49-34" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Add colorbar</span></span>
<span id="cb49-35"><a href="#cb49-35" aria-hidden="true" tabindex="-1"></a>    cbar <span class="op">=</span> plt.colorbar(im, ax<span class="op">=</span>ax1, shrink<span class="op">=</span><span class="fl">0.8</span>, pad<span class="op">=</span><span class="fl">0.02</span>)</span>
<span id="cb49-36"><a href="#cb49-36" aria-hidden="true" tabindex="-1"></a>    cbar.set_label(<span class="st">'NDVI Value'</span>, rotation<span class="op">=</span><span class="dv">270</span>, labelpad<span class="op">=</span><span class="dv">15</span>)</span>
<span id="cb49-37"><a href="#cb49-37" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb49-38"><a href="#cb49-38" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Add interpretation labels to colorbar</span></span>
<span id="cb49-39"><a href="#cb49-39" aria-hidden="true" tabindex="-1"></a>    cbar.ax.text(<span class="fl">1.3</span>, <span class="fl">0.8</span>, <span class="st">'Dense vegetation'</span>, transform<span class="op">=</span>cbar.ax.transAxes, fontsize<span class="op">=</span><span class="dv">9</span>)</span>
<span id="cb49-40"><a href="#cb49-40" aria-hidden="true" tabindex="-1"></a>    cbar.ax.text(<span class="fl">1.3</span>, <span class="fl">0.5</span>, <span class="st">'Sparse vegetation'</span>, transform<span class="op">=</span>cbar.ax.transAxes, fontsize<span class="op">=</span><span class="dv">9</span>)</span>
<span id="cb49-41"><a href="#cb49-41" aria-hidden="true" tabindex="-1"></a>    cbar.ax.text(<span class="fl">1.3</span>, <span class="fl">0.2</span>, <span class="st">'Bare soil/Urban'</span>, transform<span class="op">=</span>cbar.ax.transAxes, fontsize<span class="op">=</span><span class="dv">9</span>)</span>
<span id="cb49-42"><a href="#cb49-42" aria-hidden="true" tabindex="-1"></a>    cbar.ax.text(<span class="fl">1.3</span>, <span class="fl">0.0</span>, <span class="st">'Water/Clouds'</span>, transform<span class="op">=</span>cbar.ax.transAxes, fontsize<span class="op">=</span><span class="dv">9</span>)</span>
<span id="cb49-43"><a href="#cb49-43" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb49-44"><a href="#cb49-44" aria-hidden="true" tabindex="-1"></a>    <span class="co"># NDVI histogram</span></span>
<span id="cb49-45"><a href="#cb49-45" aria-hidden="true" tabindex="-1"></a>    ax2.hist(ndvi.flatten(), bins<span class="op">=</span><span class="dv">100</span>, color<span class="op">=</span><span class="st">'green'</span>, alpha<span class="op">=</span><span class="fl">0.7</span>, edgecolor<span class="op">=</span><span class="st">'black'</span>)</span>
<span id="cb49-46"><a href="#cb49-46" aria-hidden="true" tabindex="-1"></a>    ax2.axvline(<span class="dv">0</span>, color<span class="op">=</span><span class="st">'blue'</span>, linestyle<span class="op">=</span><span class="st">'--'</span>, alpha<span class="op">=</span><span class="fl">0.5</span>, label<span class="op">=</span><span class="st">'Water threshold'</span>)</span>
<span id="cb49-47"><a href="#cb49-47" aria-hidden="true" tabindex="-1"></a>    ax2.axvline(<span class="fl">0.3</span>, color<span class="op">=</span><span class="st">'green'</span>, linestyle<span class="op">=</span><span class="st">'--'</span>, alpha<span class="op">=</span><span class="fl">0.5</span>, label<span class="op">=</span><span class="st">'Vegetation threshold'</span>)</span>
<span id="cb49-48"><a href="#cb49-48" aria-hidden="true" tabindex="-1"></a>    ax2.set_xlabel(<span class="st">'NDVI Value'</span>)</span>
<span id="cb49-49"><a href="#cb49-49" aria-hidden="true" tabindex="-1"></a>    ax2.set_ylabel(<span class="st">'Pixel Count'</span>)</span>
<span id="cb49-50"><a href="#cb49-50" aria-hidden="true" tabindex="-1"></a>    ax2.set_title(<span class="st">'NDVI Distribution'</span>, fontweight<span class="op">=</span><span class="st">'bold'</span>)</span>
<span id="cb49-51"><a href="#cb49-51" aria-hidden="true" tabindex="-1"></a>    ax2.legend()</span>
<span id="cb49-52"><a href="#cb49-52" aria-hidden="true" tabindex="-1"></a>    ax2.grid(<span class="va">True</span>, alpha<span class="op">=</span><span class="fl">0.3</span>)</span>
<span id="cb49-53"><a href="#cb49-53" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb49-54"><a href="#cb49-54" aria-hidden="true" tabindex="-1"></a>    plt.tight_layout()</span>
<span id="cb49-55"><a href="#cb49-55" aria-hidden="true" tabindex="-1"></a>    plt.show()</span>
<span id="cb49-56"><a href="#cb49-56" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb49-57"><a href="#cb49-57" aria-hidden="true" tabindex="-1"></a>    logger.info(<span class="st">"NDVI analysis complete"</span>)</span>
<span id="cb49-58"><a href="#cb49-58" aria-hidden="true" tabindex="-1"></a><span class="cf">else</span>:</span>
<span id="cb49-59"><a href="#cb49-59" aria-hidden="true" tabindex="-1"></a>    logger.warning(<span class="st">"NIR and Red bands required for NDVI calculation"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>2025-09-21 09:54:24,161 - INFO - NDVI stats - Range: [-1.000, 1.000], Mean: 0.212
2025-09-21 09:54:24,192 - INFO - Land cover - Vegetation: 20.0%, Urban: 60.6%, Water: 1.4%</code></pre>
</div>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="c01-geospatial-data-foundations_files/figure-html/cell-25-output-2.png" class="img-fluid figure-img"></p>
</figure>
</div>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>2025-09-21 09:54:26,273 - INFO - NDVI analysis complete</code></pre>
</div>
</div>
</section>
</section>
<section id="understanding-ndvi-values" class="level2">
<h2 class="anchored" data-anchor-id="understanding-ndvi-values">Understanding NDVI Values</h2>
<p>NDVI values range from -1 to 1, and different intervals correspond to various land cover types. Values from -1 to 0 typically indicate water bodies, clouds, snow, or shadows. Values between 0 and 0.2 are characteristic of bare soil, rock, urban areas, or beaches. NDVI values from 0.2 to 0.4 suggest sparse vegetation, such as grasslands or agricultural areas. Moderate vegetation, including shrublands and crops, is usually found in the 0.4 to 0.6 range. Dense vegetation, such as forests and healthy crops, is represented by NDVI values between 0.6 and 1.0.</p>
<p>A common practice in environmental studies is to use NDVI values greater than 0.3 as a mask to identify vegetated areas.</p>
<hr>
</section>
<section id="step-6-interactive-mapping-and-band-analysis" class="level2">
<h2 class="anchored" data-anchor-id="step-6-interactive-mapping-and-band-analysis">Step 6: Interactive Mapping and Band Analysis</h2>
<p>Let’s create interactive visualizations and perform multi-band analysis.</p>
<section id="create-interactive-map-with-results" class="level3">
<h3 class="anchored" data-anchor-id="create-interactive-map-with-results">Create Interactive Map with Results</h3>
<div id="26e09fb9" class="cell" data-execution_count="25">
<div class="sourceCode cell-code" id="cb52"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb52-1"><a href="#cb52-1" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span> <span class="st">'subset_bbox'</span> <span class="kw">in</span> <span class="bu">locals</span>() <span class="kw">or</span> <span class="st">'sf_bay_bbox'</span> <span class="kw">in</span> <span class="bu">locals</span>():</span>
<span id="cb52-2"><a href="#cb52-2" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Use subset bbox if available, otherwise use the full AOI</span></span>
<span id="cb52-3"><a href="#cb52-3" aria-hidden="true" tabindex="-1"></a>    map_bbox <span class="op">=</span> subset_bbox <span class="cf">if</span> <span class="st">'subset_bbox'</span> <span class="kw">in</span> <span class="bu">locals</span>() <span class="cf">else</span> sf_bay_bbox</span>
<span id="cb52-4"><a href="#cb52-4" aria-hidden="true" tabindex="-1"></a>    center_lat <span class="op">=</span> (map_bbox[<span class="dv">1</span>] <span class="op">+</span> map_bbox[<span class="dv">3</span>]) <span class="op">/</span> <span class="dv">2</span></span>
<span id="cb52-5"><a href="#cb52-5" aria-hidden="true" tabindex="-1"></a>    center_lon <span class="op">=</span> (map_bbox[<span class="dv">0</span>] <span class="op">+</span> map_bbox[<span class="dv">2</span>]) <span class="op">/</span> <span class="dv">2</span></span>
<span id="cb52-6"><a href="#cb52-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb52-7"><a href="#cb52-7" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Create folium map</span></span>
<span id="cb52-8"><a href="#cb52-8" aria-hidden="true" tabindex="-1"></a>    m <span class="op">=</span> folium.Map(</span>
<span id="cb52-9"><a href="#cb52-9" aria-hidden="true" tabindex="-1"></a>        location<span class="op">=</span>[center_lat, center_lon],</span>
<span id="cb52-10"><a href="#cb52-10" aria-hidden="true" tabindex="-1"></a>        zoom_start<span class="op">=</span><span class="dv">12</span>,</span>
<span id="cb52-11"><a href="#cb52-11" aria-hidden="true" tabindex="-1"></a>        tiles<span class="op">=</span><span class="st">'OpenStreetMap'</span></span>
<span id="cb52-12"><a href="#cb52-12" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb52-13"><a href="#cb52-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb52-14"><a href="#cb52-14" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Add different basemap options</span></span>
<span id="cb52-15"><a href="#cb52-15" aria-hidden="true" tabindex="-1"></a>    folium.TileLayer(<span class="st">'CartoDB positron'</span>, name<span class="op">=</span><span class="st">'Light Basemap'</span>).add_to(m)</span>
<span id="cb52-16"><a href="#cb52-16" aria-hidden="true" tabindex="-1"></a>    folium.TileLayer(<span class="st">'CartoDB dark_matter'</span>, name<span class="op">=</span><span class="st">'Dark Basemap'</span>).add_to(m)</span>
<span id="cb52-17"><a href="#cb52-17" aria-hidden="true" tabindex="-1"></a>    folium.TileLayer(</span>
<span id="cb52-18"><a href="#cb52-18" aria-hidden="true" tabindex="-1"></a>        tiles<span class="op">=</span><span class="st">'https://server.arcgisonline.com/ArcGIS/rest/services/World_Imagery/MapServer/tile/</span><span class="sc">{z}</span><span class="st">/</span><span class="sc">{y}</span><span class="st">/</span><span class="sc">{x}</span><span class="st">'</span>,</span>
<span id="cb52-19"><a href="#cb52-19" aria-hidden="true" tabindex="-1"></a>        attr<span class="op">=</span><span class="st">'Esri'</span>,</span>
<span id="cb52-20"><a href="#cb52-20" aria-hidden="true" tabindex="-1"></a>        name<span class="op">=</span><span class="st">'Satellite Basemap'</span>,</span>
<span id="cb52-21"><a href="#cb52-21" aria-hidden="true" tabindex="-1"></a>        overlay<span class="op">=</span><span class="va">False</span>,</span>
<span id="cb52-22"><a href="#cb52-22" aria-hidden="true" tabindex="-1"></a>        control<span class="op">=</span><span class="va">True</span></span>
<span id="cb52-23"><a href="#cb52-23" aria-hidden="true" tabindex="-1"></a>    ).add_to(m)</span>
<span id="cb52-24"><a href="#cb52-24" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb52-25"><a href="#cb52-25" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Add study area boundary</span></span>
<span id="cb52-26"><a href="#cb52-26" aria-hidden="true" tabindex="-1"></a>    folium.Rectangle(</span>
<span id="cb52-27"><a href="#cb52-27" aria-hidden="true" tabindex="-1"></a>        bounds<span class="op">=</span>[[map_bbox[<span class="dv">1</span>], map_bbox[<span class="dv">0</span>]], [map_bbox[<span class="dv">3</span>], map_bbox[<span class="dv">2</span>]]],</span>
<span id="cb52-28"><a href="#cb52-28" aria-hidden="true" tabindex="-1"></a>        color<span class="op">=</span><span class="st">'red'</span>,</span>
<span id="cb52-29"><a href="#cb52-29" aria-hidden="true" tabindex="-1"></a>        weight<span class="op">=</span><span class="dv">3</span>,</span>
<span id="cb52-30"><a href="#cb52-30" aria-hidden="true" tabindex="-1"></a>        fill<span class="op">=</span><span class="va">True</span>,</span>
<span id="cb52-31"><a href="#cb52-31" aria-hidden="true" tabindex="-1"></a>        fillOpacity<span class="op">=</span><span class="fl">0.1</span>,</span>
<span id="cb52-32"><a href="#cb52-32" aria-hidden="true" tabindex="-1"></a>        popup<span class="op">=</span><span class="st">'Study Area'</span>,</span>
<span id="cb52-33"><a href="#cb52-33" aria-hidden="true" tabindex="-1"></a>        tooltip<span class="op">=</span><span class="st">'Analysis extent'</span></span>
<span id="cb52-34"><a href="#cb52-34" aria-hidden="true" tabindex="-1"></a>    ).add_to(m)</span>
<span id="cb52-35"><a href="#cb52-35" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb52-36"><a href="#cb52-36" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Add scene information if available</span></span>
<span id="cb52-37"><a href="#cb52-37" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> <span class="st">'best_scene'</span> <span class="kw">in</span> <span class="bu">locals</span>():</span>
<span id="cb52-38"><a href="#cb52-38" aria-hidden="true" tabindex="-1"></a>        scene_info <span class="op">=</span> <span class="ss">f"""</span></span>
<span id="cb52-39"><a href="#cb52-39" aria-hidden="true" tabindex="-1"></a><span class="ss">        &lt;div style="font-family: Arial; width: 250px;"&gt;</span></span>
<span id="cb52-40"><a href="#cb52-40" aria-hidden="true" tabindex="-1"></a><span class="ss">        &lt;h4&gt;Sentinel-2 Scene Info&lt;/h4&gt;</span></span>
<span id="cb52-41"><a href="#cb52-41" aria-hidden="true" tabindex="-1"></a><span class="ss">        &lt;b&gt;Date:&lt;/b&gt; </span><span class="sc">{</span>best_scene<span class="sc">.</span>properties[<span class="st">'datetime'</span>]<span class="sc">.</span>split(<span class="st">'T'</span>)[<span class="dv">0</span>]<span class="sc">}</span><span class="ss">&lt;br&gt;</span></span>
<span id="cb52-42"><a href="#cb52-42" aria-hidden="true" tabindex="-1"></a><span class="ss">        &lt;b&gt;Cloud Cover:&lt;/b&gt; </span><span class="sc">{</span>best_scene<span class="sc">.</span>properties[<span class="st">'eo:cloud_cover'</span>]<span class="sc">:.1f}</span><span class="ss">%&lt;br&gt;</span></span>
<span id="cb52-43"><a href="#cb52-43" aria-hidden="true" tabindex="-1"></a><span class="ss">        &lt;b&gt;Tile:&lt;/b&gt; </span><span class="sc">{</span>best_scene<span class="sc">.</span>properties<span class="sc">.</span>get(<span class="st">'sentinel:utm_zone'</span>, <span class="st">'N/A'</span>)<span class="sc">}</span><span class="ss">&lt;br&gt;</span></span>
<span id="cb52-44"><a href="#cb52-44" aria-hidden="true" tabindex="-1"></a><span class="ss">        &lt;b&gt;Processing:&lt;/b&gt; Level 2A (Surface Reflectance)&lt;br&gt;</span></span>
<span id="cb52-45"><a href="#cb52-45" aria-hidden="true" tabindex="-1"></a><span class="ss">        &lt;/div&gt;</span></span>
<span id="cb52-46"><a href="#cb52-46" aria-hidden="true" tabindex="-1"></a><span class="ss">        """</span></span>
<span id="cb52-47"><a href="#cb52-47" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb52-48"><a href="#cb52-48" aria-hidden="true" tabindex="-1"></a>        folium.Marker(</span>
<span id="cb52-49"><a href="#cb52-49" aria-hidden="true" tabindex="-1"></a>            location<span class="op">=</span>[center_lat, center_lon],</span>
<span id="cb52-50"><a href="#cb52-50" aria-hidden="true" tabindex="-1"></a>            popup<span class="op">=</span>folium.Popup(scene_info, max_width<span class="op">=</span><span class="dv">300</span>),</span>
<span id="cb52-51"><a href="#cb52-51" aria-hidden="true" tabindex="-1"></a>            tooltip<span class="op">=</span><span class="st">'Click for scene details'</span>,</span>
<span id="cb52-52"><a href="#cb52-52" aria-hidden="true" tabindex="-1"></a>            icon<span class="op">=</span>folium.Icon(color<span class="op">=</span><span class="st">'blue'</span>, icon<span class="op">=</span><span class="st">'satellite'</span>, prefix<span class="op">=</span><span class="st">'fa'</span>)</span>
<span id="cb52-53"><a href="#cb52-53" aria-hidden="true" tabindex="-1"></a>        ).add_to(m)</span>
<span id="cb52-54"><a href="#cb52-54" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb52-55"><a href="#cb52-55" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Add NDVI statistics if calculated</span></span>
<span id="cb52-56"><a href="#cb52-56" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> <span class="st">'ndvi_stats'</span> <span class="kw">in</span> <span class="bu">locals</span>():</span>
<span id="cb52-57"><a href="#cb52-57" aria-hidden="true" tabindex="-1"></a>        ndvi_info <span class="op">=</span> <span class="ss">f"""</span></span>
<span id="cb52-58"><a href="#cb52-58" aria-hidden="true" tabindex="-1"></a><span class="ss">        &lt;div style="font-family: Arial;"&gt;</span></span>
<span id="cb52-59"><a href="#cb52-59" aria-hidden="true" tabindex="-1"></a><span class="ss">        &lt;h4&gt;NDVI Statistics&lt;/h4&gt;</span></span>
<span id="cb52-60"><a href="#cb52-60" aria-hidden="true" tabindex="-1"></a><span class="ss">        &lt;b&gt;Mean:&lt;/b&gt; </span><span class="sc">{</span>ndvi_stats[<span class="st">'mean'</span>]<span class="sc">:.3f}</span><span class="ss">&lt;br&gt;</span></span>
<span id="cb52-61"><a href="#cb52-61" aria-hidden="true" tabindex="-1"></a><span class="ss">        &lt;b&gt;Std Dev:&lt;/b&gt; </span><span class="sc">{</span>ndvi_stats[<span class="st">'std'</span>]<span class="sc">:.3f}</span><span class="ss">&lt;br&gt;</span></span>
<span id="cb52-62"><a href="#cb52-62" aria-hidden="true" tabindex="-1"></a><span class="ss">        &lt;b&gt;Min:&lt;/b&gt; </span><span class="sc">{</span>ndvi_stats[<span class="st">'min'</span>]<span class="sc">:.3f}</span><span class="ss">&lt;br&gt;</span></span>
<span id="cb52-63"><a href="#cb52-63" aria-hidden="true" tabindex="-1"></a><span class="ss">        &lt;b&gt;Max:&lt;/b&gt; </span><span class="sc">{</span>ndvi_stats[<span class="st">'max'</span>]<span class="sc">:.3f}</span><span class="ss">&lt;br&gt;</span></span>
<span id="cb52-64"><a href="#cb52-64" aria-hidden="true" tabindex="-1"></a><span class="ss">        &lt;/div&gt;</span></span>
<span id="cb52-65"><a href="#cb52-65" aria-hidden="true" tabindex="-1"></a><span class="ss">        """</span></span>
<span id="cb52-66"><a href="#cb52-66" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb52-67"><a href="#cb52-67" aria-hidden="true" tabindex="-1"></a>        <span class="co"># Add a marker with NDVI stats</span></span>
<span id="cb52-68"><a href="#cb52-68" aria-hidden="true" tabindex="-1"></a>        folium.Marker(</span>
<span id="cb52-69"><a href="#cb52-69" aria-hidden="true" tabindex="-1"></a>            location<span class="op">=</span>[center_lat <span class="op">+</span> <span class="fl">0.02</span>, center_lon],</span>
<span id="cb52-70"><a href="#cb52-70" aria-hidden="true" tabindex="-1"></a>            popup<span class="op">=</span>folium.Popup(ndvi_info, max_width<span class="op">=</span><span class="dv">200</span>),</span>
<span id="cb52-71"><a href="#cb52-71" aria-hidden="true" tabindex="-1"></a>            tooltip<span class="op">=</span><span class="st">'NDVI Statistics'</span>,</span>
<span id="cb52-72"><a href="#cb52-72" aria-hidden="true" tabindex="-1"></a>            icon<span class="op">=</span>folium.Icon(color<span class="op">=</span><span class="st">'green'</span>, icon<span class="op">=</span><span class="st">'leaf'</span>, prefix<span class="op">=</span><span class="st">'fa'</span>)</span>
<span id="cb52-73"><a href="#cb52-73" aria-hidden="true" tabindex="-1"></a>        ).add_to(m)</span>
<span id="cb52-74"><a href="#cb52-74" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb52-75"><a href="#cb52-75" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Add measurement tool</span></span>
<span id="cb52-76"><a href="#cb52-76" aria-hidden="true" tabindex="-1"></a>    <span class="im">from</span> folium.plugins <span class="im">import</span> MeasureControl</span>
<span id="cb52-77"><a href="#cb52-77" aria-hidden="true" tabindex="-1"></a>    m.add_child(MeasureControl())</span>
<span id="cb52-78"><a href="#cb52-78" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb52-79"><a href="#cb52-79" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Add fullscreen button</span></span>
<span id="cb52-80"><a href="#cb52-80" aria-hidden="true" tabindex="-1"></a>    <span class="im">from</span> folium.plugins <span class="im">import</span> Fullscreen</span>
<span id="cb52-81"><a href="#cb52-81" aria-hidden="true" tabindex="-1"></a>    Fullscreen().add_to(m)</span>
<span id="cb52-82"><a href="#cb52-82" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb52-83"><a href="#cb52-83" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Add layer control</span></span>
<span id="cb52-84"><a href="#cb52-84" aria-hidden="true" tabindex="-1"></a>    folium.LayerControl(position<span class="op">=</span><span class="st">'topright'</span>).add_to(m)</span>
<span id="cb52-85"><a href="#cb52-85" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb52-86"><a href="#cb52-86" aria-hidden="true" tabindex="-1"></a>    logger.info(<span class="st">"Interactive map created with analysis overlays"</span>)</span>
<span id="cb52-87"><a href="#cb52-87" aria-hidden="true" tabindex="-1"></a>    m</span>
<span id="cb52-88"><a href="#cb52-88" aria-hidden="true" tabindex="-1"></a><span class="cf">else</span>:</span>
<span id="cb52-89"><a href="#cb52-89" aria-hidden="true" tabindex="-1"></a>    logger.warning(<span class="st">"No location data available for mapping"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>2025-09-21 09:54:26,292 - INFO - Interactive map created with analysis overlays</code></pre>
</div>
</div>
</section>
<section id="comprehensive-multi-band-analysis" class="level3">
<h3 class="anchored" data-anchor-id="comprehensive-multi-band-analysis">Comprehensive Multi-band Analysis</h3>
<div id="5707105e" class="cell" data-execution_count="26">
<div class="sourceCode cell-code" id="cb54"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb54-1"><a href="#cb54-1" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span> band_data <span class="kw">and</span> <span class="st">'rgb_composite'</span> <span class="kw">in</span> <span class="bu">locals</span>():</span>
<span id="cb54-2"><a href="#cb54-2" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Use our helper function for visualization</span></span>
<span id="cb54-3"><a href="#cb54-3" aria-hidden="true" tabindex="-1"></a>    plot_band_comparison(</span>
<span id="cb54-4"><a href="#cb54-4" aria-hidden="true" tabindex="-1"></a>        bands<span class="op">=</span>{<span class="st">'B04'</span>: band_data.get(<span class="st">'B04'</span>), <span class="st">'B08'</span>: band_data.get(<span class="st">'B08'</span>)} <span class="cf">if</span> band_data <span class="cf">else</span> {},</span>
<span id="cb54-5"><a href="#cb54-5" aria-hidden="true" tabindex="-1"></a>        rgb<span class="op">=</span>rgb_composite <span class="cf">if</span> <span class="st">'rgb_composite'</span> <span class="kw">in</span> <span class="bu">locals</span>() <span class="cf">else</span> <span class="va">None</span>,</span>
<span id="cb54-6"><a href="#cb54-6" aria-hidden="true" tabindex="-1"></a>        ndvi<span class="op">=</span>ndvi <span class="cf">if</span> <span class="st">'ndvi'</span> <span class="kw">in</span> <span class="bu">locals</span>() <span class="cf">else</span> <span class="va">None</span>,</span>
<span id="cb54-7"><a href="#cb54-7" aria-hidden="true" tabindex="-1"></a>        title<span class="op">=</span><span class="st">"Sentinel-2 Multi-band Analysis"</span></span>
<span id="cb54-8"><a href="#cb54-8" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb54-9"><a href="#cb54-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb54-10"><a href="#cb54-10" aria-hidden="true" tabindex="-1"></a>    logger.info(<span class="st">"Multi-band comparison complete"</span>)</span>
<span id="cb54-11"><a href="#cb54-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb54-12"><a href="#cb54-12" aria-hidden="true" tabindex="-1"></a><span class="co"># Additional analysis: Band correlations</span></span>
<span id="cb54-13"><a href="#cb54-13" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span> band_data <span class="kw">and</span> <span class="bu">len</span>(band_data) <span class="op">&gt;</span> <span class="dv">2</span>:</span>
<span id="cb54-14"><a href="#cb54-14" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Calculate band correlations</span></span>
<span id="cb54-15"><a href="#cb54-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb54-16"><a href="#cb54-16" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Create correlation matrix</span></span>
<span id="cb54-17"><a href="#cb54-17" aria-hidden="true" tabindex="-1"></a>    band_names <span class="op">=</span> [k <span class="cf">for</span> k <span class="kw">in</span> [<span class="st">'B02'</span>, <span class="st">'B03'</span>, <span class="st">'B04'</span>, <span class="st">'B08'</span>] <span class="cf">if</span> k <span class="kw">in</span> band_data]</span>
<span id="cb54-18"><a href="#cb54-18" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> <span class="bu">len</span>(band_names) <span class="op">&gt;=</span> <span class="dv">2</span>:</span>
<span id="cb54-19"><a href="#cb54-19" aria-hidden="true" tabindex="-1"></a>        <span class="co"># Flatten bands and create DataFrame</span></span>
<span id="cb54-20"><a href="#cb54-20" aria-hidden="true" tabindex="-1"></a>        band_df <span class="op">=</span> pd.DataFrame()</span>
<span id="cb54-21"><a href="#cb54-21" aria-hidden="true" tabindex="-1"></a>        <span class="cf">for</span> band_name <span class="kw">in</span> band_names:</span>
<span id="cb54-22"><a href="#cb54-22" aria-hidden="true" tabindex="-1"></a>            band_df[band_name] <span class="op">=</span> band_data[band_name].flatten()</span>
<span id="cb54-23"><a href="#cb54-23" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb54-24"><a href="#cb54-24" aria-hidden="true" tabindex="-1"></a>        <span class="co"># Calculate correlations</span></span>
<span id="cb54-25"><a href="#cb54-25" aria-hidden="true" tabindex="-1"></a>        correlations <span class="op">=</span> band_df.corr()</span>
<span id="cb54-26"><a href="#cb54-26" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb54-27"><a href="#cb54-27" aria-hidden="true" tabindex="-1"></a>        <span class="co"># Plot correlation matrix</span></span>
<span id="cb54-28"><a href="#cb54-28" aria-hidden="true" tabindex="-1"></a>        plt.figure(figsize<span class="op">=</span>(<span class="dv">8</span>, <span class="dv">6</span>))</span>
<span id="cb54-29"><a href="#cb54-29" aria-hidden="true" tabindex="-1"></a>        im <span class="op">=</span> plt.imshow(correlations, cmap<span class="op">=</span><span class="st">'coolwarm'</span>, vmin<span class="op">=-</span><span class="dv">1</span>, vmax<span class="op">=</span><span class="dv">1</span>)</span>
<span id="cb54-30"><a href="#cb54-30" aria-hidden="true" tabindex="-1"></a>        plt.colorbar(im, label<span class="op">=</span><span class="st">'Correlation'</span>)</span>
<span id="cb54-31"><a href="#cb54-31" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb54-32"><a href="#cb54-32" aria-hidden="true" tabindex="-1"></a>        <span class="co"># Add labels</span></span>
<span id="cb54-33"><a href="#cb54-33" aria-hidden="true" tabindex="-1"></a>        plt.xticks(<span class="bu">range</span>(<span class="bu">len</span>(band_names)), band_names)</span>
<span id="cb54-34"><a href="#cb54-34" aria-hidden="true" tabindex="-1"></a>        plt.yticks(<span class="bu">range</span>(<span class="bu">len</span>(band_names)), band_names)</span>
<span id="cb54-35"><a href="#cb54-35" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb54-36"><a href="#cb54-36" aria-hidden="true" tabindex="-1"></a>        <span class="co"># Add correlation values</span></span>
<span id="cb54-37"><a href="#cb54-37" aria-hidden="true" tabindex="-1"></a>        <span class="cf">for</span> i <span class="kw">in</span> <span class="bu">range</span>(<span class="bu">len</span>(band_names)):</span>
<span id="cb54-38"><a href="#cb54-38" aria-hidden="true" tabindex="-1"></a>            <span class="cf">for</span> j <span class="kw">in</span> <span class="bu">range</span>(<span class="bu">len</span>(band_names)):</span>
<span id="cb54-39"><a href="#cb54-39" aria-hidden="true" tabindex="-1"></a>                plt.text(j, i, <span class="ss">f'</span><span class="sc">{</span>correlations<span class="sc">.</span>iloc[i, j]<span class="sc">:.2f}</span><span class="ss">'</span>,</span>
<span id="cb54-40"><a href="#cb54-40" aria-hidden="true" tabindex="-1"></a>                        ha<span class="op">=</span><span class="st">'center'</span>, va<span class="op">=</span><span class="st">'center'</span>,</span>
<span id="cb54-41"><a href="#cb54-41" aria-hidden="true" tabindex="-1"></a>                        color<span class="op">=</span><span class="st">'white'</span> <span class="cf">if</span> <span class="bu">abs</span>(correlations.iloc[i, j]) <span class="op">&gt;</span> <span class="fl">0.5</span> <span class="cf">else</span> <span class="st">'black'</span>)</span>
<span id="cb54-42"><a href="#cb54-42" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb54-43"><a href="#cb54-43" aria-hidden="true" tabindex="-1"></a>        plt.title(<span class="st">'Band Correlation Matrix'</span>, fontweight<span class="op">=</span><span class="st">'bold'</span>)</span>
<span id="cb54-44"><a href="#cb54-44" aria-hidden="true" tabindex="-1"></a>        plt.tight_layout()</span>
<span id="cb54-45"><a href="#cb54-45" aria-hidden="true" tabindex="-1"></a>        plt.show()</span>
<span id="cb54-46"><a href="#cb54-46" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb54-47"><a href="#cb54-47" aria-hidden="true" tabindex="-1"></a>        logger.info(<span class="st">"Band correlation analysis complete"</span>)</span>
<span id="cb54-48"><a href="#cb54-48" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> <span class="st">'B03'</span> <span class="kw">in</span> band_names <span class="kw">and</span> <span class="st">'B04'</span> <span class="kw">in</span> band_names:</span>
<span id="cb54-49"><a href="#cb54-49" aria-hidden="true" tabindex="-1"></a>            logger.info(<span class="ss">f"Highest correlation: B03-B04 = </span><span class="sc">{</span>correlations<span class="sc">.</span>loc[<span class="st">'B03'</span>, <span class="st">'B04'</span>]<span class="sc">:.3f}</span><span class="ss">"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="c01-geospatial-data-foundations_files/figure-html/cell-27-output-1.png" class="img-fluid figure-img"></p>
</figure>
</div>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>2025-09-21 09:54:32,987 - INFO - Multi-band comparison complete</code></pre>
</div>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="c01-geospatial-data-foundations_files/figure-html/cell-27-output-3.png" class="img-fluid figure-img"></p>
</figure>
</div>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>2025-09-21 09:54:33,967 - INFO - Band correlation analysis complete
2025-09-21 09:54:33,967 - INFO - Highest correlation: B03-B04 = 0.915</code></pre>
</div>
</div>
<hr>
</section>
</section>
<section id="step-7-data-export-and-caching" class="level2">
<h2 class="anchored" data-anchor-id="step-7-data-export-and-caching">Step 7: Data Export and Caching</h2>
<p>Let’s save our processed data for future use and create a reusable cache.</p>
<section id="export-processed-data-using-helper-functions" class="level3">
<h3 class="anchored" data-anchor-id="export-processed-data-using-helper-functions">Export Processed Data Using Helper Functions</h3>
<div id="7dd14e3a" class="cell" data-execution_count="27">
<div class="sourceCode cell-code" id="cb57"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb57-1"><a href="#cb57-1" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> typing <span class="im">import</span> Any</span>
<span id="cb57-2"><a href="#cb57-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb57-3"><a href="#cb57-3" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> export_analysis_results(</span>
<span id="cb57-4"><a href="#cb57-4" aria-hidden="true" tabindex="-1"></a>    output_dir: <span class="bu">str</span> <span class="op">=</span> <span class="st">'week1_output'</span>,</span>
<span id="cb57-5"><a href="#cb57-5" aria-hidden="true" tabindex="-1"></a>    ndvi: Optional[np.ndarray] <span class="op">=</span> <span class="va">None</span>,</span>
<span id="cb57-6"><a href="#cb57-6" aria-hidden="true" tabindex="-1"></a>    rgb_composite: Optional[np.ndarray] <span class="op">=</span> <span class="va">None</span>,</span>
<span id="cb57-7"><a href="#cb57-7" aria-hidden="true" tabindex="-1"></a>    band_data: Optional[Dict[<span class="bu">str</span>, np.ndarray]] <span class="op">=</span> <span class="va">None</span>,</span>
<span id="cb57-8"><a href="#cb57-8" aria-hidden="true" tabindex="-1"></a>    transform: Optional[Any] <span class="op">=</span> <span class="va">None</span>,</span>
<span id="cb57-9"><a href="#cb57-9" aria-hidden="true" tabindex="-1"></a>    crs: Optional[Any] <span class="op">=</span> <span class="va">None</span>,</span>
<span id="cb57-10"><a href="#cb57-10" aria-hidden="true" tabindex="-1"></a>    scene_metadata: Optional[Dict] <span class="op">=</span> <span class="va">None</span>,</span>
<span id="cb57-11"><a href="#cb57-11" aria-hidden="true" tabindex="-1"></a>    ndvi_stats: Optional[Dict] <span class="op">=</span> <span class="va">None</span>,</span>
<span id="cb57-12"><a href="#cb57-12" aria-hidden="true" tabindex="-1"></a>    aoi_bbox: Optional[List[<span class="bu">float</span>]] <span class="op">=</span> <span class="va">None</span>,</span>
<span id="cb57-13"><a href="#cb57-13" aria-hidden="true" tabindex="-1"></a>    subset_bbox: Optional[List[<span class="bu">float</span>]] <span class="op">=</span> <span class="va">None</span></span>
<span id="cb57-14"><a href="#cb57-14" aria-hidden="true" tabindex="-1"></a>) <span class="op">-&gt;</span> Path:</span>
<span id="cb57-15"><a href="#cb57-15" aria-hidden="true" tabindex="-1"></a>    <span class="co">"""Export analysis results to structured output directory.</span></span>
<span id="cb57-16"><a href="#cb57-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb57-17"><a href="#cb57-17" aria-hidden="true" tabindex="-1"></a><span class="co">    Args:</span></span>
<span id="cb57-18"><a href="#cb57-18" aria-hidden="true" tabindex="-1"></a><span class="co">        output_dir: Output directory path</span></span>
<span id="cb57-19"><a href="#cb57-19" aria-hidden="true" tabindex="-1"></a><span class="co">        ndvi: NDVI array to export</span></span>
<span id="cb57-20"><a href="#cb57-20" aria-hidden="true" tabindex="-1"></a><span class="co">        rgb_composite: RGB composite array to export</span></span>
<span id="cb57-21"><a href="#cb57-21" aria-hidden="true" tabindex="-1"></a><span class="co">        band_data: Dictionary of band arrays to cache</span></span>
<span id="cb57-22"><a href="#cb57-22" aria-hidden="true" tabindex="-1"></a><span class="co">        transform: Geospatial transform</span></span>
<span id="cb57-23"><a href="#cb57-23" aria-hidden="true" tabindex="-1"></a><span class="co">        crs: Coordinate reference system</span></span>
<span id="cb57-24"><a href="#cb57-24" aria-hidden="true" tabindex="-1"></a><span class="co">        scene_metadata: Scene metadata dictionary</span></span>
<span id="cb57-25"><a href="#cb57-25" aria-hidden="true" tabindex="-1"></a><span class="co">        ndvi_stats: NDVI statistics dictionary</span></span>
<span id="cb57-26"><a href="#cb57-26" aria-hidden="true" tabindex="-1"></a><span class="co">        aoi_bbox: Area of interest bounding box</span></span>
<span id="cb57-27"><a href="#cb57-27" aria-hidden="true" tabindex="-1"></a><span class="co">        subset_bbox: Subset bounding box</span></span>
<span id="cb57-28"><a href="#cb57-28" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb57-29"><a href="#cb57-29" aria-hidden="true" tabindex="-1"></a><span class="co">    Returns:</span></span>
<span id="cb57-30"><a href="#cb57-30" aria-hidden="true" tabindex="-1"></a><span class="co">        Path to output directory</span></span>
<span id="cb57-31"><a href="#cb57-31" aria-hidden="true" tabindex="-1"></a><span class="co">    """</span></span>
<span id="cb57-32"><a href="#cb57-32" aria-hidden="true" tabindex="-1"></a>    <span class="im">from</span> pathlib <span class="im">import</span> Path</span>
<span id="cb57-33"><a href="#cb57-33" aria-hidden="true" tabindex="-1"></a>    <span class="im">import</span> json</span>
<span id="cb57-34"><a href="#cb57-34" aria-hidden="true" tabindex="-1"></a>    <span class="im">from</span> datetime <span class="im">import</span> datetime</span>
<span id="cb57-35"><a href="#cb57-35" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb57-36"><a href="#cb57-36" aria-hidden="true" tabindex="-1"></a>    output_path <span class="op">=</span> Path(output_dir)</span>
<span id="cb57-37"><a href="#cb57-37" aria-hidden="true" tabindex="-1"></a>    output_path.mkdir(exist_ok<span class="op">=</span><span class="va">True</span>)</span>
<span id="cb57-38"><a href="#cb57-38" aria-hidden="true" tabindex="-1"></a>    cache_dir <span class="op">=</span> output_path <span class="op">/</span> <span class="st">'cache'</span></span>
<span id="cb57-39"><a href="#cb57-39" aria-hidden="true" tabindex="-1"></a>    cache_dir.mkdir(exist_ok<span class="op">=</span><span class="va">True</span>)</span>
<span id="cb57-40"><a href="#cb57-40" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb57-41"><a href="#cb57-41" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Export NDVI if available</span></span>
<span id="cb57-42"><a href="#cb57-42" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> ndvi <span class="kw">is</span> <span class="kw">not</span> <span class="va">None</span> <span class="kw">and</span> transform <span class="kw">is</span> <span class="kw">not</span> <span class="va">None</span> <span class="kw">and</span> crs <span class="kw">is</span> <span class="kw">not</span> <span class="va">None</span>:</span>
<span id="cb57-43"><a href="#cb57-43" aria-hidden="true" tabindex="-1"></a>        ndvi_path <span class="op">=</span> output_path <span class="op">/</span> <span class="st">'ndvi.tif'</span></span>
<span id="cb57-44"><a href="#cb57-44" aria-hidden="true" tabindex="-1"></a>        save_geotiff(</span>
<span id="cb57-45"><a href="#cb57-45" aria-hidden="true" tabindex="-1"></a>            data<span class="op">=</span>ndvi,</span>
<span id="cb57-46"><a href="#cb57-46" aria-hidden="true" tabindex="-1"></a>            output_path<span class="op">=</span>ndvi_path,</span>
<span id="cb57-47"><a href="#cb57-47" aria-hidden="true" tabindex="-1"></a>            transform<span class="op">=</span>transform,</span>
<span id="cb57-48"><a href="#cb57-48" aria-hidden="true" tabindex="-1"></a>            crs<span class="op">=</span>crs,</span>
<span id="cb57-49"><a href="#cb57-49" aria-hidden="true" tabindex="-1"></a>            band_names<span class="op">=</span>[<span class="st">'NDVI'</span>]</span>
<span id="cb57-50"><a href="#cb57-50" aria-hidden="true" tabindex="-1"></a>        )</span>
<span id="cb57-51"><a href="#cb57-51" aria-hidden="true" tabindex="-1"></a>        logger.debug(<span class="ss">f"Exported NDVI to </span><span class="sc">{</span>ndvi_path<span class="sc">.</span>name<span class="sc">}</span><span class="ss">"</span>)</span>
<span id="cb57-52"><a href="#cb57-52" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb57-53"><a href="#cb57-53" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Export RGB composite if available</span></span>
<span id="cb57-54"><a href="#cb57-54" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> rgb_composite <span class="kw">is</span> <span class="kw">not</span> <span class="va">None</span> <span class="kw">and</span> transform <span class="kw">is</span> <span class="kw">not</span> <span class="va">None</span> <span class="kw">and</span> crs <span class="kw">is</span> <span class="kw">not</span> <span class="va">None</span>:</span>
<span id="cb57-55"><a href="#cb57-55" aria-hidden="true" tabindex="-1"></a>        rgb_bands <span class="op">=</span> np.transpose(rgb_composite, (<span class="dv">2</span>, <span class="dv">0</span>, <span class="dv">1</span>))  <span class="co"># HWC to CHW</span></span>
<span id="cb57-56"><a href="#cb57-56" aria-hidden="true" tabindex="-1"></a>        rgb_path <span class="op">=</span> output_path <span class="op">/</span> <span class="st">'rgb_composite.tif'</span></span>
<span id="cb57-57"><a href="#cb57-57" aria-hidden="true" tabindex="-1"></a>        save_geotiff(</span>
<span id="cb57-58"><a href="#cb57-58" aria-hidden="true" tabindex="-1"></a>            data<span class="op">=</span>rgb_bands,</span>
<span id="cb57-59"><a href="#cb57-59" aria-hidden="true" tabindex="-1"></a>            output_path<span class="op">=</span>rgb_path,</span>
<span id="cb57-60"><a href="#cb57-60" aria-hidden="true" tabindex="-1"></a>            transform<span class="op">=</span>transform,</span>
<span id="cb57-61"><a href="#cb57-61" aria-hidden="true" tabindex="-1"></a>            crs<span class="op">=</span>crs,</span>
<span id="cb57-62"><a href="#cb57-62" aria-hidden="true" tabindex="-1"></a>            band_names<span class="op">=</span>[<span class="st">'Red'</span>, <span class="st">'Green'</span>, <span class="st">'Blue'</span>]</span>
<span id="cb57-63"><a href="#cb57-63" aria-hidden="true" tabindex="-1"></a>        )</span>
<span id="cb57-64"><a href="#cb57-64" aria-hidden="true" tabindex="-1"></a>        logger.debug(<span class="ss">f"Exported RGB composite to </span><span class="sc">{</span>rgb_path<span class="sc">.</span>name<span class="sc">}</span><span class="ss">"</span>)</span>
<span id="cb57-65"><a href="#cb57-65" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb57-66"><a href="#cb57-66" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Cache individual bands</span></span>
<span id="cb57-67"><a href="#cb57-67" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> band_data:</span>
<span id="cb57-68"><a href="#cb57-68" aria-hidden="true" tabindex="-1"></a>        cached_bands <span class="op">=</span> []</span>
<span id="cb57-69"><a href="#cb57-69" aria-hidden="true" tabindex="-1"></a>        <span class="cf">for</span> band_name, band_array <span class="kw">in</span> band_data.items():</span>
<span id="cb57-70"><a href="#cb57-70" aria-hidden="true" tabindex="-1"></a>            <span class="cf">if</span> band_name.startswith(<span class="st">'B'</span>) <span class="kw">and</span> <span class="bu">isinstance</span>(band_array, np.ndarray):</span>
<span id="cb57-71"><a href="#cb57-71" aria-hidden="true" tabindex="-1"></a>                band_path <span class="op">=</span> cache_dir <span class="op">/</span> <span class="ss">f'</span><span class="sc">{</span>band_name<span class="sc">}</span><span class="ss">.npy'</span></span>
<span id="cb57-72"><a href="#cb57-72" aria-hidden="true" tabindex="-1"></a>                np.save(band_path, band_array)</span>
<span id="cb57-73"><a href="#cb57-73" aria-hidden="true" tabindex="-1"></a>                cached_bands.append(band_name)</span>
<span id="cb57-74"><a href="#cb57-74" aria-hidden="true" tabindex="-1"></a>        logger.debug(<span class="ss">f"Cached </span><span class="sc">{</span><span class="bu">len</span>(cached_bands)<span class="sc">}</span><span class="ss"> bands: </span><span class="sc">{</span>cached_bands<span class="sc">}</span><span class="ss">"</span>)</span>
<span id="cb57-75"><a href="#cb57-75" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb57-76"><a href="#cb57-76" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Create metadata</span></span>
<span id="cb57-77"><a href="#cb57-77" aria-hidden="true" tabindex="-1"></a>    metadata <span class="op">=</span> {</span>
<span id="cb57-78"><a href="#cb57-78" aria-hidden="true" tabindex="-1"></a>        <span class="st">'processing_date'</span>: datetime.now().isoformat(),</span>
<span id="cb57-79"><a href="#cb57-79" aria-hidden="true" tabindex="-1"></a>        <span class="st">'aoi_bbox'</span>: aoi_bbox,</span>
<span id="cb57-80"><a href="#cb57-80" aria-hidden="true" tabindex="-1"></a>        <span class="st">'subset_bbox'</span>: subset_bbox</span>
<span id="cb57-81"><a href="#cb57-81" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb57-82"><a href="#cb57-82" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb57-83"><a href="#cb57-83" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> scene_metadata:</span>
<span id="cb57-84"><a href="#cb57-84" aria-hidden="true" tabindex="-1"></a>        metadata[<span class="st">'scene'</span>] <span class="op">=</span> scene_metadata</span>
<span id="cb57-85"><a href="#cb57-85" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> ndvi_stats:</span>
<span id="cb57-86"><a href="#cb57-86" aria-hidden="true" tabindex="-1"></a>        metadata[<span class="st">'ndvi_statistics'</span>] <span class="op">=</span> ndvi_stats</span>
<span id="cb57-87"><a href="#cb57-87" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb57-88"><a href="#cb57-88" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Save metadata</span></span>
<span id="cb57-89"><a href="#cb57-89" aria-hidden="true" tabindex="-1"></a>    metadata_path <span class="op">=</span> output_path <span class="op">/</span> <span class="st">'metadata.json'</span></span>
<span id="cb57-90"><a href="#cb57-90" aria-hidden="true" tabindex="-1"></a>    <span class="cf">with</span> <span class="bu">open</span>(metadata_path, <span class="st">'w'</span>) <span class="im">as</span> f:</span>
<span id="cb57-91"><a href="#cb57-91" aria-hidden="true" tabindex="-1"></a>        json.dump(metadata, f, indent<span class="op">=</span><span class="dv">2</span>, default<span class="op">=</span><span class="bu">str</span>)</span>
<span id="cb57-92"><a href="#cb57-92" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb57-93"><a href="#cb57-93" aria-hidden="true" tabindex="-1"></a>    logger.info(<span class="ss">f"Analysis results exported to: </span><span class="sc">{</span>output_path<span class="sc">.</span>absolute()<span class="sc">}</span><span class="ss">"</span>)</span>
<span id="cb57-94"><a href="#cb57-94" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> output_path</span>
<span id="cb57-95"><a href="#cb57-95" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb57-96"><a href="#cb57-96" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> load_week1_data(output_dir: <span class="bu">str</span> <span class="op">=</span> <span class="st">"week1_output"</span>) <span class="op">-&gt;</span> Dict[<span class="bu">str</span>, Any]:</span>
<span id="cb57-97"><a href="#cb57-97" aria-hidden="true" tabindex="-1"></a>    <span class="co">"""Load processed data from Week 1."""</span></span>
<span id="cb57-98"><a href="#cb57-98" aria-hidden="true" tabindex="-1"></a>    <span class="im">from</span> pathlib <span class="im">import</span> Path</span>
<span id="cb57-99"><a href="#cb57-99" aria-hidden="true" tabindex="-1"></a>    <span class="im">import</span> json</span>
<span id="cb57-100"><a href="#cb57-100" aria-hidden="true" tabindex="-1"></a>    <span class="im">import</span> numpy <span class="im">as</span> np</span>
<span id="cb57-101"><a href="#cb57-101" aria-hidden="true" tabindex="-1"></a>    <span class="im">import</span> rasterio</span>
<span id="cb57-102"><a href="#cb57-102" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb57-103"><a href="#cb57-103" aria-hidden="true" tabindex="-1"></a>    output_path <span class="op">=</span> Path(output_dir)</span>
<span id="cb57-104"><a href="#cb57-104" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> <span class="kw">not</span> output_path.exists():</span>
<span id="cb57-105"><a href="#cb57-105" aria-hidden="true" tabindex="-1"></a>        <span class="cf">raise</span> <span class="pp">FileNotFoundError</span>(<span class="ss">f"Directory not found: </span><span class="sc">{</span>output_path<span class="sc">}</span><span class="ss">"</span>)</span>
<span id="cb57-106"><a href="#cb57-106" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb57-107"><a href="#cb57-107" aria-hidden="true" tabindex="-1"></a>    data <span class="op">=</span> {}</span>
<span id="cb57-108"><a href="#cb57-108" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb57-109"><a href="#cb57-109" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Load metadata</span></span>
<span id="cb57-110"><a href="#cb57-110" aria-hidden="true" tabindex="-1"></a>    metadata_path <span class="op">=</span> output_path <span class="op">/</span> <span class="st">"metadata.json"</span></span>
<span id="cb57-111"><a href="#cb57-111" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> metadata_path.exists():</span>
<span id="cb57-112"><a href="#cb57-112" aria-hidden="true" tabindex="-1"></a>        <span class="cf">with</span> <span class="bu">open</span>(metadata_path) <span class="im">as</span> f:</span>
<span id="cb57-113"><a href="#cb57-113" aria-hidden="true" tabindex="-1"></a>            data[<span class="st">"metadata"</span>] <span class="op">=</span> json.load(f)</span>
<span id="cb57-114"><a href="#cb57-114" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb57-115"><a href="#cb57-115" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Load NDVI</span></span>
<span id="cb57-116"><a href="#cb57-116" aria-hidden="true" tabindex="-1"></a>    ndvi_path <span class="op">=</span> output_path <span class="op">/</span> <span class="st">"ndvi.tif"</span></span>
<span id="cb57-117"><a href="#cb57-117" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> ndvi_path.exists():</span>
<span id="cb57-118"><a href="#cb57-118" aria-hidden="true" tabindex="-1"></a>        <span class="cf">with</span> rasterio.<span class="bu">open</span>(ndvi_path) <span class="im">as</span> src:</span>
<span id="cb57-119"><a href="#cb57-119" aria-hidden="true" tabindex="-1"></a>            data[<span class="st">"ndvi"</span>] <span class="op">=</span> src.read(<span class="dv">1</span>)</span>
<span id="cb57-120"><a href="#cb57-120" aria-hidden="true" tabindex="-1"></a>            data[<span class="st">"transform"</span>] <span class="op">=</span> src.transform</span>
<span id="cb57-121"><a href="#cb57-121" aria-hidden="true" tabindex="-1"></a>            data[<span class="st">"crs"</span>] <span class="op">=</span> src.crs</span>
<span id="cb57-122"><a href="#cb57-122" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb57-123"><a href="#cb57-123" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Load cached bands</span></span>
<span id="cb57-124"><a href="#cb57-124" aria-hidden="true" tabindex="-1"></a>    cache_dir <span class="op">=</span> output_path <span class="op">/</span> <span class="st">"cache"</span></span>
<span id="cb57-125"><a href="#cb57-125" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> cache_dir.exists():</span>
<span id="cb57-126"><a href="#cb57-126" aria-hidden="true" tabindex="-1"></a>        data[<span class="st">"bands"</span>] <span class="op">=</span> {}</span>
<span id="cb57-127"><a href="#cb57-127" aria-hidden="true" tabindex="-1"></a>        <span class="cf">for</span> band_file <span class="kw">in</span> cache_dir.glob(<span class="st">"*.npy"</span>):</span>
<span id="cb57-128"><a href="#cb57-128" aria-hidden="true" tabindex="-1"></a>            band_name <span class="op">=</span> band_file.stem</span>
<span id="cb57-129"><a href="#cb57-129" aria-hidden="true" tabindex="-1"></a>            data[<span class="st">"bands"</span>][band_name] <span class="op">=</span> np.load(band_file)</span>
<span id="cb57-130"><a href="#cb57-130" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb57-131"><a href="#cb57-131" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> data</span>
<span id="cb57-132"><a href="#cb57-132" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb57-133"><a href="#cb57-133" aria-hidden="true" tabindex="-1"></a><span class="co"># Export the analysis results</span></span>
<span id="cb57-134"><a href="#cb57-134" aria-hidden="true" tabindex="-1"></a>scene_meta <span class="op">=</span> <span class="va">None</span></span>
<span id="cb57-135"><a href="#cb57-135" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span> <span class="st">'best_scene'</span> <span class="kw">in</span> <span class="bu">locals</span>():</span>
<span id="cb57-136"><a href="#cb57-136" aria-hidden="true" tabindex="-1"></a>    scene_meta <span class="op">=</span> {</span>
<span id="cb57-137"><a href="#cb57-137" aria-hidden="true" tabindex="-1"></a>        <span class="st">'id'</span>: best_scene.<span class="bu">id</span>,</span>
<span id="cb57-138"><a href="#cb57-138" aria-hidden="true" tabindex="-1"></a>        <span class="st">'date'</span>: best_scene.properties[<span class="st">'datetime'</span>],</span>
<span id="cb57-139"><a href="#cb57-139" aria-hidden="true" tabindex="-1"></a>        <span class="st">'cloud_cover'</span>: best_scene.properties[<span class="st">'eo:cloud_cover'</span>],</span>
<span id="cb57-140"><a href="#cb57-140" aria-hidden="true" tabindex="-1"></a>        <span class="st">'platform'</span>: best_scene.properties.get(<span class="st">'platform'</span>, <span class="st">'Unknown'</span>)</span>
<span id="cb57-141"><a href="#cb57-141" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb57-142"><a href="#cb57-142" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb57-143"><a href="#cb57-143" aria-hidden="true" tabindex="-1"></a>output_dir <span class="op">=</span> export_analysis_results(</span>
<span id="cb57-144"><a href="#cb57-144" aria-hidden="true" tabindex="-1"></a>    ndvi<span class="op">=</span>ndvi <span class="cf">if</span> <span class="st">'ndvi'</span> <span class="kw">in</span> <span class="bu">locals</span>() <span class="cf">else</span> <span class="va">None</span>,</span>
<span id="cb57-145"><a href="#cb57-145" aria-hidden="true" tabindex="-1"></a>    rgb_composite<span class="op">=</span>rgb_composite <span class="cf">if</span> <span class="st">'rgb_composite'</span> <span class="kw">in</span> <span class="bu">locals</span>() <span class="cf">else</span> <span class="va">None</span>,</span>
<span id="cb57-146"><a href="#cb57-146" aria-hidden="true" tabindex="-1"></a>    band_data<span class="op">=</span>band_data <span class="cf">if</span> <span class="st">'band_data'</span> <span class="kw">in</span> <span class="bu">locals</span>() <span class="cf">else</span> <span class="va">None</span>,</span>
<span id="cb57-147"><a href="#cb57-147" aria-hidden="true" tabindex="-1"></a>    transform<span class="op">=</span>transform <span class="cf">if</span> <span class="st">'transform'</span> <span class="kw">in</span> <span class="bu">locals</span>() <span class="cf">else</span> <span class="va">None</span>,</span>
<span id="cb57-148"><a href="#cb57-148" aria-hidden="true" tabindex="-1"></a>    crs<span class="op">=</span>crs <span class="cf">if</span> <span class="st">'crs'</span> <span class="kw">in</span> <span class="bu">locals</span>() <span class="cf">else</span> <span class="va">None</span>,</span>
<span id="cb57-149"><a href="#cb57-149" aria-hidden="true" tabindex="-1"></a>    scene_metadata<span class="op">=</span>scene_meta,</span>
<span id="cb57-150"><a href="#cb57-150" aria-hidden="true" tabindex="-1"></a>    ndvi_stats<span class="op">=</span>ndvi_stats <span class="cf">if</span> <span class="st">'ndvi_stats'</span> <span class="kw">in</span> <span class="bu">locals</span>() <span class="cf">else</span> <span class="va">None</span>,</span>
<span id="cb57-151"><a href="#cb57-151" aria-hidden="true" tabindex="-1"></a>    aoi_bbox<span class="op">=</span>sf_bay_bbox <span class="cf">if</span> <span class="st">'sf_bay_bbox'</span> <span class="kw">in</span> <span class="bu">locals</span>() <span class="cf">else</span> <span class="va">None</span>,</span>
<span id="cb57-152"><a href="#cb57-152" aria-hidden="true" tabindex="-1"></a>    subset_bbox<span class="op">=</span>subset_bbox <span class="cf">if</span> <span class="st">'subset_bbox'</span> <span class="kw">in</span> <span class="bu">locals</span>() <span class="cf">else</span> <span class="va">None</span></span>
<span id="cb57-153"><a href="#cb57-153" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb57-154"><a href="#cb57-154" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb57-155"><a href="#cb57-155" aria-hidden="true" tabindex="-1"></a>logger.info(<span class="st">"Data exported - use load_week1_data() to reload"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>💾 Saved GeoTIFF: week1_output/ndvi.tif
   Shape: (4561, 4561)
   CRS: EPSG:32610
   Compression: deflate, tiled</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>2025-09-21 09:54:40,885 - INFO - Analysis results exported to: /Users/kellycaylor/dev/geoAI/book/chapters/week1_output
2025-09-21 09:54:40,885 - INFO - Data exported - use load_week1_data() to reload</code></pre>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>💾 Saved GeoTIFF: week1_output/rgb_composite.tif
   Shape: (3, 4561, 4561)
   CRS: EPSG:32610
   Compression: deflate, tiled</code></pre>
</div>
</div>
<hr>
<hr>
<hr>
</section>
</section>
<section id="conclusion-from-foundations-to-frontiers" class="level2">
<h2 class="anchored" data-anchor-id="conclusion-from-foundations-to-frontiers">Conclusion: From Foundations to Frontiers</h2>
<div class="callout callout-style-default callout-tip callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
What You’ve Accomplished
</div>
</div>
<div class="callout-body-container callout-body">
<p>You’ve successfully built a <strong>production-ready geospatial AI toolkit</strong> that demonstrates both technical excellence and software engineering best practices. This foundation will serve you throughout your career in geospatial AI.</p>
</div>
</div>
<p>🎉 <strong>Outstanding Achievement!</strong> You’ve progressed from basic satellite data access to building a sophisticated, enterprise-grade geospatial analysis system.</p>
<section id="core-competencies-developed" class="level3">
<h3 class="anchored" data-anchor-id="core-competencies-developed">Core Competencies Developed</h3>
<p><strong>Technical Mastery:</strong> 1. <strong>🛠️ Enterprise-Grade Toolkit</strong>: Built 13+ production-ready functions for geospatial AI workflows 2. <strong>🔐 Security-First Architecture</strong>: Implemented robust authentication and error handling patterns 2. <strong>🌍 Mastered STAC APIs</strong>: Connected to planetary-scale satellite data with proper authentication 3. <strong>📡 Loaded Real Satellite Data</strong>: Worked with actual Sentinel-2 imagery, not just sample data 4. <strong>🎨 Created Publication-Quality Visuals</strong>: RGB composites, NDVI maps, and interactive visualizations 5. <strong>📊 Performed Multi-band Analysis</strong>: Calculated vegetation indices and band correlations 6. <strong>🗺️ Built Interactive Maps</strong>: Folium maps with measurement tools and multiple basemaps 7. <strong>💾 Established Data Workflows</strong>: Export functions and caching for reproducible analysis</p>
</section>
<section id="key-technical-skills-gained" class="level3">
<h3 class="anchored" data-anchor-id="key-technical-skills-gained">Key Technical Skills Gained:</h3>
<ul>
<li><strong>Authentication</strong>: Planetary Computer API tokens for enterprise-level data access</li>
<li><strong>Error Handling</strong>: Robust functions with retry logic and fallback options</li>
<li><strong>Memory Management</strong>: Subsetting and efficient loading of large raster datasets</li>
<li><strong>Geospatial Standards</strong>: Working with CRS transformations and GeoTIFF exports</li>
<li><strong>Code Documentation</strong>: Well-documented functions with examples and type hints</li>
</ul>
</section>
<section id="real-world-applications" class="level3">
<h3 class="anchored" data-anchor-id="real-world-applications">Real-World Applications:</h3>
<p>Your helper functions are now ready for:</p>
<ul>
<li>🌱 <strong>Environmental Monitoring</strong>: Track deforestation, urban growth, crop health</li>
<li>🌊 <strong>Disaster Response</strong>: Flood mapping, wildfire damage assessment</li>
<li>📊 <strong>Research Projects</strong>: Time series analysis, change detection studies</li>
<li>🏢 <strong>Commercial Applications</strong>: Agricultural monitoring, real estate analysis</li>
</ul>
</section>
<section id="week-2-preview-rapid-preprocessing-pipelines" class="level3">
<h3 class="anchored" data-anchor-id="week-2-preview-rapid-preprocessing-pipelines">Week 2 Preview: Rapid Preprocessing Pipelines</h3>
<p>Next week, we’ll scale up using your new toolkit:</p>
<ul>
<li><strong>Batch Processing</strong>: Handle multiple scenes and time series</li>
<li><strong>Cloud Masking</strong>: Automatically filter cloudy pixels</li>
<li><strong>Mosaicking</strong>: Combine scenes into seamless regional datasets</li>
<li><strong>Analysis-Ready Data</strong>: Create standardized data cubes for ML</li>
<li><strong>Performance Optimization</strong>: Parallel processing and dask integration</li>
</ul>
</section>
<section id="practice-assignment" class="level3">
<h3 class="anchored" data-anchor-id="practice-assignment">Practice Assignment</h3>
<p><strong>Choose Your Own Adventure</strong> - Use your helper functions to analyze a different region:</p>
<ol type="1">
<li><strong>Urban Growth</strong>: Compare city expansion (try Phoenix, Dubai, or Shenzhen)</li>
<li><strong>Agricultural Monitoring</strong>: Track crop cycles in Central Valley or Iowa</li>
<li><strong>Environmental Change</strong>: Monitor glacial retreat in Alaska or Greenland</li>
<li><strong>Disaster Assessment</strong>: Recent wildfire or flood areas</li>
</ol>
<p><strong>Steps to try</strong>: 1. Modify the <code>sf_bay_bbox</code> to your area of interest 2. Use <code>search_sentinel2_scenes()</code> to find recent imagery 3. Run the complete analysis pipeline 4. Export your results and compare seasonal changes</p>
</section>
</section>
<section id="essential-resources" class="level2">
<h2 class="anchored" data-anchor-id="essential-resources">Essential Resources</h2>
<section id="data-sources" class="level3">
<h3 class="anchored" data-anchor-id="data-sources">Data Sources</h3>
<ul>
<li><a href="https://planetarycomputer.microsoft.com/catalog">Microsoft Planetary Computer Catalog</a> - Free satellite data</li>
<li><a href="https://radiantearth.github.io/stac-browser/">STAC Browser</a> - Explore STAC catalogs</li>
<li><a href="https://developers.google.com/earth-engine/datasets">Earth Engine Data Catalog</a> - Alternative data source</li>
</ul>
</section>
<section id="technical-documentation" class="level3">
<h3 class="anchored" data-anchor-id="technical-documentation">Technical Documentation</h3>
<ul>
<li><a href="https://rasterio.readthedocs.io/">Rasterio Documentation</a> - Geospatial I/O</li>
<li><a href="https://docs.xarray.dev/en/stable/tutorials-and-videos.html">Xarray Tutorial</a> - Multi-dimensional arrays</li>
<li><a href="https://stacspec.org/">STAC Specification</a> - Metadata standards</li>
<li><a href="https://python-visualization.github.io/folium/">Folium Examples</a> - Interactive mapping</li>
</ul>
</section>
<section id="community" class="level3">
<h3 class="anchored" data-anchor-id="community">Community</h3>
<ul>
<li><a href="https://pangeo.io/">Pangeo Community</a> - Open source geoscience</li>
<li><a href="https://discord.gg/stac">STAC Discord</a> - STAC community support</li>
<li><a href="https://github.com/pydata/pydata-book">PyData Geospatial</a> - Python geospatial ecosystem</li>
</ul>
<p><strong>Remember</strong>: Your helper functions are now your superpower! 🦸 Use them to explore any area on Earth with just a few lines of code.</p>


<!-- -->

</section>
</section>

</main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const onCopySuccess = function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  }
  const getTextToCopy = function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button:not([data-in-quarto-modal])', {
    text: getTextToCopy
  });
  clipboard.on('success', onCopySuccess);
  if (window.document.getElementById('quarto-embedded-source-code-modal')) {
    // For code content inside modals, clipBoardJS needs to be initialized with a container option
    // TODO: Check when it could be a function (https://github.com/zenorocha/clipboard.js/issues/860)
    const clipboardModal = new window.ClipboardJS('.code-copy-button[data-in-quarto-modal]', {
      text: getTextToCopy,
      container: window.document.getElementById('quarto-embedded-source-code-modal')
    });
    clipboardModal.on('success', onCopySuccess);
  }
  const viewSource = window.document.getElementById('quarto-view-source') ||
                     window.document.getElementById('quarto-code-tools-source');
  if (viewSource) {
    const sourceUrl = viewSource.getAttribute("data-quarto-source-url");
    viewSource.addEventListener("click", function(e) {
      if (sourceUrl) {
        // rstudio viewer pane
        if (/\bcapabilities=\b/.test(window.location)) {
          window.open(sourceUrl);
        } else {
          window.location.href = sourceUrl;
        }
      } else {
        const modal = new bootstrap.Modal(document.getElementById('quarto-embedded-source-code-modal'));
        modal.show();
      }
      return false;
    });
  }
  function toggleCodeHandler(show) {
    return function(e) {
      const detailsSrc = window.document.querySelectorAll(".cell > details > .sourceCode");
      for (let i=0; i<detailsSrc.length; i++) {
        const details = detailsSrc[i].parentElement;
        if (show) {
          details.open = true;
        } else {
          details.removeAttribute("open");
        }
      }
      const cellCodeDivs = window.document.querySelectorAll(".cell > .sourceCode");
      const fromCls = show ? "hidden" : "unhidden";
      const toCls = show ? "unhidden" : "hidden";
      for (let i=0; i<cellCodeDivs.length; i++) {
        const codeDiv = cellCodeDivs[i];
        if (codeDiv.classList.contains(fromCls)) {
          codeDiv.classList.remove(fromCls);
          codeDiv.classList.add(toCls);
        } 
      }
      return false;
    }
  }
  const hideAllCode = window.document.getElementById("quarto-hide-all-code");
  if (hideAllCode) {
    hideAllCode.addEventListener("click", toggleCodeHandler(false));
  }
  const showAllCode = window.document.getElementById("quarto-show-all-code");
  if (showAllCode) {
    showAllCode.addEventListener("click", toggleCodeHandler(true));
  }
    var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
    var mailtoRegex = new RegExp(/^mailto:/);
      var filterRegex = new RegExp("https:\/\/kcaylor\.github\.io\/GEOG-288KC-geospatial-foundation-models");
    var isInternal = (href) => {
        return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
    }
    // Inspect non-navigation links and adorn them if external
 	var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool):not(.about-link)');
    for (var i=0; i<links.length; i++) {
      const link = links[i];
      if (!isInternal(link.href)) {
        // undo the damage that might have been done by quarto-nav.js in the case of
        // links that we want to consider external
        if (link.dataset.originalHref !== undefined) {
          link.href = link.dataset.originalHref;
        }
      }
    }
  function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
    const config = {
      allowHTML: true,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start',
    };
    if (contentFn) {
      config.content = contentFn;
    }
    if (onTriggerFn) {
      config.onTrigger = onTriggerFn;
    }
    if (onUntriggerFn) {
      config.onUntrigger = onUntriggerFn;
    }
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      if (note) {
        return note.innerHTML;
      } else {
        return "";
      }
    });
  }
  const xrefs = window.document.querySelectorAll('a.quarto-xref');
  const processXRef = (id, note) => {
    // Strip column container classes
    const stripColumnClz = (el) => {
      el.classList.remove("page-full", "page-columns");
      if (el.children) {
        for (const child of el.children) {
          stripColumnClz(child);
        }
      }
    }
    stripColumnClz(note)
    if (id === null || id.startsWith('sec-')) {
      // Special case sections, only their first couple elements
      const container = document.createElement("div");
      if (note.children && note.children.length > 2) {
        container.appendChild(note.children[0].cloneNode(true));
        for (let i = 1; i < note.children.length; i++) {
          const child = note.children[i];
          if (child.tagName === "P" && child.innerText === "") {
            continue;
          } else {
            container.appendChild(child.cloneNode(true));
            break;
          }
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(container);
        }
        return container.innerHTML
      } else {
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        return note.innerHTML;
      }
    } else {
      // Remove any anchor links if they are present
      const anchorLink = note.querySelector('a.anchorjs-link');
      if (anchorLink) {
        anchorLink.remove();
      }
      if (window.Quarto?.typesetMath) {
        window.Quarto.typesetMath(note);
      }
      // TODO in 1.5, we should make sure this works without a callout special case
      if (note.classList.contains("callout")) {
        return note.outerHTML;
      } else {
        return note.innerHTML;
      }
    }
  }
  for (var i=0; i<xrefs.length; i++) {
    const xref = xrefs[i];
    tippyHover(xref, undefined, function(instance) {
      instance.disable();
      let url = xref.getAttribute('href');
      let hash = undefined; 
      if (url.startsWith('#')) {
        hash = url;
      } else {
        try { hash = new URL(url).hash; } catch {}
      }
      if (hash) {
        const id = hash.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note !== null) {
          try {
            const html = processXRef(id, note.cloneNode(true));
            instance.setContent(html);
          } finally {
            instance.enable();
            instance.show();
          }
        } else {
          // See if we can fetch this
          fetch(url.split('#')[0])
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.getElementById(id);
            if (note !== null) {
              const html = processXRef(id, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      } else {
        // See if we can fetch a full url (with no hash to target)
        // This is a special case and we should probably do some content thinning / targeting
        fetch(url)
        .then(res => res.text())
        .then(html => {
          const parser = new DOMParser();
          const htmlDoc = parser.parseFromString(html, "text/html");
          const note = htmlDoc.querySelector('main.content');
          if (note !== null) {
            // This should only happen for chapter cross references
            // (since there is no id in the URL)
            // remove the first header
            if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
              note.children[0].remove();
            }
            const html = processXRef(null, note);
            instance.setContent(html);
          } 
        }).finally(() => {
          instance.enable();
          instance.show();
        });
      }
    }, function(instance) {
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            div.style.left = 0;
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
        // Handle positioning of the toggle
    window.addEventListener(
      "resize",
      throttle(() => {
        elRect = undefined;
        if (selectedAnnoteEl) {
          selectCodeLines(selectedAnnoteEl);
        }
      }, 10)
    );
    function throttle(fn, ms) {
    let throttle = false;
    let timer;
      return (...args) => {
        if(!throttle) { // first call gets through
            fn.apply(this, args);
            throttle = true;
        } else { // all the others get throttled
            if(timer) clearTimeout(timer); // cancel #2
            timer = setTimeout(() => {
              fn.apply(this, args);
              timer = throttle = false;
            }, ms);
        }
      };
    }
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script><div class="modal fade" id="quarto-embedded-source-code-modal" tabindex="-1" aria-labelledby="quarto-embedded-source-code-modal-label" aria-hidden="true"><div class="modal-dialog modal-dialog-scrollable"><div class="modal-content"><div class="modal-header"><h5 class="modal-title" id="quarto-embedded-source-code-modal-label">Source Code</h5><button class="btn-close" data-bs-dismiss="modal"></button></div><div class="modal-body"><div class="">
<div class="sourceCode" id="cb61" data-shortcodes="false"><pre class="sourceCode markdown code-with-copy"><code class="sourceCode markdown"><span id="cb61-1"><a href="#cb61-1" aria-hidden="true" tabindex="-1"></a><span class="co">---</span></span>
<span id="cb61-2"><a href="#cb61-2" aria-hidden="true" tabindex="-1"></a><span class="an">title:</span><span class="co"> "Week 1: Core Tools and Data Access"</span></span>
<span id="cb61-3"><a href="#cb61-3" aria-hidden="true" tabindex="-1"></a><span class="an">subtitle:</span><span class="co"> "Setting up the geospatial AI toolkit and accessing satellite imagery"</span></span>
<span id="cb61-4"><a href="#cb61-4" aria-hidden="true" tabindex="-1"></a><span class="an">jupyter:</span><span class="co"> geoai</span></span>
<span id="cb61-5"><a href="#cb61-5" aria-hidden="true" tabindex="-1"></a><span class="an">format:</span></span>
<span id="cb61-6"><a href="#cb61-6" aria-hidden="true" tabindex="-1"></a><span class="co">  html:</span></span>
<span id="cb61-7"><a href="#cb61-7" aria-hidden="true" tabindex="-1"></a><span class="co">    toc: true</span></span>
<span id="cb61-8"><a href="#cb61-8" aria-hidden="true" tabindex="-1"></a><span class="co">    toc-depth: 3</span></span>
<span id="cb61-9"><a href="#cb61-9" aria-hidden="true" tabindex="-1"></a><span class="co">    code-fold: false</span></span>
<span id="cb61-10"><a href="#cb61-10" aria-hidden="true" tabindex="-1"></a><span class="co">---</span></span>
<span id="cb61-11"><a href="#cb61-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb61-12"><a href="#cb61-12" aria-hidden="true" tabindex="-1"></a><span class="fu">## Introduction</span></span>
<span id="cb61-13"><a href="#cb61-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb61-14"><a href="#cb61-14" aria-hidden="true" tabindex="-1"></a>Welcome to your first hands-on session with geospatial AI! Today we'll set up the core tools you'll use throughout this course and get you working with real satellite imagery immediately. No theory-heavy introductions – we're diving straight into practical data access and exploration.</span>
<span id="cb61-15"><a href="#cb61-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb61-16"><a href="#cb61-16" aria-hidden="true" tabindex="-1"></a>:::{.callout-tip}</span>
<span id="cb61-17"><a href="#cb61-17" aria-hidden="true" tabindex="-1"></a><span class="fu">## Learning Goals</span></span>
<span id="cb61-18"><a href="#cb61-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb61-19"><a href="#cb61-19" aria-hidden="true" tabindex="-1"></a>By the end of this session, you will:</span>
<span id="cb61-20"><a href="#cb61-20" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb61-21"><a href="#cb61-21" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>Have a working geospatial AI environment</span>
<span id="cb61-22"><a href="#cb61-22" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>Pull real Sentinel-2/Landsat imagery via STAC APIs</span>
<span id="cb61-23"><a href="#cb61-23" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>Load and explore satellite data with rasterio and xarray</span>
<span id="cb61-24"><a href="#cb61-24" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>Create interactive maps with folium</span>
<span id="cb61-25"><a href="#cb61-25" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>Understand the basics of multi-spectral satellite imagery</span>
<span id="cb61-26"><a href="#cb61-26" aria-hidden="true" tabindex="-1"></a>:::</span>
<span id="cb61-27"><a href="#cb61-27" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb61-28"><a href="#cb61-28" aria-hidden="true" tabindex="-1"></a><span class="fu">## Course Structure Overview</span></span>
<span id="cb61-29"><a href="#cb61-29" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb61-30"><a href="#cb61-30" aria-hidden="true" tabindex="-1"></a>This accelerated seminar follows a hands-on progression:</span>
<span id="cb61-31"><a href="#cb61-31" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb61-32"><a href="#cb61-32" aria-hidden="true" tabindex="-1"></a>| Week | Focus | Hands-on Activity | Key Tools | Goal |</span>
<span id="cb61-33"><a href="#cb61-33" aria-hidden="true" tabindex="-1"></a>|------|-------|-------------------|-----------|------|</span>
<span id="cb61-34"><a href="#cb61-34" aria-hidden="true" tabindex="-1"></a>| 1 | Core Tools &amp; Data Access | Pull satellite imagery via STAC API | rasterio, xarray, folium, pystac-client | Everyone can load and explore geospatial data |</span>
<span id="cb61-35"><a href="#cb61-35" aria-hidden="true" tabindex="-1"></a>| 2 | Rapid Preprocessing | Process Sentinel-2 scenes for AOI | rasterio, numpy, dask | Reproducible preprocessing pipeline |</span>
<span id="cb61-36"><a href="#cb61-36" aria-hidden="true" tabindex="-1"></a>| 3 | ML on Remote Sensing | Train CNN on land cover patches | PyTorch, torchgeo, sklearn | End-to-end ML workflow |</span>
<span id="cb61-37"><a href="#cb61-37" aria-hidden="true" tabindex="-1"></a>| 4 | Foundation Models | Use pretrained geospatial models | transformers, torch | Compare FM vs scratch models |</span>
<span id="cb61-38"><a href="#cb61-38" aria-hidden="true" tabindex="-1"></a>| 5 | Fine-tuning | Adapt models for new tasks | transformers, torch | Efficient transfer learning |</span>
<span id="cb61-39"><a href="#cb61-39" aria-hidden="true" tabindex="-1"></a>| 6 | Spatiotemporal &amp; Projects | Time series analysis + project proposals | xarray, matplotlib | Independent project planning |</span>
<span id="cb61-40"><a href="#cb61-40" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb61-41"><a href="#cb61-41" aria-hidden="true" tabindex="-1"></a>---</span>
<span id="cb61-42"><a href="#cb61-42" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb61-43"><a href="#cb61-43" aria-hidden="true" tabindex="-1"></a><span class="fu">## Step 1: Environment Setup and Helper Functions</span></span>
<span id="cb61-44"><a href="#cb61-44" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb61-45"><a href="#cb61-45" aria-hidden="true" tabindex="-1"></a>We'll start by setting up our environment and creating reusable helper functions that you'll use throughout the course. These functions handle common tasks like data loading, visualization, and processing.</span>
<span id="cb61-46"><a href="#cb61-46" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb61-47"><a href="#cb61-47" aria-hidden="true" tabindex="-1"></a><span class="fu">### Verify Your Environment</span></span>
<span id="cb61-48"><a href="#cb61-48" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb61-49"><a href="#cb61-49" aria-hidden="true" tabindex="-1"></a>**Environment Verification:**</span>
<span id="cb61-50"><a href="#cb61-50" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb61-51"><a href="#cb61-51" aria-hidden="true" tabindex="-1"></a>Before we begin, let's verify that your environment is properly configured. Your environment should include the following packages:</span>
<span id="cb61-52"><a href="#cb61-52" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb61-53"><a href="#cb61-53" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>**rasterio, xarray, rioxarray**: Core geospatial data handling</span>
<span id="cb61-54"><a href="#cb61-54" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>**torch, transformers**: Deep learning and foundation models</span>
<span id="cb61-55"><a href="#cb61-55" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>**folium**: Interactive mapping</span>
<span id="cb61-56"><a href="#cb61-56" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>**matplotlib, numpy, pandas**: Data analysis and visualization</span>
<span id="cb61-57"><a href="#cb61-57" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>**pystac-client, planetary-computer**: STAC API access</span>
<span id="cb61-58"><a href="#cb61-58" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>**geopandas**: Vector geospatial data</span>
<span id="cb61-59"><a href="#cb61-59" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb61-62"><a href="#cb61-62" aria-hidden="true" tabindex="-1"></a><span class="in">```{python}</span></span>
<span id="cb61-63"><a href="#cb61-63" aria-hidden="true" tabindex="-1"></a><span class="co">#| tangle: geogfm/c01.py</span></span>
<span id="cb61-64"><a href="#cb61-64" aria-hidden="true" tabindex="-1"></a><span class="co">"""Week 1: Core Tools and Data Access functions for geospatial AI."""</span></span>
<span id="cb61-65"><a href="#cb61-65" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb61-66"><a href="#cb61-66" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> sys</span>
<span id="cb61-67"><a href="#cb61-67" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> importlib.metadata</span>
<span id="cb61-68"><a href="#cb61-68" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> warnings</span>
<span id="cb61-69"><a href="#cb61-69" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> os</span>
<span id="cb61-70"><a href="#cb61-70" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> typing <span class="im">import</span> Dict, List, Tuple, Optional, Union</span>
<span id="cb61-71"><a href="#cb61-71" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> pathlib <span class="im">import</span> Path</span>
<span id="cb61-72"><a href="#cb61-72" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> time</span>
<span id="cb61-73"><a href="#cb61-73" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> logging</span>
<span id="cb61-74"><a href="#cb61-74" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb61-75"><a href="#cb61-75" aria-hidden="true" tabindex="-1"></a><span class="co"># Core geospatial libraries</span></span>
<span id="cb61-76"><a href="#cb61-76" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> rasterio</span>
<span id="cb61-77"><a href="#cb61-77" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> rasterio.windows <span class="im">import</span> from_bounds</span>
<span id="cb61-78"><a href="#cb61-78" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> rasterio.warp <span class="im">import</span> transform_bounds</span>
<span id="cb61-79"><a href="#cb61-79" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> numpy <span class="im">as</span> np</span>
<span id="cb61-80"><a href="#cb61-80" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> pandas <span class="im">as</span> pd</span>
<span id="cb61-81"><a href="#cb61-81" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> pystac_client <span class="im">import</span> Client</span>
<span id="cb61-82"><a href="#cb61-82" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> planetary_computer <span class="im">as</span> pc</span>
<span id="cb61-83"><a href="#cb61-83" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb61-84"><a href="#cb61-84" aria-hidden="true" tabindex="-1"></a>warnings.filterwarnings(<span class="st">'ignore'</span>)</span>
<span id="cb61-85"><a href="#cb61-85" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb61-86"><a href="#cb61-86" aria-hidden="true" tabindex="-1"></a><span class="co"># Configure logging</span></span>
<span id="cb61-87"><a href="#cb61-87" aria-hidden="true" tabindex="-1"></a>logging.basicConfig(level<span class="op">=</span>logging.INFO, <span class="bu">format</span><span class="op">=</span><span class="st">'</span><span class="sc">%(asctime)s</span><span class="st"> - </span><span class="sc">%(levelname)s</span><span class="st"> - </span><span class="sc">%(message)s</span><span class="st">'</span>)</span>
<span id="cb61-88"><a href="#cb61-88" aria-hidden="true" tabindex="-1"></a>logger <span class="op">=</span> logging.getLogger(<span class="va">__name__</span>)</span>
<span id="cb61-89"><a href="#cb61-89" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb61-90"><a href="#cb61-90" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> verify_environment(required_packages: <span class="bu">list</span>) <span class="op">-&gt;</span> <span class="bu">dict</span>:</span>
<span id="cb61-91"><a href="#cb61-91" aria-hidden="true" tabindex="-1"></a>    <span class="co">"""</span></span>
<span id="cb61-92"><a href="#cb61-92" aria-hidden="true" tabindex="-1"></a><span class="co">    Verify that all required packages are installed.</span></span>
<span id="cb61-93"><a href="#cb61-93" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb61-94"><a href="#cb61-94" aria-hidden="true" tabindex="-1"></a><span class="co">    Parameters</span></span>
<span id="cb61-95"><a href="#cb61-95" aria-hidden="true" tabindex="-1"></a><span class="co">    ----------</span></span>
<span id="cb61-96"><a href="#cb61-96" aria-hidden="true" tabindex="-1"></a><span class="co">    required_packages : list</span></span>
<span id="cb61-97"><a href="#cb61-97" aria-hidden="true" tabindex="-1"></a><span class="co">        List of package names to verify</span></span>
<span id="cb61-98"><a href="#cb61-98" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb61-99"><a href="#cb61-99" aria-hidden="true" tabindex="-1"></a><span class="co">    Returns</span></span>
<span id="cb61-100"><a href="#cb61-100" aria-hidden="true" tabindex="-1"></a><span class="co">    -------</span></span>
<span id="cb61-101"><a href="#cb61-101" aria-hidden="true" tabindex="-1"></a><span class="co">    dict</span></span>
<span id="cb61-102"><a href="#cb61-102" aria-hidden="true" tabindex="-1"></a><span class="co">        Dictionary with package names as keys and versions as values</span></span>
<span id="cb61-103"><a href="#cb61-103" aria-hidden="true" tabindex="-1"></a><span class="co">    """</span></span>
<span id="cb61-104"><a href="#cb61-104" aria-hidden="true" tabindex="-1"></a>    results <span class="op">=</span> {}</span>
<span id="cb61-105"><a href="#cb61-105" aria-hidden="true" tabindex="-1"></a>    missing_packages <span class="op">=</span> []</span>
<span id="cb61-106"><a href="#cb61-106" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb61-107"><a href="#cb61-107" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> package <span class="kw">in</span> required_packages:</span>
<span id="cb61-108"><a href="#cb61-108" aria-hidden="true" tabindex="-1"></a>        <span class="cf">try</span>:</span>
<span id="cb61-109"><a href="#cb61-109" aria-hidden="true" tabindex="-1"></a>            version <span class="op">=</span> importlib.metadata.version(package)</span>
<span id="cb61-110"><a href="#cb61-110" aria-hidden="true" tabindex="-1"></a>            results[package] <span class="op">=</span> version</span>
<span id="cb61-111"><a href="#cb61-111" aria-hidden="true" tabindex="-1"></a>        <span class="cf">except</span> importlib.metadata.PackageNotFoundError:</span>
<span id="cb61-112"><a href="#cb61-112" aria-hidden="true" tabindex="-1"></a>            missing_packages.append(package)</span>
<span id="cb61-113"><a href="#cb61-113" aria-hidden="true" tabindex="-1"></a>            results[package] <span class="op">=</span> <span class="va">None</span></span>
<span id="cb61-114"><a href="#cb61-114" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb61-115"><a href="#cb61-115" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Report results</span></span>
<span id="cb61-116"><a href="#cb61-116" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> missing_packages:</span>
<span id="cb61-117"><a href="#cb61-117" aria-hidden="true" tabindex="-1"></a>        <span class="bu">print</span>(<span class="ss">f"❌ Missing packages: </span><span class="sc">{</span><span class="st">', '</span><span class="sc">.</span>join(missing_packages)<span class="sc">}</span><span class="ss">"</span>)</span>
<span id="cb61-118"><a href="#cb61-118" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> results</span>
<span id="cb61-119"><a href="#cb61-119" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb61-120"><a href="#cb61-120" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="ss">f"✅ All </span><span class="sc">{</span><span class="bu">len</span>(required_packages)<span class="sc">}</span><span class="ss"> packages verified"</span>)</span>
<span id="cb61-121"><a href="#cb61-121" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> results</span>
<span id="cb61-122"><a href="#cb61-122" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb61-123"><a href="#cb61-123" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb61-126"><a href="#cb61-126" aria-hidden="true" tabindex="-1"></a><span class="in">```{python}</span></span>
<span id="cb61-127"><a href="#cb61-127" aria-hidden="true" tabindex="-1"></a><span class="co"># Verify core geospatial AI environment</span></span>
<span id="cb61-128"><a href="#cb61-128" aria-hidden="true" tabindex="-1"></a>required_packages <span class="op">=</span> [</span>
<span id="cb61-129"><a href="#cb61-129" aria-hidden="true" tabindex="-1"></a>    <span class="st">'rasterio'</span>, <span class="st">'xarray'</span>, <span class="st">'torch'</span>, <span class="st">'transformers'</span>,</span>
<span id="cb61-130"><a href="#cb61-130" aria-hidden="true" tabindex="-1"></a>    <span class="st">'folium'</span>, <span class="st">'matplotlib'</span>, <span class="st">'numpy'</span>, <span class="st">'pandas'</span>,</span>
<span id="cb61-131"><a href="#cb61-131" aria-hidden="true" tabindex="-1"></a>    <span class="st">'pystac-client'</span>, <span class="st">'geopandas'</span>, <span class="st">'rioxarray'</span>, <span class="st">'planetary-computer'</span></span>
<span id="cb61-132"><a href="#cb61-132" aria-hidden="true" tabindex="-1"></a>]</span>
<span id="cb61-133"><a href="#cb61-133" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb61-134"><a href="#cb61-134" aria-hidden="true" tabindex="-1"></a>package_status <span class="op">=</span> verify_environment(required_packages)</span>
<span id="cb61-135"><a href="#cb61-135" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb61-136"><a href="#cb61-136" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb61-137"><a href="#cb61-137" aria-hidden="true" tabindex="-1"></a><span class="fu">### Import Essential Libraries and Create Helper Functions</span></span>
<span id="cb61-138"><a href="#cb61-138" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb61-141"><a href="#cb61-141" aria-hidden="true" tabindex="-1"></a><span class="in">```{python}</span></span>
<span id="cb61-142"><a href="#cb61-142" aria-hidden="true" tabindex="-1"></a><span class="co"># Core geospatial libraries</span></span>
<span id="cb61-143"><a href="#cb61-143" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> rasterio</span>
<span id="cb61-144"><a href="#cb61-144" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> rasterio.warp <span class="im">import</span> calculate_default_transform, reproject, Resampling</span>
<span id="cb61-145"><a href="#cb61-145" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> xarray <span class="im">as</span> xr</span>
<span id="cb61-146"><a href="#cb61-146" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> rioxarray  <span class="co"># Extends xarray with rasterio functionality</span></span>
<span id="cb61-147"><a href="#cb61-147" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb61-148"><a href="#cb61-148" aria-hidden="true" tabindex="-1"></a><span class="co"># Data access and processing</span></span>
<span id="cb61-149"><a href="#cb61-149" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> numpy <span class="im">as</span> np</span>
<span id="cb61-150"><a href="#cb61-150" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> pandas <span class="im">as</span> pd</span>
<span id="cb61-151"><a href="#cb61-151" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> geopandas <span class="im">as</span> gpd</span>
<span id="cb61-152"><a href="#cb61-152" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> pystac_client <span class="im">import</span> Client</span>
<span id="cb61-153"><a href="#cb61-153" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> planetary_computer <span class="im">as</span> pc  <span class="co"># For signing asset URLs</span></span>
<span id="cb61-154"><a href="#cb61-154" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb61-155"><a href="#cb61-155" aria-hidden="true" tabindex="-1"></a><span class="co"># Visualization</span></span>
<span id="cb61-156"><a href="#cb61-156" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> matplotlib.pyplot <span class="im">as</span> plt</span>
<span id="cb61-157"><a href="#cb61-157" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> folium</span>
<span id="cb61-158"><a href="#cb61-158" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> folium <span class="im">import</span> plugins</span>
<span id="cb61-159"><a href="#cb61-159" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb61-160"><a href="#cb61-160" aria-hidden="true" tabindex="-1"></a><span class="co"># Utilities</span></span>
<span id="cb61-161"><a href="#cb61-161" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> typing <span class="im">import</span> Dict, List, Tuple, Optional, Union</span>
<span id="cb61-162"><a href="#cb61-162" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> pathlib <span class="im">import</span> Path</span>
<span id="cb61-163"><a href="#cb61-163" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> json</span>
<span id="cb61-164"><a href="#cb61-164" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> time</span>
<span id="cb61-165"><a href="#cb61-165" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> datetime <span class="im">import</span> datetime, timedelta</span>
<span id="cb61-166"><a href="#cb61-166" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> logging</span>
<span id="cb61-167"><a href="#cb61-167" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb61-168"><a href="#cb61-168" aria-hidden="true" tabindex="-1"></a><span class="co"># Deep learning libraries</span></span>
<span id="cb61-169"><a href="#cb61-169" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> torch</span>
<span id="cb61-170"><a href="#cb61-170" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb61-171"><a href="#cb61-171" aria-hidden="true" tabindex="-1"></a><span class="co"># Configure matplotlib for publication-quality plots</span></span>
<span id="cb61-172"><a href="#cb61-172" aria-hidden="true" tabindex="-1"></a>plt.rcParams.update({</span>
<span id="cb61-173"><a href="#cb61-173" aria-hidden="true" tabindex="-1"></a>    <span class="st">'figure.figsize'</span>: (<span class="dv">10</span>, <span class="dv">6</span>),</span>
<span id="cb61-174"><a href="#cb61-174" aria-hidden="true" tabindex="-1"></a>    <span class="st">'figure.dpi'</span>: <span class="dv">100</span>,</span>
<span id="cb61-175"><a href="#cb61-175" aria-hidden="true" tabindex="-1"></a>    <span class="st">'font.size'</span>: <span class="dv">10</span>,</span>
<span id="cb61-176"><a href="#cb61-176" aria-hidden="true" tabindex="-1"></a>    <span class="st">'axes.titlesize'</span>: <span class="dv">12</span>,</span>
<span id="cb61-177"><a href="#cb61-177" aria-hidden="true" tabindex="-1"></a>    <span class="st">'axes.labelsize'</span>: <span class="dv">10</span>,</span>
<span id="cb61-178"><a href="#cb61-178" aria-hidden="true" tabindex="-1"></a>    <span class="st">'xtick.labelsize'</span>: <span class="dv">9</span>,</span>
<span id="cb61-179"><a href="#cb61-179" aria-hidden="true" tabindex="-1"></a>    <span class="st">'ytick.labelsize'</span>: <span class="dv">9</span>,</span>
<span id="cb61-180"><a href="#cb61-180" aria-hidden="true" tabindex="-1"></a>    <span class="st">'legend.fontsize'</span>: <span class="dv">9</span></span>
<span id="cb61-181"><a href="#cb61-181" aria-hidden="true" tabindex="-1"></a>})</span>
<span id="cb61-182"><a href="#cb61-182" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb61-183"><a href="#cb61-183" aria-hidden="true" tabindex="-1"></a><span class="co"># Configure logging for production-ready code</span></span>
<span id="cb61-184"><a href="#cb61-184" aria-hidden="true" tabindex="-1"></a>logging.basicConfig(level<span class="op">=</span>logging.INFO, <span class="bu">format</span><span class="op">=</span><span class="st">'</span><span class="sc">%(asctime)s</span><span class="st"> - </span><span class="sc">%(levelname)s</span><span class="st"> - </span><span class="sc">%(message)s</span><span class="st">'</span>)</span>
<span id="cb61-185"><a href="#cb61-185" aria-hidden="true" tabindex="-1"></a>logger <span class="op">=</span> logging.getLogger(<span class="va">__name__</span>)</span>
<span id="cb61-186"><a href="#cb61-186" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb61-187"><a href="#cb61-187" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb61-188"><a href="#cb61-188" aria-hidden="true" tabindex="-1"></a><span class="fu">### Geospatial AI Toolkit: Comprehensive Helper Functions</span></span>
<span id="cb61-189"><a href="#cb61-189" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb61-190"><a href="#cb61-190" aria-hidden="true" tabindex="-1"></a>This chapter is organized to guide you through the essential foundations of geospatial data science and AI. The file is structured into clear sections, each focusing on a key aspect of the geospatial workflow:</span>
<span id="cb61-191"><a href="#cb61-191" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb61-192"><a href="#cb61-192" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>**Library Imports and Setup**: All necessary Python packages are imported and configured for geospatial analysis and visualization.</span>
<span id="cb61-193"><a href="#cb61-193" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>**Helper Functions**: Modular utility functions are introduced to streamline common geospatial tasks.</span>
<span id="cb61-194"><a href="#cb61-194" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>**Sectioned Capabilities**: Each major capability (such as authentication, data access, and processing) is presented in its own section, with explanations of the underlying design patterns and best practices.</span>
<span id="cb61-195"><a href="#cb61-195" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>**Progressive Complexity**: Concepts and code build on each other, moving from foundational tools to more advanced techniques.</span>
<span id="cb61-196"><a href="#cb61-196" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb61-197"><a href="#cb61-197" aria-hidden="true" tabindex="-1"></a>This structure is designed to help you understand not just how to use the tools, but also why certain architectural and security decisions are made—preparing you for both practical work and deeper learning as you progress through the course.</span>
<span id="cb61-198"><a href="#cb61-198" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb61-199"><a href="#cb61-199" aria-hidden="true" tabindex="-1"></a><span class="fu">## Section 1: STAC Authentication and Security 🔐</span></span>
<span id="cb61-200"><a href="#cb61-200" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb61-201"><a href="#cb61-201" aria-hidden="true" tabindex="-1"></a>:::{.callout-tip}</span>
<span id="cb61-202"><a href="#cb61-202" aria-hidden="true" tabindex="-1"></a><span class="fu">## Learning Objectives</span></span>
<span id="cb61-203"><a href="#cb61-203" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb61-204"><a href="#cb61-204" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>Understand API authentication patterns for production systems</span>
<span id="cb61-205"><a href="#cb61-205" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>Implement secure credential management for cloud services</span>
<span id="cb61-206"><a href="#cb61-206" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>Design robust authentication with fallback mechanisms</span>
<span id="cb61-207"><a href="#cb61-207" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>Apply enterprise security best practices to geospatial workflows</span>
<span id="cb61-208"><a href="#cb61-208" aria-hidden="true" tabindex="-1"></a>:::</span>
<span id="cb61-209"><a href="#cb61-209" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb61-210"><a href="#cb61-210" aria-hidden="true" tabindex="-1"></a><span class="fu">### Why Authentication Matters in Geospatial AI</span></span>
<span id="cb61-211"><a href="#cb61-211" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb61-212"><a href="#cb61-212" aria-hidden="true" tabindex="-1"></a>Modern satellite data access relies on cloud-native APIs that require proper authentication for:</span>
<span id="cb61-213"><a href="#cb61-213" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb61-214"><a href="#cb61-214" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>**Rate Limit Management**: Authenticated users get higher request quotas</span>
<span id="cb61-215"><a href="#cb61-215" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>**Access Control**: Some datasets require institutional or commercial access</span>
<span id="cb61-216"><a href="#cb61-216" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>**Usage Tracking**: Providers need to monitor and bill for data access</span>
<span id="cb61-217"><a href="#cb61-217" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>**Security**: Prevents abuse and ensures sustainable data sharing</span>
<span id="cb61-218"><a href="#cb61-218" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb61-221"><a href="#cb61-221" aria-hidden="true" tabindex="-1"></a><span class="in">```{python}</span></span>
<span id="cb61-222"><a href="#cb61-222" aria-hidden="true" tabindex="-1"></a><span class="co">#| tangle: geogfm/c01.py</span></span>
<span id="cb61-223"><a href="#cb61-223" aria-hidden="true" tabindex="-1"></a><span class="co">#| tangle-append: true</span></span>
<span id="cb61-224"><a href="#cb61-224" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> setup_planetary_computer_auth() <span class="op">-&gt;</span> <span class="bu">bool</span>:</span>
<span id="cb61-225"><a href="#cb61-225" aria-hidden="true" tabindex="-1"></a>    <span class="co">"""</span></span>
<span id="cb61-226"><a href="#cb61-226" aria-hidden="true" tabindex="-1"></a><span class="co">    Configure authentication for Microsoft Planetary Computer.</span></span>
<span id="cb61-227"><a href="#cb61-227" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb61-228"><a href="#cb61-228" aria-hidden="true" tabindex="-1"></a><span class="co">    Uses environment variables and .env files for credential discovery,</span></span>
<span id="cb61-229"><a href="#cb61-229" aria-hidden="true" tabindex="-1"></a><span class="co">    with graceful degradation to anonymous access.</span></span>
<span id="cb61-230"><a href="#cb61-230" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb61-231"><a href="#cb61-231" aria-hidden="true" tabindex="-1"></a><span class="co">    Returns</span></span>
<span id="cb61-232"><a href="#cb61-232" aria-hidden="true" tabindex="-1"></a><span class="co">    -------</span></span>
<span id="cb61-233"><a href="#cb61-233" aria-hidden="true" tabindex="-1"></a><span class="co">    bool</span></span>
<span id="cb61-234"><a href="#cb61-234" aria-hidden="true" tabindex="-1"></a><span class="co">        True if authenticated, False for anonymous access</span></span>
<span id="cb61-235"><a href="#cb61-235" aria-hidden="true" tabindex="-1"></a><span class="co">    """</span></span>
<span id="cb61-236"><a href="#cb61-236" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Try environment variables first (production)</span></span>
<span id="cb61-237"><a href="#cb61-237" aria-hidden="true" tabindex="-1"></a>    auth_key <span class="op">=</span> os.getenv(<span class="st">'PC_SDK_SUBSCRIPTION_KEY'</span>) <span class="kw">or</span> os.getenv(<span class="st">'PLANETARY_COMPUTER_API_KEY'</span>)</span>
<span id="cb61-238"><a href="#cb61-238" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb61-239"><a href="#cb61-239" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Fallback to .env file (development)</span></span>
<span id="cb61-240"><a href="#cb61-240" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> <span class="kw">not</span> auth_key:</span>
<span id="cb61-241"><a href="#cb61-241" aria-hidden="true" tabindex="-1"></a>        env_file <span class="op">=</span> Path(<span class="st">'.env'</span>)</span>
<span id="cb61-242"><a href="#cb61-242" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> env_file.exists():</span>
<span id="cb61-243"><a href="#cb61-243" aria-hidden="true" tabindex="-1"></a>            <span class="cf">try</span>:</span>
<span id="cb61-244"><a href="#cb61-244" aria-hidden="true" tabindex="-1"></a>                <span class="cf">with</span> <span class="bu">open</span>(env_file) <span class="im">as</span> f:</span>
<span id="cb61-245"><a href="#cb61-245" aria-hidden="true" tabindex="-1"></a>                    <span class="cf">for</span> line <span class="kw">in</span> f:</span>
<span id="cb61-246"><a href="#cb61-246" aria-hidden="true" tabindex="-1"></a>                        line <span class="op">=</span> line.strip()</span>
<span id="cb61-247"><a href="#cb61-247" aria-hidden="true" tabindex="-1"></a>                        <span class="cf">if</span> line.startswith((<span class="st">'PC_SDK_SUBSCRIPTION_KEY='</span>, <span class="st">'PLANETARY_COMPUTER_API_KEY='</span>)):</span>
<span id="cb61-248"><a href="#cb61-248" aria-hidden="true" tabindex="-1"></a>                            auth_key <span class="op">=</span> line.split(<span class="st">'='</span>, <span class="dv">1</span>)[<span class="dv">1</span>].strip().strip(<span class="st">'"</span><span class="ch">\'</span><span class="st">'</span>)</span>
<span id="cb61-249"><a href="#cb61-249" aria-hidden="true" tabindex="-1"></a>                            <span class="cf">break</span></span>
<span id="cb61-250"><a href="#cb61-250" aria-hidden="true" tabindex="-1"></a>            <span class="cf">except</span> <span class="pp">Exception</span>:</span>
<span id="cb61-251"><a href="#cb61-251" aria-hidden="true" tabindex="-1"></a>                <span class="cf">pass</span>  <span class="co"># Continue with anonymous access</span></span>
<span id="cb61-252"><a href="#cb61-252" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb61-253"><a href="#cb61-253" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Configure authentication</span></span>
<span id="cb61-254"><a href="#cb61-254" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> auth_key <span class="kw">and</span> <span class="bu">len</span>(auth_key) <span class="op">&gt;</span> <span class="dv">10</span>:</span>
<span id="cb61-255"><a href="#cb61-255" aria-hidden="true" tabindex="-1"></a>        <span class="cf">try</span>:</span>
<span id="cb61-256"><a href="#cb61-256" aria-hidden="true" tabindex="-1"></a>            pc.set_subscription_key(auth_key)</span>
<span id="cb61-257"><a href="#cb61-257" aria-hidden="true" tabindex="-1"></a>            logger.info(<span class="st">"Planetary Computer authentication successful"</span>)</span>
<span id="cb61-258"><a href="#cb61-258" aria-hidden="true" tabindex="-1"></a>            <span class="cf">return</span> <span class="va">True</span></span>
<span id="cb61-259"><a href="#cb61-259" aria-hidden="true" tabindex="-1"></a>        <span class="cf">except</span> <span class="pp">Exception</span> <span class="im">as</span> e:</span>
<span id="cb61-260"><a href="#cb61-260" aria-hidden="true" tabindex="-1"></a>            logger.warning(<span class="ss">f"Authentication failed: </span><span class="sc">{</span>e<span class="sc">}</span><span class="ss">"</span>)</span>
<span id="cb61-261"><a href="#cb61-261" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb61-262"><a href="#cb61-262" aria-hidden="true" tabindex="-1"></a>    logger.info(<span class="st">"Using anonymous access (basic rate limits)"</span>)</span>
<span id="cb61-263"><a href="#cb61-263" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> <span class="va">False</span></span>
<span id="cb61-264"><a href="#cb61-264" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb61-265"><a href="#cb61-265" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb61-268"><a href="#cb61-268" aria-hidden="true" tabindex="-1"></a><span class="in">```{python}</span></span>
<span id="cb61-269"><a href="#cb61-269" aria-hidden="true" tabindex="-1"></a><span class="co"># Initialize authentication</span></span>
<span id="cb61-270"><a href="#cb61-270" aria-hidden="true" tabindex="-1"></a>auth_status <span class="op">=</span> setup_planetary_computer_auth()</span>
<span id="cb61-271"><a href="#cb61-271" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb61-272"><a href="#cb61-272" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb61-273"><a href="#cb61-273" aria-hidden="true" tabindex="-1"></a>:::{.callout-note}</span>
<span id="cb61-274"><a href="#cb61-274" aria-hidden="true" tabindex="-1"></a><span class="fu">## Security Best Practices</span></span>
<span id="cb61-275"><a href="#cb61-275" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb61-276"><a href="#cb61-276" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>**Never hardcode credentials** in source code or notebooks</span>
<span id="cb61-277"><a href="#cb61-277" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>**Use environment variables** for production deployments</span>
<span id="cb61-278"><a href="#cb61-278" aria-hidden="true" tabindex="-1"></a>:::</span>
<span id="cb61-279"><a href="#cb61-279" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb61-280"><a href="#cb61-280" aria-hidden="true" tabindex="-1"></a>---</span>
<span id="cb61-281"><a href="#cb61-281" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb61-282"><a href="#cb61-282" aria-hidden="true" tabindex="-1"></a><span class="fu">## Section 2: STAC Data Discovery 🔍</span></span>
<span id="cb61-283"><a href="#cb61-283" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb61-284"><a href="#cb61-284" aria-hidden="true" tabindex="-1"></a>:::{.callout-tip}</span>
<span id="cb61-285"><a href="#cb61-285" aria-hidden="true" tabindex="-1"></a><span class="fu">## Learning Objectives</span></span>
<span id="cb61-286"><a href="#cb61-286" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb61-287"><a href="#cb61-287" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>Master cloud-native data discovery patterns</span>
<span id="cb61-288"><a href="#cb61-288" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>Understand STAC query optimization strategies</span>
<span id="cb61-289"><a href="#cb61-289" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>Implement robust search with intelligent filtering</span>
<span id="cb61-290"><a href="#cb61-290" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>Design scalable data discovery for large-scale analysis</span>
<span id="cb61-291"><a href="#cb61-291" aria-hidden="true" tabindex="-1"></a>:::</span>
<span id="cb61-292"><a href="#cb61-292" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb61-293"><a href="#cb61-293" aria-hidden="true" tabindex="-1"></a><span class="fu">### Cloud-Native Data Access Architecture</span></span>
<span id="cb61-294"><a href="#cb61-294" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb61-295"><a href="#cb61-295" aria-hidden="true" tabindex="-1"></a>STAC APIs represent a paradigm shift from traditional data distribution:</span>
<span id="cb61-296"><a href="#cb61-296" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb61-297"><a href="#cb61-297" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>**Federated Catalogs**: Multiple providers, unified interface</span>
<span id="cb61-298"><a href="#cb61-298" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>**On-Demand Access**: No need to download entire datasets</span>
<span id="cb61-299"><a href="#cb61-299" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>**Rich Metadata**: Searchable properties for precise discovery</span>
<span id="cb61-300"><a href="#cb61-300" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>**Cloud Optimization**: Direct access to cloud-optimized formats</span>
<span id="cb61-301"><a href="#cb61-301" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb61-304"><a href="#cb61-304" aria-hidden="true" tabindex="-1"></a><span class="in">```{python}</span></span>
<span id="cb61-305"><a href="#cb61-305" aria-hidden="true" tabindex="-1"></a><span class="co">#| tangle: geogfm/c01.py</span></span>
<span id="cb61-306"><a href="#cb61-306" aria-hidden="true" tabindex="-1"></a><span class="co">#| tangle-append: true</span></span>
<span id="cb61-307"><a href="#cb61-307" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> search_sentinel2_scenes(</span>
<span id="cb61-308"><a href="#cb61-308" aria-hidden="true" tabindex="-1"></a>    bbox: List[<span class="bu">float</span>],</span>
<span id="cb61-309"><a href="#cb61-309" aria-hidden="true" tabindex="-1"></a>    date_range: <span class="bu">str</span>,</span>
<span id="cb61-310"><a href="#cb61-310" aria-hidden="true" tabindex="-1"></a>    cloud_cover_max: <span class="bu">float</span> <span class="op">=</span> <span class="dv">20</span>,</span>
<span id="cb61-311"><a href="#cb61-311" aria-hidden="true" tabindex="-1"></a>    limit: <span class="bu">int</span> <span class="op">=</span> <span class="dv">10</span></span>
<span id="cb61-312"><a href="#cb61-312" aria-hidden="true" tabindex="-1"></a>) <span class="op">-&gt;</span> List:</span>
<span id="cb61-313"><a href="#cb61-313" aria-hidden="true" tabindex="-1"></a>    <span class="co">"""</span></span>
<span id="cb61-314"><a href="#cb61-314" aria-hidden="true" tabindex="-1"></a><span class="co">    Search Sentinel-2 Level 2A scenes using STAC API.</span></span>
<span id="cb61-315"><a href="#cb61-315" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb61-316"><a href="#cb61-316" aria-hidden="true" tabindex="-1"></a><span class="co">    Parameters</span></span>
<span id="cb61-317"><a href="#cb61-317" aria-hidden="true" tabindex="-1"></a><span class="co">    ----------</span></span>
<span id="cb61-318"><a href="#cb61-318" aria-hidden="true" tabindex="-1"></a><span class="co">    bbox : List[float]</span></span>
<span id="cb61-319"><a href="#cb61-319" aria-hidden="true" tabindex="-1"></a><span class="co">        Bounding box as [west, south, east, north] in WGS84</span></span>
<span id="cb61-320"><a href="#cb61-320" aria-hidden="true" tabindex="-1"></a><span class="co">    date_range : str</span></span>
<span id="cb61-321"><a href="#cb61-321" aria-hidden="true" tabindex="-1"></a><span class="co">        ISO date range: "YYYY-MM-DD/YYYY-MM-DD"</span></span>
<span id="cb61-322"><a href="#cb61-322" aria-hidden="true" tabindex="-1"></a><span class="co">    cloud_cover_max : float</span></span>
<span id="cb61-323"><a href="#cb61-323" aria-hidden="true" tabindex="-1"></a><span class="co">        Maximum cloud cover percentage</span></span>
<span id="cb61-324"><a href="#cb61-324" aria-hidden="true" tabindex="-1"></a><span class="co">    limit : int</span></span>
<span id="cb61-325"><a href="#cb61-325" aria-hidden="true" tabindex="-1"></a><span class="co">        Maximum scenes to return</span></span>
<span id="cb61-326"><a href="#cb61-326" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb61-327"><a href="#cb61-327" aria-hidden="true" tabindex="-1"></a><span class="co">    Returns</span></span>
<span id="cb61-328"><a href="#cb61-328" aria-hidden="true" tabindex="-1"></a><span class="co">    -------</span></span>
<span id="cb61-329"><a href="#cb61-329" aria-hidden="true" tabindex="-1"></a><span class="co">    List[pystac.Item]</span></span>
<span id="cb61-330"><a href="#cb61-330" aria-hidden="true" tabindex="-1"></a><span class="co">        List of STAC items sorted by cloud cover (ascending)</span></span>
<span id="cb61-331"><a href="#cb61-331" aria-hidden="true" tabindex="-1"></a><span class="co">    """</span></span>
<span id="cb61-332"><a href="#cb61-332" aria-hidden="true" tabindex="-1"></a>    catalog <span class="op">=</span> Client.<span class="bu">open</span>(</span>
<span id="cb61-333"><a href="#cb61-333" aria-hidden="true" tabindex="-1"></a>        <span class="st">"https://planetarycomputer.microsoft.com/api/stac/v1"</span>,</span>
<span id="cb61-334"><a href="#cb61-334" aria-hidden="true" tabindex="-1"></a>        modifier<span class="op">=</span>pc.sign_inplace</span>
<span id="cb61-335"><a href="#cb61-335" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb61-336"><a href="#cb61-336" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb61-337"><a href="#cb61-337" aria-hidden="true" tabindex="-1"></a>    search_params <span class="op">=</span> {</span>
<span id="cb61-338"><a href="#cb61-338" aria-hidden="true" tabindex="-1"></a>        <span class="st">"collections"</span>: [<span class="st">"sentinel-2-l2a"</span>],</span>
<span id="cb61-339"><a href="#cb61-339" aria-hidden="true" tabindex="-1"></a>        <span class="st">"bbox"</span>: bbox,</span>
<span id="cb61-340"><a href="#cb61-340" aria-hidden="true" tabindex="-1"></a>        <span class="st">"datetime"</span>: date_range,</span>
<span id="cb61-341"><a href="#cb61-341" aria-hidden="true" tabindex="-1"></a>        <span class="st">"query"</span>: {<span class="st">"eo:cloud_cover"</span>: {<span class="st">"lt"</span>: cloud_cover_max}},</span>
<span id="cb61-342"><a href="#cb61-342" aria-hidden="true" tabindex="-1"></a>        <span class="st">"limit"</span>: limit</span>
<span id="cb61-343"><a href="#cb61-343" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb61-344"><a href="#cb61-344" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb61-345"><a href="#cb61-345" aria-hidden="true" tabindex="-1"></a>    search_results <span class="op">=</span> catalog.search(<span class="op">**</span>search_params)</span>
<span id="cb61-346"><a href="#cb61-346" aria-hidden="true" tabindex="-1"></a>    items <span class="op">=</span> <span class="bu">list</span>(search_results.items())</span>
<span id="cb61-347"><a href="#cb61-347" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb61-348"><a href="#cb61-348" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Sort by cloud cover (best quality first)</span></span>
<span id="cb61-349"><a href="#cb61-349" aria-hidden="true" tabindex="-1"></a>    items.sort(key<span class="op">=</span><span class="kw">lambda</span> x: x.properties.get(<span class="st">'eo:cloud_cover'</span>, <span class="dv">100</span>))</span>
<span id="cb61-350"><a href="#cb61-350" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb61-351"><a href="#cb61-351" aria-hidden="true" tabindex="-1"></a>    logger.info(<span class="ss">f"Found </span><span class="sc">{</span><span class="bu">len</span>(items)<span class="sc">}</span><span class="ss"> Sentinel-2 scenes (cloud cover &lt; </span><span class="sc">{</span>cloud_cover_max<span class="sc">}</span><span class="ss">%)"</span>)</span>
<span id="cb61-352"><a href="#cb61-352" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> items</span>
<span id="cb61-353"><a href="#cb61-353" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb61-354"><a href="#cb61-354" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb61-355"><a href="#cb61-355" aria-hidden="true" tabindex="-1"></a>:::{.callout-note}</span>
<span id="cb61-356"><a href="#cb61-356" aria-hidden="true" tabindex="-1"></a><span class="fu">## Query Optimization Strategies</span></span>
<span id="cb61-357"><a href="#cb61-357" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb61-358"><a href="#cb61-358" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>**Spatial Indexing**: STAC APIs use spatial indices for fast geographic queries</span>
<span id="cb61-359"><a href="#cb61-359" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>**Temporal Partitioning**: Date-based organization enables efficient time series queries</span>
<span id="cb61-360"><a href="#cb61-360" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>**Property Filtering**: Server-side filtering reduces network transfer</span>
<span id="cb61-361"><a href="#cb61-361" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>**Result Ranking**: Sort by quality metrics (cloud cover, viewing angle) for best-first selection</span>
<span id="cb61-362"><a href="#cb61-362" aria-hidden="true" tabindex="-1"></a>:::</span>
<span id="cb61-363"><a href="#cb61-363" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb61-364"><a href="#cb61-364" aria-hidden="true" tabindex="-1"></a>---</span>
<span id="cb61-365"><a href="#cb61-365" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb61-366"><a href="#cb61-366" aria-hidden="true" tabindex="-1"></a><span class="fu">## Section 3: Intelligent Data Loading 📥</span></span>
<span id="cb61-367"><a href="#cb61-367" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb61-368"><a href="#cb61-368" aria-hidden="true" tabindex="-1"></a>:::{.callout-tip}</span>
<span id="cb61-369"><a href="#cb61-369" aria-hidden="true" tabindex="-1"></a><span class="fu">## Learning Objectives</span></span>
<span id="cb61-370"><a href="#cb61-370" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb61-371"><a href="#cb61-371" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>Implement memory-efficient satellite data loading</span>
<span id="cb61-372"><a href="#cb61-372" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>Master coordinate reference system (CRS) transformations</span>
<span id="cb61-373"><a href="#cb61-373" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>Design robust error handling for network operations</span>
<span id="cb61-374"><a href="#cb61-374" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>Optimize data transfer with intelligent subsetting</span>
<span id="cb61-375"><a href="#cb61-375" aria-hidden="true" tabindex="-1"></a>:::</span>
<span id="cb61-376"><a href="#cb61-376" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb61-377"><a href="#cb61-377" aria-hidden="true" tabindex="-1"></a><span class="fu">### Memory Management in Satellite Data Processing</span></span>
<span id="cb61-378"><a href="#cb61-378" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb61-379"><a href="#cb61-379" aria-hidden="true" tabindex="-1"></a>Satellite scenes can be massive (&gt;1GB per scene), requiring intelligent loading strategies:</span>
<span id="cb61-380"><a href="#cb61-380" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb61-381"><a href="#cb61-381" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>**Lazy Loading**: Load only when needed, not during search</span>
<span id="cb61-382"><a href="#cb61-382" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>**Subset Loading**: Extract regions of interest to reduce memory footprint</span>
<span id="cb61-383"><a href="#cb61-383" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>**Progressive Loading**: Handle multi-resolution data efficiently</span>
<span id="cb61-384"><a href="#cb61-384" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>**Error Recovery**: Robust handling of network interruptions</span>
<span id="cb61-385"><a href="#cb61-385" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb61-388"><a href="#cb61-388" aria-hidden="true" tabindex="-1"></a><span class="in">```{python}</span></span>
<span id="cb61-389"><a href="#cb61-389" aria-hidden="true" tabindex="-1"></a><span class="co">#| tangle: geogfm/c01.py</span></span>
<span id="cb61-390"><a href="#cb61-390" aria-hidden="true" tabindex="-1"></a><span class="co">#| tangle-append: true</span></span>
<span id="cb61-391"><a href="#cb61-391" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> load_sentinel2_bands(</span>
<span id="cb61-392"><a href="#cb61-392" aria-hidden="true" tabindex="-1"></a>    item,</span>
<span id="cb61-393"><a href="#cb61-393" aria-hidden="true" tabindex="-1"></a>    bands: List[<span class="bu">str</span>] <span class="op">=</span> [<span class="st">'B04'</span>, <span class="st">'B03'</span>, <span class="st">'B02'</span>, <span class="st">'B08'</span>],</span>
<span id="cb61-394"><a href="#cb61-394" aria-hidden="true" tabindex="-1"></a>    subset_bbox: Optional[List[<span class="bu">float</span>]] <span class="op">=</span> <span class="va">None</span>,</span>
<span id="cb61-395"><a href="#cb61-395" aria-hidden="true" tabindex="-1"></a>    max_retries: <span class="bu">int</span> <span class="op">=</span> <span class="dv">3</span></span>
<span id="cb61-396"><a href="#cb61-396" aria-hidden="true" tabindex="-1"></a>) <span class="op">-&gt;</span> Dict[<span class="bu">str</span>, Union[np.ndarray, <span class="bu">str</span>]]:</span>
<span id="cb61-397"><a href="#cb61-397" aria-hidden="true" tabindex="-1"></a>    <span class="co">"""</span></span>
<span id="cb61-398"><a href="#cb61-398" aria-hidden="true" tabindex="-1"></a><span class="co">    Load Sentinel-2 bands with optional spatial subsetting.</span></span>
<span id="cb61-399"><a href="#cb61-399" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb61-400"><a href="#cb61-400" aria-hidden="true" tabindex="-1"></a><span class="co">    Parameters</span></span>
<span id="cb61-401"><a href="#cb61-401" aria-hidden="true" tabindex="-1"></a><span class="co">    ----------</span></span>
<span id="cb61-402"><a href="#cb61-402" aria-hidden="true" tabindex="-1"></a><span class="co">    item : pystac.Item</span></span>
<span id="cb61-403"><a href="#cb61-403" aria-hidden="true" tabindex="-1"></a><span class="co">        STAC item representing the satellite scene</span></span>
<span id="cb61-404"><a href="#cb61-404" aria-hidden="true" tabindex="-1"></a><span class="co">    bands : List[str]</span></span>
<span id="cb61-405"><a href="#cb61-405" aria-hidden="true" tabindex="-1"></a><span class="co">        Spectral bands to load</span></span>
<span id="cb61-406"><a href="#cb61-406" aria-hidden="true" tabindex="-1"></a><span class="co">    subset_bbox : Optional[List[float]]</span></span>
<span id="cb61-407"><a href="#cb61-407" aria-hidden="true" tabindex="-1"></a><span class="co">        Spatial subset as [west, south, east, north] in WGS84</span></span>
<span id="cb61-408"><a href="#cb61-408" aria-hidden="true" tabindex="-1"></a><span class="co">    max_retries : int</span></span>
<span id="cb61-409"><a href="#cb61-409" aria-hidden="true" tabindex="-1"></a><span class="co">        Number of retry attempts per band</span></span>
<span id="cb61-410"><a href="#cb61-410" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb61-411"><a href="#cb61-411" aria-hidden="true" tabindex="-1"></a><span class="co">    Returns</span></span>
<span id="cb61-412"><a href="#cb61-412" aria-hidden="true" tabindex="-1"></a><span class="co">    -------</span></span>
<span id="cb61-413"><a href="#cb61-413" aria-hidden="true" tabindex="-1"></a><span class="co">    Dict[str, Union[np.ndarray, str]]</span></span>
<span id="cb61-414"><a href="#cb61-414" aria-hidden="true" tabindex="-1"></a><span class="co">        Band arrays plus georeferencing metadata</span></span>
<span id="cb61-415"><a href="#cb61-415" aria-hidden="true" tabindex="-1"></a><span class="co">    """</span></span>
<span id="cb61-416"><a href="#cb61-416" aria-hidden="true" tabindex="-1"></a>    <span class="im">from</span> rasterio.windows <span class="im">import</span> from_bounds</span>
<span id="cb61-417"><a href="#cb61-417" aria-hidden="true" tabindex="-1"></a>    <span class="im">from</span> rasterio.warp <span class="im">import</span> transform_bounds</span>
<span id="cb61-418"><a href="#cb61-418" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb61-419"><a href="#cb61-419" aria-hidden="true" tabindex="-1"></a>    band_data <span class="op">=</span> {}</span>
<span id="cb61-420"><a href="#cb61-420" aria-hidden="true" tabindex="-1"></a>    successful_bands <span class="op">=</span> []</span>
<span id="cb61-421"><a href="#cb61-421" aria-hidden="true" tabindex="-1"></a>    failed_bands <span class="op">=</span> []</span>
<span id="cb61-422"><a href="#cb61-422" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb61-423"><a href="#cb61-423" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> band_name <span class="kw">in</span> bands:</span>
<span id="cb61-424"><a href="#cb61-424" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> band_name <span class="kw">not</span> <span class="kw">in</span> item.assets:</span>
<span id="cb61-425"><a href="#cb61-425" aria-hidden="true" tabindex="-1"></a>            failed_bands.append(band_name)</span>
<span id="cb61-426"><a href="#cb61-426" aria-hidden="true" tabindex="-1"></a>            <span class="cf">continue</span></span>
<span id="cb61-427"><a href="#cb61-427" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb61-428"><a href="#cb61-428" aria-hidden="true" tabindex="-1"></a>        asset_url <span class="op">=</span> item.assets[band_name].href</span>
<span id="cb61-429"><a href="#cb61-429" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb61-430"><a href="#cb61-430" aria-hidden="true" tabindex="-1"></a>        <span class="co"># Retry logic with exponential backoff</span></span>
<span id="cb61-431"><a href="#cb61-431" aria-hidden="true" tabindex="-1"></a>        <span class="cf">for</span> attempt <span class="kw">in</span> <span class="bu">range</span>(max_retries):</span>
<span id="cb61-432"><a href="#cb61-432" aria-hidden="true" tabindex="-1"></a>            <span class="cf">try</span>:</span>
<span id="cb61-433"><a href="#cb61-433" aria-hidden="true" tabindex="-1"></a>                <span class="co"># URL signing for authenticated access</span></span>
<span id="cb61-434"><a href="#cb61-434" aria-hidden="true" tabindex="-1"></a>                signed_url <span class="op">=</span> pc.sign(asset_url)</span>
<span id="cb61-435"><a href="#cb61-435" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb61-436"><a href="#cb61-436" aria-hidden="true" tabindex="-1"></a>                <span class="co"># Memory-efficient loading with rasterio</span></span>
<span id="cb61-437"><a href="#cb61-437" aria-hidden="true" tabindex="-1"></a>                <span class="cf">with</span> rasterio.<span class="bu">open</span>(signed_url) <span class="im">as</span> src:</span>
<span id="cb61-438"><a href="#cb61-438" aria-hidden="true" tabindex="-1"></a>                    <span class="co"># Validate data source</span></span>
<span id="cb61-439"><a href="#cb61-439" aria-hidden="true" tabindex="-1"></a>                    <span class="cf">if</span> src.width <span class="op">==</span> <span class="dv">0</span> <span class="kw">or</span> src.height <span class="op">==</span> <span class="dv">0</span>:</span>
<span id="cb61-440"><a href="#cb61-440" aria-hidden="true" tabindex="-1"></a>                        <span class="cf">raise</span> <span class="pp">ValueError</span>(<span class="ss">f"Invalid raster dimensions: </span><span class="sc">{</span>src<span class="sc">.</span>width<span class="sc">}</span><span class="ss">x</span><span class="sc">{</span>src<span class="sc">.</span>height<span class="sc">}</span><span class="ss">"</span>)</span>
<span id="cb61-441"><a href="#cb61-441" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb61-442"><a href="#cb61-442" aria-hidden="true" tabindex="-1"></a>                    <span class="cf">if</span> subset_bbox:</span>
<span id="cb61-443"><a href="#cb61-443" aria-hidden="true" tabindex="-1"></a>                        <span class="co"># Intelligent subsetting with CRS transformation</span></span>
<span id="cb61-444"><a href="#cb61-444" aria-hidden="true" tabindex="-1"></a>                        <span class="cf">try</span>:</span>
<span id="cb61-445"><a href="#cb61-445" aria-hidden="true" tabindex="-1"></a>                            <span class="co"># Transform bbox to source CRS if needed</span></span>
<span id="cb61-446"><a href="#cb61-446" aria-hidden="true" tabindex="-1"></a>                            <span class="cf">if</span> src.crs <span class="op">!=</span> rasterio.crs.CRS.from_epsg(<span class="dv">4326</span>):</span>
<span id="cb61-447"><a href="#cb61-447" aria-hidden="true" tabindex="-1"></a>                                subset_bbox_src_crs <span class="op">=</span> transform_bounds(</span>
<span id="cb61-448"><a href="#cb61-448" aria-hidden="true" tabindex="-1"></a>                                    rasterio.crs.CRS.from_epsg(<span class="dv">4326</span>), src.crs, <span class="op">*</span>subset_bbox</span>
<span id="cb61-449"><a href="#cb61-449" aria-hidden="true" tabindex="-1"></a>                                )</span>
<span id="cb61-450"><a href="#cb61-450" aria-hidden="true" tabindex="-1"></a>                            <span class="cf">else</span>:</span>
<span id="cb61-451"><a href="#cb61-451" aria-hidden="true" tabindex="-1"></a>                                subset_bbox_src_crs <span class="op">=</span> subset_bbox</span>
<span id="cb61-452"><a href="#cb61-452" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb61-453"><a href="#cb61-453" aria-hidden="true" tabindex="-1"></a>                            <span class="co"># Calculate reading window</span></span>
<span id="cb61-454"><a href="#cb61-454" aria-hidden="true" tabindex="-1"></a>                            window <span class="op">=</span> from_bounds(<span class="op">*</span>subset_bbox_src_crs, src.transform)</span>
<span id="cb61-455"><a href="#cb61-455" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb61-456"><a href="#cb61-456" aria-hidden="true" tabindex="-1"></a>                            <span class="co"># Ensure window is within raster bounds</span></span>
<span id="cb61-457"><a href="#cb61-457" aria-hidden="true" tabindex="-1"></a>                            window <span class="op">=</span> window.intersection(</span>
<span id="cb61-458"><a href="#cb61-458" aria-hidden="true" tabindex="-1"></a>                                rasterio.windows.Window(<span class="dv">0</span>, <span class="dv">0</span>, src.width, src.height)</span>
<span id="cb61-459"><a href="#cb61-459" aria-hidden="true" tabindex="-1"></a>                            )</span>
<span id="cb61-460"><a href="#cb61-460" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb61-461"><a href="#cb61-461" aria-hidden="true" tabindex="-1"></a>                            <span class="cf">if</span> window.width <span class="op">&gt;</span> <span class="dv">0</span> <span class="kw">and</span> window.height <span class="op">&gt;</span> <span class="dv">0</span>:</span>
<span id="cb61-462"><a href="#cb61-462" aria-hidden="true" tabindex="-1"></a>                                data <span class="op">=</span> src.read(<span class="dv">1</span>, window<span class="op">=</span>window)</span>
<span id="cb61-463"><a href="#cb61-463" aria-hidden="true" tabindex="-1"></a>                                transform <span class="op">=</span> src.window_transform(window)</span>
<span id="cb61-464"><a href="#cb61-464" aria-hidden="true" tabindex="-1"></a>                                bounds <span class="op">=</span> rasterio.windows.bounds(window, src.transform)</span>
<span id="cb61-465"><a href="#cb61-465" aria-hidden="true" tabindex="-1"></a>                                <span class="cf">if</span> src.crs <span class="op">!=</span> rasterio.crs.CRS.from_epsg(<span class="dv">4326</span>):</span>
<span id="cb61-466"><a href="#cb61-466" aria-hidden="true" tabindex="-1"></a>                                    bounds <span class="op">=</span> transform_bounds(src.crs, rasterio.crs.CRS.from_epsg(<span class="dv">4326</span>), <span class="op">*</span>bounds)</span>
<span id="cb61-467"><a href="#cb61-467" aria-hidden="true" tabindex="-1"></a>                            <span class="cf">else</span>:</span>
<span id="cb61-468"><a href="#cb61-468" aria-hidden="true" tabindex="-1"></a>                                <span class="co"># Fall back to full scene</span></span>
<span id="cb61-469"><a href="#cb61-469" aria-hidden="true" tabindex="-1"></a>                                data <span class="op">=</span> src.read(<span class="dv">1</span>)</span>
<span id="cb61-470"><a href="#cb61-470" aria-hidden="true" tabindex="-1"></a>                                transform <span class="op">=</span> src.transform</span>
<span id="cb61-471"><a href="#cb61-471" aria-hidden="true" tabindex="-1"></a>                                bounds <span class="op">=</span> src.bounds</span>
<span id="cb61-472"><a href="#cb61-472" aria-hidden="true" tabindex="-1"></a>                        <span class="cf">except</span> <span class="pp">Exception</span>:</span>
<span id="cb61-473"><a href="#cb61-473" aria-hidden="true" tabindex="-1"></a>                            <span class="co"># Fall back to full scene on subset error</span></span>
<span id="cb61-474"><a href="#cb61-474" aria-hidden="true" tabindex="-1"></a>                            data <span class="op">=</span> src.read(<span class="dv">1</span>)</span>
<span id="cb61-475"><a href="#cb61-475" aria-hidden="true" tabindex="-1"></a>                            transform <span class="op">=</span> src.transform</span>
<span id="cb61-476"><a href="#cb61-476" aria-hidden="true" tabindex="-1"></a>                            bounds <span class="op">=</span> src.bounds</span>
<span id="cb61-477"><a href="#cb61-477" aria-hidden="true" tabindex="-1"></a>                    <span class="cf">else</span>:</span>
<span id="cb61-478"><a href="#cb61-478" aria-hidden="true" tabindex="-1"></a>                        <span class="co"># Load full scene</span></span>
<span id="cb61-479"><a href="#cb61-479" aria-hidden="true" tabindex="-1"></a>                        data <span class="op">=</span> src.read(<span class="dv">1</span>)</span>
<span id="cb61-480"><a href="#cb61-480" aria-hidden="true" tabindex="-1"></a>                        transform <span class="op">=</span> src.transform</span>
<span id="cb61-481"><a href="#cb61-481" aria-hidden="true" tabindex="-1"></a>                        bounds <span class="op">=</span> src.bounds</span>
<span id="cb61-482"><a href="#cb61-482" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb61-483"><a href="#cb61-483" aria-hidden="true" tabindex="-1"></a>                    <span class="cf">if</span> data.size <span class="op">==</span> <span class="dv">0</span>:</span>
<span id="cb61-484"><a href="#cb61-484" aria-hidden="true" tabindex="-1"></a>                        <span class="cf">raise</span> <span class="pp">ValueError</span>(<span class="st">"Loaded data has zero size"</span>)</span>
<span id="cb61-485"><a href="#cb61-485" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb61-486"><a href="#cb61-486" aria-hidden="true" tabindex="-1"></a>                    <span class="co"># Store band data and metadata</span></span>
<span id="cb61-487"><a href="#cb61-487" aria-hidden="true" tabindex="-1"></a>                    band_data[band_name] <span class="op">=</span> data</span>
<span id="cb61-488"><a href="#cb61-488" aria-hidden="true" tabindex="-1"></a>                    <span class="cf">if</span> <span class="st">'transform'</span> <span class="kw">not</span> <span class="kw">in</span> band_data:</span>
<span id="cb61-489"><a href="#cb61-489" aria-hidden="true" tabindex="-1"></a>                        band_data.update({</span>
<span id="cb61-490"><a href="#cb61-490" aria-hidden="true" tabindex="-1"></a>                            <span class="st">'transform'</span>: transform,</span>
<span id="cb61-491"><a href="#cb61-491" aria-hidden="true" tabindex="-1"></a>                            <span class="st">'crs'</span>: src.crs,</span>
<span id="cb61-492"><a href="#cb61-492" aria-hidden="true" tabindex="-1"></a>                            <span class="st">'bounds'</span>: bounds,</span>
<span id="cb61-493"><a href="#cb61-493" aria-hidden="true" tabindex="-1"></a>                            <span class="st">'scene_id'</span>: item.<span class="bu">id</span>,</span>
<span id="cb61-494"><a href="#cb61-494" aria-hidden="true" tabindex="-1"></a>                            <span class="st">'date'</span>: item.properties[<span class="st">'datetime'</span>].split(<span class="st">'T'</span>)[<span class="dv">0</span>]</span>
<span id="cb61-495"><a href="#cb61-495" aria-hidden="true" tabindex="-1"></a>                        })</span>
<span id="cb61-496"><a href="#cb61-496" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb61-497"><a href="#cb61-497" aria-hidden="true" tabindex="-1"></a>                    successful_bands.append(band_name)</span>
<span id="cb61-498"><a href="#cb61-498" aria-hidden="true" tabindex="-1"></a>                    <span class="cf">break</span></span>
<span id="cb61-499"><a href="#cb61-499" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb61-500"><a href="#cb61-500" aria-hidden="true" tabindex="-1"></a>            <span class="cf">except</span> <span class="pp">Exception</span> <span class="im">as</span> e:</span>
<span id="cb61-501"><a href="#cb61-501" aria-hidden="true" tabindex="-1"></a>                <span class="cf">if</span> attempt <span class="op">&lt;</span> max_retries <span class="op">-</span> <span class="dv">1</span>:</span>
<span id="cb61-502"><a href="#cb61-502" aria-hidden="true" tabindex="-1"></a>                    time.sleep(<span class="dv">2</span> <span class="op">**</span> attempt)  <span class="co"># Exponential backoff</span></span>
<span id="cb61-503"><a href="#cb61-503" aria-hidden="true" tabindex="-1"></a>                    <span class="cf">continue</span></span>
<span id="cb61-504"><a href="#cb61-504" aria-hidden="true" tabindex="-1"></a>                <span class="cf">else</span>:</span>
<span id="cb61-505"><a href="#cb61-505" aria-hidden="true" tabindex="-1"></a>                    failed_bands.append(band_name)</span>
<span id="cb61-506"><a href="#cb61-506" aria-hidden="true" tabindex="-1"></a>                    logger.warning(<span class="ss">f"Failed to load band </span><span class="sc">{</span>band_name<span class="sc">}</span><span class="ss">: </span><span class="sc">{</span><span class="bu">str</span>(e)[:<span class="dv">50</span>]<span class="sc">}</span><span class="ss">"</span>)</span>
<span id="cb61-507"><a href="#cb61-507" aria-hidden="true" tabindex="-1"></a>                    <span class="cf">break</span></span>
<span id="cb61-508"><a href="#cb61-508" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb61-509"><a href="#cb61-509" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Validate results</span></span>
<span id="cb61-510"><a href="#cb61-510" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> <span class="bu">len</span>(successful_bands) <span class="op">==</span> <span class="dv">0</span>:</span>
<span id="cb61-511"><a href="#cb61-511" aria-hidden="true" tabindex="-1"></a>        <span class="cf">raise</span> <span class="pp">Exception</span>(<span class="ss">f"Failed to load any bands from scene </span><span class="sc">{</span>item<span class="sc">.</span><span class="bu">id</span><span class="sc">}</span><span class="ss">"</span>)</span>
<span id="cb61-512"><a href="#cb61-512" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb61-513"><a href="#cb61-513" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> failed_bands:</span>
<span id="cb61-514"><a href="#cb61-514" aria-hidden="true" tabindex="-1"></a>        logger.warning(<span class="ss">f"Failed to load </span><span class="sc">{</span><span class="bu">len</span>(failed_bands)<span class="sc">}</span><span class="ss"> bands: </span><span class="sc">{</span>failed_bands<span class="sc">}</span><span class="ss">"</span>)</span>
<span id="cb61-515"><a href="#cb61-515" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb61-516"><a href="#cb61-516" aria-hidden="true" tabindex="-1"></a>    logger.info(<span class="ss">f"Successfully loaded </span><span class="sc">{</span><span class="bu">len</span>(successful_bands)<span class="sc">}</span><span class="ss"> bands: </span><span class="sc">{</span>successful_bands<span class="sc">}</span><span class="ss">"</span>)</span>
<span id="cb61-517"><a href="#cb61-517" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> band_data</span>
<span id="cb61-518"><a href="#cb61-518" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb61-519"><a href="#cb61-519" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb61-520"><a href="#cb61-520" aria-hidden="true" tabindex="-1"></a>:::{.callout-note}</span>
<span id="cb61-521"><a href="#cb61-521" aria-hidden="true" tabindex="-1"></a><span class="fu">## Memory Management Best Practices</span></span>
<span id="cb61-522"><a href="#cb61-522" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb61-523"><a href="#cb61-523" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>**Use windowed reading** for large rasters to control memory usage</span>
<span id="cb61-524"><a href="#cb61-524" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>**Load bands on-demand** rather than all at once</span>
<span id="cb61-525"><a href="#cb61-525" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>**Implement progress monitoring** for user feedback during long operations</span>
<span id="cb61-526"><a href="#cb61-526" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>**Handle CRS transformations** automatically to ensure spatial consistency</span>
<span id="cb61-527"><a href="#cb61-527" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>**Cache georeferencing metadata** to avoid redundant I/O operations</span>
<span id="cb61-528"><a href="#cb61-528" aria-hidden="true" tabindex="-1"></a>:::</span>
<span id="cb61-529"><a href="#cb61-529" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb61-530"><a href="#cb61-530" aria-hidden="true" tabindex="-1"></a>---</span>
<span id="cb61-531"><a href="#cb61-531" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb61-532"><a href="#cb61-532" aria-hidden="true" tabindex="-1"></a><span class="fu">## Section 4: Scene Processing and Subsetting 📐</span></span>
<span id="cb61-533"><a href="#cb61-533" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb61-534"><a href="#cb61-534" aria-hidden="true" tabindex="-1"></a>:::{.callout-tip}</span>
<span id="cb61-535"><a href="#cb61-535" aria-hidden="true" tabindex="-1"></a><span class="fu">## Learning Objectives</span></span>
<span id="cb61-536"><a href="#cb61-536" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb61-537"><a href="#cb61-537" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>Master percentage-based spatial subsetting for reproducible analysis</span>
<span id="cb61-538"><a href="#cb61-538" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>Understand scene geometry and coordinate system implications</span>
<span id="cb61-539"><a href="#cb61-539" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>Design scalable spatial partitioning strategies</span>
<span id="cb61-540"><a href="#cb61-540" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>Implement adaptive processing based on scene characteristics</span>
<span id="cb61-541"><a href="#cb61-541" aria-hidden="true" tabindex="-1"></a>:::</span>
<span id="cb61-542"><a href="#cb61-542" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb61-543"><a href="#cb61-543" aria-hidden="true" tabindex="-1"></a><span class="fu">### Spatial Reasoning in Satellite Data Analysis</span></span>
<span id="cb61-544"><a href="#cb61-544" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb61-545"><a href="#cb61-545" aria-hidden="true" tabindex="-1"></a>Satellite scenes come in various sizes and projections, requiring intelligent spatial handling:</span>
<span id="cb61-546"><a href="#cb61-546" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb61-547"><a href="#cb61-547" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>**Percentage-Based Subsetting**: Resolution-independent spatial cropping</span>
<span id="cb61-548"><a href="#cb61-548" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>**Adaptive Processing**: Adjust strategies based on scene characteristics</span>
<span id="cb61-549"><a href="#cb61-549" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>**Spatial Metadata**: Consistent georeferencing across operations</span>
<span id="cb61-550"><a href="#cb61-550" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>**Tiling Strategies**: Partition large scenes for parallel processing</span>
<span id="cb61-551"><a href="#cb61-551" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb61-554"><a href="#cb61-554" aria-hidden="true" tabindex="-1"></a><span class="in">```{python}</span></span>
<span id="cb61-555"><a href="#cb61-555" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> get_subset_from_scene(</span>
<span id="cb61-556"><a href="#cb61-556" aria-hidden="true" tabindex="-1"></a>    item,</span>
<span id="cb61-557"><a href="#cb61-557" aria-hidden="true" tabindex="-1"></a>    x_range: Tuple[<span class="bu">float</span>, <span class="bu">float</span>] <span class="op">=</span> (<span class="dv">25</span>, <span class="dv">75</span>),</span>
<span id="cb61-558"><a href="#cb61-558" aria-hidden="true" tabindex="-1"></a>    y_range: Tuple[<span class="bu">float</span>, <span class="bu">float</span>] <span class="op">=</span> (<span class="dv">25</span>, <span class="dv">75</span>)</span>
<span id="cb61-559"><a href="#cb61-559" aria-hidden="true" tabindex="-1"></a>) <span class="op">-&gt;</span> List[<span class="bu">float</span>]:</span>
<span id="cb61-560"><a href="#cb61-560" aria-hidden="true" tabindex="-1"></a>    <span class="co">"""</span></span>
<span id="cb61-561"><a href="#cb61-561" aria-hidden="true" tabindex="-1"></a><span class="co">    Intelligent spatial subsetting using percentage-based coordinates.</span></span>
<span id="cb61-562"><a href="#cb61-562" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb61-563"><a href="#cb61-563" aria-hidden="true" tabindex="-1"></a><span class="co">    This approach provides several advantages:</span></span>
<span id="cb61-564"><a href="#cb61-564" aria-hidden="true" tabindex="-1"></a><span class="co">    1. Resolution Independence: Works regardless of scene size or pixel resolution</span></span>
<span id="cb61-565"><a href="#cb61-565" aria-hidden="true" tabindex="-1"></a><span class="co">    2. Reproducibility: Same percentage always gives same relative location</span></span>
<span id="cb61-566"><a href="#cb61-566" aria-hidden="true" tabindex="-1"></a><span class="co">    3. Scalability: Easy to create systematic grids for batch processing</span></span>
<span id="cb61-567"><a href="#cb61-567" aria-hidden="true" tabindex="-1"></a><span class="co">    4. Adaptability: Can adjust subset size based on scene characteristics</span></span>
<span id="cb61-568"><a href="#cb61-568" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb61-569"><a href="#cb61-569" aria-hidden="true" tabindex="-1"></a><span class="co">    Parameters</span></span>
<span id="cb61-570"><a href="#cb61-570" aria-hidden="true" tabindex="-1"></a><span class="co">    ----------</span></span>
<span id="cb61-571"><a href="#cb61-571" aria-hidden="true" tabindex="-1"></a><span class="co">    item : pystac.Item</span></span>
<span id="cb61-572"><a href="#cb61-572" aria-hidden="true" tabindex="-1"></a><span class="co">        STAC item containing scene geometry</span></span>
<span id="cb61-573"><a href="#cb61-573" aria-hidden="true" tabindex="-1"></a><span class="co">    x_range : Tuple[float, float]</span></span>
<span id="cb61-574"><a href="#cb61-574" aria-hidden="true" tabindex="-1"></a><span class="co">        Longitude percentage range (0-100)</span></span>
<span id="cb61-575"><a href="#cb61-575" aria-hidden="true" tabindex="-1"></a><span class="co">    y_range : Tuple[float, float]</span></span>
<span id="cb61-576"><a href="#cb61-576" aria-hidden="true" tabindex="-1"></a><span class="co">        Latitude percentage range (0-100)</span></span>
<span id="cb61-577"><a href="#cb61-577" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb61-578"><a href="#cb61-578" aria-hidden="true" tabindex="-1"></a><span class="co">    Returns</span></span>
<span id="cb61-579"><a href="#cb61-579" aria-hidden="true" tabindex="-1"></a><span class="co">    -------</span></span>
<span id="cb61-580"><a href="#cb61-580" aria-hidden="true" tabindex="-1"></a><span class="co">    List[float]</span></span>
<span id="cb61-581"><a href="#cb61-581" aria-hidden="true" tabindex="-1"></a><span class="co">        Subset bounding box [west, south, east, north] in WGS84</span></span>
<span id="cb61-582"><a href="#cb61-582" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb61-583"><a href="#cb61-583" aria-hidden="true" tabindex="-1"></a><span class="co">    Design Pattern: Template Method with Spatial Reasoning</span></span>
<span id="cb61-584"><a href="#cb61-584" aria-hidden="true" tabindex="-1"></a><span class="co">    - Provides consistent interface for varied spatial operations</span></span>
<span id="cb61-585"><a href="#cb61-585" aria-hidden="true" tabindex="-1"></a><span class="co">    - Encapsulates coordinate system complexity</span></span>
<span id="cb61-586"><a href="#cb61-586" aria-hidden="true" tabindex="-1"></a><span class="co">    - Enables systematic spatial sampling strategies</span></span>
<span id="cb61-587"><a href="#cb61-587" aria-hidden="true" tabindex="-1"></a><span class="co">    """</span></span>
<span id="cb61-588"><a href="#cb61-588" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Extract scene geometry from STAC metadata</span></span>
<span id="cb61-589"><a href="#cb61-589" aria-hidden="true" tabindex="-1"></a>    scene_bbox <span class="op">=</span> item.bbox  <span class="co"># [west, south, east, north]</span></span>
<span id="cb61-590"><a href="#cb61-590" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb61-591"><a href="#cb61-591" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Input validation for percentage ranges</span></span>
<span id="cb61-592"><a href="#cb61-592" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> <span class="kw">not</span> (<span class="dv">0</span> <span class="op">&lt;=</span> x_range[<span class="dv">0</span>] <span class="op">&lt;</span> x_range[<span class="dv">1</span>] <span class="op">&lt;=</span> <span class="dv">100</span>):</span>
<span id="cb61-593"><a href="#cb61-593" aria-hidden="true" tabindex="-1"></a>        <span class="cf">raise</span> <span class="pp">ValueError</span>(<span class="ss">f"Invalid x_range: </span><span class="sc">{</span>x_range<span class="sc">}</span><span class="ss">. Must be (min, max) with 0 &lt;= min &lt; max &lt;= 100"</span>)</span>
<span id="cb61-594"><a href="#cb61-594" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> <span class="kw">not</span> (<span class="dv">0</span> <span class="op">&lt;=</span> y_range[<span class="dv">0</span>] <span class="op">&lt;</span> y_range[<span class="dv">1</span>] <span class="op">&lt;=</span> <span class="dv">100</span>):</span>
<span id="cb61-595"><a href="#cb61-595" aria-hidden="true" tabindex="-1"></a>        <span class="cf">raise</span> <span class="pp">ValueError</span>(<span class="ss">f"Invalid y_range: </span><span class="sc">{</span>y_range<span class="sc">}</span><span class="ss">. Must be (min, max) with 0 &lt;= min &lt; max &lt;= 100"</span>)</span>
<span id="cb61-596"><a href="#cb61-596" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb61-597"><a href="#cb61-597" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Calculate scene dimensions in geographic coordinates</span></span>
<span id="cb61-598"><a href="#cb61-598" aria-hidden="true" tabindex="-1"></a>    scene_width <span class="op">=</span> scene_bbox[<span class="dv">2</span>] <span class="op">-</span> scene_bbox[<span class="dv">0</span>]   <span class="co"># east - west</span></span>
<span id="cb61-599"><a href="#cb61-599" aria-hidden="true" tabindex="-1"></a>    scene_height <span class="op">=</span> scene_bbox[<span class="dv">3</span>] <span class="op">-</span> scene_bbox[<span class="dv">1</span>]  <span class="co"># north - south</span></span>
<span id="cb61-600"><a href="#cb61-600" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb61-601"><a href="#cb61-601" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Convert percentages to geographic coordinates</span></span>
<span id="cb61-602"><a href="#cb61-602" aria-hidden="true" tabindex="-1"></a>    west <span class="op">=</span> scene_bbox[<span class="dv">0</span>] <span class="op">+</span> (x_range[<span class="dv">0</span>] <span class="op">/</span> <span class="fl">100.0</span>) <span class="op">*</span> scene_width</span>
<span id="cb61-603"><a href="#cb61-603" aria-hidden="true" tabindex="-1"></a>    east <span class="op">=</span> scene_bbox[<span class="dv">0</span>] <span class="op">+</span> (x_range[<span class="dv">1</span>] <span class="op">/</span> <span class="fl">100.0</span>) <span class="op">*</span> scene_width</span>
<span id="cb61-604"><a href="#cb61-604" aria-hidden="true" tabindex="-1"></a>    south <span class="op">=</span> scene_bbox[<span class="dv">1</span>] <span class="op">+</span> (y_range[<span class="dv">0</span>] <span class="op">/</span> <span class="fl">100.0</span>) <span class="op">*</span> scene_height</span>
<span id="cb61-605"><a href="#cb61-605" aria-hidden="true" tabindex="-1"></a>    north <span class="op">=</span> scene_bbox[<span class="dv">1</span>] <span class="op">+</span> (y_range[<span class="dv">1</span>] <span class="op">/</span> <span class="fl">100.0</span>) <span class="op">*</span> scene_height</span>
<span id="cb61-606"><a href="#cb61-606" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb61-607"><a href="#cb61-607" aria-hidden="true" tabindex="-1"></a>    subset_bbox <span class="op">=</span> [west, south, east, north]</span>
<span id="cb61-608"><a href="#cb61-608" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb61-609"><a href="#cb61-609" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Calculate subset metrics for reporting</span></span>
<span id="cb61-610"><a href="#cb61-610" aria-hidden="true" tabindex="-1"></a>    subset_area_percent <span class="op">=</span> ((x_range[<span class="dv">1</span>] <span class="op">-</span> x_range[<span class="dv">0</span>]) <span class="op">*</span> (y_range[<span class="dv">1</span>] <span class="op">-</span> y_range[<span class="dv">0</span>])) <span class="op">/</span> <span class="fl">100.0</span></span>
<span id="cb61-611"><a href="#cb61-611" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb61-612"><a href="#cb61-612" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="ss">f"📐 Calculated subset from scene bounds:"</span>)</span>
<span id="cb61-613"><a href="#cb61-613" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="ss">f"   Scene bbox: [</span><span class="sc">{</span>scene_bbox[<span class="dv">0</span>]<span class="sc">:.4f}</span><span class="ss">, </span><span class="sc">{</span>scene_bbox[<span class="dv">1</span>]<span class="sc">:.4f}</span><span class="ss">, </span><span class="sc">{</span>scene_bbox[<span class="dv">2</span>]<span class="sc">:.4f}</span><span class="ss">, </span><span class="sc">{</span>scene_bbox[<span class="dv">3</span>]<span class="sc">:.4f}</span><span class="ss">]"</span>)</span>
<span id="cb61-614"><a href="#cb61-614" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="ss">f"   Subset bbox: [</span><span class="sc">{</span>west<span class="sc">:.4f}</span><span class="ss">, </span><span class="sc">{</span>south<span class="sc">:.4f}</span><span class="ss">, </span><span class="sc">{</span>east<span class="sc">:.4f}</span><span class="ss">, </span><span class="sc">{</span>north<span class="sc">:.4f}</span><span class="ss">]"</span>)</span>
<span id="cb61-615"><a href="#cb61-615" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="ss">f"   X range: </span><span class="sc">{</span>x_range[<span class="dv">0</span>]<span class="sc">}</span><span class="ss">%-</span><span class="sc">{</span>x_range[<span class="dv">1</span>]<span class="sc">}</span><span class="ss">%, Y range: </span><span class="sc">{</span>y_range[<span class="dv">0</span>]<span class="sc">}</span><span class="ss">%-</span><span class="sc">{</span>y_range[<span class="dv">1</span>]<span class="sc">}</span><span class="ss">%"</span>)</span>
<span id="cb61-616"><a href="#cb61-616" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="ss">f"   Subset area: </span><span class="sc">{</span>subset_area_percent<span class="sc">:.1f}</span><span class="ss">% of original scene"</span>)</span>
<span id="cb61-617"><a href="#cb61-617" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb61-618"><a href="#cb61-618" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> subset_bbox</span>
<span id="cb61-619"><a href="#cb61-619" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb61-620"><a href="#cb61-620" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> get_scene_info(item):</span>
<span id="cb61-621"><a href="#cb61-621" aria-hidden="true" tabindex="-1"></a>    <span class="co">"""</span></span>
<span id="cb61-622"><a href="#cb61-622" aria-hidden="true" tabindex="-1"></a><span class="co">    Extract comprehensive scene characteristics for adaptive processing.</span></span>
<span id="cb61-623"><a href="#cb61-623" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb61-624"><a href="#cb61-624" aria-hidden="true" tabindex="-1"></a><span class="co">    Parameters</span></span>
<span id="cb61-625"><a href="#cb61-625" aria-hidden="true" tabindex="-1"></a><span class="co">    ----------</span></span>
<span id="cb61-626"><a href="#cb61-626" aria-hidden="true" tabindex="-1"></a><span class="co">    item : pystac.Item</span></span>
<span id="cb61-627"><a href="#cb61-627" aria-hidden="true" tabindex="-1"></a><span class="co">        STAC item to analyze</span></span>
<span id="cb61-628"><a href="#cb61-628" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb61-629"><a href="#cb61-629" aria-hidden="true" tabindex="-1"></a><span class="co">    Returns</span></span>
<span id="cb61-630"><a href="#cb61-630" aria-hidden="true" tabindex="-1"></a><span class="co">    -------</span></span>
<span id="cb61-631"><a href="#cb61-631" aria-hidden="true" tabindex="-1"></a><span class="co">    Dict</span></span>
<span id="cb61-632"><a href="#cb61-632" aria-hidden="true" tabindex="-1"></a><span class="co">        Scene characteristics including dimensions and geographic metrics</span></span>
<span id="cb61-633"><a href="#cb61-633" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb61-634"><a href="#cb61-634" aria-hidden="true" tabindex="-1"></a><span class="co">    Design Pattern: Information Expert</span></span>
<span id="cb61-635"><a href="#cb61-635" aria-hidden="true" tabindex="-1"></a><span class="co">    - Centralizes scene analysis logic</span></span>
<span id="cb61-636"><a href="#cb61-636" aria-hidden="true" tabindex="-1"></a><span class="co">    - Provides basis for adaptive processing decisions</span></span>
<span id="cb61-637"><a href="#cb61-637" aria-hidden="true" tabindex="-1"></a><span class="co">    - Enables consistent scene characterization across workflows</span></span>
<span id="cb61-638"><a href="#cb61-638" aria-hidden="true" tabindex="-1"></a><span class="co">    """</span></span>
<span id="cb61-639"><a href="#cb61-639" aria-hidden="true" tabindex="-1"></a>    bbox <span class="op">=</span> item.bbox</span>
<span id="cb61-640"><a href="#cb61-640" aria-hidden="true" tabindex="-1"></a>    width_deg <span class="op">=</span> bbox[<span class="dv">2</span>] <span class="op">-</span> bbox[<span class="dv">0</span>]</span>
<span id="cb61-641"><a href="#cb61-641" aria-hidden="true" tabindex="-1"></a>    height_deg <span class="op">=</span> bbox[<span class="dv">3</span>] <span class="op">-</span> bbox[<span class="dv">1</span>]</span>
<span id="cb61-642"><a href="#cb61-642" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb61-643"><a href="#cb61-643" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Approximate conversion to kilometers (suitable for most latitudes)</span></span>
<span id="cb61-644"><a href="#cb61-644" aria-hidden="true" tabindex="-1"></a>    center_lat <span class="op">=</span> (bbox[<span class="dv">1</span>] <span class="op">+</span> bbox[<span class="dv">3</span>]) <span class="op">/</span> <span class="dv">2</span></span>
<span id="cb61-645"><a href="#cb61-645" aria-hidden="true" tabindex="-1"></a>    width_km <span class="op">=</span> width_deg <span class="op">*</span> <span class="dv">111</span> <span class="op">*</span> np.cos(np.radians(center_lat))</span>
<span id="cb61-646"><a href="#cb61-646" aria-hidden="true" tabindex="-1"></a>    height_km <span class="op">=</span> height_deg <span class="op">*</span> <span class="dv">111</span></span>
<span id="cb61-647"><a href="#cb61-647" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb61-648"><a href="#cb61-648" aria-hidden="true" tabindex="-1"></a>    info <span class="op">=</span> {</span>
<span id="cb61-649"><a href="#cb61-649" aria-hidden="true" tabindex="-1"></a>        <span class="st">'scene_id'</span>: item.<span class="bu">id</span>,</span>
<span id="cb61-650"><a href="#cb61-650" aria-hidden="true" tabindex="-1"></a>        <span class="st">'date'</span>: item.properties[<span class="st">'datetime'</span>].split(<span class="st">'T'</span>)[<span class="dv">0</span>],</span>
<span id="cb61-651"><a href="#cb61-651" aria-hidden="true" tabindex="-1"></a>        <span class="st">'bbox'</span>: bbox,</span>
<span id="cb61-652"><a href="#cb61-652" aria-hidden="true" tabindex="-1"></a>        <span class="st">'width_deg'</span>: width_deg,</span>
<span id="cb61-653"><a href="#cb61-653" aria-hidden="true" tabindex="-1"></a>        <span class="st">'height_deg'</span>: height_deg,</span>
<span id="cb61-654"><a href="#cb61-654" aria-hidden="true" tabindex="-1"></a>        <span class="st">'width_km'</span>: width_km,</span>
<span id="cb61-655"><a href="#cb61-655" aria-hidden="true" tabindex="-1"></a>        <span class="st">'height_km'</span>: height_km,</span>
<span id="cb61-656"><a href="#cb61-656" aria-hidden="true" tabindex="-1"></a>        <span class="st">'area_km2'</span>: width_km <span class="op">*</span> height_km,</span>
<span id="cb61-657"><a href="#cb61-657" aria-hidden="true" tabindex="-1"></a>        <span class="st">'center_lat'</span>: center_lat,</span>
<span id="cb61-658"><a href="#cb61-658" aria-hidden="true" tabindex="-1"></a>        <span class="st">'center_lon'</span>: (bbox[<span class="dv">0</span>] <span class="op">+</span> bbox[<span class="dv">2</span>]) <span class="op">/</span> <span class="dv">2</span></span>
<span id="cb61-659"><a href="#cb61-659" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb61-660"><a href="#cb61-660" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb61-661"><a href="#cb61-661" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> info</span>
<span id="cb61-662"><a href="#cb61-662" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb61-663"><a href="#cb61-663" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"✅ Scene processing and subsetting functions ready"</span>)</span>
<span id="cb61-664"><a href="#cb61-664" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb61-665"><a href="#cb61-665" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb61-666"><a href="#cb61-666" aria-hidden="true" tabindex="-1"></a>:::{.callout-note}</span>
<span id="cb61-667"><a href="#cb61-667" aria-hidden="true" tabindex="-1"></a><span class="fu">## Spatial Processing Design Patterns</span></span>
<span id="cb61-668"><a href="#cb61-668" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb61-669"><a href="#cb61-669" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>**Percentage-based coordinates** provide resolution independence</span>
<span id="cb61-670"><a href="#cb61-670" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>**Adaptive processing** adjusts strategies based on scene size</span>
<span id="cb61-671"><a href="#cb61-671" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>**Systematic spatial sampling** enables reproducible analysis</span>
<span id="cb61-672"><a href="#cb61-672" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>**Geographic metrics** support intelligent subset sizing decisions</span>
<span id="cb61-673"><a href="#cb61-673" aria-hidden="true" tabindex="-1"></a>:::</span>
<span id="cb61-674"><a href="#cb61-674" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb61-675"><a href="#cb61-675" aria-hidden="true" tabindex="-1"></a>---</span>
<span id="cb61-676"><a href="#cb61-676" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb61-677"><a href="#cb61-677" aria-hidden="true" tabindex="-1"></a><span class="fu">## Section 5: Data Processing Pipelines 🔬</span></span>
<span id="cb61-678"><a href="#cb61-678" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb61-679"><a href="#cb61-679" aria-hidden="true" tabindex="-1"></a>:::{.callout-tip}</span>
<span id="cb61-680"><a href="#cb61-680" aria-hidden="true" tabindex="-1"></a><span class="fu">## Learning Objectives</span></span>
<span id="cb61-681"><a href="#cb61-681" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb61-682"><a href="#cb61-682" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>Master spectral analysis and vegetation index calculations</span>
<span id="cb61-683"><a href="#cb61-683" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>Implement robust statistical analysis with error handling</span>
<span id="cb61-684"><a href="#cb61-684" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>Design composable processing functions for workflow flexibility</span>
<span id="cb61-685"><a href="#cb61-685" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>Understand radiometric enhancement techniques for visualization</span>
<span id="cb61-686"><a href="#cb61-686" aria-hidden="true" tabindex="-1"></a>:::</span>
<span id="cb61-687"><a href="#cb61-687" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb61-688"><a href="#cb61-688" aria-hidden="true" tabindex="-1"></a><span class="fu">### Spectral Analysis Fundamentals</span></span>
<span id="cb61-689"><a href="#cb61-689" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb61-690"><a href="#cb61-690" aria-hidden="true" tabindex="-1"></a>Satellite sensors capture electromagnetic radiation across multiple spectral bands, enabling sophisticated analysis:</span>
<span id="cb61-691"><a href="#cb61-691" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb61-692"><a href="#cb61-692" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>**Radiometric Enhancement**: Optimize visual representation of spectral data</span>
<span id="cb61-693"><a href="#cb61-693" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>**Vegetation Indices**: Combine bands to highlight biological activity</span>
<span id="cb61-694"><a href="#cb61-694" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>**Statistical Analysis**: Characterize data distributions and quality</span>
<span id="cb61-695"><a href="#cb61-695" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>**Composable Functions**: Build complex workflows from simple operations</span>
<span id="cb61-696"><a href="#cb61-696" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb61-699"><a href="#cb61-699" aria-hidden="true" tabindex="-1"></a><span class="in">```{python}</span></span>
<span id="cb61-700"><a href="#cb61-700" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> normalize_band(</span>
<span id="cb61-701"><a href="#cb61-701" aria-hidden="true" tabindex="-1"></a>    band: np.ndarray,</span>
<span id="cb61-702"><a href="#cb61-702" aria-hidden="true" tabindex="-1"></a>    percentiles: Tuple[<span class="bu">float</span>, <span class="bu">float</span>] <span class="op">=</span> (<span class="dv">2</span>, <span class="dv">98</span>),</span>
<span id="cb61-703"><a href="#cb61-703" aria-hidden="true" tabindex="-1"></a>    clip: <span class="bu">bool</span> <span class="op">=</span> <span class="va">True</span></span>
<span id="cb61-704"><a href="#cb61-704" aria-hidden="true" tabindex="-1"></a>) <span class="op">-&gt;</span> np.ndarray:</span>
<span id="cb61-705"><a href="#cb61-705" aria-hidden="true" tabindex="-1"></a>    <span class="co">"""</span></span>
<span id="cb61-706"><a href="#cb61-706" aria-hidden="true" tabindex="-1"></a><span class="co">    Percentile-based radiometric enhancement for optimal visualization.</span></span>
<span id="cb61-707"><a href="#cb61-707" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb61-708"><a href="#cb61-708" aria-hidden="true" tabindex="-1"></a><span class="co">    This normalization approach addresses several challenges:</span></span>
<span id="cb61-709"><a href="#cb61-709" aria-hidden="true" tabindex="-1"></a><span class="co">    1. Dynamic Range: Raw satellite data often has poor contrast</span></span>
<span id="cb61-710"><a href="#cb61-710" aria-hidden="true" tabindex="-1"></a><span class="co">    2. Outlier Robustness: Percentiles ignore extreme values</span></span>
<span id="cb61-711"><a href="#cb61-711" aria-hidden="true" tabindex="-1"></a><span class="co">    3. Visual Optimization: Results in pleasing, interpretable images</span></span>
<span id="cb61-712"><a href="#cb61-712" aria-hidden="true" tabindex="-1"></a><span class="co">    4. Statistical Validity: Preserves relative data relationships</span></span>
<span id="cb61-713"><a href="#cb61-713" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb61-714"><a href="#cb61-714" aria-hidden="true" tabindex="-1"></a><span class="co">    Parameters</span></span>
<span id="cb61-715"><a href="#cb61-715" aria-hidden="true" tabindex="-1"></a><span class="co">    ----------</span></span>
<span id="cb61-716"><a href="#cb61-716" aria-hidden="true" tabindex="-1"></a><span class="co">    band : np.ndarray</span></span>
<span id="cb61-717"><a href="#cb61-717" aria-hidden="true" tabindex="-1"></a><span class="co">        Raw satellite band values</span></span>
<span id="cb61-718"><a href="#cb61-718" aria-hidden="true" tabindex="-1"></a><span class="co">    percentiles : Tuple[float, float]</span></span>
<span id="cb61-719"><a href="#cb61-719" aria-hidden="true" tabindex="-1"></a><span class="co">        Lower and upper percentiles for stretching</span></span>
<span id="cb61-720"><a href="#cb61-720" aria-hidden="true" tabindex="-1"></a><span class="co">    clip : bool</span></span>
<span id="cb61-721"><a href="#cb61-721" aria-hidden="true" tabindex="-1"></a><span class="co">        Whether to clip values to [0, 1] range</span></span>
<span id="cb61-722"><a href="#cb61-722" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb61-723"><a href="#cb61-723" aria-hidden="true" tabindex="-1"></a><span class="co">    Returns</span></span>
<span id="cb61-724"><a href="#cb61-724" aria-hidden="true" tabindex="-1"></a><span class="co">    -------</span></span>
<span id="cb61-725"><a href="#cb61-725" aria-hidden="true" tabindex="-1"></a><span class="co">    np.ndarray</span></span>
<span id="cb61-726"><a href="#cb61-726" aria-hidden="true" tabindex="-1"></a><span class="co">        Normalized band values optimized for visualization</span></span>
<span id="cb61-727"><a href="#cb61-727" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb61-728"><a href="#cb61-728" aria-hidden="true" tabindex="-1"></a><span class="co">    Design Pattern: Strategy Pattern for Enhancement</span></span>
<span id="cb61-729"><a href="#cb61-729" aria-hidden="true" tabindex="-1"></a><span class="co">    - Encapsulates different enhancement algorithms</span></span>
<span id="cb61-730"><a href="#cb61-730" aria-hidden="true" tabindex="-1"></a><span class="co">    - Provides consistent interface for various normalization strategies</span></span>
<span id="cb61-731"><a href="#cb61-731" aria-hidden="true" tabindex="-1"></a><span class="co">    - Handles edge cases (NaN, infinite values) robustly</span></span>
<span id="cb61-732"><a href="#cb61-732" aria-hidden="true" tabindex="-1"></a><span class="co">    """</span></span>
<span id="cb61-733"><a href="#cb61-733" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Handle NaN and infinite values robustly</span></span>
<span id="cb61-734"><a href="#cb61-734" aria-hidden="true" tabindex="-1"></a>    valid_mask <span class="op">=</span> np.isfinite(band)</span>
<span id="cb61-735"><a href="#cb61-735" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> <span class="kw">not</span> np.<span class="bu">any</span>(valid_mask):</span>
<span id="cb61-736"><a href="#cb61-736" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> np.zeros_like(band)</span>
<span id="cb61-737"><a href="#cb61-737" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb61-738"><a href="#cb61-738" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Calculate percentiles on valid data only</span></span>
<span id="cb61-739"><a href="#cb61-739" aria-hidden="true" tabindex="-1"></a>    p_low, p_high <span class="op">=</span> np.percentile(band[valid_mask], percentiles)</span>
<span id="cb61-740"><a href="#cb61-740" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb61-741"><a href="#cb61-741" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Avoid division by zero</span></span>
<span id="cb61-742"><a href="#cb61-742" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> p_high <span class="op">==</span> p_low:</span>
<span id="cb61-743"><a href="#cb61-743" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> np.zeros_like(band)</span>
<span id="cb61-744"><a href="#cb61-744" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb61-745"><a href="#cb61-745" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Linear stretch based on percentiles</span></span>
<span id="cb61-746"><a href="#cb61-746" aria-hidden="true" tabindex="-1"></a>    normalized <span class="op">=</span> (band <span class="op">-</span> p_low) <span class="op">/</span> (p_high <span class="op">-</span> p_low)</span>
<span id="cb61-747"><a href="#cb61-747" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb61-748"><a href="#cb61-748" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Optional clipping to [0, 1] range</span></span>
<span id="cb61-749"><a href="#cb61-749" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> clip:</span>
<span id="cb61-750"><a href="#cb61-750" aria-hidden="true" tabindex="-1"></a>        normalized <span class="op">=</span> np.clip(normalized, <span class="dv">0</span>, <span class="dv">1</span>)</span>
<span id="cb61-751"><a href="#cb61-751" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb61-752"><a href="#cb61-752" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> normalized</span>
<span id="cb61-753"><a href="#cb61-753" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb61-754"><a href="#cb61-754" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> create_rgb_composite(</span>
<span id="cb61-755"><a href="#cb61-755" aria-hidden="true" tabindex="-1"></a>    red: np.ndarray,</span>
<span id="cb61-756"><a href="#cb61-756" aria-hidden="true" tabindex="-1"></a>    green: np.ndarray,</span>
<span id="cb61-757"><a href="#cb61-757" aria-hidden="true" tabindex="-1"></a>    blue: np.ndarray,</span>
<span id="cb61-758"><a href="#cb61-758" aria-hidden="true" tabindex="-1"></a>    enhance: <span class="bu">bool</span> <span class="op">=</span> <span class="va">True</span></span>
<span id="cb61-759"><a href="#cb61-759" aria-hidden="true" tabindex="-1"></a>) <span class="op">-&gt;</span> np.ndarray:</span>
<span id="cb61-760"><a href="#cb61-760" aria-hidden="true" tabindex="-1"></a>    <span class="co">"""</span></span>
<span id="cb61-761"><a href="#cb61-761" aria-hidden="true" tabindex="-1"></a><span class="co">    Create publication-quality RGB composite images.</span></span>
<span id="cb61-762"><a href="#cb61-762" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb61-763"><a href="#cb61-763" aria-hidden="true" tabindex="-1"></a><span class="co">    Parameters</span></span>
<span id="cb61-764"><a href="#cb61-764" aria-hidden="true" tabindex="-1"></a><span class="co">    ----------</span></span>
<span id="cb61-765"><a href="#cb61-765" aria-hidden="true" tabindex="-1"></a><span class="co">    red, green, blue : np.ndarray</span></span>
<span id="cb61-766"><a href="#cb61-766" aria-hidden="true" tabindex="-1"></a><span class="co">        Individual spectral bands</span></span>
<span id="cb61-767"><a href="#cb61-767" aria-hidden="true" tabindex="-1"></a><span class="co">    enhance : bool</span></span>
<span id="cb61-768"><a href="#cb61-768" aria-hidden="true" tabindex="-1"></a><span class="co">        Apply automatic contrast enhancement</span></span>
<span id="cb61-769"><a href="#cb61-769" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb61-770"><a href="#cb61-770" aria-hidden="true" tabindex="-1"></a><span class="co">    Returns</span></span>
<span id="cb61-771"><a href="#cb61-771" aria-hidden="true" tabindex="-1"></a><span class="co">    -------</span></span>
<span id="cb61-772"><a href="#cb61-772" aria-hidden="true" tabindex="-1"></a><span class="co">    np.ndarray</span></span>
<span id="cb61-773"><a href="#cb61-773" aria-hidden="true" tabindex="-1"></a><span class="co">        RGB composite with shape (height, width, 3)</span></span>
<span id="cb61-774"><a href="#cb61-774" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb61-775"><a href="#cb61-775" aria-hidden="true" tabindex="-1"></a><span class="co">    Design Pattern: Composite Pattern for Multi-band Operations</span></span>
<span id="cb61-776"><a href="#cb61-776" aria-hidden="true" tabindex="-1"></a><span class="co">    - Combines multiple bands into unified representation</span></span>
<span id="cb61-777"><a href="#cb61-777" aria-hidden="true" tabindex="-1"></a><span class="co">    - Applies consistent enhancement across all channels</span></span>
<span id="cb61-778"><a href="#cb61-778" aria-hidden="true" tabindex="-1"></a><span class="co">    - Produces standard format for visualization libraries</span></span>
<span id="cb61-779"><a href="#cb61-779" aria-hidden="true" tabindex="-1"></a><span class="co">    """</span></span>
<span id="cb61-780"><a href="#cb61-780" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Apply enhancement to each channel</span></span>
<span id="cb61-781"><a href="#cb61-781" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> enhance:</span>
<span id="cb61-782"><a href="#cb61-782" aria-hidden="true" tabindex="-1"></a>        red_norm <span class="op">=</span> normalize_band(red)</span>
<span id="cb61-783"><a href="#cb61-783" aria-hidden="true" tabindex="-1"></a>        green_norm <span class="op">=</span> normalize_band(green)</span>
<span id="cb61-784"><a href="#cb61-784" aria-hidden="true" tabindex="-1"></a>        blue_norm <span class="op">=</span> normalize_band(blue)</span>
<span id="cb61-785"><a href="#cb61-785" aria-hidden="true" tabindex="-1"></a>    <span class="cf">else</span>:</span>
<span id="cb61-786"><a href="#cb61-786" aria-hidden="true" tabindex="-1"></a>        <span class="co"># Simple linear scaling</span></span>
<span id="cb61-787"><a href="#cb61-787" aria-hidden="true" tabindex="-1"></a>        red_norm <span class="op">=</span> red <span class="op">/</span> np.<span class="bu">max</span>(red) <span class="cf">if</span> np.<span class="bu">max</span>(red) <span class="op">&gt;</span> <span class="dv">0</span> <span class="cf">else</span> red</span>
<span id="cb61-788"><a href="#cb61-788" aria-hidden="true" tabindex="-1"></a>        green_norm <span class="op">=</span> green <span class="op">/</span> np.<span class="bu">max</span>(green) <span class="cf">if</span> np.<span class="bu">max</span>(green) <span class="op">&gt;</span> <span class="dv">0</span> <span class="cf">else</span> green</span>
<span id="cb61-789"><a href="#cb61-789" aria-hidden="true" tabindex="-1"></a>        blue_norm <span class="op">=</span> blue <span class="op">/</span> np.<span class="bu">max</span>(blue) <span class="cf">if</span> np.<span class="bu">max</span>(blue) <span class="op">&gt;</span> <span class="dv">0</span> <span class="cf">else</span> blue</span>
<span id="cb61-790"><a href="#cb61-790" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb61-791"><a href="#cb61-791" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Stack into RGB composite</span></span>
<span id="cb61-792"><a href="#cb61-792" aria-hidden="true" tabindex="-1"></a>    rgb_composite <span class="op">=</span> np.dstack([red_norm, green_norm, blue_norm])</span>
<span id="cb61-793"><a href="#cb61-793" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb61-794"><a href="#cb61-794" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> rgb_composite</span>
<span id="cb61-795"><a href="#cb61-795" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb61-796"><a href="#cb61-796" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> calculate_ndvi(</span>
<span id="cb61-797"><a href="#cb61-797" aria-hidden="true" tabindex="-1"></a>    nir: np.ndarray,</span>
<span id="cb61-798"><a href="#cb61-798" aria-hidden="true" tabindex="-1"></a>    red: np.ndarray,</span>
<span id="cb61-799"><a href="#cb61-799" aria-hidden="true" tabindex="-1"></a>    epsilon: <span class="bu">float</span> <span class="op">=</span> <span class="fl">1e-8</span></span>
<span id="cb61-800"><a href="#cb61-800" aria-hidden="true" tabindex="-1"></a>) <span class="op">-&gt;</span> np.ndarray:</span>
<span id="cb61-801"><a href="#cb61-801" aria-hidden="true" tabindex="-1"></a>    <span class="co">"""</span></span>
<span id="cb61-802"><a href="#cb61-802" aria-hidden="true" tabindex="-1"></a><span class="co">    Calculate Normalized Difference Vegetation Index with robust error handling.</span></span>
<span id="cb61-803"><a href="#cb61-803" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb61-804"><a href="#cb61-804" aria-hidden="true" tabindex="-1"></a><span class="co">    NDVI = (NIR - Red) / (NIR + Red)</span></span>
<span id="cb61-805"><a href="#cb61-805" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb61-806"><a href="#cb61-806" aria-hidden="true" tabindex="-1"></a><span class="co">    NDVI is fundamental to vegetation monitoring because:</span></span>
<span id="cb61-807"><a href="#cb61-807" aria-hidden="true" tabindex="-1"></a><span class="co">    1. Physical Basis: Reflects chlorophyll absorption and cellular structure</span></span>
<span id="cb61-808"><a href="#cb61-808" aria-hidden="true" tabindex="-1"></a><span class="co">    2. Standardization: Normalized to [-1, 1] range for comparison</span></span>
<span id="cb61-809"><a href="#cb61-809" aria-hidden="true" tabindex="-1"></a><span class="co">    3. Temporal Stability: Enables change detection across seasons/years</span></span>
<span id="cb61-810"><a href="#cb61-810" aria-hidden="true" tabindex="-1"></a><span class="co">    4. Ecological Meaning: Strong correlation with biomass and health</span></span>
<span id="cb61-811"><a href="#cb61-811" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb61-812"><a href="#cb61-812" aria-hidden="true" tabindex="-1"></a><span class="co">    Parameters</span></span>
<span id="cb61-813"><a href="#cb61-813" aria-hidden="true" tabindex="-1"></a><span class="co">    ----------</span></span>
<span id="cb61-814"><a href="#cb61-814" aria-hidden="true" tabindex="-1"></a><span class="co">    nir : np.ndarray</span></span>
<span id="cb61-815"><a href="#cb61-815" aria-hidden="true" tabindex="-1"></a><span class="co">        Near-infrared reflectance (Band 8: 842nm)</span></span>
<span id="cb61-816"><a href="#cb61-816" aria-hidden="true" tabindex="-1"></a><span class="co">    red : np.ndarray</span></span>
<span id="cb61-817"><a href="#cb61-817" aria-hidden="true" tabindex="-1"></a><span class="co">        Red reflectance (Band 4: 665nm)</span></span>
<span id="cb61-818"><a href="#cb61-818" aria-hidden="true" tabindex="-1"></a><span class="co">    epsilon : float</span></span>
<span id="cb61-819"><a href="#cb61-819" aria-hidden="true" tabindex="-1"></a><span class="co">        Numerical stability constant</span></span>
<span id="cb61-820"><a href="#cb61-820" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb61-821"><a href="#cb61-821" aria-hidden="true" tabindex="-1"></a><span class="co">    Returns</span></span>
<span id="cb61-822"><a href="#cb61-822" aria-hidden="true" tabindex="-1"></a><span class="co">    -------</span></span>
<span id="cb61-823"><a href="#cb61-823" aria-hidden="true" tabindex="-1"></a><span class="co">    np.ndarray</span></span>
<span id="cb61-824"><a href="#cb61-824" aria-hidden="true" tabindex="-1"></a><span class="co">        NDVI values in range [-1, 1]</span></span>
<span id="cb61-825"><a href="#cb61-825" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb61-826"><a href="#cb61-826" aria-hidden="true" tabindex="-1"></a><span class="co">    Design Pattern: Domain-Specific Language for Spectral Indices</span></span>
<span id="cb61-827"><a href="#cb61-827" aria-hidden="true" tabindex="-1"></a><span class="co">    - Encapsulates spectral physics knowledge</span></span>
<span id="cb61-828"><a href="#cb61-828" aria-hidden="true" tabindex="-1"></a><span class="co">    - Provides numerical stability for edge cases</span></span>
<span id="cb61-829"><a href="#cb61-829" aria-hidden="true" tabindex="-1"></a><span class="co">    - Enables consistent index calculation across projects</span></span>
<span id="cb61-830"><a href="#cb61-830" aria-hidden="true" tabindex="-1"></a><span class="co">    """</span></span>
<span id="cb61-831"><a href="#cb61-831" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Convert to float for numerical precision</span></span>
<span id="cb61-832"><a href="#cb61-832" aria-hidden="true" tabindex="-1"></a>    nir_float <span class="op">=</span> nir.astype(np.float32)</span>
<span id="cb61-833"><a href="#cb61-833" aria-hidden="true" tabindex="-1"></a>    red_float <span class="op">=</span> red.astype(np.float32)</span>
<span id="cb61-834"><a href="#cb61-834" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb61-835"><a href="#cb61-835" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Calculate NDVI with numerical stability</span></span>
<span id="cb61-836"><a href="#cb61-836" aria-hidden="true" tabindex="-1"></a>    numerator <span class="op">=</span> nir_float <span class="op">-</span> red_float</span>
<span id="cb61-837"><a href="#cb61-837" aria-hidden="true" tabindex="-1"></a>    denominator <span class="op">=</span> nir_float <span class="op">+</span> red_float <span class="op">+</span> epsilon</span>
<span id="cb61-838"><a href="#cb61-838" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb61-839"><a href="#cb61-839" aria-hidden="true" tabindex="-1"></a>    ndvi <span class="op">=</span> numerator <span class="op">/</span> denominator</span>
<span id="cb61-840"><a href="#cb61-840" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb61-841"><a href="#cb61-841" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Handle edge cases (both bands zero, etc.)</span></span>
<span id="cb61-842"><a href="#cb61-842" aria-hidden="true" tabindex="-1"></a>    ndvi <span class="op">=</span> np.where(np.isfinite(ndvi), ndvi, <span class="dv">0</span>)</span>
<span id="cb61-843"><a href="#cb61-843" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb61-844"><a href="#cb61-844" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> ndvi</span>
<span id="cb61-845"><a href="#cb61-845" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb61-846"><a href="#cb61-846" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> calculate_band_statistics(band: np.ndarray, name: <span class="bu">str</span> <span class="op">=</span> <span class="st">"Band"</span>) <span class="op">-&gt;</span> Dict:</span>
<span id="cb61-847"><a href="#cb61-847" aria-hidden="true" tabindex="-1"></a>    <span class="co">"""</span></span>
<span id="cb61-848"><a href="#cb61-848" aria-hidden="true" tabindex="-1"></a><span class="co">    Comprehensive statistical characterization of satellite bands.</span></span>
<span id="cb61-849"><a href="#cb61-849" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb61-850"><a href="#cb61-850" aria-hidden="true" tabindex="-1"></a><span class="co">    Parameters</span></span>
<span id="cb61-851"><a href="#cb61-851" aria-hidden="true" tabindex="-1"></a><span class="co">    ----------</span></span>
<span id="cb61-852"><a href="#cb61-852" aria-hidden="true" tabindex="-1"></a><span class="co">    band : np.ndarray</span></span>
<span id="cb61-853"><a href="#cb61-853" aria-hidden="true" tabindex="-1"></a><span class="co">        Input band array</span></span>
<span id="cb61-854"><a href="#cb61-854" aria-hidden="true" tabindex="-1"></a><span class="co">    name : str</span></span>
<span id="cb61-855"><a href="#cb61-855" aria-hidden="true" tabindex="-1"></a><span class="co">        Descriptive name for reporting</span></span>
<span id="cb61-856"><a href="#cb61-856" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb61-857"><a href="#cb61-857" aria-hidden="true" tabindex="-1"></a><span class="co">    Returns</span></span>
<span id="cb61-858"><a href="#cb61-858" aria-hidden="true" tabindex="-1"></a><span class="co">    -------</span></span>
<span id="cb61-859"><a href="#cb61-859" aria-hidden="true" tabindex="-1"></a><span class="co">    Dict</span></span>
<span id="cb61-860"><a href="#cb61-860" aria-hidden="true" tabindex="-1"></a><span class="co">        Complete statistical summary including percentiles and counts</span></span>
<span id="cb61-861"><a href="#cb61-861" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb61-862"><a href="#cb61-862" aria-hidden="true" tabindex="-1"></a><span class="co">    Design Pattern: Observer Pattern for Data Quality Assessment</span></span>
<span id="cb61-863"><a href="#cb61-863" aria-hidden="true" tabindex="-1"></a><span class="co">    - Provides standardized quality metrics</span></span>
<span id="cb61-864"><a href="#cb61-864" aria-hidden="true" tabindex="-1"></a><span class="co">    - Enables data validation and quality control</span></span>
<span id="cb61-865"><a href="#cb61-865" aria-hidden="true" tabindex="-1"></a><span class="co">    - Supports automated quality assessment workflows</span></span>
<span id="cb61-866"><a href="#cb61-866" aria-hidden="true" tabindex="-1"></a><span class="co">    """</span></span>
<span id="cb61-867"><a href="#cb61-867" aria-hidden="true" tabindex="-1"></a>    valid_mask <span class="op">=</span> np.isfinite(band)</span>
<span id="cb61-868"><a href="#cb61-868" aria-hidden="true" tabindex="-1"></a>    valid_data <span class="op">=</span> band[valid_mask]</span>
<span id="cb61-869"><a href="#cb61-869" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb61-870"><a href="#cb61-870" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> <span class="bu">len</span>(valid_data) <span class="op">==</span> <span class="dv">0</span>:</span>
<span id="cb61-871"><a href="#cb61-871" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> {</span>
<span id="cb61-872"><a href="#cb61-872" aria-hidden="true" tabindex="-1"></a>            <span class="st">'name'</span>: name,</span>
<span id="cb61-873"><a href="#cb61-873" aria-hidden="true" tabindex="-1"></a>            <span class="st">'min'</span>: np.nan, <span class="st">'max'</span>: np.nan, <span class="st">'mean'</span>: np.nan,</span>
<span id="cb61-874"><a href="#cb61-874" aria-hidden="true" tabindex="-1"></a>            <span class="st">'std'</span>: np.nan, <span class="st">'median'</span>: np.nan,</span>
<span id="cb61-875"><a href="#cb61-875" aria-hidden="true" tabindex="-1"></a>            <span class="st">'valid_pixels'</span>: <span class="dv">0</span>, <span class="st">'total_pixels'</span>: band.size</span>
<span id="cb61-876"><a href="#cb61-876" aria-hidden="true" tabindex="-1"></a>        }</span>
<span id="cb61-877"><a href="#cb61-877" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb61-878"><a href="#cb61-878" aria-hidden="true" tabindex="-1"></a>    stats <span class="op">=</span> {</span>
<span id="cb61-879"><a href="#cb61-879" aria-hidden="true" tabindex="-1"></a>        <span class="st">'name'</span>: name,</span>
<span id="cb61-880"><a href="#cb61-880" aria-hidden="true" tabindex="-1"></a>        <span class="st">'min'</span>: <span class="bu">float</span>(np.<span class="bu">min</span>(valid_data)),</span>
<span id="cb61-881"><a href="#cb61-881" aria-hidden="true" tabindex="-1"></a>        <span class="st">'max'</span>: <span class="bu">float</span>(np.<span class="bu">max</span>(valid_data)),</span>
<span id="cb61-882"><a href="#cb61-882" aria-hidden="true" tabindex="-1"></a>        <span class="st">'mean'</span>: <span class="bu">float</span>(np.mean(valid_data)),</span>
<span id="cb61-883"><a href="#cb61-883" aria-hidden="true" tabindex="-1"></a>        <span class="st">'std'</span>: <span class="bu">float</span>(np.std(valid_data)),</span>
<span id="cb61-884"><a href="#cb61-884" aria-hidden="true" tabindex="-1"></a>        <span class="st">'median'</span>: <span class="bu">float</span>(np.median(valid_data)),</span>
<span id="cb61-885"><a href="#cb61-885" aria-hidden="true" tabindex="-1"></a>        <span class="st">'valid_pixels'</span>: <span class="bu">int</span>(np.<span class="bu">sum</span>(valid_mask)),</span>
<span id="cb61-886"><a href="#cb61-886" aria-hidden="true" tabindex="-1"></a>        <span class="st">'total_pixels'</span>: <span class="bu">int</span>(band.size),</span>
<span id="cb61-887"><a href="#cb61-887" aria-hidden="true" tabindex="-1"></a>        <span class="st">'percentiles'</span>: {</span>
<span id="cb61-888"><a href="#cb61-888" aria-hidden="true" tabindex="-1"></a>            <span class="st">'p25'</span>: <span class="bu">float</span>(np.percentile(valid_data, <span class="dv">25</span>)),</span>
<span id="cb61-889"><a href="#cb61-889" aria-hidden="true" tabindex="-1"></a>            <span class="st">'p75'</span>: <span class="bu">float</span>(np.percentile(valid_data, <span class="dv">75</span>)),</span>
<span id="cb61-890"><a href="#cb61-890" aria-hidden="true" tabindex="-1"></a>            <span class="st">'p95'</span>: <span class="bu">float</span>(np.percentile(valid_data, <span class="dv">95</span>))</span>
<span id="cb61-891"><a href="#cb61-891" aria-hidden="true" tabindex="-1"></a>        }</span>
<span id="cb61-892"><a href="#cb61-892" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb61-893"><a href="#cb61-893" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb61-894"><a href="#cb61-894" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> stats</span>
<span id="cb61-895"><a href="#cb61-895" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb61-896"><a href="#cb61-896" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"✅ Data processing pipeline functions ready"</span>)</span>
<span id="cb61-897"><a href="#cb61-897" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb61-898"><a href="#cb61-898" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb61-899"><a href="#cb61-899" aria-hidden="true" tabindex="-1"></a>:::{.callout-note}</span>
<span id="cb61-900"><a href="#cb61-900" aria-hidden="true" tabindex="-1"></a><span class="fu">## Spectral Analysis Best Practices</span></span>
<span id="cb61-901"><a href="#cb61-901" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb61-902"><a href="#cb61-902" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>**Percentile normalization** provides robust enhancement against outliers</span>
<span id="cb61-903"><a href="#cb61-903" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>**Numerical stability constants** prevent division by zero in index calculations</span>
<span id="cb61-904"><a href="#cb61-904" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>**Type conversion to float32** ensures adequate precision for calculations</span>
<span id="cb61-905"><a href="#cb61-905" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>**Comprehensive statistics** enable quality assessment and validation</span>
<span id="cb61-906"><a href="#cb61-906" aria-hidden="true" tabindex="-1"></a>:::</span>
<span id="cb61-907"><a href="#cb61-907" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb61-908"><a href="#cb61-908" aria-hidden="true" tabindex="-1"></a>---</span>
<span id="cb61-909"><a href="#cb61-909" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb61-910"><a href="#cb61-910" aria-hidden="true" tabindex="-1"></a><span class="fu">## Section 6: Visualization Functions 📊</span></span>
<span id="cb61-911"><a href="#cb61-911" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb61-912"><a href="#cb61-912" aria-hidden="true" tabindex="-1"></a>:::{.callout-tip}</span>
<span id="cb61-913"><a href="#cb61-913" aria-hidden="true" tabindex="-1"></a><span class="fu">## Learning Objectives</span></span>
<span id="cb61-914"><a href="#cb61-914" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb61-915"><a href="#cb61-915" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>Design publication-quality visualization systems</span>
<span id="cb61-916"><a href="#cb61-916" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>Implement adaptive layout algorithms for multi-panel displays</span>
<span id="cb61-917"><a href="#cb61-917" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>Master colormap selection for scientific data representation</span>
<span id="cb61-918"><a href="#cb61-918" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>Create interactive and informative visual narratives</span>
<span id="cb61-919"><a href="#cb61-919" aria-hidden="true" tabindex="-1"></a>:::</span>
<span id="cb61-920"><a href="#cb61-920" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb61-921"><a href="#cb61-921" aria-hidden="true" tabindex="-1"></a><span class="fu">### Scientific Visualization Design Principles</span></span>
<span id="cb61-922"><a href="#cb61-922" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb61-923"><a href="#cb61-923" aria-hidden="true" tabindex="-1"></a>Effective satellite data visualization requires careful consideration of:</span>
<span id="cb61-924"><a href="#cb61-924" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb61-925"><a href="#cb61-925" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>**Perceptual Uniformity**: Colormaps that accurately represent data relationships</span>
<span id="cb61-926"><a href="#cb61-926" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>**Information Density**: Maximum insight per pixel</span>
<span id="cb61-927"><a href="#cb61-927" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>**Adaptive Layout**: Accommodate variable numbers of data layers</span>
<span id="cb61-928"><a href="#cb61-928" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>**Context Preservation**: Maintain spatial and temporal reference information</span>
<span id="cb61-929"><a href="#cb61-929" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb61-932"><a href="#cb61-932" aria-hidden="true" tabindex="-1"></a><span class="in">```{python}</span></span>
<span id="cb61-933"><a href="#cb61-933" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> plot_band_comparison(</span>
<span id="cb61-934"><a href="#cb61-934" aria-hidden="true" tabindex="-1"></a>    bands: Dict[<span class="bu">str</span>, np.ndarray],</span>
<span id="cb61-935"><a href="#cb61-935" aria-hidden="true" tabindex="-1"></a>    rgb: Optional[np.ndarray] <span class="op">=</span> <span class="va">None</span>,</span>
<span id="cb61-936"><a href="#cb61-936" aria-hidden="true" tabindex="-1"></a>    ndvi: Optional[np.ndarray] <span class="op">=</span> <span class="va">None</span>,</span>
<span id="cb61-937"><a href="#cb61-937" aria-hidden="true" tabindex="-1"></a>    title: <span class="bu">str</span> <span class="op">=</span> <span class="st">"Multi-band Analysis"</span></span>
<span id="cb61-938"><a href="#cb61-938" aria-hidden="true" tabindex="-1"></a>) <span class="op">-&gt;</span> <span class="va">None</span>:</span>
<span id="cb61-939"><a href="#cb61-939" aria-hidden="true" tabindex="-1"></a>    <span class="co">"""</span></span>
<span id="cb61-940"><a href="#cb61-940" aria-hidden="true" tabindex="-1"></a><span class="co">    Create comprehensive multi-panel visualization for satellite analysis.</span></span>
<span id="cb61-941"><a href="#cb61-941" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb61-942"><a href="#cb61-942" aria-hidden="true" tabindex="-1"></a><span class="co">    This function demonstrates several visualization principles:</span></span>
<span id="cb61-943"><a href="#cb61-943" aria-hidden="true" tabindex="-1"></a><span class="co">    1. Adaptive Layout: Automatically adjusts grid based on available data</span></span>
<span id="cb61-944"><a href="#cb61-944" aria-hidden="true" tabindex="-1"></a><span class="co">    2. Consistent Scaling: Uniform treatment of individual bands</span></span>
<span id="cb61-945"><a href="#cb61-945" aria-hidden="true" tabindex="-1"></a><span class="co">    3. Specialized Colormaps: Scientific colormaps for different data types</span></span>
<span id="cb61-946"><a href="#cb61-946" aria-hidden="true" tabindex="-1"></a><span class="co">    4. Context Information: Titles, colorbars, and interpretive text</span></span>
<span id="cb61-947"><a href="#cb61-947" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb61-948"><a href="#cb61-948" aria-hidden="true" tabindex="-1"></a><span class="co">    Parameters</span></span>
<span id="cb61-949"><a href="#cb61-949" aria-hidden="true" tabindex="-1"></a><span class="co">    ----------</span></span>
<span id="cb61-950"><a href="#cb61-950" aria-hidden="true" tabindex="-1"></a><span class="co">    bands : Dict[str, np.ndarray]</span></span>
<span id="cb61-951"><a href="#cb61-951" aria-hidden="true" tabindex="-1"></a><span class="co">        Individual spectral bands to visualize</span></span>
<span id="cb61-952"><a href="#cb61-952" aria-hidden="true" tabindex="-1"></a><span class="co">    rgb : Optional[np.ndarray]</span></span>
<span id="cb61-953"><a href="#cb61-953" aria-hidden="true" tabindex="-1"></a><span class="co">        True color composite for context</span></span>
<span id="cb61-954"><a href="#cb61-954" aria-hidden="true" tabindex="-1"></a><span class="co">    ndvi : Optional[np.ndarray]</span></span>
<span id="cb61-955"><a href="#cb61-955" aria-hidden="true" tabindex="-1"></a><span class="co">        Vegetation index with specialized colormap</span></span>
<span id="cb61-956"><a href="#cb61-956" aria-hidden="true" tabindex="-1"></a><span class="co">    title : str</span></span>
<span id="cb61-957"><a href="#cb61-957" aria-hidden="true" tabindex="-1"></a><span class="co">        Overall figure title</span></span>
<span id="cb61-958"><a href="#cb61-958" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb61-959"><a href="#cb61-959" aria-hidden="true" tabindex="-1"></a><span class="co">    Design Pattern: Facade Pattern for Complex Visualizations</span></span>
<span id="cb61-960"><a href="#cb61-960" aria-hidden="true" tabindex="-1"></a><span class="co">    - Simplifies complex matplotlib operations</span></span>
<span id="cb61-961"><a href="#cb61-961" aria-hidden="true" tabindex="-1"></a><span class="co">    - Provides consistent visualization interface</span></span>
<span id="cb61-962"><a href="#cb61-962" aria-hidden="true" tabindex="-1"></a><span class="co">    - Handles layout complexity automatically</span></span>
<span id="cb61-963"><a href="#cb61-963" aria-hidden="true" tabindex="-1"></a><span class="co">    """</span></span>
<span id="cb61-964"><a href="#cb61-964" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Calculate layout</span></span>
<span id="cb61-965"><a href="#cb61-965" aria-hidden="true" tabindex="-1"></a>    n_panels <span class="op">=</span> <span class="bu">len</span>(bands) <span class="op">+</span> (<span class="dv">1</span> <span class="cf">if</span> rgb <span class="kw">is</span> <span class="kw">not</span> <span class="va">None</span> <span class="cf">else</span> <span class="dv">0</span>) <span class="op">+</span> (<span class="dv">1</span> <span class="cf">if</span> ndvi <span class="kw">is</span> <span class="kw">not</span> <span class="va">None</span> <span class="cf">else</span> <span class="dv">0</span>)</span>
<span id="cb61-966"><a href="#cb61-966" aria-hidden="true" tabindex="-1"></a>    n_cols <span class="op">=</span> <span class="bu">min</span>(<span class="dv">3</span>, n_panels)</span>
<span id="cb61-967"><a href="#cb61-967" aria-hidden="true" tabindex="-1"></a>    n_rows <span class="op">=</span> (n_panels <span class="op">+</span> n_cols <span class="op">-</span> <span class="dv">1</span>) <span class="op">//</span> n_cols</span>
<span id="cb61-968"><a href="#cb61-968" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb61-969"><a href="#cb61-969" aria-hidden="true" tabindex="-1"></a>    fig, axes <span class="op">=</span> plt.subplots(n_rows, n_cols, figsize<span class="op">=</span>(<span class="dv">5</span><span class="op">*</span>n_cols, <span class="dv">4</span><span class="op">*</span>n_rows))</span>
<span id="cb61-970"><a href="#cb61-970" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> n_panels <span class="op">==</span> <span class="dv">1</span>:</span>
<span id="cb61-971"><a href="#cb61-971" aria-hidden="true" tabindex="-1"></a>        axes <span class="op">=</span> [axes]</span>
<span id="cb61-972"><a href="#cb61-972" aria-hidden="true" tabindex="-1"></a>    <span class="cf">elif</span> n_rows <span class="op">&gt;</span> <span class="dv">1</span>:</span>
<span id="cb61-973"><a href="#cb61-973" aria-hidden="true" tabindex="-1"></a>        axes <span class="op">=</span> axes.flatten()</span>
<span id="cb61-974"><a href="#cb61-974" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb61-975"><a href="#cb61-975" aria-hidden="true" tabindex="-1"></a>    panel_idx <span class="op">=</span> <span class="dv">0</span></span>
<span id="cb61-976"><a href="#cb61-976" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb61-977"><a href="#cb61-977" aria-hidden="true" tabindex="-1"></a>    <span class="co"># RGB composite</span></span>
<span id="cb61-978"><a href="#cb61-978" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> rgb <span class="kw">is</span> <span class="kw">not</span> <span class="va">None</span>:</span>
<span id="cb61-979"><a href="#cb61-979" aria-hidden="true" tabindex="-1"></a>        axes[panel_idx].imshow(rgb)</span>
<span id="cb61-980"><a href="#cb61-980" aria-hidden="true" tabindex="-1"></a>        axes[panel_idx].set_title(<span class="st">'RGB Composite'</span>, fontweight<span class="op">=</span><span class="st">'bold'</span>)</span>
<span id="cb61-981"><a href="#cb61-981" aria-hidden="true" tabindex="-1"></a>        axes[panel_idx].axis(<span class="st">'off'</span>)</span>
<span id="cb61-982"><a href="#cb61-982" aria-hidden="true" tabindex="-1"></a>        panel_idx <span class="op">+=</span> <span class="dv">1</span></span>
<span id="cb61-983"><a href="#cb61-983" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb61-984"><a href="#cb61-984" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Individual bands</span></span>
<span id="cb61-985"><a href="#cb61-985" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> band_name, band_data <span class="kw">in</span> bands.items():</span>
<span id="cb61-986"><a href="#cb61-986" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> panel_idx <span class="op">&lt;</span> <span class="bu">len</span>(axes):</span>
<span id="cb61-987"><a href="#cb61-987" aria-hidden="true" tabindex="-1"></a>            normalized <span class="op">=</span> normalize_band(band_data)</span>
<span id="cb61-988"><a href="#cb61-988" aria-hidden="true" tabindex="-1"></a>            axes[panel_idx].imshow(normalized, cmap<span class="op">=</span><span class="st">'gray'</span>, vmin<span class="op">=</span><span class="dv">0</span>, vmax<span class="op">=</span><span class="dv">1</span>)</span>
<span id="cb61-989"><a href="#cb61-989" aria-hidden="true" tabindex="-1"></a>            axes[panel_idx].set_title(<span class="ss">f'Band: </span><span class="sc">{</span>band_name<span class="sc">}</span><span class="ss">'</span>, fontweight<span class="op">=</span><span class="st">'bold'</span>)</span>
<span id="cb61-990"><a href="#cb61-990" aria-hidden="true" tabindex="-1"></a>            axes[panel_idx].axis(<span class="st">'off'</span>)</span>
<span id="cb61-991"><a href="#cb61-991" aria-hidden="true" tabindex="-1"></a>            panel_idx <span class="op">+=</span> <span class="dv">1</span></span>
<span id="cb61-992"><a href="#cb61-992" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb61-993"><a href="#cb61-993" aria-hidden="true" tabindex="-1"></a>    <span class="co"># NDVI with colorbar</span></span>
<span id="cb61-994"><a href="#cb61-994" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> ndvi <span class="kw">is</span> <span class="kw">not</span> <span class="va">None</span> <span class="kw">and</span> panel_idx <span class="op">&lt;</span> <span class="bu">len</span>(axes):</span>
<span id="cb61-995"><a href="#cb61-995" aria-hidden="true" tabindex="-1"></a>        im <span class="op">=</span> axes[panel_idx].imshow(ndvi, cmap<span class="op">=</span><span class="st">'RdYlGn'</span>, vmin<span class="op">=-</span><span class="fl">0.5</span>, vmax<span class="op">=</span><span class="fl">1.0</span>)</span>
<span id="cb61-996"><a href="#cb61-996" aria-hidden="true" tabindex="-1"></a>        axes[panel_idx].set_title(<span class="st">'NDVI'</span>, fontweight<span class="op">=</span><span class="st">'bold'</span>)</span>
<span id="cb61-997"><a href="#cb61-997" aria-hidden="true" tabindex="-1"></a>        axes[panel_idx].axis(<span class="st">'off'</span>)</span>
<span id="cb61-998"><a href="#cb61-998" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb61-999"><a href="#cb61-999" aria-hidden="true" tabindex="-1"></a>        cbar <span class="op">=</span> plt.colorbar(im, ax<span class="op">=</span>axes[panel_idx], shrink<span class="op">=</span><span class="fl">0.6</span>)</span>
<span id="cb61-1000"><a href="#cb61-1000" aria-hidden="true" tabindex="-1"></a>        cbar.set_label(<span class="st">'NDVI Value'</span>, rotation<span class="op">=</span><span class="dv">270</span>, labelpad<span class="op">=</span><span class="dv">15</span>)</span>
<span id="cb61-1001"><a href="#cb61-1001" aria-hidden="true" tabindex="-1"></a>        panel_idx <span class="op">+=</span> <span class="dv">1</span></span>
<span id="cb61-1002"><a href="#cb61-1002" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb61-1003"><a href="#cb61-1003" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Hide unused panels</span></span>
<span id="cb61-1004"><a href="#cb61-1004" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> idx <span class="kw">in</span> <span class="bu">range</span>(panel_idx, <span class="bu">len</span>(axes)):</span>
<span id="cb61-1005"><a href="#cb61-1005" aria-hidden="true" tabindex="-1"></a>        axes[idx].axis(<span class="st">'off'</span>)</span>
<span id="cb61-1006"><a href="#cb61-1006" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb61-1007"><a href="#cb61-1007" aria-hidden="true" tabindex="-1"></a>    plt.suptitle(title, fontsize<span class="op">=</span><span class="dv">14</span>, fontweight<span class="op">=</span><span class="st">'bold'</span>)</span>
<span id="cb61-1008"><a href="#cb61-1008" aria-hidden="true" tabindex="-1"></a>    plt.tight_layout()</span>
<span id="cb61-1009"><a href="#cb61-1009" aria-hidden="true" tabindex="-1"></a>    plt.show()</span>
<span id="cb61-1010"><a href="#cb61-1010" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb61-1011"><a href="#cb61-1011" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"✅ Scientific visualization functions ready"</span>)</span>
<span id="cb61-1012"><a href="#cb61-1012" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb61-1013"><a href="#cb61-1013" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb61-1014"><a href="#cb61-1014" aria-hidden="true" tabindex="-1"></a>:::{.callout-note}</span>
<span id="cb61-1015"><a href="#cb61-1015" aria-hidden="true" tabindex="-1"></a><span class="fu">## Visualization Design Principles</span></span>
<span id="cb61-1016"><a href="#cb61-1016" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb61-1017"><a href="#cb61-1017" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>**Adaptive layouts** accommodate varying numbers of data layers</span>
<span id="cb61-1018"><a href="#cb61-1018" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>**Perceptually uniform colormaps** (like RdYlGn for NDVI) accurately represent data relationships</span>
<span id="cb61-1019"><a href="#cb61-1019" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>**Consistent normalization** enables fair comparison between bands</span>
<span id="cb61-1020"><a href="#cb61-1020" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>**Interpretive elements** (colorbars, labels) provide context for non-experts</span>
<span id="cb61-1021"><a href="#cb61-1021" aria-hidden="true" tabindex="-1"></a>:::</span>
<span id="cb61-1022"><a href="#cb61-1022" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb61-1023"><a href="#cb61-1023" aria-hidden="true" tabindex="-1"></a>---</span>
<span id="cb61-1024"><a href="#cb61-1024" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb61-1025"><a href="#cb61-1025" aria-hidden="true" tabindex="-1"></a><span class="fu">## Section 7: Data Export and Interoperability 💾</span></span>
<span id="cb61-1026"><a href="#cb61-1026" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb61-1027"><a href="#cb61-1027" aria-hidden="true" tabindex="-1"></a>:::{.callout-tip}</span>
<span id="cb61-1028"><a href="#cb61-1028" aria-hidden="true" tabindex="-1"></a><span class="fu">## Learning Objectives</span></span>
<span id="cb61-1029"><a href="#cb61-1029" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb61-1030"><a href="#cb61-1030" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>Master geospatial data standards (GeoTIFF, CRS, metadata)</span>
<span id="cb61-1031"><a href="#cb61-1031" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>Implement cloud-optimized data formats for scalable access</span>
<span id="cb61-1032"><a href="#cb61-1032" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>Design interoperable workflows for multi-platform analysis</span>
<span id="cb61-1033"><a href="#cb61-1033" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>Ensure data provenance and reproducibility through metadata</span>
<span id="cb61-1034"><a href="#cb61-1034" aria-hidden="true" tabindex="-1"></a>:::</span>
<span id="cb61-1035"><a href="#cb61-1035" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb61-1036"><a href="#cb61-1036" aria-hidden="true" tabindex="-1"></a><span class="fu">### Geospatial Data Standards and Interoperability</span></span>
<span id="cb61-1037"><a href="#cb61-1037" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb61-1038"><a href="#cb61-1038" aria-hidden="true" tabindex="-1"></a>Modern geospatial workflows require adherence to established standards:</span>
<span id="cb61-1039"><a href="#cb61-1039" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb61-1040"><a href="#cb61-1040" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>**GeoTIFF**: Industry standard for georeferenced raster data</span>
<span id="cb61-1041"><a href="#cb61-1041" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>**CRS Preservation**: Maintain spatial reference throughout processing</span>
<span id="cb61-1042"><a href="#cb61-1042" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>**Metadata Standards**: Ensure data provenance and reproducibility</span>
<span id="cb61-1043"><a href="#cb61-1043" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>**Cloud Optimization**: Structure data for efficient cloud-native access</span>
<span id="cb61-1044"><a href="#cb61-1044" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb61-1047"><a href="#cb61-1047" aria-hidden="true" tabindex="-1"></a><span class="in">```{python}</span></span>
<span id="cb61-1048"><a href="#cb61-1048" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> save_geotiff(</span>
<span id="cb61-1049"><a href="#cb61-1049" aria-hidden="true" tabindex="-1"></a>    data: np.ndarray,</span>
<span id="cb61-1050"><a href="#cb61-1050" aria-hidden="true" tabindex="-1"></a>    output_path: Union[<span class="bu">str</span>, Path],</span>
<span id="cb61-1051"><a href="#cb61-1051" aria-hidden="true" tabindex="-1"></a>    transform,</span>
<span id="cb61-1052"><a href="#cb61-1052" aria-hidden="true" tabindex="-1"></a>    crs,</span>
<span id="cb61-1053"><a href="#cb61-1053" aria-hidden="true" tabindex="-1"></a>    band_names: Optional[List[<span class="bu">str</span>]] <span class="op">=</span> <span class="va">None</span></span>
<span id="cb61-1054"><a href="#cb61-1054" aria-hidden="true" tabindex="-1"></a>) <span class="op">-&gt;</span> <span class="va">None</span>:</span>
<span id="cb61-1055"><a href="#cb61-1055" aria-hidden="true" tabindex="-1"></a>    <span class="co">"""</span></span>
<span id="cb61-1056"><a href="#cb61-1056" aria-hidden="true" tabindex="-1"></a><span class="co">    Export georeferenced data using industry-standard GeoTIFF format.</span></span>
<span id="cb61-1057"><a href="#cb61-1057" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb61-1058"><a href="#cb61-1058" aria-hidden="true" tabindex="-1"></a><span class="co">    This function embodies several geospatial best practices:</span></span>
<span id="cb61-1059"><a href="#cb61-1059" aria-hidden="true" tabindex="-1"></a><span class="co">    1. Standards Compliance: Uses OGC-compliant GeoTIFF format</span></span>
<span id="cb61-1060"><a href="#cb61-1060" aria-hidden="true" tabindex="-1"></a><span class="co">    2. Metadata Preservation: Maintains CRS and transform information</span></span>
<span id="cb61-1061"><a href="#cb61-1061" aria-hidden="true" tabindex="-1"></a><span class="co">    3. Compression: Applies lossless compression for efficiency</span></span>
<span id="cb61-1062"><a href="#cb61-1062" aria-hidden="true" tabindex="-1"></a><span class="co">    4. Band Description: Documents spectral band information</span></span>
<span id="cb61-1063"><a href="#cb61-1063" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb61-1064"><a href="#cb61-1064" aria-hidden="true" tabindex="-1"></a><span class="co">    Parameters</span></span>
<span id="cb61-1065"><a href="#cb61-1065" aria-hidden="true" tabindex="-1"></a><span class="co">    ----------</span></span>
<span id="cb61-1066"><a href="#cb61-1066" aria-hidden="true" tabindex="-1"></a><span class="co">    data : np.ndarray</span></span>
<span id="cb61-1067"><a href="#cb61-1067" aria-hidden="true" tabindex="-1"></a><span class="co">        Data array (2D for single band, 3D for multi-band)</span></span>
<span id="cb61-1068"><a href="#cb61-1068" aria-hidden="true" tabindex="-1"></a><span class="co">    output_path : Union[str, Path]</span></span>
<span id="cb61-1069"><a href="#cb61-1069" aria-hidden="true" tabindex="-1"></a><span class="co">        Output file path</span></span>
<span id="cb61-1070"><a href="#cb61-1070" aria-hidden="true" tabindex="-1"></a><span class="co">    transform : rasterio.transform.Affine</span></span>
<span id="cb61-1071"><a href="#cb61-1071" aria-hidden="true" tabindex="-1"></a><span class="co">        Geospatial transform matrix</span></span>
<span id="cb61-1072"><a href="#cb61-1072" aria-hidden="true" tabindex="-1"></a><span class="co">    crs : rasterio.crs.CRS</span></span>
<span id="cb61-1073"><a href="#cb61-1073" aria-hidden="true" tabindex="-1"></a><span class="co">        Coordinate reference system</span></span>
<span id="cb61-1074"><a href="#cb61-1074" aria-hidden="true" tabindex="-1"></a><span class="co">    band_names : Optional[List[str]]</span></span>
<span id="cb61-1075"><a href="#cb61-1075" aria-hidden="true" tabindex="-1"></a><span class="co">        Descriptive names for each band</span></span>
<span id="cb61-1076"><a href="#cb61-1076" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb61-1077"><a href="#cb61-1077" aria-hidden="true" tabindex="-1"></a><span class="co">    Design Pattern: Builder Pattern for Geospatial Data Export</span></span>
<span id="cb61-1078"><a href="#cb61-1078" aria-hidden="true" tabindex="-1"></a><span class="co">    - Constructs complex geospatial files incrementally</span></span>
<span id="cb61-1079"><a href="#cb61-1079" aria-hidden="true" tabindex="-1"></a><span class="co">    - Ensures all required metadata is preserved</span></span>
<span id="cb61-1080"><a href="#cb61-1080" aria-hidden="true" tabindex="-1"></a><span class="co">    - Provides extensible framework for additional metadata</span></span>
<span id="cb61-1081"><a href="#cb61-1081" aria-hidden="true" tabindex="-1"></a><span class="co">    """</span></span>
<span id="cb61-1082"><a href="#cb61-1082" aria-hidden="true" tabindex="-1"></a>    output_path <span class="op">=</span> Path(output_path)</span>
<span id="cb61-1083"><a href="#cb61-1083" aria-hidden="true" tabindex="-1"></a>    output_path.parent.mkdir(parents<span class="op">=</span><span class="va">True</span>, exist_ok<span class="op">=</span><span class="va">True</span>)</span>
<span id="cb61-1084"><a href="#cb61-1084" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb61-1085"><a href="#cb61-1085" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Handle both 2D and 3D arrays</span></span>
<span id="cb61-1086"><a href="#cb61-1086" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> data.ndim <span class="op">==</span> <span class="dv">2</span>:</span>
<span id="cb61-1087"><a href="#cb61-1087" aria-hidden="true" tabindex="-1"></a>        count <span class="op">=</span> <span class="dv">1</span></span>
<span id="cb61-1088"><a href="#cb61-1088" aria-hidden="true" tabindex="-1"></a>        height, width <span class="op">=</span> data.shape</span>
<span id="cb61-1089"><a href="#cb61-1089" aria-hidden="true" tabindex="-1"></a>    <span class="cf">else</span>:</span>
<span id="cb61-1090"><a href="#cb61-1090" aria-hidden="true" tabindex="-1"></a>        count, height, width <span class="op">=</span> data.shape</span>
<span id="cb61-1091"><a href="#cb61-1091" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb61-1092"><a href="#cb61-1092" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Write GeoTIFF with comprehensive metadata</span></span>
<span id="cb61-1093"><a href="#cb61-1093" aria-hidden="true" tabindex="-1"></a>    <span class="cf">with</span> rasterio.<span class="bu">open</span>(</span>
<span id="cb61-1094"><a href="#cb61-1094" aria-hidden="true" tabindex="-1"></a>        output_path,</span>
<span id="cb61-1095"><a href="#cb61-1095" aria-hidden="true" tabindex="-1"></a>        <span class="st">'w'</span>,</span>
<span id="cb61-1096"><a href="#cb61-1096" aria-hidden="true" tabindex="-1"></a>        driver<span class="op">=</span><span class="st">'GTiff'</span>,</span>
<span id="cb61-1097"><a href="#cb61-1097" aria-hidden="true" tabindex="-1"></a>        height<span class="op">=</span>height,</span>
<span id="cb61-1098"><a href="#cb61-1098" aria-hidden="true" tabindex="-1"></a>        width<span class="op">=</span>width,</span>
<span id="cb61-1099"><a href="#cb61-1099" aria-hidden="true" tabindex="-1"></a>        count<span class="op">=</span>count,</span>
<span id="cb61-1100"><a href="#cb61-1100" aria-hidden="true" tabindex="-1"></a>        dtype<span class="op">=</span>data.dtype,</span>
<span id="cb61-1101"><a href="#cb61-1101" aria-hidden="true" tabindex="-1"></a>        crs<span class="op">=</span>crs,</span>
<span id="cb61-1102"><a href="#cb61-1102" aria-hidden="true" tabindex="-1"></a>        transform<span class="op">=</span>transform,</span>
<span id="cb61-1103"><a href="#cb61-1103" aria-hidden="true" tabindex="-1"></a>        compress<span class="op">=</span><span class="st">'deflate'</span>,  <span class="co"># Lossless compression</span></span>
<span id="cb61-1104"><a href="#cb61-1104" aria-hidden="true" tabindex="-1"></a>        tiled<span class="op">=</span><span class="va">True</span>,         <span class="co"># Cloud-optimized structure</span></span>
<span id="cb61-1105"><a href="#cb61-1105" aria-hidden="true" tabindex="-1"></a>        blockxsize<span class="op">=</span><span class="dv">512</span>,     <span class="co"># Optimize for cloud access</span></span>
<span id="cb61-1106"><a href="#cb61-1106" aria-hidden="true" tabindex="-1"></a>        blockysize<span class="op">=</span><span class="dv">512</span></span>
<span id="cb61-1107"><a href="#cb61-1107" aria-hidden="true" tabindex="-1"></a>    ) <span class="im">as</span> dst:</span>
<span id="cb61-1108"><a href="#cb61-1108" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> data.ndim <span class="op">==</span> <span class="dv">2</span>:</span>
<span id="cb61-1109"><a href="#cb61-1109" aria-hidden="true" tabindex="-1"></a>            dst.write(data, <span class="dv">1</span>)</span>
<span id="cb61-1110"><a href="#cb61-1110" aria-hidden="true" tabindex="-1"></a>            <span class="cf">if</span> band_names:</span>
<span id="cb61-1111"><a href="#cb61-1111" aria-hidden="true" tabindex="-1"></a>                dst.set_band_description(<span class="dv">1</span>, band_names[<span class="dv">0</span>])</span>
<span id="cb61-1112"><a href="#cb61-1112" aria-hidden="true" tabindex="-1"></a>        <span class="cf">else</span>:</span>
<span id="cb61-1113"><a href="#cb61-1113" aria-hidden="true" tabindex="-1"></a>            <span class="cf">for</span> i <span class="kw">in</span> <span class="bu">range</span>(count):</span>
<span id="cb61-1114"><a href="#cb61-1114" aria-hidden="true" tabindex="-1"></a>                dst.write(data[i], i <span class="op">+</span> <span class="dv">1</span>)</span>
<span id="cb61-1115"><a href="#cb61-1115" aria-hidden="true" tabindex="-1"></a>                <span class="cf">if</span> band_names <span class="kw">and</span> i <span class="op">&lt;</span> <span class="bu">len</span>(band_names):</span>
<span id="cb61-1116"><a href="#cb61-1116" aria-hidden="true" tabindex="-1"></a>                    dst.set_band_description(i <span class="op">+</span> <span class="dv">1</span>, band_names[i])</span>
<span id="cb61-1117"><a href="#cb61-1117" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb61-1118"><a href="#cb61-1118" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="ss">f"💾 Saved GeoTIFF: </span><span class="sc">{</span>output_path<span class="sc">}</span><span class="ss">"</span>)</span>
<span id="cb61-1119"><a href="#cb61-1119" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="ss">f"   Shape: </span><span class="sc">{</span>data<span class="sc">.</span>shape<span class="sc">}</span><span class="ss">"</span>)</span>
<span id="cb61-1120"><a href="#cb61-1120" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="ss">f"   CRS: </span><span class="sc">{</span>crs<span class="sc">}</span><span class="ss">"</span>)</span>
<span id="cb61-1121"><a href="#cb61-1121" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="ss">f"   Compression: deflate, tiled"</span>)</span>
<span id="cb61-1122"><a href="#cb61-1122" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb61-1123"><a href="#cb61-1123" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"✅ Geospatial data export functions ready"</span>)</span>
<span id="cb61-1124"><a href="#cb61-1124" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb61-1125"><a href="#cb61-1125" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb61-1126"><a href="#cb61-1126" aria-hidden="true" tabindex="-1"></a>:::{.callout-note}</span>
<span id="cb61-1127"><a href="#cb61-1127" aria-hidden="true" tabindex="-1"></a><span class="fu">## Geospatial Data Standards</span></span>
<span id="cb61-1128"><a href="#cb61-1128" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb61-1129"><a href="#cb61-1129" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>**GeoTIFF with COG optimization** ensures cloud-native accessibility</span>
<span id="cb61-1130"><a href="#cb61-1130" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>**CRS preservation** maintains spatial accuracy across platforms</span>
<span id="cb61-1131"><a href="#cb61-1131" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>**Lossless compression** reduces storage costs without data loss</span>
<span id="cb61-1132"><a href="#cb61-1132" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>**Band descriptions** provide metadata for analysis reproducibility</span>
<span id="cb61-1133"><a href="#cb61-1133" aria-hidden="true" tabindex="-1"></a>:::</span>
<span id="cb61-1134"><a href="#cb61-1134" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb61-1135"><a href="#cb61-1135" aria-hidden="true" tabindex="-1"></a>---</span>
<span id="cb61-1136"><a href="#cb61-1136" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb61-1137"><a href="#cb61-1137" aria-hidden="true" tabindex="-1"></a><span class="fu">## Section 8: Advanced Workflow Patterns 🚀</span></span>
<span id="cb61-1138"><a href="#cb61-1138" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb61-1139"><a href="#cb61-1139" aria-hidden="true" tabindex="-1"></a>:::{.callout-tip}</span>
<span id="cb61-1140"><a href="#cb61-1140" aria-hidden="true" tabindex="-1"></a><span class="fu">## Learning Objectives</span></span>
<span id="cb61-1141"><a href="#cb61-1141" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb61-1142"><a href="#cb61-1142" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>Design scalable spatial partitioning strategies for large-scale analysis</span>
<span id="cb61-1143"><a href="#cb61-1143" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>Implement testing frameworks for geospatial data pipelines</span>
<span id="cb61-1144"><a href="#cb61-1144" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>Master parallel processing patterns for satellite data workflows</span>
<span id="cb61-1145"><a href="#cb61-1145" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>Create adaptive processing strategies based on scene characteristics</span>
<span id="cb61-1146"><a href="#cb61-1146" aria-hidden="true" tabindex="-1"></a>:::</span>
<span id="cb61-1147"><a href="#cb61-1147" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb61-1148"><a href="#cb61-1148" aria-hidden="true" tabindex="-1"></a><span class="fu">### Scalable Geospatial Processing Architectures</span></span>
<span id="cb61-1149"><a href="#cb61-1149" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb61-1150"><a href="#cb61-1150" aria-hidden="true" tabindex="-1"></a>Large-scale satellite analysis requires sophisticated workflow patterns:</span>
<span id="cb61-1151"><a href="#cb61-1151" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb61-1152"><a href="#cb61-1152" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>**Spatial Partitioning**: Divide scenes into manageable processing units</span>
<span id="cb61-1153"><a href="#cb61-1153" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>**Adaptive Strategies**: Adjust processing based on data characteristics</span>
<span id="cb61-1154"><a href="#cb61-1154" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>**Quality Assurance**: Automated testing of processing pipelines</span>
<span id="cb61-1155"><a href="#cb61-1155" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>**Parallel Execution**: Leverage multiple cores/nodes for efficiency</span>
<span id="cb61-1156"><a href="#cb61-1156" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb61-1159"><a href="#cb61-1159" aria-hidden="true" tabindex="-1"></a><span class="in">```{python}</span></span>
<span id="cb61-1160"><a href="#cb61-1160" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> create_scene_tiles(item, tile_size: Tuple[<span class="bu">int</span>, <span class="bu">int</span>] <span class="op">=</span> (<span class="dv">3</span>, <span class="dv">3</span>)):</span>
<span id="cb61-1161"><a href="#cb61-1161" aria-hidden="true" tabindex="-1"></a>    <span class="co">"""</span></span>
<span id="cb61-1162"><a href="#cb61-1162" aria-hidden="true" tabindex="-1"></a><span class="co">    Create systematic spatial partitioning for parallel processing workflows.</span></span>
<span id="cb61-1163"><a href="#cb61-1163" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb61-1164"><a href="#cb61-1164" aria-hidden="true" tabindex="-1"></a><span class="co">    This tiling approach enables several advanced patterns:</span></span>
<span id="cb61-1165"><a href="#cb61-1165" aria-hidden="true" tabindex="-1"></a><span class="co">    1. Parallel Processing: Independent tiles can be processed simultaneously</span></span>
<span id="cb61-1166"><a href="#cb61-1166" aria-hidden="true" tabindex="-1"></a><span class="co">    2. Memory Management: Process large scenes without loading entirely</span></span>
<span id="cb61-1167"><a href="#cb61-1167" aria-hidden="true" tabindex="-1"></a><span class="co">    3. Quality Control: Test processing on representative tiles first</span></span>
<span id="cb61-1168"><a href="#cb61-1168" aria-hidden="true" tabindex="-1"></a><span class="co">    4. Scalability: Extend to arbitrary scene sizes and processing resources</span></span>
<span id="cb61-1169"><a href="#cb61-1169" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb61-1170"><a href="#cb61-1170" aria-hidden="true" tabindex="-1"></a><span class="co">    Parameters</span></span>
<span id="cb61-1171"><a href="#cb61-1171" aria-hidden="true" tabindex="-1"></a><span class="co">    ----------</span></span>
<span id="cb61-1172"><a href="#cb61-1172" aria-hidden="true" tabindex="-1"></a><span class="co">    item : pystac.Item</span></span>
<span id="cb61-1173"><a href="#cb61-1173" aria-hidden="true" tabindex="-1"></a><span class="co">        STAC item to partition</span></span>
<span id="cb61-1174"><a href="#cb61-1174" aria-hidden="true" tabindex="-1"></a><span class="co">    tile_size : Tuple[int, int]</span></span>
<span id="cb61-1175"><a href="#cb61-1175" aria-hidden="true" tabindex="-1"></a><span class="co">        Grid dimensions (nx, ny)</span></span>
<span id="cb61-1176"><a href="#cb61-1176" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb61-1177"><a href="#cb61-1177" aria-hidden="true" tabindex="-1"></a><span class="co">    Returns</span></span>
<span id="cb61-1178"><a href="#cb61-1178" aria-hidden="true" tabindex="-1"></a><span class="co">    -------</span></span>
<span id="cb61-1179"><a href="#cb61-1179" aria-hidden="true" tabindex="-1"></a><span class="co">    List[Dict]</span></span>
<span id="cb61-1180"><a href="#cb61-1180" aria-hidden="true" tabindex="-1"></a><span class="co">        Tile metadata with bounding boxes and processing information</span></span>
<span id="cb61-1181"><a href="#cb61-1181" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb61-1182"><a href="#cb61-1182" aria-hidden="true" tabindex="-1"></a><span class="co">    Design Pattern: Strategy Pattern for Spatial Partitioning</span></span>
<span id="cb61-1183"><a href="#cb61-1183" aria-hidden="true" tabindex="-1"></a><span class="co">    - Provides flexible tiling strategies for different use cases</span></span>
<span id="cb61-1184"><a href="#cb61-1184" aria-hidden="true" tabindex="-1"></a><span class="co">    - Encapsulates spatial mathematics complexity</span></span>
<span id="cb61-1185"><a href="#cb61-1185" aria-hidden="true" tabindex="-1"></a><span class="co">    - Enables systematic quality control and testing</span></span>
<span id="cb61-1186"><a href="#cb61-1186" aria-hidden="true" tabindex="-1"></a><span class="co">    """</span></span>
<span id="cb61-1187"><a href="#cb61-1187" aria-hidden="true" tabindex="-1"></a>    tiles <span class="op">=</span> []</span>
<span id="cb61-1188"><a href="#cb61-1188" aria-hidden="true" tabindex="-1"></a>    nx, ny <span class="op">=</span> tile_size</span>
<span id="cb61-1189"><a href="#cb61-1189" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb61-1190"><a href="#cb61-1190" aria-hidden="true" tabindex="-1"></a>    scene_info <span class="op">=</span> get_scene_info(item)</span>
<span id="cb61-1191"><a href="#cb61-1191" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb61-1192"><a href="#cb61-1192" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="ss">f"🔲 Creating </span><span class="sc">{</span>nx<span class="sc">}</span><span class="ss">×</span><span class="sc">{</span>ny<span class="sc">}</span><span class="ss"> tile grid from scene..."</span>)</span>
<span id="cb61-1193"><a href="#cb61-1193" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="ss">f"   Total tiles: </span><span class="sc">{</span>nx <span class="op">*</span> ny<span class="sc">}</span><span class="ss">"</span>)</span>
<span id="cb61-1194"><a href="#cb61-1194" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="ss">f"   Scene area: </span><span class="sc">{</span>scene_info[<span class="st">'area_km2'</span>]<span class="sc">:.0f}</span><span class="ss"> km²"</span>)</span>
<span id="cb61-1195"><a href="#cb61-1195" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb61-1196"><a href="#cb61-1196" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> i <span class="kw">in</span> <span class="bu">range</span>(nx):</span>
<span id="cb61-1197"><a href="#cb61-1197" aria-hidden="true" tabindex="-1"></a>        <span class="cf">for</span> j <span class="kw">in</span> <span class="bu">range</span>(ny):</span>
<span id="cb61-1198"><a href="#cb61-1198" aria-hidden="true" tabindex="-1"></a>            <span class="co"># Calculate percentage ranges for this tile</span></span>
<span id="cb61-1199"><a href="#cb61-1199" aria-hidden="true" tabindex="-1"></a>            x_start <span class="op">=</span> (i <span class="op">/</span> nx) <span class="op">*</span> <span class="dv">100</span></span>
<span id="cb61-1200"><a href="#cb61-1200" aria-hidden="true" tabindex="-1"></a>            x_end <span class="op">=</span> ((i <span class="op">+</span> <span class="dv">1</span>) <span class="op">/</span> nx) <span class="op">*</span> <span class="dv">100</span></span>
<span id="cb61-1201"><a href="#cb61-1201" aria-hidden="true" tabindex="-1"></a>            y_start <span class="op">=</span> (j <span class="op">/</span> ny) <span class="op">*</span> <span class="dv">100</span></span>
<span id="cb61-1202"><a href="#cb61-1202" aria-hidden="true" tabindex="-1"></a>            y_end <span class="op">=</span> ((j <span class="op">+</span> <span class="dv">1</span>) <span class="op">/</span> ny) <span class="op">*</span> <span class="dv">100</span></span>
<span id="cb61-1203"><a href="#cb61-1203" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb61-1204"><a href="#cb61-1204" aria-hidden="true" tabindex="-1"></a>            <span class="co"># Generate tile bounding box</span></span>
<span id="cb61-1205"><a href="#cb61-1205" aria-hidden="true" tabindex="-1"></a>            tile_bbox <span class="op">=</span> get_subset_from_scene(</span>
<span id="cb61-1206"><a href="#cb61-1206" aria-hidden="true" tabindex="-1"></a>                item,</span>
<span id="cb61-1207"><a href="#cb61-1207" aria-hidden="true" tabindex="-1"></a>                x_range<span class="op">=</span>(x_start, x_end),</span>
<span id="cb61-1208"><a href="#cb61-1208" aria-hidden="true" tabindex="-1"></a>                y_range<span class="op">=</span>(y_start, y_end)</span>
<span id="cb61-1209"><a href="#cb61-1209" aria-hidden="true" tabindex="-1"></a>            )</span>
<span id="cb61-1210"><a href="#cb61-1210" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb61-1211"><a href="#cb61-1211" aria-hidden="true" tabindex="-1"></a>            <span class="co"># Package tile metadata for processing</span></span>
<span id="cb61-1212"><a href="#cb61-1212" aria-hidden="true" tabindex="-1"></a>            tile_info <span class="op">=</span> {</span>
<span id="cb61-1213"><a href="#cb61-1213" aria-hidden="true" tabindex="-1"></a>                <span class="st">'tile_id'</span>: <span class="ss">f"</span><span class="sc">{</span>i<span class="sc">}</span><span class="ss">_</span><span class="sc">{</span>j<span class="sc">}</span><span class="ss">"</span>,</span>
<span id="cb61-1214"><a href="#cb61-1214" aria-hidden="true" tabindex="-1"></a>                <span class="st">'row'</span>: j,</span>
<span id="cb61-1215"><a href="#cb61-1215" aria-hidden="true" tabindex="-1"></a>                <span class="st">'col'</span>: i,</span>
<span id="cb61-1216"><a href="#cb61-1216" aria-hidden="true" tabindex="-1"></a>                <span class="st">'bbox'</span>: tile_bbox,</span>
<span id="cb61-1217"><a href="#cb61-1217" aria-hidden="true" tabindex="-1"></a>                <span class="st">'x_range'</span>: (x_start, x_end),</span>
<span id="cb61-1218"><a href="#cb61-1218" aria-hidden="true" tabindex="-1"></a>                <span class="st">'y_range'</span>: (y_start, y_end),</span>
<span id="cb61-1219"><a href="#cb61-1219" aria-hidden="true" tabindex="-1"></a>                <span class="st">'area_percent'</span>: ((x_end <span class="op">-</span> x_start) <span class="op">*</span> (y_end <span class="op">-</span> y_start)) <span class="op">/</span> <span class="fl">100.0</span>,</span>
<span id="cb61-1220"><a href="#cb61-1220" aria-hidden="true" tabindex="-1"></a>                <span class="st">'processing_priority'</span>: <span class="st">'high'</span> <span class="cf">if</span> (i <span class="op">==</span> nx<span class="op">//</span><span class="dv">2</span> <span class="kw">and</span> j <span class="op">==</span> ny<span class="op">//</span><span class="dv">2</span>) <span class="cf">else</span> <span class="st">'normal'</span>  <span class="co"># Center tile first</span></span>
<span id="cb61-1221"><a href="#cb61-1221" aria-hidden="true" tabindex="-1"></a>            }</span>
<span id="cb61-1222"><a href="#cb61-1222" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb61-1223"><a href="#cb61-1223" aria-hidden="true" tabindex="-1"></a>            tiles.append(tile_info)</span>
<span id="cb61-1224"><a href="#cb61-1224" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb61-1225"><a href="#cb61-1225" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="ss">f"   ✅ Created </span><span class="sc">{</span><span class="bu">len</span>(tiles)<span class="sc">}</span><span class="ss"> tiles, each covering </span><span class="sc">{</span>tiles[<span class="dv">0</span>][<span class="st">'area_percent'</span>]<span class="sc">:.1f}</span><span class="ss">% of scene"</span>)</span>
<span id="cb61-1226"><a href="#cb61-1226" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> tiles</span>
<span id="cb61-1227"><a href="#cb61-1227" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb61-1228"><a href="#cb61-1228" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> test_subset_functionality(item):</span>
<span id="cb61-1229"><a href="#cb61-1229" aria-hidden="true" tabindex="-1"></a>    <span class="co">"""</span></span>
<span id="cb61-1230"><a href="#cb61-1230" aria-hidden="true" tabindex="-1"></a><span class="co">    Automated quality assurance for data loading pipelines.</span></span>
<span id="cb61-1231"><a href="#cb61-1231" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb61-1232"><a href="#cb61-1232" aria-hidden="true" tabindex="-1"></a><span class="co">    This testing approach demonstrates:</span></span>
<span id="cb61-1233"><a href="#cb61-1233" aria-hidden="true" tabindex="-1"></a><span class="co">    1. Smoke Testing: Verify basic functionality before full processing</span></span>
<span id="cb61-1234"><a href="#cb61-1234" aria-hidden="true" tabindex="-1"></a><span class="co">    2. Representative Sampling: Test with manageable data subset</span></span>
<span id="cb61-1235"><a href="#cb61-1235" aria-hidden="true" tabindex="-1"></a><span class="co">    3. Error Detection: Identify issues early in processing pipeline</span></span>
<span id="cb61-1236"><a href="#cb61-1236" aria-hidden="true" tabindex="-1"></a><span class="co">    4. Performance Validation: Ensure acceptable loading performance</span></span>
<span id="cb61-1237"><a href="#cb61-1237" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb61-1238"><a href="#cb61-1238" aria-hidden="true" tabindex="-1"></a><span class="co">    Parameters</span></span>
<span id="cb61-1239"><a href="#cb61-1239" aria-hidden="true" tabindex="-1"></a><span class="co">    ----------</span></span>
<span id="cb61-1240"><a href="#cb61-1240" aria-hidden="true" tabindex="-1"></a><span class="co">    item : pystac.Item</span></span>
<span id="cb61-1241"><a href="#cb61-1241" aria-hidden="true" tabindex="-1"></a><span class="co">        STAC item to test</span></span>
<span id="cb61-1242"><a href="#cb61-1242" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb61-1243"><a href="#cb61-1243" aria-hidden="true" tabindex="-1"></a><span class="co">    Returns</span></span>
<span id="cb61-1244"><a href="#cb61-1244" aria-hidden="true" tabindex="-1"></a><span class="co">    -------</span></span>
<span id="cb61-1245"><a href="#cb61-1245" aria-hidden="true" tabindex="-1"></a><span class="co">    bool</span></span>
<span id="cb61-1246"><a href="#cb61-1246" aria-hidden="true" tabindex="-1"></a><span class="co">        True if subset functionality is working correctly</span></span>
<span id="cb61-1247"><a href="#cb61-1247" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb61-1248"><a href="#cb61-1248" aria-hidden="true" tabindex="-1"></a><span class="co">    Design Pattern: Chain of Responsibility for Quality Assurance</span></span>
<span id="cb61-1249"><a href="#cb61-1249" aria-hidden="true" tabindex="-1"></a><span class="co">    - Implements systematic testing hierarchy</span></span>
<span id="cb61-1250"><a href="#cb61-1250" aria-hidden="true" tabindex="-1"></a><span class="co">    - Provides early failure detection</span></span>
<span id="cb61-1251"><a href="#cb61-1251" aria-hidden="true" tabindex="-1"></a><span class="co">    - Validates core functionality before expensive operations</span></span>
<span id="cb61-1252"><a href="#cb61-1252" aria-hidden="true" tabindex="-1"></a><span class="co">    """</span></span>
<span id="cb61-1253"><a href="#cb61-1253" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="ss">f"🧪 Testing subset functionality..."</span>)</span>
<span id="cb61-1254"><a href="#cb61-1254" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb61-1255"><a href="#cb61-1255" aria-hidden="true" tabindex="-1"></a>    <span class="cf">try</span>:</span>
<span id="cb61-1256"><a href="#cb61-1256" aria-hidden="true" tabindex="-1"></a>        <span class="co"># Test with small central area (minimal data transfer)</span></span>
<span id="cb61-1257"><a href="#cb61-1257" aria-hidden="true" tabindex="-1"></a>        test_bbox <span class="op">=</span> get_subset_from_scene(item, x_range<span class="op">=</span>(<span class="dv">40</span>, <span class="dv">60</span>), y_range<span class="op">=</span>(<span class="dv">40</span>, <span class="dv">60</span>))</span>
<span id="cb61-1258"><a href="#cb61-1258" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb61-1259"><a href="#cb61-1259" aria-hidden="true" tabindex="-1"></a>        <span class="co"># Load minimal data for testing</span></span>
<span id="cb61-1260"><a href="#cb61-1260" aria-hidden="true" tabindex="-1"></a>        test_data <span class="op">=</span> load_sentinel2_bands(</span>
<span id="cb61-1261"><a href="#cb61-1261" aria-hidden="true" tabindex="-1"></a>            item,</span>
<span id="cb61-1262"><a href="#cb61-1262" aria-hidden="true" tabindex="-1"></a>            bands<span class="op">=</span>[<span class="st">'B04'</span>],  <span class="co"># Single band reduces test time</span></span>
<span id="cb61-1263"><a href="#cb61-1263" aria-hidden="true" tabindex="-1"></a>            subset_bbox<span class="op">=</span>test_bbox,</span>
<span id="cb61-1264"><a href="#cb61-1264" aria-hidden="true" tabindex="-1"></a>            max_retries<span class="op">=</span><span class="dv">2</span></span>
<span id="cb61-1265"><a href="#cb61-1265" aria-hidden="true" tabindex="-1"></a>        )</span>
<span id="cb61-1266"><a href="#cb61-1266" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb61-1267"><a href="#cb61-1267" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> <span class="st">'B04'</span> <span class="kw">in</span> test_data:</span>
<span id="cb61-1268"><a href="#cb61-1268" aria-hidden="true" tabindex="-1"></a>            shape <span class="op">=</span> test_data[<span class="st">'B04'</span>].shape</span>
<span id="cb61-1269"><a href="#cb61-1269" aria-hidden="true" tabindex="-1"></a>            has_data <span class="op">=</span> test_data[<span class="st">'B04'</span>].size <span class="op">&gt;</span> <span class="dv">0</span></span>
<span id="cb61-1270"><a href="#cb61-1270" aria-hidden="true" tabindex="-1"></a>            <span class="bu">print</span>(<span class="ss">f"   ✅ Subset test successful: </span><span class="sc">{</span>shape<span class="sc">}</span><span class="ss"> pixels, </span><span class="sc">{</span>test_data[<span class="st">'B04'</span>]<span class="sc">.</span>size<span class="sc">}</span><span class="ss"> total"</span>)</span>
<span id="cb61-1271"><a href="#cb61-1271" aria-hidden="true" tabindex="-1"></a>            <span class="cf">return</span> <span class="va">True</span></span>
<span id="cb61-1272"><a href="#cb61-1272" aria-hidden="true" tabindex="-1"></a>        <span class="cf">else</span>:</span>
<span id="cb61-1273"><a href="#cb61-1273" aria-hidden="true" tabindex="-1"></a>            <span class="bu">print</span>(<span class="ss">f"   ❌ Subset test failed: no data returned"</span>)</span>
<span id="cb61-1274"><a href="#cb61-1274" aria-hidden="true" tabindex="-1"></a>            <span class="cf">return</span> <span class="va">False</span></span>
<span id="cb61-1275"><a href="#cb61-1275" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb61-1276"><a href="#cb61-1276" aria-hidden="true" tabindex="-1"></a>    <span class="cf">except</span> <span class="pp">Exception</span> <span class="im">as</span> e:</span>
<span id="cb61-1277"><a href="#cb61-1277" aria-hidden="true" tabindex="-1"></a>        <span class="bu">print</span>(<span class="ss">f"   ❌ Subset test failed: </span><span class="sc">{</span><span class="bu">str</span>(e)[:<span class="dv">50</span>]<span class="sc">}</span><span class="ss">..."</span>)</span>
<span id="cb61-1278"><a href="#cb61-1278" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> <span class="va">False</span></span>
<span id="cb61-1279"><a href="#cb61-1279" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb61-1280"><a href="#cb61-1280" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"✅ Advanced workflow pattern functions ready"</span>)</span>
<span id="cb61-1281"><a href="#cb61-1281" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb61-1282"><a href="#cb61-1282" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb61-1283"><a href="#cb61-1283" aria-hidden="true" tabindex="-1"></a>:::{.callout-note}</span>
<span id="cb61-1284"><a href="#cb61-1284" aria-hidden="true" tabindex="-1"></a><span class="fu">## Scalable Processing Patterns</span></span>
<span id="cb61-1285"><a href="#cb61-1285" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb61-1286"><a href="#cb61-1286" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>**Systematic tiling** enables parallel processing of large datasets</span>
<span id="cb61-1287"><a href="#cb61-1287" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>**Quality assurance testing** prevents failures in production workflows</span>
<span id="cb61-1288"><a href="#cb61-1288" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>**Adaptive processing priorities** optimize resource utilization</span>
<span id="cb61-1289"><a href="#cb61-1289" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>**Metadata packaging** supports complex workflow orchestration</span>
<span id="cb61-1290"><a href="#cb61-1290" aria-hidden="true" tabindex="-1"></a>:::</span>
<span id="cb61-1291"><a href="#cb61-1291" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb61-1292"><a href="#cb61-1292" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb61-1293"><a href="#cb61-1293" aria-hidden="true" tabindex="-1"></a><span class="fu">## Summary: Your Geospatial AI Toolkit</span></span>
<span id="cb61-1294"><a href="#cb61-1294" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb61-1295"><a href="#cb61-1295" aria-hidden="true" tabindex="-1"></a>You now have a comprehensive, production-ready toolkit with:</span>
<span id="cb61-1296"><a href="#cb61-1296" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb61-1297"><a href="#cb61-1297" aria-hidden="true" tabindex="-1"></a><span class="fu">### Core Capabilities</span></span>
<span id="cb61-1298"><a href="#cb61-1298" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb61-1299"><a href="#cb61-1299" aria-hidden="true" tabindex="-1"></a><span class="ss">1. </span>**🔐 Enterprise Authentication**: Secure, scalable API access patterns</span>
<span id="cb61-1300"><a href="#cb61-1300" aria-hidden="true" tabindex="-1"></a><span class="ss">2. </span>**🔍 Intelligent Data Discovery**: Cloud-native search with optimization</span>
<span id="cb61-1301"><a href="#cb61-1301" aria-hidden="true" tabindex="-1"></a><span class="ss">3. </span>**📥 Memory-Efficient Loading**: Robust data access with subsetting</span>
<span id="cb61-1302"><a href="#cb61-1302" aria-hidden="true" tabindex="-1"></a><span class="ss">4. </span>**📐 Spatial Processing**: Percentage-based, reproducible operations</span>
<span id="cb61-1303"><a href="#cb61-1303" aria-hidden="true" tabindex="-1"></a><span class="ss">5. </span>**🔬 Spectral Analysis**: Publication-quality processing pipelines</span>
<span id="cb61-1304"><a href="#cb61-1304" aria-hidden="true" tabindex="-1"></a><span class="ss">6. </span>**📊 Scientific Visualization**: Adaptive, informative displays</span>
<span id="cb61-1305"><a href="#cb61-1305" aria-hidden="true" tabindex="-1"></a><span class="ss">7. </span>**💾 Standards-Compliant Export**: Interoperable data formats</span>
<span id="cb61-1306"><a href="#cb61-1306" aria-hidden="true" tabindex="-1"></a><span class="ss">8. </span>**🚀 Scalable Workflows**: Parallel processing and quality assurance</span>
<span id="cb61-1307"><a href="#cb61-1307" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb61-1308"><a href="#cb61-1308" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb61-1309"><a href="#cb61-1309" aria-hidden="true" tabindex="-1"></a><span class="fu">### Design Philosophy</span></span>
<span id="cb61-1310"><a href="#cb61-1310" aria-hidden="true" tabindex="-1"></a>Each function embodies software engineering best practices:</span>
<span id="cb61-1311"><a href="#cb61-1311" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb61-1312"><a href="#cb61-1312" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>**Error Handling**: Graceful degradation and informative error messages</span>
<span id="cb61-1313"><a href="#cb61-1313" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>**Composability**: Functions work together in complex workflows</span>
<span id="cb61-1314"><a href="#cb61-1314" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>**Extensibility**: Easy to modify and extend for new requirements</span>
<span id="cb61-1315"><a href="#cb61-1315" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>**Documentation**: Clear examples and architectural reasoning</span>
<span id="cb61-1316"><a href="#cb61-1316" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb61-1317"><a href="#cb61-1317" aria-hidden="true" tabindex="-1"></a><span class="fu">### Ready for Production</span></span>
<span id="cb61-1318"><a href="#cb61-1318" aria-hidden="true" tabindex="-1"></a>These functions are designed for real-world deployment:</span>
<span id="cb61-1319"><a href="#cb61-1319" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb61-1320"><a href="#cb61-1320" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>**Scalability**: Handle datasets from small studies to global analysis</span>
<span id="cb61-1321"><a href="#cb61-1321" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>**Reliability**: Robust error handling and recovery mechanisms</span>
<span id="cb61-1322"><a href="#cb61-1322" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>**Performance**: Memory-efficient algorithms and cloud optimization</span>
<span id="cb61-1323"><a href="#cb61-1323" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>**Maintainability**: Clear code structure and comprehensive documentation</span>
<span id="cb61-1324"><a href="#cb61-1324" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb61-1325"><a href="#cb61-1325" aria-hidden="true" tabindex="-1"></a><span class="fu">## Troubleshooting</span></span>
<span id="cb61-1326"><a href="#cb61-1326" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb61-1327"><a href="#cb61-1327" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>**Systematic tiling** enables parallel processing of large datasets</span>
<span id="cb61-1328"><a href="#cb61-1328" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>**Quality assurance testing** prevents failures in production workflows</span>
<span id="cb61-1329"><a href="#cb61-1329" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>**Adaptive processing priorities** optimize resource utilization</span>
<span id="cb61-1330"><a href="#cb61-1330" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>**Metadata packaging** supports complex workflow orchestration</span>
<span id="cb61-1331"><a href="#cb61-1331" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb61-1332"><a href="#cb61-1332" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb61-1333"><a href="#cb61-1333" aria-hidden="true" tabindex="-1"></a>---</span>
<span id="cb61-1334"><a href="#cb61-1334" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb61-1335"><a href="#cb61-1335" aria-hidden="true" tabindex="-1"></a><span class="fu">## Step 2: Understanding STAC APIs and Cloud-Native Geospatial Architecture</span></span>
<span id="cb61-1336"><a href="#cb61-1336" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb61-1337"><a href="#cb61-1337" aria-hidden="true" tabindex="-1"></a>:::{.callout-tip}</span>
<span id="cb61-1338"><a href="#cb61-1338" aria-hidden="true" tabindex="-1"></a><span class="fu">## Learning Objectives</span></span>
<span id="cb61-1339"><a href="#cb61-1339" aria-hidden="true" tabindex="-1"></a>By the end of this section, you will:</span>
<span id="cb61-1340"><a href="#cb61-1340" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb61-1341"><a href="#cb61-1341" aria-hidden="true" tabindex="-1"></a>Understand the STAC specification and its role in modern geospatial architecture</span>
<span id="cb61-1342"><a href="#cb61-1342" aria-hidden="true" tabindex="-1"></a>Connect to cloud-native data catalogs with proper authentication</span>
<span id="cb61-1343"><a href="#cb61-1343" aria-hidden="true" tabindex="-1"></a>Explore available satellite datasets and their characteristics</span>
<span id="cb61-1344"><a href="#cb61-1344" aria-hidden="true" tabindex="-1"></a>Design robust data discovery workflows for production systems</span>
<span id="cb61-1345"><a href="#cb61-1345" aria-hidden="true" tabindex="-1"></a>:::</span>
<span id="cb61-1346"><a href="#cb61-1346" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb61-1347"><a href="#cb61-1347" aria-hidden="true" tabindex="-1"></a><span class="fu">### The STAC Revolution: From Data Downloads to Cloud-Native Discovery</span></span>
<span id="cb61-1348"><a href="#cb61-1348" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb61-1349"><a href="#cb61-1349" aria-hidden="true" tabindex="-1"></a>**STAC (SpatioTemporal Asset Catalog)** represents a fundamental shift in how we access geospatial data. Instead of downloading entire datasets (often terabytes), STAC enables intelligent, on-demand access to exactly the data you need.</span>
<span id="cb61-1350"><a href="#cb61-1350" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb61-1351"><a href="#cb61-1351" aria-hidden="true" tabindex="-1"></a><span class="fu">#### Why STAC Matters for Geospatial AI</span></span>
<span id="cb61-1352"><a href="#cb61-1352" aria-hidden="true" tabindex="-1"></a>Traditional satellite data distribution faced several challenges. Users were required to download and store massive datasets locally, leading to significant storage bottlenecks. There was no standardized way to search across different providers, making data discovery difficult. Before analysis could begin, heavy preprocessing was often necessary, creating additional barriers. Furthermore, tracking data lineage and updates was challenging, complicating version control.</span>
<span id="cb61-1353"><a href="#cb61-1353" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb61-1354"><a href="#cb61-1354" aria-hidden="true" tabindex="-1"></a>STAC addresses these issues by enabling federated discovery, allowing users to search across multiple data providers through a unified interface. It supports lazy loading, so only the necessary spatial and temporal subsets are accessed. The use of rich, standardized metadata enables intelligent filtering of data. Additionally, STAC is optimized for the cloud, providing direct access to analysis-ready data stored remotely.</span>
<span id="cb61-1355"><a href="#cb61-1355" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb61-1356"><a href="#cb61-1356" aria-hidden="true" tabindex="-1"></a><span class="fu">### STAC Architecture Components</span></span>
<span id="cb61-1357"><a href="#cb61-1357" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb61-1358"><a href="#cb61-1358" aria-hidden="true" tabindex="-1"></a>The STAC architecture is composed of several key elements. STAC Items represent individual scenes or data granules, each described with standardized metadata. These items are grouped into STAC Collections, which organize related items, such as all Sentinel-2 data. Collections and items are further structured within STAC Catalogs, creating a hierarchical organization that enables efficient navigation and discovery. Access to these resources is provided through STAC APIs, which are RESTful interfaces designed for searching and retrieving geospatial data.</span>
<span id="cb61-1359"><a href="#cb61-1359" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb61-1360"><a href="#cb61-1360" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb61-1361"><a href="#cb61-1361" aria-hidden="true" tabindex="-1"></a><span class="fu">### Practical STAC Connection: Microsoft Planetary Computer</span></span>
<span id="cb61-1362"><a href="#cb61-1362" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb61-1363"><a href="#cb61-1363" aria-hidden="true" tabindex="-1"></a>Microsoft Planetary Computer hosts one of the world's largest STAC catalogs, providing free access to petabytes of environmental data. Let's establish a robust connection and explore available datasets.</span>
<span id="cb61-1364"><a href="#cb61-1364" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb61-1365"><a href="#cb61-1365" aria-hidden="true" tabindex="-1"></a><span class="fu">#### Testing STAC Connectivity and Catalog Discovery</span></span>
<span id="cb61-1366"><a href="#cb61-1366" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb61-1367"><a href="#cb61-1367" aria-hidden="true" tabindex="-1"></a>This connection test demonstrates several important concepts for production geospatial systems:</span>
<span id="cb61-1368"><a href="#cb61-1368" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb61-1371"><a href="#cb61-1371" aria-hidden="true" tabindex="-1"></a><span class="in">```{python}</span></span>
<span id="cb61-1372"><a href="#cb61-1372" aria-hidden="true" tabindex="-1"></a><span class="co"># Connect to STAC catalog</span></span>
<span id="cb61-1373"><a href="#cb61-1373" aria-hidden="true" tabindex="-1"></a><span class="cf">try</span>:</span>
<span id="cb61-1374"><a href="#cb61-1374" aria-hidden="true" tabindex="-1"></a>    catalog <span class="op">=</span> Client.<span class="bu">open</span>(</span>
<span id="cb61-1375"><a href="#cb61-1375" aria-hidden="true" tabindex="-1"></a>        <span class="st">"https://planetarycomputer.microsoft.com/api/stac/v1"</span>,</span>
<span id="cb61-1376"><a href="#cb61-1376" aria-hidden="true" tabindex="-1"></a>        modifier<span class="op">=</span>pc.sign_inplace</span>
<span id="cb61-1377"><a href="#cb61-1377" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb61-1378"><a href="#cb61-1378" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb61-1379"><a href="#cb61-1379" aria-hidden="true" tabindex="-1"></a>    logger.info(<span class="st">"Connected to Planetary Computer STAC API"</span>)</span>
<span id="cb61-1380"><a href="#cb61-1380" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb61-1381"><a href="#cb61-1381" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Get catalog information</span></span>
<span id="cb61-1382"><a href="#cb61-1382" aria-hidden="true" tabindex="-1"></a>    <span class="cf">try</span>:</span>
<span id="cb61-1383"><a href="#cb61-1383" aria-hidden="true" tabindex="-1"></a>        catalog_info <span class="op">=</span> catalog.get_self()</span>
<span id="cb61-1384"><a href="#cb61-1384" aria-hidden="true" tabindex="-1"></a>        logger.info(<span class="ss">f"Catalog: </span><span class="sc">{</span>catalog_info<span class="sc">.</span>title<span class="sc">}</span><span class="ss">"</span>)</span>
<span id="cb61-1385"><a href="#cb61-1385" aria-hidden="true" tabindex="-1"></a>    <span class="cf">except</span> <span class="pp">Exception</span>:</span>
<span id="cb61-1386"><a href="#cb61-1386" aria-hidden="true" tabindex="-1"></a>        logger.info(<span class="st">"Basic connection successful"</span>)</span>
<span id="cb61-1387"><a href="#cb61-1387" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb61-1388"><a href="#cb61-1388" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Explore key satellite datasets</span></span>
<span id="cb61-1389"><a href="#cb61-1389" aria-hidden="true" tabindex="-1"></a>    satellite_collections <span class="op">=</span> {</span>
<span id="cb61-1390"><a href="#cb61-1390" aria-hidden="true" tabindex="-1"></a>        <span class="st">'sentinel-2-l2a'</span>: <span class="st">'Sentinel-2 Level 2A (10m optical)'</span>,</span>
<span id="cb61-1391"><a href="#cb61-1391" aria-hidden="true" tabindex="-1"></a>        <span class="st">'landsat-c2-l2'</span>: <span class="st">'Landsat Collection 2 Level 2 (30m optical)'</span>,</span>
<span id="cb61-1392"><a href="#cb61-1392" aria-hidden="true" tabindex="-1"></a>        <span class="st">'sentinel-1-grd'</span>: <span class="st">'Sentinel-1 SAR (radar)'</span>,</span>
<span id="cb61-1393"><a href="#cb61-1393" aria-hidden="true" tabindex="-1"></a>        <span class="st">'naip'</span>: <span class="st">'NAIP (1m aerial imagery)'</span></span>
<span id="cb61-1394"><a href="#cb61-1394" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb61-1395"><a href="#cb61-1395" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb61-1396"><a href="#cb61-1396" aria-hidden="true" tabindex="-1"></a>    available_collections <span class="op">=</span> []</span>
<span id="cb61-1397"><a href="#cb61-1397" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> collection_id, description <span class="kw">in</span> satellite_collections.items():</span>
<span id="cb61-1398"><a href="#cb61-1398" aria-hidden="true" tabindex="-1"></a>        <span class="cf">try</span>:</span>
<span id="cb61-1399"><a href="#cb61-1399" aria-hidden="true" tabindex="-1"></a>            collection <span class="op">=</span> catalog.get_collection(collection_id)</span>
<span id="cb61-1400"><a href="#cb61-1400" aria-hidden="true" tabindex="-1"></a>            available_collections.append(collection_id)</span>
<span id="cb61-1401"><a href="#cb61-1401" aria-hidden="true" tabindex="-1"></a>            logger.info(<span class="ss">f"Available: </span><span class="sc">{</span>description<span class="sc">}</span><span class="ss">"</span>)</span>
<span id="cb61-1402"><a href="#cb61-1402" aria-hidden="true" tabindex="-1"></a>        <span class="cf">except</span> <span class="pp">Exception</span>:</span>
<span id="cb61-1403"><a href="#cb61-1403" aria-hidden="true" tabindex="-1"></a>            logger.warning(<span class="ss">f"Not accessible: </span><span class="sc">{</span>description<span class="sc">}</span><span class="ss">"</span>)</span>
<span id="cb61-1404"><a href="#cb61-1404" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb61-1405"><a href="#cb61-1405" aria-hidden="true" tabindex="-1"></a>    logger.info(<span class="ss">f"Accessible collections: </span><span class="sc">{</span><span class="bu">len</span>(available_collections)<span class="sc">}</span><span class="ss">/</span><span class="sc">{</span><span class="bu">len</span>(satellite_collections)<span class="sc">}</span><span class="ss">"</span>)</span>
<span id="cb61-1406"><a href="#cb61-1406" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb61-1407"><a href="#cb61-1407" aria-hidden="true" tabindex="-1"></a><span class="cf">except</span> <span class="pp">Exception</span> <span class="im">as</span> e:</span>
<span id="cb61-1408"><a href="#cb61-1408" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="ss">f"</span><span class="ch">\n</span><span class="ss">❌ STAC connection failed: </span><span class="sc">{</span><span class="bu">str</span>(e)<span class="sc">}</span><span class="ss">"</span>)</span>
<span id="cb61-1409"><a href="#cb61-1409" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="ss">f"</span><span class="ch">\n</span><span class="ss">🔧 Troubleshooting steps:"</span>)</span>
<span id="cb61-1410"><a href="#cb61-1410" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="ss">f"   1. Verify internet connectivity"</span>)</span>
<span id="cb61-1411"><a href="#cb61-1411" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="ss">f"   2. Check Planetary Computer API status: https://planetarycomputer.microsoft.com/"</span>)</span>
<span id="cb61-1412"><a href="#cb61-1412" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="ss">f"   3. Ensure pystac-client is installed: pip install pystac-client"</span>)</span>
<span id="cb61-1413"><a href="#cb61-1413" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="ss">f"   4. Verify planetary-computer package: pip install planetary-computer"</span>)</span>
<span id="cb61-1414"><a href="#cb61-1414" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="ss">f"   5. Try again in a few minutes (temporary API issues)"</span>)</span>
<span id="cb61-1415"><a href="#cb61-1415" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb61-1416"><a href="#cb61-1416" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Provide fallback information for educational purposes</span></span>
<span id="cb61-1417"><a href="#cb61-1417" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="ss">f"</span><span class="ch">\n</span><span class="ss">📚 Educational Note: Even without connection, you now understand:"</span>)</span>
<span id="cb61-1418"><a href="#cb61-1418" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="ss">f"   • STAC APIs provide standardized geospatial data access"</span>)</span>
<span id="cb61-1419"><a href="#cb61-1419" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="ss">f"   • Cloud-native architectures eliminate data download requirements"</span>)</span>
<span id="cb61-1420"><a href="#cb61-1420" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="ss">f"   • Federated catalogs enable multi-provider data discovery"</span>)</span>
<span id="cb61-1421"><a href="#cb61-1421" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="ss">f"   • Authentication enables enhanced rate limits and access control"</span>)</span>
<span id="cb61-1422"><a href="#cb61-1422" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb61-1423"><a href="#cb61-1423" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb61-1424"><a href="#cb61-1424" aria-hidden="true" tabindex="-1"></a><span class="fu">## Connection Troubleshooting</span></span>
<span id="cb61-1425"><a href="#cb61-1425" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb61-1426"><a href="#cb61-1426" aria-hidden="true" tabindex="-1"></a>If you encounter connection issues, first verify your internet connectivity and check your firewall settings. Keep in mind that anonymous users have lower API rate limits than authenticated users, which can also cause problems. You should also check the <span class="co">[</span><span class="ot">Planetary Computer status page</span><span class="co">](https://planetarycomputer.microsoft.com/)</span> to see if there are any ongoing outages. Finally, make sure you have the latest versions of both the <span class="in">`pystac-client`</span> and <span class="in">`planetary-computer`</span> packages installed.</span>
<span id="cb61-1427"><a href="#cb61-1427" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb61-1428"><a href="#cb61-1428" aria-hidden="true" tabindex="-1"></a>The connection process demonstrates real-world challenges in building production geospatial systems.</span>
<span id="cb61-1429"><a href="#cb61-1429" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb61-1430"><a href="#cb61-1430" aria-hidden="true" tabindex="-1"></a><span class="fu">### Understanding Collection Metadata and Selection Criteria</span></span>
<span id="cb61-1431"><a href="#cb61-1431" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb61-1432"><a href="#cb61-1432" aria-hidden="true" tabindex="-1"></a>Each STAC collection contains rich metadata that helps you choose the right dataset for your analysis. Let's explore how to make informed decisions about which satellite data to use:</span>
<span id="cb61-1433"><a href="#cb61-1433" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb61-1434"><a href="#cb61-1434" aria-hidden="true" tabindex="-1"></a>---</span>
<span id="cb61-1435"><a href="#cb61-1435" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb61-1436"><a href="#cb61-1436" aria-hidden="true" tabindex="-1"></a><span class="fu">## Step 3: Spatial Analysis Design - Defining Areas of Interest</span></span>
<span id="cb61-1437"><a href="#cb61-1437" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb61-1438"><a href="#cb61-1438" aria-hidden="true" tabindex="-1"></a><span class="fu">### Learning Objectives</span></span>
<span id="cb61-1439"><a href="#cb61-1439" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb61-1440"><a href="#cb61-1440" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb61-1441"><a href="#cb61-1441" aria-hidden="true" tabindex="-1"></a>By the end of this section, you will be able to understand coordinate systems and bounding box conventions in geospatial analysis, design effective study areas based on analysis objectives and data characteristics, create interactive maps for spatial context and validation, and apply best practices for reproducible spatial analysis workflows.</span>
<span id="cb61-1442"><a href="#cb61-1442" aria-hidden="true" tabindex="-1"></a>:::</span>
<span id="cb61-1443"><a href="#cb61-1443" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb61-1444"><a href="#cb61-1444" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb61-1445"><a href="#cb61-1445" aria-hidden="true" tabindex="-1"></a><span class="fu">### The Art and Science of Spatial Scope Definition</span></span>
<span id="cb61-1446"><a href="#cb61-1446" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb61-1447"><a href="#cb61-1447" aria-hidden="true" tabindex="-1"></a>Defining your Area of Interest (AOI) is a critical design decision that influences several aspects of your analysis. The size of the area determines the amount of data you need to process and store. The validity of your analysis depends on how well your study boundaries align with relevant ecological or administrative regions. The location of your AOI affects satellite revisit patterns and data availability, and the way you define your area can impact processing efficiency, such as the choice of optimal tile sizes for your workflow.</span>
<span id="cb61-1448"><a href="#cb61-1448" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb61-1449"><a href="#cb61-1449" aria-hidden="true" tabindex="-1"></a><span class="fu">#### Coordinate Systems and Bounding Box Conventions</span></span>
<span id="cb61-1450"><a href="#cb61-1450" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb61-1451"><a href="#cb61-1451" aria-hidden="true" tabindex="-1"></a>For our AOI definition, we will use the WGS84 geographic coordinate system (EPSG:4326). In this system, longitude (X) represents the east-west position and ranges from -180° to +180°, with negative values indicating west. Latitude (Y) represents the north-south position and ranges from -90° to +90°, with negative values indicating south. Bounding boxes are formatted as <span class="co">[</span><span class="ot">west, south, east, north</span><span class="co">]</span>, corresponding to (min_x, min_y, max_x, max_y).</span>
<span id="cb61-1452"><a href="#cb61-1452" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb61-1453"><a href="#cb61-1453" aria-hidden="true" tabindex="-1"></a><span class="fu">#### Study Area Selection: San Francisco Bay Area</span></span>
<span id="cb61-1454"><a href="#cb61-1454" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb61-1455"><a href="#cb61-1455" aria-hidden="true" tabindex="-1"></a>We'll use the San Francisco Bay Area as our exemplar study region because it features a mix of urban, water, agricultural, and natural environments. The region is characterized by dynamic processes such as urban growth, vegetation changes, and water level fluctuations. It also benefits from frequent satellite coverage with minimal cloud interference and presents geographic complexity, including islands, peninsulas, and varied topography.</span>
<span id="cb61-1456"><a href="#cb61-1456" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb61-1457"><a href="#cb61-1457" aria-hidden="true" tabindex="-1"></a>**Designing Area of Interest (AOI) for Geospatial Analysis**</span>
<span id="cb61-1458"><a href="#cb61-1458" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb61-1459"><a href="#cb61-1459" aria-hidden="true" tabindex="-1"></a>This demonstrates spatial scope definition for satellite-based studies. We'll work with the San Francisco Bay Area as our primary study area.</span>
<span id="cb61-1460"><a href="#cb61-1460" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb61-1463"><a href="#cb61-1463" aria-hidden="true" tabindex="-1"></a><span class="in">```{python}</span></span>
<span id="cb61-1464"><a href="#cb61-1464" aria-hidden="true" tabindex="-1"></a><span class="co"># Step 3A: Define Area of Interest with Geographic Reasoning</span></span>
<span id="cb61-1465"><a href="#cb61-1465" aria-hidden="true" tabindex="-1"></a><span class="co"># Primary study area: San Francisco Bay Area</span></span>
<span id="cb61-1466"><a href="#cb61-1466" aria-hidden="true" tabindex="-1"></a><span class="co"># Coordinates chosen to encompass the greater metropolitan region</span></span>
<span id="cb61-1467"><a href="#cb61-1467" aria-hidden="true" tabindex="-1"></a>sf_bay_bbox <span class="op">=</span> [<span class="op">-</span><span class="fl">122.5</span>, <span class="fl">37.3</span>, <span class="op">-</span><span class="fl">121.8</span>, <span class="fl">38.0</span>]  <span class="co"># [west, south, east, north]</span></span>
<span id="cb61-1468"><a href="#cb61-1468" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb61-1469"><a href="#cb61-1469" aria-hidden="true" tabindex="-1"></a><span class="co"># Import required libraries for spatial calculations</span></span>
<span id="cb61-1470"><a href="#cb61-1470" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> shapely.geometry <span class="im">import</span> box</span>
<span id="cb61-1471"><a href="#cb61-1471" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> os</span>
<span id="cb61-1472"><a href="#cb61-1472" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb61-1473"><a href="#cb61-1473" aria-hidden="true" tabindex="-1"></a><span class="co"># Create geometry object for area calculations</span></span>
<span id="cb61-1474"><a href="#cb61-1474" aria-hidden="true" tabindex="-1"></a>aoi_geom <span class="op">=</span> box(<span class="op">*</span>sf_bay_bbox)</span>
<span id="cb61-1475"><a href="#cb61-1475" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb61-1476"><a href="#cb61-1476" aria-hidden="true" tabindex="-1"></a><span class="co"># Calculate basic spatial metrics</span></span>
<span id="cb61-1477"><a href="#cb61-1477" aria-hidden="true" tabindex="-1"></a>area_degrees <span class="op">=</span> aoi_geom.area</span>
<span id="cb61-1478"><a href="#cb61-1478" aria-hidden="true" tabindex="-1"></a><span class="co"># Approximate conversion to kilometers (valid for mid-latitudes)</span></span>
<span id="cb61-1479"><a href="#cb61-1479" aria-hidden="true" tabindex="-1"></a>center_lat <span class="op">=</span> (sf_bay_bbox[<span class="dv">1</span>] <span class="op">+</span> sf_bay_bbox[<span class="dv">3</span>]) <span class="op">/</span> <span class="dv">2</span></span>
<span id="cb61-1480"><a href="#cb61-1480" aria-hidden="true" tabindex="-1"></a>lat_correction <span class="op">=</span> np.cos(np.radians(center_lat))</span>
<span id="cb61-1481"><a href="#cb61-1481" aria-hidden="true" tabindex="-1"></a>area_km2 <span class="op">=</span> area_degrees <span class="op">*</span> (<span class="fl">111.32</span> <span class="op">**</span> <span class="dv">2</span>) <span class="op">*</span> lat_correction  <span class="co"># 1 degree ≈ 111.32 km</span></span>
<span id="cb61-1482"><a href="#cb61-1482" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb61-1483"><a href="#cb61-1483" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"</span><span class="ch">\n</span><span class="ss">📊 AOI Spatial Characteristics:"</span>)</span>
<span id="cb61-1484"><a href="#cb61-1484" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"   📍 Region: San Francisco Bay Area"</span>)</span>
<span id="cb61-1485"><a href="#cb61-1485" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"   🗺️ Bounding box: </span><span class="sc">{</span>sf_bay_bbox<span class="sc">}</span><span class="ss">"</span>)</span>
<span id="cb61-1486"><a href="#cb61-1486" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"   📐 Dimensions: </span><span class="sc">{</span>(sf_bay_bbox[<span class="dv">2</span>] <span class="op">-</span> sf_bay_bbox[<span class="dv">0</span>])<span class="sc">:.2f}</span><span class="ss">° × </span><span class="sc">{</span>(sf_bay_bbox[<span class="dv">3</span>] <span class="op">-</span> sf_bay_bbox[<span class="dv">1</span>])<span class="sc">:.2f}</span><span class="ss">°"</span>)</span>
<span id="cb61-1487"><a href="#cb61-1487" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"   📏 Approximate area: </span><span class="sc">{</span>area_km2<span class="sc">:.0f}</span><span class="ss"> km²"</span>)</span>
<span id="cb61-1488"><a href="#cb61-1488" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"   🏙️ Population: ~8 million (Bay Area metropolitan region)"</span>)</span>
<span id="cb61-1489"><a href="#cb61-1489" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb61-1490"><a href="#cb61-1490" aria-hidden="true" tabindex="-1"></a><span class="co"># Provide alternative study areas for different research interests</span></span>
<span id="cb61-1491"><a href="#cb61-1491" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"</span><span class="ch">\n</span><span class="ss">🌐 Alternative AOI Options for Different Study Objectives:"</span>)</span>
<span id="cb61-1492"><a href="#cb61-1492" aria-hidden="true" tabindex="-1"></a>alternative_aois <span class="op">=</span> {</span>
<span id="cb61-1493"><a href="#cb61-1493" aria-hidden="true" tabindex="-1"></a>    <span class="st">"Los Angeles Basin"</span>: {</span>
<span id="cb61-1494"><a href="#cb61-1494" aria-hidden="true" tabindex="-1"></a>        <span class="st">"bbox"</span>: [<span class="op">-</span><span class="fl">118.7</span>, <span class="fl">33.7</span>, <span class="op">-</span><span class="fl">118.1</span>, <span class="fl">34.3</span>],</span>
<span id="cb61-1495"><a href="#cb61-1495" aria-hidden="true" tabindex="-1"></a>        <span class="st">"focus"</span>: <span class="st">"Urban heat islands, air quality, sprawl patterns"</span>,</span>
<span id="cb61-1496"><a href="#cb61-1496" aria-hidden="true" tabindex="-1"></a>        <span class="st">"challenges"</span>: <span class="st">"Frequent clouds, complex topography"</span></span>
<span id="cb61-1497"><a href="#cb61-1497" aria-hidden="true" tabindex="-1"></a>    },</span>
<span id="cb61-1498"><a href="#cb61-1498" aria-hidden="true" tabindex="-1"></a>    <span class="st">"New York City"</span>: {</span>
<span id="cb61-1499"><a href="#cb61-1499" aria-hidden="true" tabindex="-1"></a>        <span class="st">"bbox"</span>: [<span class="op">-</span><span class="fl">74.3</span>, <span class="fl">40.5</span>, <span class="op">-</span><span class="fl">73.7</span>, <span class="fl">40.9</span>],</span>
<span id="cb61-1500"><a href="#cb61-1500" aria-hidden="true" tabindex="-1"></a>        <span class="st">"focus"</span>: <span class="st">"Dense urban analysis, coastal processes"</span>,</span>
<span id="cb61-1501"><a href="#cb61-1501" aria-hidden="true" tabindex="-1"></a>        <span class="st">"challenges"</span>: <span class="st">"Seasonal cloud cover, urban shadows"</span></span>
<span id="cb61-1502"><a href="#cb61-1502" aria-hidden="true" tabindex="-1"></a>    },</span>
<span id="cb61-1503"><a href="#cb61-1503" aria-hidden="true" tabindex="-1"></a>    <span class="st">"Central Valley Agriculture"</span>: {</span>
<span id="cb61-1504"><a href="#cb61-1504" aria-hidden="true" tabindex="-1"></a>        <span class="st">"bbox"</span>: [<span class="op">-</span><span class="fl">121.5</span>, <span class="fl">36.0</span>, <span class="op">-</span><span class="fl">120.0</span>, <span class="fl">37.5</span>],</span>
<span id="cb61-1505"><a href="#cb61-1505" aria-hidden="true" tabindex="-1"></a>        <span class="st">"focus"</span>: <span class="st">"Crop monitoring, irrigation patterns, drought"</span>,</span>
<span id="cb61-1506"><a href="#cb61-1506" aria-hidden="true" tabindex="-1"></a>        <span class="st">"challenges"</span>: <span class="st">"Seasonal variations, haze"</span></span>
<span id="cb61-1507"><a href="#cb61-1507" aria-hidden="true" tabindex="-1"></a>    },</span>
<span id="cb61-1508"><a href="#cb61-1508" aria-hidden="true" tabindex="-1"></a>    <span class="st">"Florida Everglades"</span>: {</span>
<span id="cb61-1509"><a href="#cb61-1509" aria-hidden="true" tabindex="-1"></a>        <span class="st">"bbox"</span>: [<span class="op">-</span><span class="fl">81.5</span>, <span class="fl">25.0</span>, <span class="op">-</span><span class="fl">80.0</span>, <span class="fl">26.5</span>],</span>
<span id="cb61-1510"><a href="#cb61-1510" aria-hidden="true" tabindex="-1"></a>        <span class="st">"focus"</span>: <span class="st">"Wetland monitoring, water levels, restoration"</span>,</span>
<span id="cb61-1511"><a href="#cb61-1511" aria-hidden="true" tabindex="-1"></a>        <span class="st">"challenges"</span>: <span class="st">"Frequent clouds, seasonal flooding"</span></span>
<span id="cb61-1512"><a href="#cb61-1512" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb61-1513"><a href="#cb61-1513" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb61-1514"><a href="#cb61-1514" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb61-1515"><a href="#cb61-1515" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> region, info <span class="kw">in</span> alternative_aois.items():</span>
<span id="cb61-1516"><a href="#cb61-1516" aria-hidden="true" tabindex="-1"></a>    bbox <span class="op">=</span> info[<span class="st">"bbox"</span>]</span>
<span id="cb61-1517"><a href="#cb61-1517" aria-hidden="true" tabindex="-1"></a>    area_alt <span class="op">=</span> ((bbox[<span class="dv">2</span>] <span class="op">-</span> bbox[<span class="dv">0</span>]) <span class="op">*</span> (bbox[<span class="dv">3</span>] <span class="op">-</span> bbox[<span class="dv">1</span>]) <span class="op">*</span></span>
<span id="cb61-1518"><a href="#cb61-1518" aria-hidden="true" tabindex="-1"></a>                (<span class="fl">111.32</span> <span class="op">**</span> <span class="dv">2</span>) <span class="op">*</span> np.cos(np.radians((bbox[<span class="dv">1</span>] <span class="op">+</span> bbox[<span class="dv">3</span>]) <span class="op">/</span> <span class="dv">2</span>)))</span>
<span id="cb61-1519"><a href="#cb61-1519" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="ss">f"   🗺️ </span><span class="sc">{</span>region<span class="sc">}</span><span class="ss">: </span><span class="sc">{</span>info[<span class="st">'bbox'</span>]<span class="sc">}</span><span class="ss"> (</span><span class="sc">{</span>area_alt<span class="sc">:.0f}</span><span class="ss"> km²)"</span>)</span>
<span id="cb61-1520"><a href="#cb61-1520" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="ss">f"      🎯 Research focus: </span><span class="sc">{</span>info[<span class="st">'focus'</span>]<span class="sc">}</span><span class="ss">"</span>)</span>
<span id="cb61-1521"><a href="#cb61-1521" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="ss">f"      ⚠️ Considerations: </span><span class="sc">{</span>info[<span class="st">'challenges'</span>]<span class="sc">}</span><span class="ss">"</span>)</span>
<span id="cb61-1522"><a href="#cb61-1522" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb61-1523"><a href="#cb61-1523" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"</span><span class="ch">\n</span><span class="ss">💡 Pro Tip: Choose AOI based on:"</span>)</span>
<span id="cb61-1524"><a href="#cb61-1524" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"   1. Research objectives and required spatial resolution"</span>)</span>
<span id="cb61-1525"><a href="#cb61-1525" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"   2. Data availability and typical cloud cover patterns"</span>)</span>
<span id="cb61-1526"><a href="#cb61-1526" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"   3. Computational resources and processing time constraints"</span>)</span>
<span id="cb61-1527"><a href="#cb61-1527" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"   4. Ecological or administrative boundary alignment"</span>)</span>
<span id="cb61-1528"><a href="#cb61-1528" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb61-1529"><a href="#cb61-1529" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb61-1530"><a href="#cb61-1530" aria-hidden="true" tabindex="-1"></a><span class="fu">#### Interactive Mapping for Spatial Context and Validation</span></span>
<span id="cb61-1531"><a href="#cb61-1531" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb61-1532"><a href="#cb61-1532" aria-hidden="true" tabindex="-1"></a>Creating interactive maps serves several important purposes in geospatial analysis, such as providing spatial context to understand the geographic setting and features, validating that the area of interest (AOI) encompasses the intended study features, supporting stakeholder communication through visual representation for project discussions, and enabling quality assurance by helping to detect coordinate errors or unrealistic extents.</span>
<span id="cb61-1533"><a href="#cb61-1533" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb61-1534"><a href="#cb61-1534" aria-hidden="true" tabindex="-1"></a>**Creating Interactive Map for Spatial Context:**</span>
<span id="cb61-1535"><a href="#cb61-1535" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb61-1536"><a href="#cb61-1536" aria-hidden="true" tabindex="-1"></a>This demonstrates best practices for geospatial visualization with multiple basemap options.</span>
<span id="cb61-1537"><a href="#cb61-1537" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb61-1540"><a href="#cb61-1540" aria-hidden="true" tabindex="-1"></a><span class="in">```{python}</span></span>
<span id="cb61-1541"><a href="#cb61-1541" aria-hidden="true" tabindex="-1"></a><span class="co"># Step 3B: Create Interactive Map with Multiple Basemap Options</span></span>
<span id="cb61-1542"><a href="#cb61-1542" aria-hidden="true" tabindex="-1"></a><span class="co"># Calculate map center for optimal display</span></span>
<span id="cb61-1543"><a href="#cb61-1543" aria-hidden="true" tabindex="-1"></a>center_lat <span class="op">=</span> (sf_bay_bbox[<span class="dv">1</span>] <span class="op">+</span> sf_bay_bbox[<span class="dv">3</span>]) <span class="op">/</span> <span class="dv">2</span></span>
<span id="cb61-1544"><a href="#cb61-1544" aria-hidden="true" tabindex="-1"></a>center_lon <span class="op">=</span> (sf_bay_bbox[<span class="dv">0</span>] <span class="op">+</span> sf_bay_bbox[<span class="dv">2</span>]) <span class="op">/</span> <span class="dv">2</span></span>
<span id="cb61-1545"><a href="#cb61-1545" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb61-1546"><a href="#cb61-1546" aria-hidden="true" tabindex="-1"></a><span class="co"># Initialize folium map with appropriate zoom level</span></span>
<span id="cb61-1547"><a href="#cb61-1547" aria-hidden="true" tabindex="-1"></a><span class="co"># Zoom level chosen to show entire AOI while maintaining detail</span></span>
<span id="cb61-1548"><a href="#cb61-1548" aria-hidden="true" tabindex="-1"></a>m <span class="op">=</span> folium.Map(</span>
<span id="cb61-1549"><a href="#cb61-1549" aria-hidden="true" tabindex="-1"></a>    location<span class="op">=</span>[center_lat, center_lon],</span>
<span id="cb61-1550"><a href="#cb61-1550" aria-hidden="true" tabindex="-1"></a>    zoom_start<span class="op">=</span><span class="dv">9</span>,  <span class="co"># Optimal for metropolitan area viewing</span></span>
<span id="cb61-1551"><a href="#cb61-1551" aria-hidden="true" tabindex="-1"></a>    tiles<span class="op">=</span><span class="st">'OpenStreetMap'</span></span>
<span id="cb61-1552"><a href="#cb61-1552" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb61-1553"><a href="#cb61-1553" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb61-1554"><a href="#cb61-1554" aria-hidden="true" tabindex="-1"></a><span class="co"># Add diverse basemap options for different analysis contexts</span></span>
<span id="cb61-1555"><a href="#cb61-1555" aria-hidden="true" tabindex="-1"></a>basemap_options <span class="op">=</span> {</span>
<span id="cb61-1556"><a href="#cb61-1556" aria-hidden="true" tabindex="-1"></a>    <span class="st">'CartoDB positron'</span>: {</span>
<span id="cb61-1557"><a href="#cb61-1557" aria-hidden="true" tabindex="-1"></a>        <span class="st">'layer'</span>: folium.TileLayer(<span class="st">'CartoDB positron'</span>, name<span class="op">=</span><span class="st">'Clean Basemap'</span>),</span>
<span id="cb61-1558"><a href="#cb61-1558" aria-hidden="true" tabindex="-1"></a>        <span class="st">'use_case'</span>: <span class="st">'Data overlay visualization, presentations'</span></span>
<span id="cb61-1559"><a href="#cb61-1559" aria-hidden="true" tabindex="-1"></a>    },</span>
<span id="cb61-1560"><a href="#cb61-1560" aria-hidden="true" tabindex="-1"></a>    <span class="st">'CartoDB dark_matter'</span>: {</span>
<span id="cb61-1561"><a href="#cb61-1561" aria-hidden="true" tabindex="-1"></a>        <span class="st">'layer'</span>: folium.TileLayer(<span class="st">'CartoDB dark_matter'</span>, name<span class="op">=</span><span class="st">'Dark Theme'</span>),</span>
<span id="cb61-1562"><a href="#cb61-1562" aria-hidden="true" tabindex="-1"></a>        <span class="st">'use_case'</span>: <span class="st">'Night mode, reducing eye strain'</span></span>
<span id="cb61-1563"><a href="#cb61-1563" aria-hidden="true" tabindex="-1"></a>    },</span>
<span id="cb61-1564"><a href="#cb61-1564" aria-hidden="true" tabindex="-1"></a>    <span class="st">'Esri World Imagery'</span>: {</span>
<span id="cb61-1565"><a href="#cb61-1565" aria-hidden="true" tabindex="-1"></a>        <span class="st">'layer'</span>: folium.TileLayer(</span>
<span id="cb61-1566"><a href="#cb61-1566" aria-hidden="true" tabindex="-1"></a>            tiles<span class="op">=</span><span class="st">'https://server.arcgisonline.com/ArcGIS/rest/services/World_Imagery/MapServer/tile/</span><span class="sc">{z}</span><span class="st">/</span><span class="sc">{y}</span><span class="st">/</span><span class="sc">{x}</span><span class="st">'</span>,</span>
<span id="cb61-1567"><a href="#cb61-1567" aria-hidden="true" tabindex="-1"></a>            attr<span class="op">=</span><span class="st">'Esri'</span>, name<span class="op">=</span><span class="st">'Satellite Imagery'</span>, overlay<span class="op">=</span><span class="va">False</span>, control<span class="op">=</span><span class="va">True</span></span>
<span id="cb61-1568"><a href="#cb61-1568" aria-hidden="true" tabindex="-1"></a>        ),</span>
<span id="cb61-1569"><a href="#cb61-1569" aria-hidden="true" tabindex="-1"></a>        <span class="st">'use_case'</span>: <span class="st">'Ground truth validation, visual interpretation'</span></span>
<span id="cb61-1570"><a href="#cb61-1570" aria-hidden="true" tabindex="-1"></a>    },</span>
<span id="cb61-1571"><a href="#cb61-1571" aria-hidden="true" tabindex="-1"></a>    <span class="st">'Stamen Terrain'</span>: {</span>
<span id="cb61-1572"><a href="#cb61-1572" aria-hidden="true" tabindex="-1"></a>        <span class="st">'layer'</span>: folium.TileLayer(</span>
<span id="cb61-1573"><a href="#cb61-1573" aria-hidden="true" tabindex="-1"></a>            <span class="st">'Stamen Terrain'</span>,</span>
<span id="cb61-1574"><a href="#cb61-1574" aria-hidden="true" tabindex="-1"></a>            name<span class="op">=</span><span class="st">'Topographic'</span>,</span>
<span id="cb61-1575"><a href="#cb61-1575" aria-hidden="true" tabindex="-1"></a>            attr<span class="op">=</span><span class="st">'Map tiles by Stamen Design, CC BY 3.0 — Map data © OpenStreetMap contributors'</span></span>
<span id="cb61-1576"><a href="#cb61-1576" aria-hidden="true" tabindex="-1"></a>        ),</span>
<span id="cb61-1577"><a href="#cb61-1577" aria-hidden="true" tabindex="-1"></a>        <span class="st">'use_case'</span>: <span class="st">'Elevation context, watershed analysis'</span></span>
<span id="cb61-1578"><a href="#cb61-1578" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb61-1579"><a href="#cb61-1579" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb61-1580"><a href="#cb61-1580" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb61-1581"><a href="#cb61-1581" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"   📚 Adding </span><span class="sc">{</span><span class="bu">len</span>(basemap_options)<span class="sc">}</span><span class="ss"> basemap options:"</span>)</span>
<span id="cb61-1582"><a href="#cb61-1582" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> name, info <span class="kw">in</span> basemap_options.items():</span>
<span id="cb61-1583"><a href="#cb61-1583" aria-hidden="true" tabindex="-1"></a>    info[<span class="st">'layer'</span>].add_to(m)</span>
<span id="cb61-1584"><a href="#cb61-1584" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="ss">f"     • </span><span class="sc">{</span>name<span class="sc">}</span><span class="ss">: </span><span class="sc">{</span>info[<span class="st">'use_case'</span>]<span class="sc">}</span><span class="ss">"</span>)</span>
<span id="cb61-1585"><a href="#cb61-1585" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb61-1586"><a href="#cb61-1586" aria-hidden="true" tabindex="-1"></a><span class="co"># Add AOI boundary with informative styling</span></span>
<span id="cb61-1587"><a href="#cb61-1587" aria-hidden="true" tabindex="-1"></a>aoi_bounds <span class="op">=</span> [[sf_bay_bbox[<span class="dv">1</span>], sf_bay_bbox[<span class="dv">0</span>]],  <span class="co"># southwest corner</span></span>
<span id="cb61-1588"><a href="#cb61-1588" aria-hidden="true" tabindex="-1"></a>              [sf_bay_bbox[<span class="dv">3</span>], sf_bay_bbox[<span class="dv">2</span>]]]  <span class="co"># northeast corner</span></span>
<span id="cb61-1589"><a href="#cb61-1589" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb61-1590"><a href="#cb61-1590" aria-hidden="true" tabindex="-1"></a>folium.Rectangle(</span>
<span id="cb61-1591"><a href="#cb61-1591" aria-hidden="true" tabindex="-1"></a>    bounds<span class="op">=</span>aoi_bounds,</span>
<span id="cb61-1592"><a href="#cb61-1592" aria-hidden="true" tabindex="-1"></a>    color<span class="op">=</span><span class="st">'red'</span>,</span>
<span id="cb61-1593"><a href="#cb61-1593" aria-hidden="true" tabindex="-1"></a>    weight<span class="op">=</span><span class="dv">3</span>,</span>
<span id="cb61-1594"><a href="#cb61-1594" aria-hidden="true" tabindex="-1"></a>    fill<span class="op">=</span><span class="va">True</span>,</span>
<span id="cb61-1595"><a href="#cb61-1595" aria-hidden="true" tabindex="-1"></a>    fillOpacity<span class="op">=</span><span class="fl">0.1</span>,</span>
<span id="cb61-1596"><a href="#cb61-1596" aria-hidden="true" tabindex="-1"></a>    popup<span class="op">=</span>folium.Popup(</span>
<span id="cb61-1597"><a href="#cb61-1597" aria-hidden="true" tabindex="-1"></a>        <span class="ss">f"""</span></span>
<span id="cb61-1598"><a href="#cb61-1598" aria-hidden="true" tabindex="-1"></a><span class="ss">        &lt;div style="font-family: Arial; width: 300px;"&gt;</span></span>
<span id="cb61-1599"><a href="#cb61-1599" aria-hidden="true" tabindex="-1"></a><span class="ss">        &lt;h4&gt;📊 Study Area Details&lt;/h4&gt;</span></span>
<span id="cb61-1600"><a href="#cb61-1600" aria-hidden="true" tabindex="-1"></a><span class="ss">        &lt;b&gt;Region:&lt;/b&gt; San Francisco Bay Area&lt;br&gt;</span></span>
<span id="cb61-1601"><a href="#cb61-1601" aria-hidden="true" tabindex="-1"></a><span class="ss">        &lt;b&gt;Coordinates:&lt;/b&gt; </span><span class="sc">{</span>sf_bay_bbox<span class="sc">}</span><span class="ss">&lt;br&gt;</span></span>
<span id="cb61-1602"><a href="#cb61-1602" aria-hidden="true" tabindex="-1"></a><span class="ss">        &lt;b&gt;Area:&lt;/b&gt; </span><span class="sc">{</span>area_km2<span class="sc">:.0f}</span><span class="ss"> km²&lt;br&gt;</span></span>
<span id="cb61-1603"><a href="#cb61-1603" aria-hidden="true" tabindex="-1"></a><span class="ss">        &lt;b&gt;Purpose:&lt;/b&gt; Geospatial AI Training&lt;br&gt;</span></span>
<span id="cb61-1604"><a href="#cb61-1604" aria-hidden="true" tabindex="-1"></a><span class="ss">        &lt;b&gt;Data Type:&lt;/b&gt; Sentinel-2 Optical&lt;br&gt;</span></span>
<span id="cb61-1605"><a href="#cb61-1605" aria-hidden="true" tabindex="-1"></a><span class="ss">        &lt;/div&gt;</span></span>
<span id="cb61-1606"><a href="#cb61-1606" aria-hidden="true" tabindex="-1"></a><span class="ss">        """</span>,</span>
<span id="cb61-1607"><a href="#cb61-1607" aria-hidden="true" tabindex="-1"></a>        max_width<span class="op">=</span><span class="dv">350</span></span>
<span id="cb61-1608"><a href="#cb61-1608" aria-hidden="true" tabindex="-1"></a>    ),</span>
<span id="cb61-1609"><a href="#cb61-1609" aria-hidden="true" tabindex="-1"></a>    tooltip<span class="op">=</span><span class="st">"Study Area Boundary - Click for details"</span></span>
<span id="cb61-1610"><a href="#cb61-1610" aria-hidden="true" tabindex="-1"></a>).add_to(m)</span>
<span id="cb61-1611"><a href="#cb61-1611" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb61-1612"><a href="#cb61-1612" aria-hidden="true" tabindex="-1"></a><span class="co"># Add geographic reference points with contextual information</span></span>
<span id="cb61-1613"><a href="#cb61-1613" aria-hidden="true" tabindex="-1"></a>reference_locations <span class="op">=</span> [</span>
<span id="cb61-1614"><a href="#cb61-1614" aria-hidden="true" tabindex="-1"></a>    {</span>
<span id="cb61-1615"><a href="#cb61-1615" aria-hidden="true" tabindex="-1"></a>        <span class="st">"name"</span>: <span class="st">"San Francisco"</span>,</span>
<span id="cb61-1616"><a href="#cb61-1616" aria-hidden="true" tabindex="-1"></a>        <span class="st">"coords"</span>: [<span class="fl">37.7749</span>, <span class="op">-</span><span class="fl">122.4194</span>],</span>
<span id="cb61-1617"><a href="#cb61-1617" aria-hidden="true" tabindex="-1"></a>        <span class="st">"description"</span>: <span class="st">"Urban core, dense development"</span>,</span>
<span id="cb61-1618"><a href="#cb61-1618" aria-hidden="true" tabindex="-1"></a>        <span class="st">"icon"</span>: <span class="st">"building"</span>,</span>
<span id="cb61-1619"><a href="#cb61-1619" aria-hidden="true" tabindex="-1"></a>        <span class="st">"color"</span>: <span class="st">"blue"</span></span>
<span id="cb61-1620"><a href="#cb61-1620" aria-hidden="true" tabindex="-1"></a>    },</span>
<span id="cb61-1621"><a href="#cb61-1621" aria-hidden="true" tabindex="-1"></a>    {</span>
<span id="cb61-1622"><a href="#cb61-1622" aria-hidden="true" tabindex="-1"></a>        <span class="st">"name"</span>: <span class="st">"Oakland"</span>,</span>
<span id="cb61-1623"><a href="#cb61-1623" aria-hidden="true" tabindex="-1"></a>        <span class="st">"coords"</span>: [<span class="fl">37.8044</span>, <span class="op">-</span><span class="fl">122.2712</span>],</span>
<span id="cb61-1624"><a href="#cb61-1624" aria-hidden="true" tabindex="-1"></a>        <span class="st">"description"</span>: <span class="st">"Port city, mixed urban-industrial"</span>,</span>
<span id="cb61-1625"><a href="#cb61-1625" aria-hidden="true" tabindex="-1"></a>        <span class="st">"icon"</span>: <span class="st">"ship"</span>,</span>
<span id="cb61-1626"><a href="#cb61-1626" aria-hidden="true" tabindex="-1"></a>        <span class="st">"color"</span>: <span class="st">"green"</span></span>
<span id="cb61-1627"><a href="#cb61-1627" aria-hidden="true" tabindex="-1"></a>    },</span>
<span id="cb61-1628"><a href="#cb61-1628" aria-hidden="true" tabindex="-1"></a>    {</span>
<span id="cb61-1629"><a href="#cb61-1629" aria-hidden="true" tabindex="-1"></a>        <span class="st">"name"</span>: <span class="st">"San Jose"</span>,</span>
<span id="cb61-1630"><a href="#cb61-1630" aria-hidden="true" tabindex="-1"></a>        <span class="st">"coords"</span>: [<span class="fl">37.3382</span>, <span class="op">-</span><span class="fl">121.8863</span>],</span>
<span id="cb61-1631"><a href="#cb61-1631" aria-hidden="true" tabindex="-1"></a>        <span class="st">"description"</span>: <span class="st">"Silicon Valley, tech corridors"</span>,</span>
<span id="cb61-1632"><a href="#cb61-1632" aria-hidden="true" tabindex="-1"></a>        <span class="st">"icon"</span>: <span class="st">"microchip"</span>,</span>
<span id="cb61-1633"><a href="#cb61-1633" aria-hidden="true" tabindex="-1"></a>        <span class="st">"color"</span>: <span class="st">"purple"</span></span>
<span id="cb61-1634"><a href="#cb61-1634" aria-hidden="true" tabindex="-1"></a>    },</span>
<span id="cb61-1635"><a href="#cb61-1635" aria-hidden="true" tabindex="-1"></a>    {</span>
<span id="cb61-1636"><a href="#cb61-1636" aria-hidden="true" tabindex="-1"></a>        <span class="st">"name"</span>: <span class="st">"Palo Alto"</span>,</span>
<span id="cb61-1637"><a href="#cb61-1637" aria-hidden="true" tabindex="-1"></a>        <span class="st">"coords"</span>: [<span class="fl">37.4419</span>, <span class="op">-</span><span class="fl">122.1430</span>],</span>
<span id="cb61-1638"><a href="#cb61-1638" aria-hidden="true" tabindex="-1"></a>        <span class="st">"description"</span>: <span class="st">"University town, research facilities"</span>,</span>
<span id="cb61-1639"><a href="#cb61-1639" aria-hidden="true" tabindex="-1"></a>        <span class="st">"icon"</span>: <span class="st">"graduation-cap"</span>,</span>
<span id="cb61-1640"><a href="#cb61-1640" aria-hidden="true" tabindex="-1"></a>        <span class="st">"color"</span>: <span class="st">"orange"</span></span>
<span id="cb61-1641"><a href="#cb61-1641" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb61-1642"><a href="#cb61-1642" aria-hidden="true" tabindex="-1"></a>]</span>
<span id="cb61-1643"><a href="#cb61-1643" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb61-1644"><a href="#cb61-1644" aria-hidden="true" tabindex="-1"></a>logger.info(<span class="ss">f"Adding </span><span class="sc">{</span><span class="bu">len</span>(reference_locations)<span class="sc">}</span><span class="ss"> geographic reference points"</span>)</span>
<span id="cb61-1645"><a href="#cb61-1645" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> location <span class="kw">in</span> reference_locations:</span>
<span id="cb61-1646"><a href="#cb61-1646" aria-hidden="true" tabindex="-1"></a>    logger.debug(<span class="ss">f"</span><span class="sc">{</span>location[<span class="st">'name'</span>]<span class="sc">}</span><span class="ss">: </span><span class="sc">{</span>location[<span class="st">'description'</span>]<span class="sc">}</span><span class="ss">"</span>)</span>
<span id="cb61-1647"><a href="#cb61-1647" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb61-1648"><a href="#cb61-1648" aria-hidden="true" tabindex="-1"></a>    folium.Marker(</span>
<span id="cb61-1649"><a href="#cb61-1649" aria-hidden="true" tabindex="-1"></a>        location<span class="op">=</span>location[<span class="st">"coords"</span>],</span>
<span id="cb61-1650"><a href="#cb61-1650" aria-hidden="true" tabindex="-1"></a>        popup<span class="op">=</span>folium.Popup(</span>
<span id="cb61-1651"><a href="#cb61-1651" aria-hidden="true" tabindex="-1"></a>            <span class="ss">f"""</span></span>
<span id="cb61-1652"><a href="#cb61-1652" aria-hidden="true" tabindex="-1"></a><span class="ss">            &lt;div style="font-family: Arial;"&gt;</span></span>
<span id="cb61-1653"><a href="#cb61-1653" aria-hidden="true" tabindex="-1"></a><span class="ss">            &lt;h4&gt;</span><span class="sc">{</span>location[<span class="st">'name'</span>]<span class="sc">}</span><span class="ss">&lt;/h4&gt;</span></span>
<span id="cb61-1654"><a href="#cb61-1654" aria-hidden="true" tabindex="-1"></a><span class="ss">            &lt;b&gt;Coordinates:&lt;/b&gt; </span><span class="sc">{</span>location[<span class="st">'coords'</span>][<span class="dv">0</span>]<span class="sc">:.4f}</span><span class="ss">, </span><span class="sc">{</span>location[<span class="st">'coords'</span>][<span class="dv">1</span>]<span class="sc">:.4f}</span><span class="ss">&lt;br&gt;</span></span>
<span id="cb61-1655"><a href="#cb61-1655" aria-hidden="true" tabindex="-1"></a><span class="ss">            &lt;b&gt;Context:&lt;/b&gt; </span><span class="sc">{</span>location[<span class="st">'description'</span>]<span class="sc">}</span><span class="ss">&lt;br&gt;</span></span>
<span id="cb61-1656"><a href="#cb61-1656" aria-hidden="true" tabindex="-1"></a><span class="ss">            &lt;b&gt;Role in Analysis:&lt;/b&gt; Geographic reference point</span></span>
<span id="cb61-1657"><a href="#cb61-1657" aria-hidden="true" tabindex="-1"></a><span class="ss">            &lt;/div&gt;</span></span>
<span id="cb61-1658"><a href="#cb61-1658" aria-hidden="true" tabindex="-1"></a><span class="ss">            """</span>,</span>
<span id="cb61-1659"><a href="#cb61-1659" aria-hidden="true" tabindex="-1"></a>            max_width<span class="op">=</span><span class="dv">250</span></span>
<span id="cb61-1660"><a href="#cb61-1660" aria-hidden="true" tabindex="-1"></a>        ),</span>
<span id="cb61-1661"><a href="#cb61-1661" aria-hidden="true" tabindex="-1"></a>        tooltip<span class="op">=</span><span class="ss">f"</span><span class="sc">{</span>location[<span class="st">'name'</span>]<span class="sc">}</span><span class="ss"> - </span><span class="sc">{</span>location[<span class="st">'description'</span>]<span class="sc">}</span><span class="ss">"</span>,</span>
<span id="cb61-1662"><a href="#cb61-1662" aria-hidden="true" tabindex="-1"></a>        icon<span class="op">=</span>folium.Icon(</span>
<span id="cb61-1663"><a href="#cb61-1663" aria-hidden="true" tabindex="-1"></a>            color<span class="op">=</span>location[<span class="st">'color'</span>],</span>
<span id="cb61-1664"><a href="#cb61-1664" aria-hidden="true" tabindex="-1"></a>            icon<span class="op">=</span>location[<span class="st">'icon'</span>],</span>
<span id="cb61-1665"><a href="#cb61-1665" aria-hidden="true" tabindex="-1"></a>            prefix<span class="op">=</span><span class="st">'fa'</span></span>
<span id="cb61-1666"><a href="#cb61-1666" aria-hidden="true" tabindex="-1"></a>        )</span>
<span id="cb61-1667"><a href="#cb61-1667" aria-hidden="true" tabindex="-1"></a>    ).add_to(m)</span>
<span id="cb61-1668"><a href="#cb61-1668" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb61-1669"><a href="#cb61-1669" aria-hidden="true" tabindex="-1"></a><span class="co"># Add measurement and interaction tools for analysis</span></span>
<span id="cb61-1670"><a href="#cb61-1670" aria-hidden="true" tabindex="-1"></a>logger.info(<span class="st">"Adding interactive analysis tools"</span>)</span>
<span id="cb61-1671"><a href="#cb61-1671" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb61-1672"><a href="#cb61-1672" aria-hidden="true" tabindex="-1"></a><span class="co"># Measurement tool for distance/area calculations</span></span>
<span id="cb61-1673"><a href="#cb61-1673" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> folium.plugins <span class="im">import</span> MeasureControl</span>
<span id="cb61-1674"><a href="#cb61-1674" aria-hidden="true" tabindex="-1"></a>measure_control <span class="op">=</span> MeasureControl(</span>
<span id="cb61-1675"><a href="#cb61-1675" aria-hidden="true" tabindex="-1"></a>    primary_length_unit<span class="op">=</span><span class="st">'kilometers'</span>,</span>
<span id="cb61-1676"><a href="#cb61-1676" aria-hidden="true" tabindex="-1"></a>    primary_area_unit<span class="op">=</span><span class="st">'sqkilometers'</span>,</span>
<span id="cb61-1677"><a href="#cb61-1677" aria-hidden="true" tabindex="-1"></a>    secondary_length_unit<span class="op">=</span><span class="st">'miles'</span>,</span>
<span id="cb61-1678"><a href="#cb61-1678" aria-hidden="true" tabindex="-1"></a>    secondary_area_unit<span class="op">=</span><span class="st">'sqmiles'</span></span>
<span id="cb61-1679"><a href="#cb61-1679" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb61-1680"><a href="#cb61-1680" aria-hidden="true" tabindex="-1"></a>m.add_child(measure_control)</span>
<span id="cb61-1681"><a href="#cb61-1681" aria-hidden="true" tabindex="-1"></a>logger.debug(<span class="st">"Added measurement tool for distance/area calculations"</span>)</span>
<span id="cb61-1682"><a href="#cb61-1682" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb61-1683"><a href="#cb61-1683" aria-hidden="true" tabindex="-1"></a><span class="co"># Fullscreen capability for detailed examination</span></span>
<span id="cb61-1684"><a href="#cb61-1684" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> folium.plugins <span class="im">import</span> Fullscreen</span>
<span id="cb61-1685"><a href="#cb61-1685" aria-hidden="true" tabindex="-1"></a>Fullscreen(</span>
<span id="cb61-1686"><a href="#cb61-1686" aria-hidden="true" tabindex="-1"></a>    position<span class="op">=</span><span class="st">'topright'</span>,</span>
<span id="cb61-1687"><a href="#cb61-1687" aria-hidden="true" tabindex="-1"></a>    title<span class="op">=</span><span class="st">'Full Screen Mode'</span>,</span>
<span id="cb61-1688"><a href="#cb61-1688" aria-hidden="true" tabindex="-1"></a>    title_cancel<span class="op">=</span><span class="st">'Exit Full Screen'</span>,</span>
<span id="cb61-1689"><a href="#cb61-1689" aria-hidden="true" tabindex="-1"></a>    force_separate_button<span class="op">=</span><span class="va">True</span></span>
<span id="cb61-1690"><a href="#cb61-1690" aria-hidden="true" tabindex="-1"></a>).add_to(m)</span>
<span id="cb61-1691"><a href="#cb61-1691" aria-hidden="true" tabindex="-1"></a>logger.debug(<span class="st">"Added fullscreen mode capability"</span>)</span>
<span id="cb61-1692"><a href="#cb61-1692" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb61-1693"><a href="#cb61-1693" aria-hidden="true" tabindex="-1"></a><span class="co"># Layer control for basemap switching</span></span>
<span id="cb61-1694"><a href="#cb61-1694" aria-hidden="true" tabindex="-1"></a>layer_control <span class="op">=</span> folium.LayerControl(</span>
<span id="cb61-1695"><a href="#cb61-1695" aria-hidden="true" tabindex="-1"></a>    position<span class="op">=</span><span class="st">'topright'</span>,</span>
<span id="cb61-1696"><a href="#cb61-1696" aria-hidden="true" tabindex="-1"></a>    collapsed<span class="op">=</span><span class="va">False</span></span>
<span id="cb61-1697"><a href="#cb61-1697" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb61-1698"><a href="#cb61-1698" aria-hidden="true" tabindex="-1"></a>layer_control.add_to(m)</span>
<span id="cb61-1699"><a href="#cb61-1699" aria-hidden="true" tabindex="-1"></a>logger.debug(<span class="st">"Added layer control for basemap switching"</span>)</span>
<span id="cb61-1700"><a href="#cb61-1700" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb61-1701"><a href="#cb61-1701" aria-hidden="true" tabindex="-1"></a>logger.info(<span class="st">"Interactive map created with comprehensive spatial context"</span>)</span>
<span id="cb61-1702"><a href="#cb61-1702" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb61-1703"><a href="#cb61-1703" aria-hidden="true" tabindex="-1"></a><span class="co"># Display the map</span></span>
<span id="cb61-1704"><a href="#cb61-1704" aria-hidden="true" tabindex="-1"></a>m</span>
<span id="cb61-1705"><a href="#cb61-1705" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb61-1706"><a href="#cb61-1706" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb61-1707"><a href="#cb61-1707" aria-hidden="true" tabindex="-1"></a>:::{.callout-note}</span>
<span id="cb61-1708"><a href="#cb61-1708" aria-hidden="true" tabindex="-1"></a><span class="fu">## AOI Design Best Practices</span></span>
<span id="cb61-1709"><a href="#cb61-1709" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb61-1710"><a href="#cb61-1710" aria-hidden="true" tabindex="-1"></a>**Size Considerations:**  </span>
<span id="cb61-1711"><a href="#cb61-1711" aria-hidden="true" tabindex="-1"></a>When defining your Area of Interest (AOI), consider that an area too small may miss important spatial patterns or edge effects, while an area too large can increase processing time and may include irrelevant regions. Aim for a balance that ensures computational efficiency without sacrificing analytical completeness.</span>
<span id="cb61-1712"><a href="#cb61-1712" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb61-1713"><a href="#cb61-1713" aria-hidden="true" tabindex="-1"></a>**Boundary Alignment:**  </span>
<span id="cb61-1714"><a href="#cb61-1714" aria-hidden="true" tabindex="-1"></a>AOI boundaries can be aligned with ecological features such as watersheds, ecoregions, or habitat boundaries; with administrative units like counties, states, or protected areas; or with sensor-based divisions such as satellite tile boundaries and processing units. Choose the alignment that best fits your study objectives.</span>
<span id="cb61-1715"><a href="#cb61-1715" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb61-1716"><a href="#cb61-1716" aria-hidden="true" tabindex="-1"></a>**Temporal Considerations:**  </span>
<span id="cb61-1717"><a href="#cb61-1717" aria-hidden="true" tabindex="-1"></a>Ensure your AOI captures relevant seasonal dynamics and accounts for both historical and projected changes in the study area. Also, verify that data coverage is consistent across your intended temporal study period.</span>
<span id="cb61-1718"><a href="#cb61-1718" aria-hidden="true" tabindex="-1"></a>:::</span>
<span id="cb61-1719"><a href="#cb61-1719" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb61-1720"><a href="#cb61-1720" aria-hidden="true" tabindex="-1"></a><span class="fu">### Validating Your AOI Selection</span></span>
<span id="cb61-1721"><a href="#cb61-1721" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb61-1722"><a href="#cb61-1722" aria-hidden="true" tabindex="-1"></a>Before proceeding with data acquisition, confirm that your AOI is well-matched to your analysis objectives.</span>
<span id="cb61-1723"><a href="#cb61-1723" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb61-1724"><a href="#cb61-1724" aria-hidden="true" tabindex="-1"></a>---</span>
<span id="cb61-1725"><a href="#cb61-1725" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb61-1726"><a href="#cb61-1726" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb61-1727"><a href="#cb61-1727" aria-hidden="true" tabindex="-1"></a><span class="fu">## Step 4: Intelligent Satellite Scene Discovery and Selection</span></span>
<span id="cb61-1728"><a href="#cb61-1728" aria-hidden="true" tabindex="-1"></a><span class="fu">### Intelligent Satellite Scene Discovery</span></span>
<span id="cb61-1729"><a href="#cb61-1729" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb61-1730"><a href="#cb61-1730" aria-hidden="true" tabindex="-1"></a>Selecting appropriate satellite imagery is a multi-faceted challenge that requires balancing several key factors: temporal coverage (recent vs. historical data), data quality (cloud cover, sensor conditions, processing artifacts), spatial coverage (ensuring your AOI is fully captured), and the processing level of the data (raw vs. analysis-ready products). Relying on a single search strategy often leads to missed opportunities or suboptimal results, especially when data availability is limited by weather or acquisition schedules.</span>
<span id="cb61-1731"><a href="#cb61-1731" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb61-1732"><a href="#cb61-1732" aria-hidden="true" tabindex="-1"></a>To address these challenges, a robust approach involves designing and implementing multi-strategy search patterns. This means systematically applying a sequence of search strategies, each with progressively relaxed criteria—such as expanding the temporal window or increasing the allowable cloud cover. By doing so, you maximize the chances of finding suitable imagery while still prioritizing the highest quality data available. This method is widely used in operational geospatial systems to ensure reliable and efficient satellite scene discovery, even under less-than-ideal conditions.</span>
<span id="cb61-1733"><a href="#cb61-1733" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb61-1734"><a href="#cb61-1734" aria-hidden="true" tabindex="-1"></a>By the end of this section, you will be able to design robust, multi-strategy search workflows for satellite data discovery, understand how quality filters and temporal windows affect data availability, implement fallback mechanisms to guarantee reliable data access, and evaluate scene metadata to select the most appropriate imagery for your analysis.</span>
<span id="cb61-1735"><a href="#cb61-1735" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb61-1738"><a href="#cb61-1738" aria-hidden="true" tabindex="-1"></a><span class="in">```{python}</span></span>
<span id="cb61-1739"><a href="#cb61-1739" aria-hidden="true" tabindex="-1"></a><span class="co"># Step 4A: Implement Robust Multi-Strategy Scene Discovery</span></span>
<span id="cb61-1740"><a href="#cb61-1740" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> datetime <span class="im">import</span> datetime, timedelta</span>
<span id="cb61-1741"><a href="#cb61-1741" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb61-1742"><a href="#cb61-1742" aria-hidden="true" tabindex="-1"></a><span class="co"># Strategy 1: Dynamic temporal window based on current date</span></span>
<span id="cb61-1743"><a href="#cb61-1743" aria-hidden="true" tabindex="-1"></a>current_date <span class="op">=</span> datetime.now()</span>
<span id="cb61-1744"><a href="#cb61-1744" aria-hidden="true" tabindex="-1"></a>logger.info(<span class="ss">f"Calculating optimal temporal search windows (current date: </span><span class="sc">{</span>current_date<span class="sc">.</span>strftime(<span class="st">'%Y-%m-</span><span class="sc">%d</span><span class="st">'</span>)<span class="sc">}</span><span class="ss">)"</span>)</span>
<span id="cb61-1745"><a href="#cb61-1745" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb61-1746"><a href="#cb61-1746" aria-hidden="true" tabindex="-1"></a><span class="co"># Define multiple search strategies with different trade-offs</span></span>
<span id="cb61-1747"><a href="#cb61-1747" aria-hidden="true" tabindex="-1"></a><span class="co"># Each strategy balances data quality against data availability</span></span>
<span id="cb61-1748"><a href="#cb61-1748" aria-hidden="true" tabindex="-1"></a>search_strategies <span class="op">=</span> [</span>
<span id="cb61-1749"><a href="#cb61-1749" aria-hidden="true" tabindex="-1"></a>    {</span>
<span id="cb61-1750"><a href="#cb61-1750" aria-hidden="true" tabindex="-1"></a>        <span class="st">"name"</span>: <span class="st">"Optimal Quality"</span>,</span>
<span id="cb61-1751"><a href="#cb61-1751" aria-hidden="true" tabindex="-1"></a>        <span class="st">"date_range"</span>: <span class="st">"2024-06-01/2024-09-30"</span>,</span>
<span id="cb61-1752"><a href="#cb61-1752" aria-hidden="true" tabindex="-1"></a>        <span class="st">"cloud_max"</span>: <span class="dv">20</span>,</span>
<span id="cb61-1753"><a href="#cb61-1753" aria-hidden="true" tabindex="-1"></a>        <span class="st">"description"</span>: <span class="st">"Recent summer data with excellent atmospheric conditions"</span>,</span>
<span id="cb61-1754"><a href="#cb61-1754" aria-hidden="true" tabindex="-1"></a>        <span class="st">"priority"</span>: <span class="st">"Best for analysis quality"</span>,</span>
<span id="cb61-1755"><a href="#cb61-1755" aria-hidden="true" tabindex="-1"></a>        <span class="st">"trade_offs"</span>: <span class="st">"May have limited availability"</span></span>
<span id="cb61-1756"><a href="#cb61-1756" aria-hidden="true" tabindex="-1"></a>    },</span>
<span id="cb61-1757"><a href="#cb61-1757" aria-hidden="true" tabindex="-1"></a>    {</span>
<span id="cb61-1758"><a href="#cb61-1758" aria-hidden="true" tabindex="-1"></a>        <span class="st">"name"</span>: <span class="st">"Good Quality"</span>,</span>
<span id="cb61-1759"><a href="#cb61-1759" aria-hidden="true" tabindex="-1"></a>        <span class="st">"date_range"</span>: <span class="st">"2024-03-01/2024-08-31"</span>,</span>
<span id="cb61-1760"><a href="#cb61-1760" aria-hidden="true" tabindex="-1"></a>        <span class="st">"cloud_max"</span>: <span class="dv">35</span>,</span>
<span id="cb61-1761"><a href="#cb61-1761" aria-hidden="true" tabindex="-1"></a>        <span class="st">"description"</span>: <span class="st">"Extended seasonal window with good conditions"</span>,</span>
<span id="cb61-1762"><a href="#cb61-1762" aria-hidden="true" tabindex="-1"></a>        <span class="st">"priority"</span>: <span class="st">"Balance of quality and availability"</span>,</span>
<span id="cb61-1763"><a href="#cb61-1763" aria-hidden="true" tabindex="-1"></a>        <span class="st">"trade_offs"</span>: <span class="st">"Some atmospheric interference"</span></span>
<span id="cb61-1764"><a href="#cb61-1764" aria-hidden="true" tabindex="-1"></a>    },</span>
<span id="cb61-1765"><a href="#cb61-1765" aria-hidden="true" tabindex="-1"></a>    {</span>
<span id="cb61-1766"><a href="#cb61-1766" aria-hidden="true" tabindex="-1"></a>        <span class="st">"name"</span>: <span class="st">"Acceptable Quality"</span>,</span>
<span id="cb61-1767"><a href="#cb61-1767" aria-hidden="true" tabindex="-1"></a>        <span class="st">"date_range"</span>: <span class="st">"2023-09-01/2024-11-30"</span>,</span>
<span id="cb61-1768"><a href="#cb61-1768" aria-hidden="true" tabindex="-1"></a>        <span class="st">"cloud_max"</span>: <span class="dv">50</span>,</span>
<span id="cb61-1769"><a href="#cb61-1769" aria-hidden="true" tabindex="-1"></a>        <span class="st">"description"</span>: <span class="st">"Broader temporal and quality window"</span>,</span>
<span id="cb61-1770"><a href="#cb61-1770" aria-hidden="true" tabindex="-1"></a>        <span class="st">"priority"</span>: <span class="st">"Reliable data availability"</span>,</span>
<span id="cb61-1771"><a href="#cb61-1771" aria-hidden="true" tabindex="-1"></a>        <span class="st">"trade_offs"</span>: <span class="st">"May require additional preprocessing"</span></span>
<span id="cb61-1772"><a href="#cb61-1772" aria-hidden="true" tabindex="-1"></a>    },</span>
<span id="cb61-1773"><a href="#cb61-1773" aria-hidden="true" tabindex="-1"></a>    {</span>
<span id="cb61-1774"><a href="#cb61-1774" aria-hidden="true" tabindex="-1"></a>        <span class="st">"name"</span>: <span class="st">"Fallback Option"</span>,</span>
<span id="cb61-1775"><a href="#cb61-1775" aria-hidden="true" tabindex="-1"></a>        <span class="st">"date_range"</span>: <span class="st">"2023-01-01/2024-12-31"</span>,</span>
<span id="cb61-1776"><a href="#cb61-1776" aria-hidden="true" tabindex="-1"></a>        <span class="st">"cloud_max"</span>: <span class="dv">75</span>,</span>
<span id="cb61-1777"><a href="#cb61-1777" aria-hidden="true" tabindex="-1"></a>        <span class="st">"description"</span>: <span class="st">"Maximum temporal window, relaxed quality constraints"</span>,</span>
<span id="cb61-1778"><a href="#cb61-1778" aria-hidden="true" tabindex="-1"></a>        <span class="st">"priority"</span>: <span class="st">"Guaranteed data access"</span>,</span>
<span id="cb61-1779"><a href="#cb61-1779" aria-hidden="true" tabindex="-1"></a>        <span class="st">"trade_offs"</span>: <span class="st">"Significant cloud contamination possible"</span></span>
<span id="cb61-1780"><a href="#cb61-1780" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb61-1781"><a href="#cb61-1781" aria-hidden="true" tabindex="-1"></a>]</span>
<span id="cb61-1782"><a href="#cb61-1782" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb61-1783"><a href="#cb61-1783" aria-hidden="true" tabindex="-1"></a>logger.info(<span class="ss">f"Defined </span><span class="sc">{</span><span class="bu">len</span>(search_strategies)<span class="sc">}</span><span class="ss"> search strategies"</span>)</span>
<span id="cb61-1784"><a href="#cb61-1784" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> i, strategy <span class="kw">in</span> <span class="bu">enumerate</span>(search_strategies, <span class="dv">1</span>):</span>
<span id="cb61-1785"><a href="#cb61-1785" aria-hidden="true" tabindex="-1"></a>    logger.debug(<span class="ss">f"Strategy </span><span class="sc">{</span>i<span class="sc">}</span><span class="ss">: </span><span class="sc">{</span>strategy[<span class="st">'name'</span>]<span class="sc">}</span><span class="ss"> - </span><span class="sc">{</span>strategy[<span class="st">'description'</span>]<span class="sc">}</span><span class="ss">"</span>)</span>
<span id="cb61-1786"><a href="#cb61-1786" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb61-1787"><a href="#cb61-1787" aria-hidden="true" tabindex="-1"></a><span class="co"># Execute search strategies in order of preference</span></span>
<span id="cb61-1788"><a href="#cb61-1788" aria-hidden="true" tabindex="-1"></a>scenes <span class="op">=</span> []</span>
<span id="cb61-1789"><a href="#cb61-1789" aria-hidden="true" tabindex="-1"></a>successful_strategy <span class="op">=</span> <span class="va">None</span></span>
<span id="cb61-1790"><a href="#cb61-1790" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb61-1791"><a href="#cb61-1791" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> i, strategy <span class="kw">in</span> <span class="bu">enumerate</span>(search_strategies, <span class="dv">1</span>):</span>
<span id="cb61-1792"><a href="#cb61-1792" aria-hidden="true" tabindex="-1"></a>    logger.info(<span class="ss">f"Executing Strategy </span><span class="sc">{</span>i<span class="sc">}</span><span class="ss">: </span><span class="sc">{</span>strategy[<span class="st">'name'</span>]<span class="sc">}</span><span class="ss"> (dates: </span><span class="sc">{</span>strategy[<span class="st">'date_range'</span>]<span class="sc">}</span><span class="ss">, cloud &lt; </span><span class="sc">{</span>strategy[<span class="st">'cloud_max'</span>]<span class="sc">}</span><span class="ss">%)"</span>)</span>
<span id="cb61-1793"><a href="#cb61-1793" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb61-1794"><a href="#cb61-1794" aria-hidden="true" tabindex="-1"></a>    <span class="cf">try</span>:</span>
<span id="cb61-1795"><a href="#cb61-1795" aria-hidden="true" tabindex="-1"></a>        <span class="co"># Use our optimized search function with current strategy parameters</span></span>
<span id="cb61-1796"><a href="#cb61-1796" aria-hidden="true" tabindex="-1"></a>        temp_scenes <span class="op">=</span> search_sentinel2_scenes(</span>
<span id="cb61-1797"><a href="#cb61-1797" aria-hidden="true" tabindex="-1"></a>            bbox<span class="op">=</span>sf_bay_bbox,</span>
<span id="cb61-1798"><a href="#cb61-1798" aria-hidden="true" tabindex="-1"></a>            date_range<span class="op">=</span>strategy[<span class="st">"date_range"</span>],</span>
<span id="cb61-1799"><a href="#cb61-1799" aria-hidden="true" tabindex="-1"></a>            cloud_cover_max<span class="op">=</span>strategy[<span class="st">"cloud_max"</span>],</span>
<span id="cb61-1800"><a href="#cb61-1800" aria-hidden="true" tabindex="-1"></a>            limit<span class="op">=</span><span class="dv">100</span>  <span class="co"># Generous limit for selection flexibility</span></span>
<span id="cb61-1801"><a href="#cb61-1801" aria-hidden="true" tabindex="-1"></a>        )</span>
<span id="cb61-1802"><a href="#cb61-1802" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb61-1803"><a href="#cb61-1803" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> temp_scenes:</span>
<span id="cb61-1804"><a href="#cb61-1804" aria-hidden="true" tabindex="-1"></a>            scenes <span class="op">=</span> temp_scenes</span>
<span id="cb61-1805"><a href="#cb61-1805" aria-hidden="true" tabindex="-1"></a>            successful_strategy <span class="op">=</span> strategy</span>
<span id="cb61-1806"><a href="#cb61-1806" aria-hidden="true" tabindex="-1"></a>            logger.info(<span class="ss">f"SUCCESS! Found </span><span class="sc">{</span><span class="bu">len</span>(scenes)<span class="sc">}</span><span class="ss"> qualifying scenes with </span><span class="sc">{</span>strategy[<span class="st">'name'</span>]<span class="sc">}</span><span class="ss"> strategy"</span>)</span>
<span id="cb61-1807"><a href="#cb61-1807" aria-hidden="true" tabindex="-1"></a>            <span class="cf">break</span></span>
<span id="cb61-1808"><a href="#cb61-1808" aria-hidden="true" tabindex="-1"></a>        <span class="cf">else</span>:</span>
<span id="cb61-1809"><a href="#cb61-1809" aria-hidden="true" tabindex="-1"></a>            logger.warning(<span class="ss">f"No scenes found with </span><span class="sc">{</span>strategy[<span class="st">'name'</span>]<span class="sc">}</span><span class="ss"> strategy, proceeding to next"</span>)</span>
<span id="cb61-1810"><a href="#cb61-1810" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb61-1811"><a href="#cb61-1811" aria-hidden="true" tabindex="-1"></a>    <span class="cf">except</span> <span class="pp">Exception</span> <span class="im">as</span> e:</span>
<span id="cb61-1812"><a href="#cb61-1812" aria-hidden="true" tabindex="-1"></a>        logger.warning(<span class="ss">f"Search execution failed for </span><span class="sc">{</span>strategy[<span class="st">'name'</span>]<span class="sc">}</span><span class="ss">: </span><span class="sc">{</span><span class="bu">str</span>(e)[:<span class="dv">80</span>]<span class="sc">}</span><span class="ss">"</span>)</span>
<span id="cb61-1813"><a href="#cb61-1813" aria-hidden="true" tabindex="-1"></a>        <span class="cf">continue</span></span>
<span id="cb61-1814"><a href="#cb61-1814" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb61-1815"><a href="#cb61-1815" aria-hidden="true" tabindex="-1"></a><span class="co"># Validate search results and provide detailed feedback</span></span>
<span id="cb61-1816"><a href="#cb61-1816" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span> <span class="kw">not</span> scenes:</span>
<span id="cb61-1817"><a href="#cb61-1817" aria-hidden="true" tabindex="-1"></a>    logger.error(<span class="ss">f"Scene discovery failed after trying all </span><span class="sc">{</span><span class="bu">len</span>(search_strategies)<span class="sc">}</span><span class="ss"> strategies"</span>)</span>
<span id="cb61-1818"><a href="#cb61-1818" aria-hidden="true" tabindex="-1"></a>    logger.info(<span class="st">"Diagnostic steps: 1) Check network connectivity, 2) Verify API status, 3) Confirm AOI coverage, 4) Try broader date ranges, 5) Check authentication"</span>)</span>
<span id="cb61-1819"><a href="#cb61-1819" aria-hidden="true" tabindex="-1"></a>    <span class="cf">raise</span> <span class="pp">Exception</span>(<span class="st">"Critical failure in scene discovery. Review diagnostic steps and retry."</span>)</span>
<span id="cb61-1820"><a href="#cb61-1820" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb61-1821"><a href="#cb61-1821" aria-hidden="true" tabindex="-1"></a>logger.info(<span class="ss">f"Scene discovery completed: </span><span class="sc">{</span>successful_strategy[<span class="st">'name'</span>]<span class="sc">}</span><span class="ss"> strategy found </span><span class="sc">{</span><span class="bu">len</span>(scenes)<span class="sc">}</span><span class="ss"> scenes (attempt </span><span class="sc">{</span>search_strategies<span class="sc">.</span>index(successful_strategy) <span class="op">+</span> <span class="dv">1</span><span class="sc">}</span><span class="ss">/</span><span class="sc">{</span><span class="bu">len</span>(search_strategies)<span class="sc">}</span><span class="ss">)"</span>)</span>
<span id="cb61-1822"><a href="#cb61-1822" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb61-1823"><a href="#cb61-1823" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb61-1824"><a href="#cb61-1824" aria-hidden="true" tabindex="-1"></a><span class="fu">#### Scene Quality Assessment and Selection</span></span>
<span id="cb61-1825"><a href="#cb61-1825" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb61-1826"><a href="#cb61-1826" aria-hidden="true" tabindex="-1"></a>Once we have candidate scenes, we need to systematically evaluate and select the best option:</span>
<span id="cb61-1827"><a href="#cb61-1827" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb61-1828"><a href="#cb61-1828" aria-hidden="true" tabindex="-1"></a>**Performing Comprehensive Scene Quality Assessment:**</span>
<span id="cb61-1829"><a href="#cb61-1829" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb61-1830"><a href="#cb61-1830" aria-hidden="true" tabindex="-1"></a>This demonstrates multi-criteria decision making for satellite data selection using cloud cover, acquisition date, and other quality metrics.</span>
<span id="cb61-1831"><a href="#cb61-1831" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb61-1834"><a href="#cb61-1834" aria-hidden="true" tabindex="-1"></a><span class="in">```{python}</span></span>
<span id="cb61-1835"><a href="#cb61-1835" aria-hidden="true" tabindex="-1"></a><span class="co"># Step 4B: Intelligent Scene Selection Based on Multiple Quality Criteria</span></span>
<span id="cb61-1836"><a href="#cb61-1836" aria-hidden="true" tabindex="-1"></a><span class="co"># Sort scenes by multiple quality criteria</span></span>
<span id="cb61-1837"><a href="#cb61-1837" aria-hidden="true" tabindex="-1"></a><span class="co"># Primary: cloud cover (lower is better)</span></span>
<span id="cb61-1838"><a href="#cb61-1838" aria-hidden="true" tabindex="-1"></a><span class="co"># Secondary: date (more recent is better)</span></span>
<span id="cb61-1839"><a href="#cb61-1839" aria-hidden="true" tabindex="-1"></a>scenes_with_scores <span class="op">=</span> []</span>
<span id="cb61-1840"><a href="#cb61-1840" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb61-1841"><a href="#cb61-1841" aria-hidden="true" tabindex="-1"></a>logger.info(<span class="ss">f"Evaluating </span><span class="sc">{</span><span class="bu">len</span>(scenes)<span class="sc">}</span><span class="ss"> candidate scenes for quality assessment"</span>)</span>
<span id="cb61-1842"><a href="#cb61-1842" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> scene <span class="kw">in</span> scenes:</span>
<span id="cb61-1843"><a href="#cb61-1843" aria-hidden="true" tabindex="-1"></a>    props <span class="op">=</span> scene.properties</span>
<span id="cb61-1844"><a href="#cb61-1844" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb61-1845"><a href="#cb61-1845" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Extract key quality metrics</span></span>
<span id="cb61-1846"><a href="#cb61-1846" aria-hidden="true" tabindex="-1"></a>    cloud_cover <span class="op">=</span> props.get(<span class="st">'eo:cloud_cover'</span>, <span class="dv">100</span>)</span>
<span id="cb61-1847"><a href="#cb61-1847" aria-hidden="true" tabindex="-1"></a>    date_str <span class="op">=</span> props.get(<span class="st">'datetime'</span>, <span class="st">''</span>).split(<span class="st">'T'</span>)[<span class="dv">0</span>]</span>
<span id="cb61-1848"><a href="#cb61-1848" aria-hidden="true" tabindex="-1"></a>    scene_date <span class="op">=</span> datetime.strptime(date_str, <span class="st">'%Y-%m-</span><span class="sc">%d</span><span class="st">'</span>)</span>
<span id="cb61-1849"><a href="#cb61-1849" aria-hidden="true" tabindex="-1"></a>    days_old <span class="op">=</span> (current_date <span class="op">-</span> scene_date).days</span>
<span id="cb61-1850"><a href="#cb61-1850" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb61-1851"><a href="#cb61-1851" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Calculate composite quality score (lower is better)</span></span>
<span id="cb61-1852"><a href="#cb61-1852" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Weight factors: cloud cover (70%), recency (30%)</span></span>
<span id="cb61-1853"><a href="#cb61-1853" aria-hidden="true" tabindex="-1"></a>    cloud_score <span class="op">=</span> cloud_cover  <span class="co"># 0-100 scale</span></span>
<span id="cb61-1854"><a href="#cb61-1854" aria-hidden="true" tabindex="-1"></a>    recency_score <span class="op">=</span> <span class="bu">min</span>(days_old <span class="op">/</span> <span class="dv">30</span>, <span class="dv">100</span>)  <span class="co"># Normalize to 0-100, cap at 100</span></span>
<span id="cb61-1855"><a href="#cb61-1855" aria-hidden="true" tabindex="-1"></a>    quality_score <span class="op">=</span> (<span class="fl">0.7</span> <span class="op">*</span> cloud_score) <span class="op">+</span> (<span class="fl">0.3</span> <span class="op">*</span> recency_score)</span>
<span id="cb61-1856"><a href="#cb61-1856" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb61-1857"><a href="#cb61-1857" aria-hidden="true" tabindex="-1"></a>    scene_info <span class="op">=</span> {</span>
<span id="cb61-1858"><a href="#cb61-1858" aria-hidden="true" tabindex="-1"></a>        <span class="st">'scene'</span>: scene,</span>
<span id="cb61-1859"><a href="#cb61-1859" aria-hidden="true" tabindex="-1"></a>        <span class="st">'date'</span>: date_str,</span>
<span id="cb61-1860"><a href="#cb61-1860" aria-hidden="true" tabindex="-1"></a>        <span class="st">'cloud_cover'</span>: cloud_cover,</span>
<span id="cb61-1861"><a href="#cb61-1861" aria-hidden="true" tabindex="-1"></a>        <span class="st">'days_old'</span>: days_old,</span>
<span id="cb61-1862"><a href="#cb61-1862" aria-hidden="true" tabindex="-1"></a>        <span class="st">'quality_score'</span>: quality_score,</span>
<span id="cb61-1863"><a href="#cb61-1863" aria-hidden="true" tabindex="-1"></a>        <span class="st">'tile_id'</span>: props.get(<span class="st">'sentinel:grid_square'</span>, <span class="st">'Unknown'</span>),</span>
<span id="cb61-1864"><a href="#cb61-1864" aria-hidden="true" tabindex="-1"></a>        <span class="st">'platform'</span>: props.get(<span class="st">'platform'</span>, <span class="st">'Sentinel-2'</span>)</span>
<span id="cb61-1865"><a href="#cb61-1865" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb61-1866"><a href="#cb61-1866" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb61-1867"><a href="#cb61-1867" aria-hidden="true" tabindex="-1"></a>    scenes_with_scores.append(scene_info)</span>
<span id="cb61-1868"><a href="#cb61-1868" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb61-1869"><a href="#cb61-1869" aria-hidden="true" tabindex="-1"></a><span class="co"># Sort by quality score (best first)</span></span>
<span id="cb61-1870"><a href="#cb61-1870" aria-hidden="true" tabindex="-1"></a>scenes_with_scores.sort(key<span class="op">=</span><span class="kw">lambda</span> x: x[<span class="st">'quality_score'</span>])</span>
<span id="cb61-1871"><a href="#cb61-1871" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb61-1872"><a href="#cb61-1872" aria-hidden="true" tabindex="-1"></a><span class="co"># Display top candidates for educational purposes</span></span>
<span id="cb61-1873"><a href="#cb61-1873" aria-hidden="true" tabindex="-1"></a>logger.info(<span class="st">"Top 5 Scene Candidates (ranked by quality score):"</span>)</span>
<span id="cb61-1874"><a href="#cb61-1874" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> i, scene_info <span class="kw">in</span> <span class="bu">enumerate</span>(scenes_with_scores[:<span class="dv">5</span>], <span class="dv">1</span>):</span>
<span id="cb61-1875"><a href="#cb61-1875" aria-hidden="true" tabindex="-1"></a>    logger.debug(<span class="ss">f"</span><span class="sc">{</span>i<span class="sc">}</span><span class="ss">. </span><span class="sc">{</span>scene_info[<span class="st">'date'</span>]<span class="sc">}</span><span class="ss"> - Cloud: </span><span class="sc">{</span>scene_info[<span class="st">'cloud_cover'</span>]<span class="sc">:.1f}</span><span class="ss">%, Age: </span><span class="sc">{</span>scene_info[<span class="st">'days_old'</span>]<span class="sc">}</span><span class="ss"> days, Score: </span><span class="sc">{</span>scene_info[<span class="st">'quality_score'</span>]<span class="sc">:.1f}</span><span class="ss">"</span>)</span>
<span id="cb61-1876"><a href="#cb61-1876" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> i <span class="op">==</span> <span class="dv">1</span>:</span>
<span id="cb61-1877"><a href="#cb61-1877" aria-hidden="true" tabindex="-1"></a>        logger.info(<span class="ss">f"Selected optimal scene: </span><span class="sc">{</span>scene_info[<span class="st">'date'</span>]<span class="sc">}</span><span class="ss">"</span>)</span>
<span id="cb61-1878"><a href="#cb61-1878" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb61-1879"><a href="#cb61-1879" aria-hidden="true" tabindex="-1"></a><span class="co"># Select the best scene</span></span>
<span id="cb61-1880"><a href="#cb61-1880" aria-hidden="true" tabindex="-1"></a>best_scene_info <span class="op">=</span> scenes_with_scores[<span class="dv">0</span>]</span>
<span id="cb61-1881"><a href="#cb61-1881" aria-hidden="true" tabindex="-1"></a>best_scene <span class="op">=</span> best_scene_info[<span class="st">'scene'</span>]</span>
<span id="cb61-1882"><a href="#cb61-1882" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb61-1883"><a href="#cb61-1883" aria-hidden="true" tabindex="-1"></a>logger.info(<span class="ss">f"Optimal scene selected: </span><span class="sc">{</span>best_scene_info[<span class="st">'date'</span>]<span class="sc">}</span><span class="ss"> (</span><span class="sc">{</span>best_scene_info[<span class="st">'cloud_cover'</span>]<span class="sc">:.1f}</span><span class="ss">% cloud cover, </span><span class="sc">{</span>best_scene_info[<span class="st">'platform'</span>]<span class="sc">}</span><span class="ss">, Tile: </span><span class="sc">{</span>best_scene_info[<span class="st">'tile_id'</span>]<span class="sc">}</span><span class="ss">)"</span>)</span>
<span id="cb61-1884"><a href="#cb61-1884" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb61-1885"><a href="#cb61-1885" aria-hidden="true" tabindex="-1"></a><span class="co"># Validate scene completeness for required analysis</span></span>
<span id="cb61-1886"><a href="#cb61-1886" aria-hidden="true" tabindex="-1"></a>logger.info(<span class="st">"Validating scene data completeness"</span>)</span>
<span id="cb61-1887"><a href="#cb61-1887" aria-hidden="true" tabindex="-1"></a>required_bands <span class="op">=</span> [<span class="st">'B02'</span>, <span class="st">'B03'</span>, <span class="st">'B04'</span>, <span class="st">'B08'</span>]  <span class="co"># Blue, Green, Red, NIR</span></span>
<span id="cb61-1888"><a href="#cb61-1888" aria-hidden="true" tabindex="-1"></a>available_bands <span class="op">=</span> <span class="bu">list</span>(best_scene.assets.keys())</span>
<span id="cb61-1889"><a href="#cb61-1889" aria-hidden="true" tabindex="-1"></a>spectral_bands <span class="op">=</span> [b <span class="cf">for</span> b <span class="kw">in</span> available_bands <span class="cf">if</span> b.startswith(<span class="st">'B'</span>) <span class="kw">and</span> <span class="bu">len</span>(b) <span class="op">&lt;=</span> <span class="dv">3</span>]</span>
<span id="cb61-1890"><a href="#cb61-1890" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb61-1891"><a href="#cb61-1891" aria-hidden="true" tabindex="-1"></a>logger.debug(<span class="ss">f"Available spectral bands: </span><span class="sc">{</span><span class="bu">len</span>(spectral_bands)<span class="sc">}</span><span class="ss">, Required: </span><span class="sc">{</span>required_bands<span class="sc">}</span><span class="ss">"</span>)</span>
<span id="cb61-1892"><a href="#cb61-1892" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb61-1893"><a href="#cb61-1893" aria-hidden="true" tabindex="-1"></a>missing_bands <span class="op">=</span> [b <span class="cf">for</span> b <span class="kw">in</span> required_bands <span class="cf">if</span> b <span class="kw">not</span> <span class="kw">in</span> available_bands]</span>
<span id="cb61-1894"><a href="#cb61-1894" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span> missing_bands:</span>
<span id="cb61-1895"><a href="#cb61-1895" aria-hidden="true" tabindex="-1"></a>    logger.warning(<span class="ss">f"Missing critical bands: </span><span class="sc">{</span>missing_bands<span class="sc">}</span><span class="ss"> - this may limit analysis capabilities"</span>)</span>
<span id="cb61-1896"><a href="#cb61-1896" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb61-1897"><a href="#cb61-1897" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Check for alternative bands</span></span>
<span id="cb61-1898"><a href="#cb61-1898" aria-hidden="true" tabindex="-1"></a>    alternative_mapping <span class="op">=</span> {<span class="st">'B02'</span>: <span class="st">'blue'</span>, <span class="st">'B03'</span>: <span class="st">'green'</span>, <span class="st">'B04'</span>: <span class="st">'red'</span>, <span class="st">'B08'</span>: <span class="st">'nir'</span>}</span>
<span id="cb61-1899"><a href="#cb61-1899" aria-hidden="true" tabindex="-1"></a>    alternatives_found <span class="op">=</span> []</span>
<span id="cb61-1900"><a href="#cb61-1900" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> missing <span class="kw">in</span> missing_bands:</span>
<span id="cb61-1901"><a href="#cb61-1901" aria-hidden="true" tabindex="-1"></a>        alt_name <span class="op">=</span> alternative_mapping.get(missing, missing.lower())</span>
<span id="cb61-1902"><a href="#cb61-1902" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> alt_name <span class="kw">in</span> available_bands:</span>
<span id="cb61-1903"><a href="#cb61-1903" aria-hidden="true" tabindex="-1"></a>            alternatives_found.append((missing, alt_name))</span>
<span id="cb61-1904"><a href="#cb61-1904" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb61-1905"><a href="#cb61-1905" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> alternatives_found:</span>
<span id="cb61-1906"><a href="#cb61-1906" aria-hidden="true" tabindex="-1"></a>        logger.info(<span class="ss">f"Found alternative band names: </span><span class="sc">{</span>alternatives_found<span class="sc">}</span><span class="ss">"</span>)</span>
<span id="cb61-1907"><a href="#cb61-1907" aria-hidden="true" tabindex="-1"></a><span class="cf">else</span>:</span>
<span id="cb61-1908"><a href="#cb61-1908" aria-hidden="true" tabindex="-1"></a>    logger.info(<span class="st">"All required bands available"</span>)</span>
<span id="cb61-1909"><a href="#cb61-1909" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb61-1910"><a href="#cb61-1910" aria-hidden="true" tabindex="-1"></a><span class="co"># Additional quality checks</span></span>
<span id="cb61-1911"><a href="#cb61-1911" aria-hidden="true" tabindex="-1"></a>extra_bands <span class="op">=</span> [b <span class="cf">for</span> b <span class="kw">in</span> spectral_bands <span class="cf">if</span> b <span class="kw">not</span> <span class="kw">in</span> required_bands]</span>
<span id="cb61-1912"><a href="#cb61-1912" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span> extra_bands:</span>
<span id="cb61-1913"><a href="#cb61-1913" aria-hidden="true" tabindex="-1"></a>    logger.debug(<span class="ss">f"Bonus bands available: </span><span class="sc">{</span>extra_bands[:<span class="dv">5</span>]<span class="sc">}{</span><span class="st">'...'</span> <span class="cf">if</span> <span class="bu">len</span>(extra_bands) <span class="op">&gt;</span> <span class="dv">5</span> <span class="cf">else</span> <span class="st">''</span><span class="sc">}</span><span class="ss"> (enable advanced spectral analysis)"</span>)</span>
<span id="cb61-1914"><a href="#cb61-1914" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb61-1915"><a href="#cb61-1915" aria-hidden="true" tabindex="-1"></a>logger.info(<span class="st">"Scene validation complete - ready for data loading"</span>)</span>
<span id="cb61-1916"><a href="#cb61-1916" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb61-1917"><a href="#cb61-1917" aria-hidden="true" tabindex="-1"></a><span class="co"># Quick connectivity test using our helper function</span></span>
<span id="cb61-1918"><a href="#cb61-1918" aria-hidden="true" tabindex="-1"></a>logger.info(<span class="st">"Performing pre-flight connectivity test"</span>)</span>
<span id="cb61-1919"><a href="#cb61-1919" aria-hidden="true" tabindex="-1"></a>connectivity_test <span class="op">=</span> test_subset_functionality(best_scene)</span>
<span id="cb61-1920"><a href="#cb61-1920" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb61-1921"><a href="#cb61-1921" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span> connectivity_test:</span>
<span id="cb61-1922"><a href="#cb61-1922" aria-hidden="true" tabindex="-1"></a>    logger.info(<span class="st">"Data access confirmed - all systems ready"</span>)</span>
<span id="cb61-1923"><a href="#cb61-1923" aria-hidden="true" tabindex="-1"></a><span class="cf">else</span>:</span>
<span id="cb61-1924"><a href="#cb61-1924" aria-hidden="true" tabindex="-1"></a>    logger.warning(<span class="st">"Connectivity issues detected - will attempt full download with fallback mechanisms"</span>)</span>
<span id="cb61-1925"><a href="#cb61-1925" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb61-1926"><a href="#cb61-1926" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb61-1927"><a href="#cb61-1927" aria-hidden="true" tabindex="-1"></a>Scene selection for geospatial analysis should prioritize several key quality criteria. Cloud cover is the most important factor, as it directly affects data usability. Temporal relevance is also critical; more recent data better reflects current conditions. The processing level matters as well—Level 2A data, for example, provides atmospheric correction, which is often preferred. Finally, consider spatial coverage, ensuring that the selected scene fully covers the area of interest rather than only partially.</span>
<span id="cb61-1928"><a href="#cb61-1928" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb61-1929"><a href="#cb61-1929" aria-hidden="true" tabindex="-1"></a>In production workflows, it is important to have fallback strategies in place, such as using multiple search approaches to ensure data availability. Automated selection can be improved by applying standardized quality scoring metrics. Always validate metadata to confirm that all required bands and assets are present, and test connectivity to the data source before starting major processing tasks.</span>
<span id="cb61-1930"><a href="#cb61-1930" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb61-1931"><a href="#cb61-1931" aria-hidden="true" tabindex="-1"></a>Before loading data, it is helpful to examine the characteristics of the selected Sentinel-2 scene. For example, you can use the <span class="in">`eo:cloud_cover`</span> property to filter scenes by cloud coverage. Sentinel-2 satellites revisit the same location every five days, so multiple scenes are usually available for a given area. Level 2A data is already atmospherically corrected, which simplifies preprocessing. Be aware that different satellites may use different naming conventions and have varying properties.</span>
<span id="cb61-1932"><a href="#cb61-1932" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb61-1933"><a href="#cb61-1933" aria-hidden="true" tabindex="-1"></a>A thorough analysis of scene metadata is essential for designing effective workflows. By systematically inventorying available assets and understanding sensor characteristics, you can take full advantage of the rich metadata provided in STAC items and ensure your analysis is both robust and reliable.</span>
<span id="cb61-1934"><a href="#cb61-1934" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb61-1937"><a href="#cb61-1937" aria-hidden="true" tabindex="-1"></a><span class="in">```{python}</span></span>
<span id="cb61-1938"><a href="#cb61-1938" aria-hidden="true" tabindex="-1"></a><span class="co"># Step 4C: Comprehensive Scene and Sensor Characterization</span></span>
<span id="cb61-1939"><a href="#cb61-1939" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span> <span class="st">'best_scene'</span> <span class="kw">in</span> <span class="bu">locals</span>():</span>
<span id="cb61-1940"><a href="#cb61-1940" aria-hidden="true" tabindex="-1"></a>    scene_props <span class="op">=</span> best_scene.properties</span>
<span id="cb61-1941"><a href="#cb61-1941" aria-hidden="true" tabindex="-1"></a>    scene_assets <span class="op">=</span> best_scene.assets</span>
<span id="cb61-1942"><a href="#cb61-1942" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb61-1943"><a href="#cb61-1943" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Sentinel-2 spectral band specifications with AI applications</span></span>
<span id="cb61-1944"><a href="#cb61-1944" aria-hidden="true" tabindex="-1"></a>    sentinel2_bands <span class="op">=</span> {</span>
<span id="cb61-1945"><a href="#cb61-1945" aria-hidden="true" tabindex="-1"></a>        <span class="st">'B01'</span>: {</span>
<span id="cb61-1946"><a href="#cb61-1946" aria-hidden="true" tabindex="-1"></a>            <span class="st">'name'</span>: <span class="st">'Coastal/Aerosol'</span>,</span>
<span id="cb61-1947"><a href="#cb61-1947" aria-hidden="true" tabindex="-1"></a>            <span class="st">'wavelength'</span>: <span class="st">'443 nm'</span>,</span>
<span id="cb61-1948"><a href="#cb61-1948" aria-hidden="true" tabindex="-1"></a>            <span class="st">'resolution'</span>: <span class="st">'60m'</span>,</span>
<span id="cb61-1949"><a href="#cb61-1949" aria-hidden="true" tabindex="-1"></a>            <span class="st">'ai_applications'</span>: <span class="st">'Atmospheric correction, aerosol detection'</span></span>
<span id="cb61-1950"><a href="#cb61-1950" aria-hidden="true" tabindex="-1"></a>        },</span>
<span id="cb61-1951"><a href="#cb61-1951" aria-hidden="true" tabindex="-1"></a>        <span class="st">'B02'</span>: {</span>
<span id="cb61-1952"><a href="#cb61-1952" aria-hidden="true" tabindex="-1"></a>            <span class="st">'name'</span>: <span class="st">'Blue'</span>,</span>
<span id="cb61-1953"><a href="#cb61-1953" aria-hidden="true" tabindex="-1"></a>            <span class="st">'wavelength'</span>: <span class="st">'490 nm'</span>,</span>
<span id="cb61-1954"><a href="#cb61-1954" aria-hidden="true" tabindex="-1"></a>            <span class="st">'resolution'</span>: <span class="st">'10m'</span>,</span>
<span id="cb61-1955"><a href="#cb61-1955" aria-hidden="true" tabindex="-1"></a>            <span class="st">'ai_applications'</span>: <span class="st">'Water body detection, urban classification'</span></span>
<span id="cb61-1956"><a href="#cb61-1956" aria-hidden="true" tabindex="-1"></a>        },</span>
<span id="cb61-1957"><a href="#cb61-1957" aria-hidden="true" tabindex="-1"></a>        <span class="st">'B03'</span>: {</span>
<span id="cb61-1958"><a href="#cb61-1958" aria-hidden="true" tabindex="-1"></a>            <span class="st">'name'</span>: <span class="st">'Green'</span>,</span>
<span id="cb61-1959"><a href="#cb61-1959" aria-hidden="true" tabindex="-1"></a>            <span class="st">'wavelength'</span>: <span class="st">'560 nm'</span>,</span>
<span id="cb61-1960"><a href="#cb61-1960" aria-hidden="true" tabindex="-1"></a>            <span class="st">'resolution'</span>: <span class="st">'10m'</span>,</span>
<span id="cb61-1961"><a href="#cb61-1961" aria-hidden="true" tabindex="-1"></a>            <span class="st">'ai_applications'</span>: <span class="st">'Vegetation health, true color composites'</span></span>
<span id="cb61-1962"><a href="#cb61-1962" aria-hidden="true" tabindex="-1"></a>        },</span>
<span id="cb61-1963"><a href="#cb61-1963" aria-hidden="true" tabindex="-1"></a>        <span class="st">'B04'</span>: {</span>
<span id="cb61-1964"><a href="#cb61-1964" aria-hidden="true" tabindex="-1"></a>            <span class="st">'name'</span>: <span class="st">'Red'</span>,</span>
<span id="cb61-1965"><a href="#cb61-1965" aria-hidden="true" tabindex="-1"></a>            <span class="st">'wavelength'</span>: <span class="st">'665 nm'</span>,</span>
<span id="cb61-1966"><a href="#cb61-1966" aria-hidden="true" tabindex="-1"></a>            <span class="st">'resolution'</span>: <span class="st">'10m'</span>,</span>
<span id="cb61-1967"><a href="#cb61-1967" aria-hidden="true" tabindex="-1"></a>            <span class="st">'ai_applications'</span>: <span class="st">'Vegetation stress, NDVI calculation'</span></span>
<span id="cb61-1968"><a href="#cb61-1968" aria-hidden="true" tabindex="-1"></a>        },</span>
<span id="cb61-1969"><a href="#cb61-1969" aria-hidden="true" tabindex="-1"></a>        <span class="st">'B05'</span>: {</span>
<span id="cb61-1970"><a href="#cb61-1970" aria-hidden="true" tabindex="-1"></a>            <span class="st">'name'</span>: <span class="st">'Red Edge 1'</span>,</span>
<span id="cb61-1971"><a href="#cb61-1971" aria-hidden="true" tabindex="-1"></a>            <span class="st">'wavelength'</span>: <span class="st">'705 nm'</span>,</span>
<span id="cb61-1972"><a href="#cb61-1972" aria-hidden="true" tabindex="-1"></a>            <span class="st">'resolution'</span>: <span class="st">'20m'</span>,</span>
<span id="cb61-1973"><a href="#cb61-1973" aria-hidden="true" tabindex="-1"></a>            <span class="st">'ai_applications'</span>: <span class="st">'Vegetation analysis, crop type classification'</span></span>
<span id="cb61-1974"><a href="#cb61-1974" aria-hidden="true" tabindex="-1"></a>        },</span>
<span id="cb61-1975"><a href="#cb61-1975" aria-hidden="true" tabindex="-1"></a>        <span class="st">'B06'</span>: {</span>
<span id="cb61-1976"><a href="#cb61-1976" aria-hidden="true" tabindex="-1"></a>            <span class="st">'name'</span>: <span class="st">'Red Edge 2'</span>,</span>
<span id="cb61-1977"><a href="#cb61-1977" aria-hidden="true" tabindex="-1"></a>            <span class="st">'wavelength'</span>: <span class="st">'740 nm'</span>,</span>
<span id="cb61-1978"><a href="#cb61-1978" aria-hidden="true" tabindex="-1"></a>            <span class="st">'resolution'</span>: <span class="st">'20m'</span>,</span>
<span id="cb61-1979"><a href="#cb61-1979" aria-hidden="true" tabindex="-1"></a>            <span class="st">'ai_applications'</span>: <span class="st">'Advanced vegetation indices, stress detection'</span></span>
<span id="cb61-1980"><a href="#cb61-1980" aria-hidden="true" tabindex="-1"></a>        },</span>
<span id="cb61-1981"><a href="#cb61-1981" aria-hidden="true" tabindex="-1"></a>        <span class="st">'B07'</span>: {</span>
<span id="cb61-1982"><a href="#cb61-1982" aria-hidden="true" tabindex="-1"></a>            <span class="st">'name'</span>: <span class="st">'Red Edge 3'</span>,</span>
<span id="cb61-1983"><a href="#cb61-1983" aria-hidden="true" tabindex="-1"></a>            <span class="st">'wavelength'</span>: <span class="st">'783 nm'</span>,</span>
<span id="cb61-1984"><a href="#cb61-1984" aria-hidden="true" tabindex="-1"></a>            <span class="st">'resolution'</span>: <span class="st">'20m'</span>,</span>
<span id="cb61-1985"><a href="#cb61-1985" aria-hidden="true" tabindex="-1"></a>            <span class="st">'ai_applications'</span>: <span class="st">'Vegetation biophysical parameters'</span></span>
<span id="cb61-1986"><a href="#cb61-1986" aria-hidden="true" tabindex="-1"></a>        },</span>
<span id="cb61-1987"><a href="#cb61-1987" aria-hidden="true" tabindex="-1"></a>        <span class="st">'B08'</span>: {</span>
<span id="cb61-1988"><a href="#cb61-1988" aria-hidden="true" tabindex="-1"></a>            <span class="st">'name'</span>: <span class="st">'NIR (Near Infrared)'</span>,</span>
<span id="cb61-1989"><a href="#cb61-1989" aria-hidden="true" tabindex="-1"></a>            <span class="st">'wavelength'</span>: <span class="st">'842 nm'</span>,</span>
<span id="cb61-1990"><a href="#cb61-1990" aria-hidden="true" tabindex="-1"></a>            <span class="st">'resolution'</span>: <span class="st">'10m'</span>,</span>
<span id="cb61-1991"><a href="#cb61-1991" aria-hidden="true" tabindex="-1"></a>            <span class="st">'ai_applications'</span>: <span class="st">'Biomass estimation, water/land separation'</span></span>
<span id="cb61-1992"><a href="#cb61-1992" aria-hidden="true" tabindex="-1"></a>        },</span>
<span id="cb61-1993"><a href="#cb61-1993" aria-hidden="true" tabindex="-1"></a>        <span class="st">'B8A'</span>: {</span>
<span id="cb61-1994"><a href="#cb61-1994" aria-hidden="true" tabindex="-1"></a>            <span class="st">'name'</span>: <span class="st">'NIR Narrow'</span>,</span>
<span id="cb61-1995"><a href="#cb61-1995" aria-hidden="true" tabindex="-1"></a>            <span class="st">'wavelength'</span>: <span class="st">'865 nm'</span>,</span>
<span id="cb61-1996"><a href="#cb61-1996" aria-hidden="true" tabindex="-1"></a>            <span class="st">'resolution'</span>: <span class="st">'20m'</span>,</span>
<span id="cb61-1997"><a href="#cb61-1997" aria-hidden="true" tabindex="-1"></a>            <span class="st">'ai_applications'</span>: <span class="st">'Refined vegetation analysis'</span></span>
<span id="cb61-1998"><a href="#cb61-1998" aria-hidden="true" tabindex="-1"></a>        },</span>
<span id="cb61-1999"><a href="#cb61-1999" aria-hidden="true" tabindex="-1"></a>        <span class="st">'B09'</span>: {</span>
<span id="cb61-2000"><a href="#cb61-2000" aria-hidden="true" tabindex="-1"></a>            <span class="st">'name'</span>: <span class="st">'Water Vapor'</span>,</span>
<span id="cb61-2001"><a href="#cb61-2001" aria-hidden="true" tabindex="-1"></a>            <span class="st">'wavelength'</span>: <span class="st">'945 nm'</span>,</span>
<span id="cb61-2002"><a href="#cb61-2002" aria-hidden="true" tabindex="-1"></a>            <span class="st">'resolution'</span>: <span class="st">'60m'</span>,</span>
<span id="cb61-2003"><a href="#cb61-2003" aria-hidden="true" tabindex="-1"></a>            <span class="st">'ai_applications'</span>: <span class="st">'Atmospheric water vapor correction'</span></span>
<span id="cb61-2004"><a href="#cb61-2004" aria-hidden="true" tabindex="-1"></a>        },</span>
<span id="cb61-2005"><a href="#cb61-2005" aria-hidden="true" tabindex="-1"></a>        <span class="st">'B11'</span>: {</span>
<span id="cb61-2006"><a href="#cb61-2006" aria-hidden="true" tabindex="-1"></a>            <span class="st">'name'</span>: <span class="st">'SWIR 1'</span>,</span>
<span id="cb61-2007"><a href="#cb61-2007" aria-hidden="true" tabindex="-1"></a>            <span class="st">'wavelength'</span>: <span class="st">'1610 nm'</span>,</span>
<span id="cb61-2008"><a href="#cb61-2008" aria-hidden="true" tabindex="-1"></a>            <span class="st">'resolution'</span>: <span class="st">'20m'</span>,</span>
<span id="cb61-2009"><a href="#cb61-2009" aria-hidden="true" tabindex="-1"></a>            <span class="st">'ai_applications'</span>: <span class="st">'Fire detection, soil moisture, geology'</span></span>
<span id="cb61-2010"><a href="#cb61-2010" aria-hidden="true" tabindex="-1"></a>        },</span>
<span id="cb61-2011"><a href="#cb61-2011" aria-hidden="true" tabindex="-1"></a>        <span class="st">'B12'</span>: {</span>
<span id="cb61-2012"><a href="#cb61-2012" aria-hidden="true" tabindex="-1"></a>            <span class="st">'name'</span>: <span class="st">'SWIR 2'</span>,</span>
<span id="cb61-2013"><a href="#cb61-2013" aria-hidden="true" tabindex="-1"></a>            <span class="st">'wavelength'</span>: <span class="st">'2190 nm'</span>,</span>
<span id="cb61-2014"><a href="#cb61-2014" aria-hidden="true" tabindex="-1"></a>            <span class="st">'resolution'</span>: <span class="st">'20m'</span>,</span>
<span id="cb61-2015"><a href="#cb61-2015" aria-hidden="true" tabindex="-1"></a>            <span class="st">'ai_applications'</span>: <span class="st">'Burn area mapping, mineral detection'</span></span>
<span id="cb61-2016"><a href="#cb61-2016" aria-hidden="true" tabindex="-1"></a>        }</span>
<span id="cb61-2017"><a href="#cb61-2017" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb61-2018"><a href="#cb61-2018" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb61-2019"><a href="#cb61-2019" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Additional data products available in Level 2A</span></span>
<span id="cb61-2020"><a href="#cb61-2020" aria-hidden="true" tabindex="-1"></a>    additional_products <span class="op">=</span> {</span>
<span id="cb61-2021"><a href="#cb61-2021" aria-hidden="true" tabindex="-1"></a>        <span class="st">'SCL'</span>: {</span>
<span id="cb61-2022"><a href="#cb61-2022" aria-hidden="true" tabindex="-1"></a>            <span class="st">'name'</span>: <span class="st">'Scene Classification Layer'</span>,</span>
<span id="cb61-2023"><a href="#cb61-2023" aria-hidden="true" tabindex="-1"></a>            <span class="st">'description'</span>: <span class="st">'Pixel-level land cover classification'</span>,</span>
<span id="cb61-2024"><a href="#cb61-2024" aria-hidden="true" tabindex="-1"></a>            <span class="st">'ai_applications'</span>: <span class="st">'Cloud masking, quality assessment'</span></span>
<span id="cb61-2025"><a href="#cb61-2025" aria-hidden="true" tabindex="-1"></a>        },</span>
<span id="cb61-2026"><a href="#cb61-2026" aria-hidden="true" tabindex="-1"></a>        <span class="st">'AOT'</span>: {</span>
<span id="cb61-2027"><a href="#cb61-2027" aria-hidden="true" tabindex="-1"></a>            <span class="st">'name'</span>: <span class="st">'Aerosol Optical Thickness'</span>,</span>
<span id="cb61-2028"><a href="#cb61-2028" aria-hidden="true" tabindex="-1"></a>            <span class="st">'description'</span>: <span class="st">'Atmospheric aerosol content'</span>,</span>
<span id="cb61-2029"><a href="#cb61-2029" aria-hidden="true" tabindex="-1"></a>            <span class="st">'ai_applications'</span>: <span class="st">'Atmospheric correction validation'</span></span>
<span id="cb61-2030"><a href="#cb61-2030" aria-hidden="true" tabindex="-1"></a>        },</span>
<span id="cb61-2031"><a href="#cb61-2031" aria-hidden="true" tabindex="-1"></a>        <span class="st">'WVP'</span>: {</span>
<span id="cb61-2032"><a href="#cb61-2032" aria-hidden="true" tabindex="-1"></a>            <span class="st">'name'</span>: <span class="st">'Water Vapor Pressure'</span>,</span>
<span id="cb61-2033"><a href="#cb61-2033" aria-hidden="true" tabindex="-1"></a>            <span class="st">'description'</span>: <span class="st">'Columnar water vapor content'</span>,</span>
<span id="cb61-2034"><a href="#cb61-2034" aria-hidden="true" tabindex="-1"></a>            <span class="st">'ai_applications'</span>: <span class="st">'Atmospheric correction, weather analysis'</span></span>
<span id="cb61-2035"><a href="#cb61-2035" aria-hidden="true" tabindex="-1"></a>        },</span>
<span id="cb61-2036"><a href="#cb61-2036" aria-hidden="true" tabindex="-1"></a>        <span class="st">'visual'</span>: {</span>
<span id="cb61-2037"><a href="#cb61-2037" aria-hidden="true" tabindex="-1"></a>            <span class="st">'name'</span>: <span class="st">'True Color Preview'</span>,</span>
<span id="cb61-2038"><a href="#cb61-2038" aria-hidden="true" tabindex="-1"></a>            <span class="st">'description'</span>: <span class="st">'RGB composite for visualization'</span>,</span>
<span id="cb61-2039"><a href="#cb61-2039" aria-hidden="true" tabindex="-1"></a>            <span class="st">'ai_applications'</span>: <span class="st">'Quick visual assessment, presentation'</span></span>
<span id="cb61-2040"><a href="#cb61-2040" aria-hidden="true" tabindex="-1"></a>        },</span>
<span id="cb61-2041"><a href="#cb61-2041" aria-hidden="true" tabindex="-1"></a>        <span class="st">'thumbnail'</span>: {</span>
<span id="cb61-2042"><a href="#cb61-2042" aria-hidden="true" tabindex="-1"></a>            <span class="st">'name'</span>: <span class="st">'Scene Thumbnail'</span>,</span>
<span id="cb61-2043"><a href="#cb61-2043" aria-hidden="true" tabindex="-1"></a>            <span class="st">'description'</span>: <span class="st">'Low-resolution preview image'</span>,</span>
<span id="cb61-2044"><a href="#cb61-2044" aria-hidden="true" tabindex="-1"></a>            <span class="st">'ai_applications'</span>: <span class="st">'Rapid quality screening'</span></span>
<span id="cb61-2045"><a href="#cb61-2045" aria-hidden="true" tabindex="-1"></a>        }</span>
<span id="cb61-2046"><a href="#cb61-2046" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb61-2047"><a href="#cb61-2047" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb61-2048"><a href="#cb61-2048" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Scene technical specifications</span></span>
<span id="cb61-2049"><a href="#cb61-2049" aria-hidden="true" tabindex="-1"></a>    acquisition_date <span class="op">=</span> scene_props.get(<span class="st">'datetime'</span>, <span class="st">'Unknown'</span>).split(<span class="st">'T'</span>)[<span class="dv">0</span>]</span>
<span id="cb61-2050"><a href="#cb61-2050" aria-hidden="true" tabindex="-1"></a>    platform <span class="op">=</span> scene_props.get(<span class="st">'platform'</span>, <span class="st">'Unknown'</span>)</span>
<span id="cb61-2051"><a href="#cb61-2051" aria-hidden="true" tabindex="-1"></a>    cloud_cover <span class="op">=</span> scene_props.get(<span class="st">'eo:cloud_cover'</span>, <span class="dv">0</span>)</span>
<span id="cb61-2052"><a href="#cb61-2052" aria-hidden="true" tabindex="-1"></a>    tile_id <span class="op">=</span> scene_props.get(<span class="st">'sentinel:grid_square'</span>, <span class="st">'Unknown'</span>)</span>
<span id="cb61-2053"><a href="#cb61-2053" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb61-2054"><a href="#cb61-2054" aria-hidden="true" tabindex="-1"></a>    logger.info(<span class="ss">f"Scene: </span><span class="sc">{</span>platform<span class="sc">}</span><span class="ss"> </span><span class="sc">{</span>acquisition_date<span class="sc">}</span><span class="ss">, Cloud: </span><span class="sc">{</span>cloud_cover<span class="sc">:.1f}</span><span class="ss">%, Tile: </span><span class="sc">{</span>tile_id<span class="sc">}</span><span class="ss">"</span>)</span>
<span id="cb61-2055"><a href="#cb61-2055" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb61-2056"><a href="#cb61-2056" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Inventory available spectral bands</span></span>
<span id="cb61-2057"><a href="#cb61-2057" aria-hidden="true" tabindex="-1"></a>    available_spectral <span class="op">=</span> []</span>
<span id="cb61-2058"><a href="#cb61-2058" aria-hidden="true" tabindex="-1"></a>    available_products <span class="op">=</span> []</span>
<span id="cb61-2059"><a href="#cb61-2059" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb61-2060"><a href="#cb61-2060" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> band_id, info <span class="kw">in</span> sentinel2_bands.items():</span>
<span id="cb61-2061"><a href="#cb61-2061" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> band_id <span class="kw">in</span> scene_assets:</span>
<span id="cb61-2062"><a href="#cb61-2062" aria-hidden="true" tabindex="-1"></a>            available_spectral.append(band_id)</span>
<span id="cb61-2063"><a href="#cb61-2063" aria-hidden="true" tabindex="-1"></a>            logger.debug(<span class="ss">f"Available: </span><span class="sc">{</span>band_id<span class="sc">}</span><span class="ss"> (</span><span class="sc">{</span>info[<span class="st">'name'</span>]<span class="sc">}</span><span class="ss">, </span><span class="sc">{</span>info[<span class="st">'resolution'</span>]<span class="sc">}</span><span class="ss">)"</span>)</span>
<span id="cb61-2064"><a href="#cb61-2064" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb61-2065"><a href="#cb61-2065" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> product_id, info <span class="kw">in</span> additional_products.items():</span>
<span id="cb61-2066"><a href="#cb61-2066" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> product_id <span class="kw">in</span> scene_assets:</span>
<span id="cb61-2067"><a href="#cb61-2067" aria-hidden="true" tabindex="-1"></a>            available_products.append(product_id)</span>
<span id="cb61-2068"><a href="#cb61-2068" aria-hidden="true" tabindex="-1"></a>            logger.debug(<span class="ss">f"Available product: </span><span class="sc">{</span>product_id<span class="sc">}</span><span class="ss"> - </span><span class="sc">{</span>info[<span class="st">'name'</span>]<span class="sc">}</span><span class="ss">"</span>)</span>
<span id="cb61-2069"><a href="#cb61-2069" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb61-2070"><a href="#cb61-2070" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Analysis readiness assessment</span></span>
<span id="cb61-2071"><a href="#cb61-2071" aria-hidden="true" tabindex="-1"></a>    core_bands <span class="op">=</span> [<span class="st">'B02'</span>, <span class="st">'B03'</span>, <span class="st">'B04'</span>, <span class="st">'B08'</span>]  <span class="co"># Essential for basic analysis</span></span>
<span id="cb61-2072"><a href="#cb61-2072" aria-hidden="true" tabindex="-1"></a>    advanced_bands <span class="op">=</span> [<span class="st">'B05'</span>, <span class="st">'B06'</span>, <span class="st">'B07'</span>, <span class="st">'B8A'</span>, <span class="st">'B11'</span>, <span class="st">'B12'</span>]  <span class="co"># For advanced analysis</span></span>
<span id="cb61-2073"><a href="#cb61-2073" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb61-2074"><a href="#cb61-2074" aria-hidden="true" tabindex="-1"></a>    core_available <span class="op">=</span> <span class="bu">sum</span>(<span class="dv">1</span> <span class="cf">for</span> band <span class="kw">in</span> core_bands <span class="cf">if</span> band <span class="kw">in</span> available_spectral)</span>
<span id="cb61-2075"><a href="#cb61-2075" aria-hidden="true" tabindex="-1"></a>    advanced_available <span class="op">=</span> <span class="bu">sum</span>(<span class="dv">1</span> <span class="cf">for</span> band <span class="kw">in</span> advanced_bands <span class="cf">if</span> band <span class="kw">in</span> available_spectral)</span>
<span id="cb61-2076"><a href="#cb61-2076" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb61-2077"><a href="#cb61-2077" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Analysis readiness assessment</span></span>
<span id="cb61-2078"><a href="#cb61-2078" aria-hidden="true" tabindex="-1"></a>    logger.info(<span class="ss">f"Bands available: </span><span class="sc">{</span>core_available<span class="sc">}</span><span class="ss">/</span><span class="sc">{</span><span class="bu">len</span>(core_bands)<span class="sc">}</span><span class="ss"> core, </span><span class="sc">{</span>advanced_available<span class="sc">}</span><span class="ss">/</span><span class="sc">{</span><span class="bu">len</span>(advanced_bands)<span class="sc">}</span><span class="ss"> advanced"</span>)</span>
<span id="cb61-2079"><a href="#cb61-2079" aria-hidden="true" tabindex="-1"></a>    logger.info(<span class="ss">f"Additional products: </span><span class="sc">{</span><span class="bu">len</span>(available_products)<span class="sc">}</span><span class="ss">"</span>)</span>
<span id="cb61-2080"><a href="#cb61-2080" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb61-2081"><a href="#cb61-2081" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Determine analysis capabilities</span></span>
<span id="cb61-2082"><a href="#cb61-2082" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> core_available <span class="op">==</span> <span class="bu">len</span>(core_bands):</span>
<span id="cb61-2083"><a href="#cb61-2083" aria-hidden="true" tabindex="-1"></a>        analysis_capabilities <span class="op">=</span> [<span class="st">"NDVI calculation"</span>, <span class="st">"True color visualization"</span>, <span class="st">"Basic land cover classification"</span>]</span>
<span id="cb61-2084"><a href="#cb61-2084" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb61-2085"><a href="#cb61-2085" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> <span class="st">'B11'</span> <span class="kw">in</span> available_spectral <span class="kw">and</span> <span class="st">'B12'</span> <span class="kw">in</span> available_spectral:</span>
<span id="cb61-2086"><a href="#cb61-2086" aria-hidden="true" tabindex="-1"></a>            analysis_capabilities.extend([<span class="st">"Fire detection"</span>, <span class="st">"Soil moisture analysis"</span>])</span>
<span id="cb61-2087"><a href="#cb61-2087" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> advanced_available <span class="op">&gt;=</span> <span class="dv">4</span>:</span>
<span id="cb61-2088"><a href="#cb61-2088" aria-hidden="true" tabindex="-1"></a>            analysis_capabilities.extend([<span class="st">"Advanced vegetation indices"</span>, <span class="st">"Crop type classification"</span>])</span>
<span id="cb61-2089"><a href="#cb61-2089" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> <span class="st">'SCL'</span> <span class="kw">in</span> available_products:</span>
<span id="cb61-2090"><a href="#cb61-2090" aria-hidden="true" tabindex="-1"></a>            analysis_capabilities.append(<span class="st">"Automated cloud masking"</span>)</span>
<span id="cb61-2091"><a href="#cb61-2091" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb61-2092"><a href="#cb61-2092" aria-hidden="true" tabindex="-1"></a>        logger.info(<span class="ss">f"Analysis ready: </span><span class="sc">{</span><span class="bu">len</span>(analysis_capabilities)<span class="sc">}</span><span class="ss"> capabilities enabled"</span>)</span>
<span id="cb61-2093"><a href="#cb61-2093" aria-hidden="true" tabindex="-1"></a>    <span class="cf">else</span>:</span>
<span id="cb61-2094"><a href="#cb61-2094" aria-hidden="true" tabindex="-1"></a>        missing_core <span class="op">=</span> [band <span class="cf">for</span> band <span class="kw">in</span> core_bands <span class="cf">if</span> band <span class="kw">not</span> <span class="kw">in</span> available_spectral]</span>
<span id="cb61-2095"><a href="#cb61-2095" aria-hidden="true" tabindex="-1"></a>        logger.warning(<span class="ss">f"Limited analysis: missing core bands </span><span class="sc">{</span>missing_core<span class="sc">}</span><span class="ss">"</span>)</span>
<span id="cb61-2096"><a href="#cb61-2096" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb61-2097"><a href="#cb61-2097" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Store technical metadata</span></span>
<span id="cb61-2098"><a href="#cb61-2098" aria-hidden="true" tabindex="-1"></a>    crs_info <span class="op">=</span> <span class="ss">f"EPSG:</span><span class="sc">{</span>scene_props[<span class="st">'proj:epsg'</span>]<span class="sc">}</span><span class="ss">"</span> <span class="cf">if</span> <span class="st">'proj:epsg'</span> <span class="kw">in</span> scene_props <span class="cf">else</span> <span class="st">"UTM"</span></span>
<span id="cb61-2099"><a href="#cb61-2099" aria-hidden="true" tabindex="-1"></a>    utm_zone <span class="op">=</span> scene_props.get(<span class="st">'sentinel:utm_zone'</span>, <span class="st">'Unknown'</span>)</span>
<span id="cb61-2100"><a href="#cb61-2100" aria-hidden="true" tabindex="-1"></a>    logger.info(<span class="ss">f"Metadata: </span><span class="sc">{</span>crs_info<span class="sc">}</span><span class="ss">, UTM zone </span><span class="sc">{</span>utm_zone<span class="sc">}</span><span class="ss">, 16-bit COG format"</span>)</span>
<span id="cb61-2101"><a href="#cb61-2101" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb61-2102"><a href="#cb61-2102" aria-hidden="true" tabindex="-1"></a><span class="cf">else</span>:</span>
<span id="cb61-2103"><a href="#cb61-2103" aria-hidden="true" tabindex="-1"></a>    logger.warning(<span class="st">"No optimal scene selected - cannot perform metadata analysis"</span>)</span>
<span id="cb61-2104"><a href="#cb61-2104" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb61-2105"><a href="#cb61-2105" aria-hidden="true" tabindex="-1"></a><span class="fu">## Sentinel-2 for AI Applications</span></span>
<span id="cb61-2106"><a href="#cb61-2106" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb61-2107"><a href="#cb61-2107" aria-hidden="true" tabindex="-1"></a>Sentinel-2 is well-suited for geospatial AI due to its 13 multi-spectral bands spanning the visible to shortwave infrared range. The satellite offers a high revisit frequency of every 5 days, enabling temporal analysis. Its moderate spatial resolution of 10 to 20 meters is optimal for landscape-scale AI tasks. Sentinel-2 data is freely accessible under an open data policy, which supports large-scale model training. The standardized Level 2A processing ensures consistent data quality, and global coverage provides uniform data characteristics worldwide.</span>
<span id="cb61-2108"><a href="#cb61-2108" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb61-2109"><a href="#cb61-2109" aria-hidden="true" tabindex="-1"></a>For AI applications, Sentinel-2 offers several advantages. The large data volume supports robust model development and training. The scene classification layer can be used as ground truth for validation. Time series data enables the development of sequence models, and the availability of multiple spatial resolutions allows for hierarchical learning approaches.</span>
<span id="cb61-2110"><a href="#cb61-2110" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb61-2111"><a href="#cb61-2111" aria-hidden="true" tabindex="-1"></a>Now let's examine the scene's geographic characteristics and proceed to data loading.</span>
<span id="cb61-2112"><a href="#cb61-2112" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb61-2113"><a href="#cb61-2113" aria-hidden="true" tabindex="-1"></a>---</span>
<span id="cb61-2114"><a href="#cb61-2114" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb61-2115"><a href="#cb61-2115" aria-hidden="true" tabindex="-1"></a><span class="fu">## Step 5: Production-Grade Satellite Data Loading and Processing</span></span>
<span id="cb61-2116"><a href="#cb61-2116" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb61-2117"><a href="#cb61-2117" aria-hidden="true" tabindex="-1"></a><span class="fu">### Learning Objectives</span></span>
<span id="cb61-2118"><a href="#cb61-2118" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb61-2119"><a href="#cb61-2119" aria-hidden="true" tabindex="-1"></a>By the end of this section, you will be able to implement memory-efficient satellite data loading with intelligent subsetting, design adaptive processing strategies based on scene characteristics, create robust error handling for network-dependent data workflows, and build multi-dimensional datasets suitable for AI and machine learning applications.</span>
<span id="cb61-2120"><a href="#cb61-2120" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb61-2121"><a href="#cb61-2121" aria-hidden="true" tabindex="-1"></a><span class="fu">### The Challenge of Large-Scale Satellite Data Loading</span></span>
<span id="cb61-2122"><a href="#cb61-2122" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb61-2123"><a href="#cb61-2123" aria-hidden="true" tabindex="-1"></a>Modern satellite scenes can exceed 1GB in size, which requires careful planning for data loading and processing. Efficient memory management is necessary to avoid loading unnecessary data into RAM. Network efficiency is also important to minimize data transfer while maintaining analysis quality. Processing strategies should be adaptive, adjusting to the size and characteristics of each scene. Additionally, workflows must be resilient to network interruptions and data access failures.</span>
<span id="cb61-2124"><a href="#cb61-2124" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb61-2125"><a href="#cb61-2125" aria-hidden="true" tabindex="-1"></a><span class="fu">### Intelligent Data Loading Architecture</span></span>
<span id="cb61-2126"><a href="#cb61-2126" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb61-2127"><a href="#cb61-2127" aria-hidden="true" tabindex="-1"></a>The following approach demonstrates production-ready patterns used in operational systems. It implements an intelligent satellite data loading pipeline that adapts processing based on scene characteristics, selecting optimal loading strategies according to the scene size and analysis requirements.</span>
<span id="cb61-2128"><a href="#cb61-2128" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb61-2131"><a href="#cb61-2131" aria-hidden="true" tabindex="-1"></a><span class="in">```{python}</span></span>
<span id="cb61-2132"><a href="#cb61-2132" aria-hidden="true" tabindex="-1"></a><span class="co"># Step 5A: Scene Analysis and Adaptive Subset Strategy Selection</span></span>
<span id="cb61-2133"><a href="#cb61-2133" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span> <span class="st">'best_scene'</span> <span class="kw">in</span> <span class="bu">locals</span>():</span>
<span id="cb61-2134"><a href="#cb61-2134" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Comprehensive scene analysis for optimal loading strategy</span></span>
<span id="cb61-2135"><a href="#cb61-2135" aria-hidden="true" tabindex="-1"></a>    scene_info <span class="op">=</span> get_scene_info(best_scene)</span>
<span id="cb61-2136"><a href="#cb61-2136" aria-hidden="true" tabindex="-1"></a>    logger.info(<span class="ss">f"Scene extent: </span><span class="sc">{</span>scene_info[<span class="st">'width_km'</span>]<span class="sc">:.1f}</span><span class="ss">×</span><span class="sc">{</span>scene_info[<span class="st">'height_km'</span>]<span class="sc">:.1f}</span><span class="ss"> km (</span><span class="sc">{</span>scene_info[<span class="st">'area_km2'</span>]<span class="sc">:.0f}</span><span class="ss"> km²)"</span>)</span>
<span id="cb61-2137"><a href="#cb61-2137" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb61-2138"><a href="#cb61-2138" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Adaptive subset strategy based on scene characteristics</span></span>
<span id="cb61-2139"><a href="#cb61-2139" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb61-2140"><a href="#cb61-2140" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Decision matrix for subset sizing</span></span>
<span id="cb61-2141"><a href="#cb61-2141" aria-hidden="true" tabindex="-1"></a>    subset_strategies <span class="op">=</span> {</span>
<span id="cb61-2142"><a href="#cb61-2142" aria-hidden="true" tabindex="-1"></a>        <span class="st">"large_scene"</span>: {</span>
<span id="cb61-2143"><a href="#cb61-2143" aria-hidden="true" tabindex="-1"></a>            <span class="st">"condition"</span>: scene_info[<span class="st">'area_km2'</span>] <span class="op">&gt;</span> <span class="dv">5000</span>,</span>
<span id="cb61-2144"><a href="#cb61-2144" aria-hidden="true" tabindex="-1"></a>            <span class="st">"x_range"</span>: (<span class="dv">30</span>, <span class="dv">70</span>),</span>
<span id="cb61-2145"><a href="#cb61-2145" aria-hidden="true" tabindex="-1"></a>            <span class="st">"y_range"</span>: (<span class="dv">30</span>, <span class="dv">70</span>),</span>
<span id="cb61-2146"><a href="#cb61-2146" aria-hidden="true" tabindex="-1"></a>            <span class="st">"coverage"</span>: <span class="dv">16</span>,  <span class="co"># 40% × 40%</span></span>
<span id="cb61-2147"><a href="#cb61-2147" aria-hidden="true" tabindex="-1"></a>            <span class="st">"rationale"</span>: <span class="st">"Conservative subset for large scenes to manage memory usage"</span>,</span>
<span id="cb61-2148"><a href="#cb61-2148" aria-hidden="true" tabindex="-1"></a>            <span class="st">"description"</span>: <span class="st">"middle 40% (large scene optimization)"</span></span>
<span id="cb61-2149"><a href="#cb61-2149" aria-hidden="true" tabindex="-1"></a>        },</span>
<span id="cb61-2150"><a href="#cb61-2150" aria-hidden="true" tabindex="-1"></a>        <span class="st">"medium_scene"</span>: {</span>
<span id="cb61-2151"><a href="#cb61-2151" aria-hidden="true" tabindex="-1"></a>            <span class="st">"condition"</span>: scene_info[<span class="st">'area_km2'</span>] <span class="op">&gt;</span> <span class="dv">1000</span>,</span>
<span id="cb61-2152"><a href="#cb61-2152" aria-hidden="true" tabindex="-1"></a>            <span class="st">"x_range"</span>: (<span class="dv">20</span>, <span class="dv">80</span>),</span>
<span id="cb61-2153"><a href="#cb61-2153" aria-hidden="true" tabindex="-1"></a>            <span class="st">"y_range"</span>: (<span class="dv">20</span>, <span class="dv">80</span>),</span>
<span id="cb61-2154"><a href="#cb61-2154" aria-hidden="true" tabindex="-1"></a>            <span class="st">"coverage"</span>: <span class="dv">36</span>,  <span class="co"># 60% × 60%</span></span>
<span id="cb61-2155"><a href="#cb61-2155" aria-hidden="true" tabindex="-1"></a>            <span class="st">"rationale"</span>: <span class="st">"Balanced subset for medium scenes"</span>,</span>
<span id="cb61-2156"><a href="#cb61-2156" aria-hidden="true" tabindex="-1"></a>            <span class="st">"description"</span>: <span class="st">"middle 60% (balanced approach)"</span></span>
<span id="cb61-2157"><a href="#cb61-2157" aria-hidden="true" tabindex="-1"></a>        },</span>
<span id="cb61-2158"><a href="#cb61-2158" aria-hidden="true" tabindex="-1"></a>        <span class="st">"small_scene"</span>: {</span>
<span id="cb61-2159"><a href="#cb61-2159" aria-hidden="true" tabindex="-1"></a>            <span class="st">"condition"</span>: scene_info[<span class="st">'area_km2'</span>] <span class="op">&lt;=</span> <span class="dv">1000</span>,</span>
<span id="cb61-2160"><a href="#cb61-2160" aria-hidden="true" tabindex="-1"></a>            <span class="st">"x_range"</span>: (<span class="dv">10</span>, <span class="dv">90</span>),</span>
<span id="cb61-2161"><a href="#cb61-2161" aria-hidden="true" tabindex="-1"></a>            <span class="st">"y_range"</span>: (<span class="dv">10</span>, <span class="dv">90</span>),</span>
<span id="cb61-2162"><a href="#cb61-2162" aria-hidden="true" tabindex="-1"></a>            <span class="st">"coverage"</span>: <span class="dv">64</span>,  <span class="co"># 80% × 80%</span></span>
<span id="cb61-2163"><a href="#cb61-2163" aria-hidden="true" tabindex="-1"></a>            <span class="st">"rationale"</span>: <span class="st">"Maximum coverage for small scenes"</span>,</span>
<span id="cb61-2164"><a href="#cb61-2164" aria-hidden="true" tabindex="-1"></a>            <span class="st">"description"</span>: <span class="st">"most of scene (small scene - maximize coverage)"</span></span>
<span id="cb61-2165"><a href="#cb61-2165" aria-hidden="true" tabindex="-1"></a>        }</span>
<span id="cb61-2166"><a href="#cb61-2166" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb61-2167"><a href="#cb61-2167" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb61-2168"><a href="#cb61-2168" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Select optimal strategy</span></span>
<span id="cb61-2169"><a href="#cb61-2169" aria-hidden="true" tabindex="-1"></a>    selected_strategy <span class="op">=</span> <span class="va">None</span></span>
<span id="cb61-2170"><a href="#cb61-2170" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> strategy_name, strategy <span class="kw">in</span> subset_strategies.items():</span>
<span id="cb61-2171"><a href="#cb61-2171" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> strategy[<span class="st">"condition"</span>]:</span>
<span id="cb61-2172"><a href="#cb61-2172" aria-hidden="true" tabindex="-1"></a>            selected_strategy <span class="op">=</span> strategy</span>
<span id="cb61-2173"><a href="#cb61-2173" aria-hidden="true" tabindex="-1"></a>            strategy_name_selected <span class="op">=</span> strategy_name</span>
<span id="cb61-2174"><a href="#cb61-2174" aria-hidden="true" tabindex="-1"></a>            logger.info(<span class="ss">f"Selected strategy: </span><span class="sc">{</span>strategy_name<span class="sc">}</span><span class="ss"> (</span><span class="sc">{</span>strategy[<span class="st">'coverage'</span>]<span class="sc">}</span><span class="ss">% coverage)"</span>)</span>
<span id="cb61-2175"><a href="#cb61-2175" aria-hidden="true" tabindex="-1"></a>            <span class="cf">break</span></span>
<span id="cb61-2176"><a href="#cb61-2176" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb61-2177"><a href="#cb61-2177" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Apply selected subset strategy</span></span>
<span id="cb61-2178"><a href="#cb61-2178" aria-hidden="true" tabindex="-1"></a>    x_range, y_range <span class="op">=</span> selected_strategy[<span class="st">"x_range"</span>], selected_strategy[<span class="st">"y_range"</span>]</span>
<span id="cb61-2179"><a href="#cb61-2179" aria-hidden="true" tabindex="-1"></a>    subset_bbox <span class="op">=</span> get_subset_from_scene(best_scene, x_range<span class="op">=</span>x_range, y_range<span class="op">=</span>y_range)</span>
<span id="cb61-2180"><a href="#cb61-2180" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb61-2181"><a href="#cb61-2181" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Calculate expected data characteristics</span></span>
<span id="cb61-2182"><a href="#cb61-2182" aria-hidden="true" tabindex="-1"></a>    subset_area_km2 <span class="op">=</span> scene_info[<span class="st">'area_km2'</span>] <span class="op">*</span> (selected_strategy[<span class="st">'coverage'</span>] <span class="op">/</span> <span class="dv">100</span>)</span>
<span id="cb61-2183"><a href="#cb61-2183" aria-hidden="true" tabindex="-1"></a>    estimated_pixels_10m <span class="op">=</span> subset_area_km2 <span class="op">*</span> <span class="fl">1e6</span> <span class="op">/</span> (<span class="dv">10</span> <span class="op">*</span> <span class="dv">10</span>)  <span class="co"># 10m pixel size</span></span>
<span id="cb61-2184"><a href="#cb61-2184" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb61-2185"><a href="#cb61-2185" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Log subset characteristics</span></span>
<span id="cb61-2186"><a href="#cb61-2186" aria-hidden="true" tabindex="-1"></a>    logger.info(<span class="ss">f"Subset: </span><span class="sc">{</span>subset_area_km2<span class="sc">:.0f}</span><span class="ss"> km², </span><span class="sc">{</span>estimated_pixels_10m<span class="sc">:,.0f}</span><span class="ss"> pixels, ~</span><span class="sc">{</span>estimated_pixels_10m <span class="op">*</span> <span class="dv">4</span> <span class="op">*</span> <span class="dv">2</span> <span class="op">/</span> <span class="fl">1e6</span><span class="sc">:.1f}</span><span class="ss"> MB"</span>)</span>
<span id="cb61-2187"><a href="#cb61-2187" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb61-2188"><a href="#cb61-2188" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Alternative subset strategies available for experimentation</span></span>
<span id="cb61-2189"><a href="#cb61-2189" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb61-2190"><a href="#cb61-2190" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Core bands for essential analysis</span></span>
<span id="cb61-2191"><a href="#cb61-2191" aria-hidden="true" tabindex="-1"></a>    core_bands <span class="op">=</span> [<span class="st">'B04'</span>, <span class="st">'B03'</span>, <span class="st">'B02'</span>, <span class="st">'B08'</span>]  <span class="co"># Red, Green, Blue, NIR</span></span>
<span id="cb61-2192"><a href="#cb61-2192" aria-hidden="true" tabindex="-1"></a>    logger.info(<span class="ss">f"Selected </span><span class="sc">{</span><span class="bu">len</span>(core_bands)<span class="sc">}</span><span class="ss"> core bands for RGB and NDVI analysis"</span>)</span>
<span id="cb61-2193"><a href="#cb61-2193" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb61-2194"><a href="#cb61-2194" aria-hidden="true" tabindex="-1"></a><span class="cf">else</span>:</span>
<span id="cb61-2195"><a href="#cb61-2195" aria-hidden="true" tabindex="-1"></a>    logger.warning(<span class="st">"No optimal scene available - using default configuration"</span>)</span>
<span id="cb61-2196"><a href="#cb61-2196" aria-hidden="true" tabindex="-1"></a>    core_bands <span class="op">=</span> [<span class="st">'B04'</span>, <span class="st">'B03'</span>, <span class="st">'B02'</span>, <span class="st">'B08'</span>]  <span class="co"># Default selection</span></span>
<span id="cb61-2197"><a href="#cb61-2197" aria-hidden="true" tabindex="-1"></a>    subset_bbox <span class="op">=</span> <span class="va">None</span></span>
<span id="cb61-2198"><a href="#cb61-2198" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb61-2199"><a href="#cb61-2199" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb61-2200"><a href="#cb61-2200" aria-hidden="true" tabindex="-1"></a><span class="fu">#### High-Performance Data Loading Implementation</span></span>
<span id="cb61-2201"><a href="#cb61-2201" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb61-2202"><a href="#cb61-2202" aria-hidden="true" tabindex="-1"></a>Now we'll implement the actual data loading with comprehensive error handling and performance monitoring:</span>
<span id="cb61-2203"><a href="#cb61-2203" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb61-2204"><a href="#cb61-2204" aria-hidden="true" tabindex="-1"></a>**Executing Production-Grade Data Loading:**</span>
<span id="cb61-2205"><a href="#cb61-2205" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb61-2206"><a href="#cb61-2206" aria-hidden="true" tabindex="-1"></a>This demonstrates enterprise-level error handling and performance optimization with comprehensive pre-loading validation.</span>
<span id="cb61-2207"><a href="#cb61-2207" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb61-2210"><a href="#cb61-2210" aria-hidden="true" tabindex="-1"></a><span class="in">```{python}</span></span>
<span id="cb61-2211"><a href="#cb61-2211" aria-hidden="true" tabindex="-1"></a><span class="co"># Step 5B: Execute Robust Data Loading with Performance Monitoring</span></span>
<span id="cb61-2212"><a href="#cb61-2212" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span> <span class="st">'best_scene'</span> <span class="kw">in</span> <span class="bu">locals</span>() <span class="kw">and</span> <span class="st">'subset_bbox'</span> <span class="kw">in</span> <span class="bu">locals</span>():</span>
<span id="cb61-2213"><a href="#cb61-2213" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Pre-loading validation and preparation</span></span>
<span id="cb61-2214"><a href="#cb61-2214" aria-hidden="true" tabindex="-1"></a>    logger.info(<span class="ss">f"Loading scene </span><span class="sc">{</span>best_scene<span class="sc">.</span><span class="bu">id</span><span class="sc">}</span><span class="ss">: </span><span class="sc">{</span><span class="bu">len</span>(core_bands)<span class="sc">}</span><span class="ss"> bands, ~</span><span class="sc">{</span>estimated_pixels_10m <span class="op">*</span> <span class="bu">len</span>(core_bands) <span class="op">*</span> <span class="dv">2</span> <span class="op">/</span> <span class="fl">1e6</span><span class="sc">:.1f}</span><span class="ss"> MB"</span>)</span>
<span id="cb61-2215"><a href="#cb61-2215" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb61-2216"><a href="#cb61-2216" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Enhanced loading with comprehensive monitoring</span></span>
<span id="cb61-2217"><a href="#cb61-2217" aria-hidden="true" tabindex="-1"></a>    loading_start_time <span class="op">=</span> time.time()</span>
<span id="cb61-2218"><a href="#cb61-2218" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb61-2219"><a href="#cb61-2219" aria-hidden="true" tabindex="-1"></a>    <span class="cf">try</span>:</span>
<span id="cb61-2220"><a href="#cb61-2220" aria-hidden="true" tabindex="-1"></a>        band_data <span class="op">=</span> load_sentinel2_bands(</span>
<span id="cb61-2221"><a href="#cb61-2221" aria-hidden="true" tabindex="-1"></a>            best_scene,</span>
<span id="cb61-2222"><a href="#cb61-2222" aria-hidden="true" tabindex="-1"></a>            bands<span class="op">=</span>core_bands,</span>
<span id="cb61-2223"><a href="#cb61-2223" aria-hidden="true" tabindex="-1"></a>            subset_bbox<span class="op">=</span>subset_bbox,</span>
<span id="cb61-2224"><a href="#cb61-2224" aria-hidden="true" tabindex="-1"></a>            max_retries<span class="op">=</span><span class="dv">5</span></span>
<span id="cb61-2225"><a href="#cb61-2225" aria-hidden="true" tabindex="-1"></a>        )</span>
<span id="cb61-2226"><a href="#cb61-2226" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb61-2227"><a href="#cb61-2227" aria-hidden="true" tabindex="-1"></a>        loading_duration <span class="op">=</span> time.time() <span class="op">-</span> loading_start_time</span>
<span id="cb61-2228"><a href="#cb61-2228" aria-hidden="true" tabindex="-1"></a>        transfer_rate <span class="op">=</span> (estimated_pixels_10m <span class="op">*</span> <span class="bu">len</span>(core_bands) <span class="op">*</span> <span class="dv">2</span> <span class="op">/</span> <span class="fl">1e6</span>) <span class="op">/</span> loading_duration</span>
<span id="cb61-2229"><a href="#cb61-2229" aria-hidden="true" tabindex="-1"></a>        logger.info(<span class="ss">f"Data loading successful: </span><span class="sc">{</span>loading_duration<span class="sc">:.1f}</span><span class="ss">s, </span><span class="sc">{</span>transfer_rate<span class="sc">:.1f}</span><span class="ss"> MB/s"</span>)</span>
<span id="cb61-2230"><a href="#cb61-2230" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb61-2231"><a href="#cb61-2231" aria-hidden="true" tabindex="-1"></a>    <span class="cf">except</span> <span class="pp">Exception</span> <span class="im">as</span> loading_error:</span>
<span id="cb61-2232"><a href="#cb61-2232" aria-hidden="true" tabindex="-1"></a>        loading_duration <span class="op">=</span> time.time() <span class="op">-</span> loading_start_time</span>
<span id="cb61-2233"><a href="#cb61-2233" aria-hidden="true" tabindex="-1"></a>        logger.error(<span class="ss">f"Data loading failed after </span><span class="sc">{</span>loading_duration<span class="sc">:.1f}</span><span class="ss">s: </span><span class="sc">{</span><span class="bu">str</span>(loading_error)[:<span class="dv">80</span>]<span class="sc">}</span><span class="ss">"</span>)</span>
<span id="cb61-2234"><a href="#cb61-2234" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb61-2235"><a href="#cb61-2235" aria-hidden="true" tabindex="-1"></a>        <span class="co"># Fallback 1: Try without subset</span></span>
<span id="cb61-2236"><a href="#cb61-2236" aria-hidden="true" tabindex="-1"></a>        <span class="cf">try</span>:</span>
<span id="cb61-2237"><a href="#cb61-2237" aria-hidden="true" tabindex="-1"></a>            band_data <span class="op">=</span> load_sentinel2_bands(</span>
<span id="cb61-2238"><a href="#cb61-2238" aria-hidden="true" tabindex="-1"></a>                best_scene,</span>
<span id="cb61-2239"><a href="#cb61-2239" aria-hidden="true" tabindex="-1"></a>                bands<span class="op">=</span>core_bands,</span>
<span id="cb61-2240"><a href="#cb61-2240" aria-hidden="true" tabindex="-1"></a>                subset_bbox<span class="op">=</span><span class="va">None</span>,</span>
<span id="cb61-2241"><a href="#cb61-2241" aria-hidden="true" tabindex="-1"></a>                max_retries<span class="op">=</span><span class="dv">3</span></span>
<span id="cb61-2242"><a href="#cb61-2242" aria-hidden="true" tabindex="-1"></a>            )</span>
<span id="cb61-2243"><a href="#cb61-2243" aria-hidden="true" tabindex="-1"></a>            logger.info(<span class="st">"Full scene loading successful"</span>)</span>
<span id="cb61-2244"><a href="#cb61-2244" aria-hidden="true" tabindex="-1"></a>            subset_bbox <span class="op">=</span> <span class="va">None</span></span>
<span id="cb61-2245"><a href="#cb61-2245" aria-hidden="true" tabindex="-1"></a>        <span class="cf">except</span> <span class="pp">Exception</span> <span class="im">as</span> full_scene_error:</span>
<span id="cb61-2246"><a href="#cb61-2246" aria-hidden="true" tabindex="-1"></a>            logger.warning(<span class="ss">f"Full scene loading failed: </span><span class="sc">{</span><span class="bu">str</span>(full_scene_error)[:<span class="dv">80</span>]<span class="sc">}</span><span class="ss">"</span>)</span>
<span id="cb61-2247"><a href="#cb61-2247" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb61-2248"><a href="#cb61-2248" aria-hidden="true" tabindex="-1"></a>            <span class="co"># Fallback 2: Reduce band count</span></span>
<span id="cb61-2249"><a href="#cb61-2249" aria-hidden="true" tabindex="-1"></a>            <span class="cf">try</span>:</span>
<span id="cb61-2250"><a href="#cb61-2250" aria-hidden="true" tabindex="-1"></a>                essential_bands <span class="op">=</span> [<span class="st">'B04'</span>, <span class="st">'B08'</span>]  <span class="co"># Minimum for NDVI</span></span>
<span id="cb61-2251"><a href="#cb61-2251" aria-hidden="true" tabindex="-1"></a>                band_data <span class="op">=</span> load_sentinel2_bands(</span>
<span id="cb61-2252"><a href="#cb61-2252" aria-hidden="true" tabindex="-1"></a>                    best_scene,</span>
<span id="cb61-2253"><a href="#cb61-2253" aria-hidden="true" tabindex="-1"></a>                    bands<span class="op">=</span>essential_bands,</span>
<span id="cb61-2254"><a href="#cb61-2254" aria-hidden="true" tabindex="-1"></a>                    subset_bbox<span class="op">=</span>subset_bbox,</span>
<span id="cb61-2255"><a href="#cb61-2255" aria-hidden="true" tabindex="-1"></a>                    max_retries<span class="op">=</span><span class="dv">3</span></span>
<span id="cb61-2256"><a href="#cb61-2256" aria-hidden="true" tabindex="-1"></a>                )</span>
<span id="cb61-2257"><a href="#cb61-2257" aria-hidden="true" tabindex="-1"></a>                core_bands <span class="op">=</span> essential_bands</span>
<span id="cb61-2258"><a href="#cb61-2258" aria-hidden="true" tabindex="-1"></a>                logger.info(<span class="ss">f"Reduced band loading successful (</span><span class="sc">{</span><span class="bu">len</span>(essential_bands)<span class="sc">}</span><span class="ss"> bands)"</span>)</span>
<span id="cb61-2259"><a href="#cb61-2259" aria-hidden="true" tabindex="-1"></a>            <span class="cf">except</span> <span class="pp">Exception</span> <span class="im">as</span> reduced_error:</span>
<span id="cb61-2260"><a href="#cb61-2260" aria-hidden="true" tabindex="-1"></a>                logger.error(<span class="st">"All loading strategies failed - creating synthetic data"</span>)</span>
<span id="cb61-2261"><a href="#cb61-2261" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb61-2262"><a href="#cb61-2262" aria-hidden="true" tabindex="-1"></a>                <span class="co"># Create realistic synthetic data for educational continuity</span></span>
<span id="cb61-2263"><a href="#cb61-2263" aria-hidden="true" tabindex="-1"></a>                synthetic_size <span class="op">=</span> (<span class="dv">1000</span>, <span class="dv">1000</span>)</span>
<span id="cb61-2264"><a href="#cb61-2264" aria-hidden="true" tabindex="-1"></a>                band_data <span class="op">=</span> {</span>
<span id="cb61-2265"><a href="#cb61-2265" aria-hidden="true" tabindex="-1"></a>                    <span class="st">'B04'</span>: np.random.randint(<span class="dv">1000</span>, <span class="dv">4000</span>, synthetic_size, dtype<span class="op">=</span>np.uint16),</span>
<span id="cb61-2266"><a href="#cb61-2266" aria-hidden="true" tabindex="-1"></a>                    <span class="st">'B03'</span>: np.random.randint(<span class="dv">1000</span>, <span class="dv">4000</span>, synthetic_size, dtype<span class="op">=</span>np.uint16),</span>
<span id="cb61-2267"><a href="#cb61-2267" aria-hidden="true" tabindex="-1"></a>                    <span class="st">'B02'</span>: np.random.randint(<span class="dv">1000</span>, <span class="dv">4000</span>, synthetic_size, dtype<span class="op">=</span>np.uint16),</span>
<span id="cb61-2268"><a href="#cb61-2268" aria-hidden="true" tabindex="-1"></a>                    <span class="st">'B08'</span>: np.random.randint(<span class="dv">2000</span>, <span class="dv">6000</span>, synthetic_size, dtype<span class="op">=</span>np.uint16),</span>
<span id="cb61-2269"><a href="#cb61-2269" aria-hidden="true" tabindex="-1"></a>                    <span class="st">'transform'</span>: <span class="va">None</span>,</span>
<span id="cb61-2270"><a href="#cb61-2270" aria-hidden="true" tabindex="-1"></a>                    <span class="st">'crs'</span>: <span class="va">None</span>,</span>
<span id="cb61-2271"><a href="#cb61-2271" aria-hidden="true" tabindex="-1"></a>                    <span class="st">'bounds'</span>: subset_bbox <span class="cf">if</span> subset_bbox <span class="cf">else</span> sf_bay_bbox,</span>
<span id="cb61-2272"><a href="#cb61-2272" aria-hidden="true" tabindex="-1"></a>                    <span class="st">'scene_id'</span>: <span class="st">'SYNTHETIC_DEMO'</span>,</span>
<span id="cb61-2273"><a href="#cb61-2273" aria-hidden="true" tabindex="-1"></a>                    <span class="st">'date'</span>: <span class="st">'2024-01-01'</span></span>
<span id="cb61-2274"><a href="#cb61-2274" aria-hidden="true" tabindex="-1"></a>                }</span>
<span id="cb61-2275"><a href="#cb61-2275" aria-hidden="true" tabindex="-1"></a>                logger.info(<span class="ss">f"Synthetic data created: </span><span class="sc">{</span>synthetic_size[<span class="dv">0</span>]<span class="sc">}</span><span class="ss">×</span><span class="sc">{</span>synthetic_size[<span class="dv">1</span>]<span class="sc">}</span><span class="ss"> pixels"</span>)</span>
<span id="cb61-2276"><a href="#cb61-2276" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb61-2277"><a href="#cb61-2277" aria-hidden="true" tabindex="-1"></a><span class="cf">else</span>:</span>
<span id="cb61-2278"><a href="#cb61-2278" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Fallback for educational purposes</span></span>
<span id="cb61-2279"><a href="#cb61-2279" aria-hidden="true" tabindex="-1"></a>    logger.info(<span class="st">"No scene available - creating educational synthetic dataset"</span>)</span>
<span id="cb61-2280"><a href="#cb61-2280" aria-hidden="true" tabindex="-1"></a>    synthetic_size <span class="op">=</span> (<span class="dv">800</span>, <span class="dv">800</span>)</span>
<span id="cb61-2281"><a href="#cb61-2281" aria-hidden="true" tabindex="-1"></a>    band_data <span class="op">=</span> {</span>
<span id="cb61-2282"><a href="#cb61-2282" aria-hidden="true" tabindex="-1"></a>        <span class="st">'B04'</span>: np.random.randint(<span class="dv">1000</span>, <span class="dv">4000</span>, synthetic_size, dtype<span class="op">=</span>np.uint16),</span>
<span id="cb61-2283"><a href="#cb61-2283" aria-hidden="true" tabindex="-1"></a>        <span class="st">'B03'</span>: np.random.randint(<span class="dv">1000</span>, <span class="dv">4000</span>, synthetic_size, dtype<span class="op">=</span>np.uint16),</span>
<span id="cb61-2284"><a href="#cb61-2284" aria-hidden="true" tabindex="-1"></a>        <span class="st">'B02'</span>: np.random.randint(<span class="dv">1000</span>, <span class="dv">4000</span>, synthetic_size, dtype<span class="op">=</span>np.uint16),</span>
<span id="cb61-2285"><a href="#cb61-2285" aria-hidden="true" tabindex="-1"></a>        <span class="st">'B08'</span>: np.random.randint(<span class="dv">2000</span>, <span class="dv">6000</span>, synthetic_size, dtype<span class="op">=</span>np.uint16),</span>
<span id="cb61-2286"><a href="#cb61-2286" aria-hidden="true" tabindex="-1"></a>        <span class="st">'transform'</span>: <span class="va">None</span>,</span>
<span id="cb61-2287"><a href="#cb61-2287" aria-hidden="true" tabindex="-1"></a>        <span class="st">'crs'</span>: <span class="va">None</span>,</span>
<span id="cb61-2288"><a href="#cb61-2288" aria-hidden="true" tabindex="-1"></a>        <span class="st">'bounds'</span>: [<span class="op">-</span><span class="fl">122.5</span>, <span class="fl">37.7</span>, <span class="op">-</span><span class="fl">122.35</span>, <span class="fl">37.85</span>],</span>
<span id="cb61-2289"><a href="#cb61-2289" aria-hidden="true" tabindex="-1"></a>        <span class="st">'scene_id'</span>: <span class="st">'EDUCATIONAL_DEMO'</span>,</span>
<span id="cb61-2290"><a href="#cb61-2290" aria-hidden="true" tabindex="-1"></a>        <span class="st">'date'</span>: <span class="st">'2024-01-01'</span></span>
<span id="cb61-2291"><a href="#cb61-2291" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb61-2292"><a href="#cb61-2292" aria-hidden="true" tabindex="-1"></a>    core_bands <span class="op">=</span> [<span class="st">'B04'</span>, <span class="st">'B03'</span>, <span class="st">'B02'</span>, <span class="st">'B08'</span>]</span>
<span id="cb61-2293"><a href="#cb61-2293" aria-hidden="true" tabindex="-1"></a>    subset_bbox <span class="op">=</span> <span class="va">None</span></span>
<span id="cb61-2294"><a href="#cb61-2294" aria-hidden="true" tabindex="-1"></a>    logger.info(<span class="ss">f"Educational dataset ready: </span><span class="sc">{</span>synthetic_size[<span class="dv">0</span>]<span class="sc">}</span><span class="ss">×</span><span class="sc">{</span>synthetic_size[<span class="dv">1</span>]<span class="sc">}</span><span class="ss"> pixels"</span>)</span>
<span id="cb61-2295"><a href="#cb61-2295" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb61-2296"><a href="#cb61-2296" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb61-2297"><a href="#cb61-2297" aria-hidden="true" tabindex="-1"></a><span class="fu">#### Comprehensive Data Validation and Quality Assessment</span></span>
<span id="cb61-2298"><a href="#cb61-2298" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb61-2299"><a href="#cb61-2299" aria-hidden="true" tabindex="-1"></a>After loading, we must validate data quality and completeness before proceeding with analysis:</span>
<span id="cb61-2300"><a href="#cb61-2300" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb61-2301"><a href="#cb61-2301" aria-hidden="true" tabindex="-1"></a>**Performing Comprehensive Data Validation:**</span>
<span id="cb61-2302"><a href="#cb61-2302" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb61-2303"><a href="#cb61-2303" aria-hidden="true" tabindex="-1"></a>This demonstrates production-level quality assurance for satellite data including validation of data loading success and quality metrics.</span>
<span id="cb61-2304"><a href="#cb61-2304" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb61-2307"><a href="#cb61-2307" aria-hidden="true" tabindex="-1"></a><span class="in">```{python}</span></span>
<span id="cb61-2308"><a href="#cb61-2308" aria-hidden="true" tabindex="-1"></a><span class="co"># Step 5C: Comprehensive Data Validation and Quality Assessment</span></span>
<span id="cb61-2309"><a href="#cb61-2309" aria-hidden="true" tabindex="-1"></a><span class="co"># Validate successful data loading</span></span>
<span id="cb61-2310"><a href="#cb61-2310" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span> <span class="st">'band_data'</span> <span class="kw">in</span> <span class="bu">locals</span>() <span class="kw">and</span> band_data:</span>
<span id="cb61-2311"><a href="#cb61-2311" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb61-2312"><a href="#cb61-2312" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Extract loaded bands and metadata</span></span>
<span id="cb61-2313"><a href="#cb61-2313" aria-hidden="true" tabindex="-1"></a>    available_bands <span class="op">=</span> [b <span class="cf">for</span> b <span class="kw">in</span> core_bands <span class="cf">if</span> b <span class="kw">in</span> band_data <span class="kw">and</span> <span class="bu">isinstance</span>(band_data[b], np.ndarray)]</span>
<span id="cb61-2314"><a href="#cb61-2314" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb61-2315"><a href="#cb61-2315" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Extract georeferencing information</span></span>
<span id="cb61-2316"><a href="#cb61-2316" aria-hidden="true" tabindex="-1"></a>    transform <span class="op">=</span> band_data.get(<span class="st">'transform'</span>, <span class="va">None</span>)</span>
<span id="cb61-2317"><a href="#cb61-2317" aria-hidden="true" tabindex="-1"></a>    crs <span class="op">=</span> band_data.get(<span class="st">'crs'</span>, <span class="va">None</span>)</span>
<span id="cb61-2318"><a href="#cb61-2318" aria-hidden="true" tabindex="-1"></a>    bounds <span class="op">=</span> band_data.get(<span class="st">'bounds'</span>, subset_bbox <span class="cf">if</span> <span class="st">'subset_bbox'</span> <span class="kw">in</span> <span class="bu">locals</span>() <span class="cf">else</span> sf_bay_bbox)</span>
<span id="cb61-2319"><a href="#cb61-2319" aria-hidden="true" tabindex="-1"></a>    scene_id <span class="op">=</span> band_data.get(<span class="st">'scene_id'</span>, <span class="st">'Unknown'</span>)</span>
<span id="cb61-2320"><a href="#cb61-2320" aria-hidden="true" tabindex="-1"></a>    acquisition_date <span class="op">=</span> band_data.get(<span class="st">'date'</span>, <span class="st">'Unknown'</span>)</span>
<span id="cb61-2321"><a href="#cb61-2321" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb61-2322"><a href="#cb61-2322" aria-hidden="true" tabindex="-1"></a>    logger.info(<span class="ss">f"Loaded </span><span class="sc">{</span><span class="bu">len</span>(available_bands)<span class="sc">}</span><span class="ss">/</span><span class="sc">{</span><span class="bu">len</span>(core_bands)<span class="sc">}</span><span class="ss"> bands: </span><span class="sc">{</span>available_bands<span class="sc">}</span><span class="ss">"</span>)</span>
<span id="cb61-2323"><a href="#cb61-2323" aria-hidden="true" tabindex="-1"></a>    logger.info(<span class="ss">f"Scene: </span><span class="sc">{</span>scene_id<span class="sc">}</span><span class="ss"> (</span><span class="sc">{</span>acquisition_date<span class="sc">}</span><span class="ss">)"</span>)</span>
<span id="cb61-2324"><a href="#cb61-2324" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb61-2325"><a href="#cb61-2325" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Quality assessment</span></span>
<span id="cb61-2326"><a href="#cb61-2326" aria-hidden="true" tabindex="-1"></a>    band_stats_summary <span class="op">=</span> {}</span>
<span id="cb61-2327"><a href="#cb61-2327" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> band_name <span class="kw">in</span> available_bands:</span>
<span id="cb61-2328"><a href="#cb61-2328" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> band_name <span class="kw">in</span> band_data:</span>
<span id="cb61-2329"><a href="#cb61-2329" aria-hidden="true" tabindex="-1"></a>            stats <span class="op">=</span> calculate_band_statistics(band_data[band_name], band_name)</span>
<span id="cb61-2330"><a href="#cb61-2330" aria-hidden="true" tabindex="-1"></a>            band_stats_summary[band_name] <span class="op">=</span> stats</span>
<span id="cb61-2331"><a href="#cb61-2331" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb61-2332"><a href="#cb61-2332" aria-hidden="true" tabindex="-1"></a>            <span class="co"># Quality flags</span></span>
<span id="cb61-2333"><a href="#cb61-2333" aria-hidden="true" tabindex="-1"></a>            quality_flags <span class="op">=</span> []</span>
<span id="cb61-2334"><a href="#cb61-2334" aria-hidden="true" tabindex="-1"></a>            <span class="cf">if</span> stats[<span class="st">'valid_pixels'</span>] <span class="op">&lt;</span> stats[<span class="st">'total_pixels'</span>] <span class="op">*</span> <span class="fl">0.95</span>:</span>
<span id="cb61-2335"><a href="#cb61-2335" aria-hidden="true" tabindex="-1"></a>                quality_flags.append(<span class="st">"invalid pixels"</span>)</span>
<span id="cb61-2336"><a href="#cb61-2336" aria-hidden="true" tabindex="-1"></a>            <span class="cf">if</span> stats[<span class="st">'std'</span>] <span class="op">&lt;</span> <span class="dv">10</span>:</span>
<span id="cb61-2337"><a href="#cb61-2337" aria-hidden="true" tabindex="-1"></a>                quality_flags.append(<span class="st">"low variance"</span>)</span>
<span id="cb61-2338"><a href="#cb61-2338" aria-hidden="true" tabindex="-1"></a>            <span class="cf">if</span> stats[<span class="st">'max'</span>] <span class="op">&gt;</span> <span class="dv">10000</span>:</span>
<span id="cb61-2339"><a href="#cb61-2339" aria-hidden="true" tabindex="-1"></a>                quality_flags.append(<span class="st">"possible saturation"</span>)</span>
<span id="cb61-2340"><a href="#cb61-2340" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb61-2341"><a href="#cb61-2341" aria-hidden="true" tabindex="-1"></a>            quality_status <span class="op">=</span> <span class="st">"; "</span>.join(quality_flags) <span class="cf">if</span> quality_flags <span class="cf">else</span> <span class="st">"normal"</span></span>
<span id="cb61-2342"><a href="#cb61-2342" aria-hidden="true" tabindex="-1"></a>            logger.info(<span class="ss">f"</span><span class="sc">{</span>band_name<span class="sc">}</span><span class="ss">: range [</span><span class="sc">{</span>stats[<span class="st">'min'</span>]<span class="sc">:.0f}</span><span class="ss">, </span><span class="sc">{</span>stats[<span class="st">'max'</span>]<span class="sc">:.0f}</span><span class="ss">], quality: </span><span class="sc">{</span>quality_status<span class="sc">}</span><span class="ss">"</span>)</span>
<span id="cb61-2343"><a href="#cb61-2343" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb61-2344"><a href="#cb61-2344" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Cross-band validation</span></span>
<span id="cb61-2345"><a href="#cb61-2345" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> <span class="bu">len</span>(available_bands) <span class="op">&gt;=</span> <span class="dv">2</span>:</span>
<span id="cb61-2346"><a href="#cb61-2346" aria-hidden="true" tabindex="-1"></a>        shapes <span class="op">=</span> [band_data[band].shape <span class="cf">for</span> band <span class="kw">in</span> available_bands]</span>
<span id="cb61-2347"><a href="#cb61-2347" aria-hidden="true" tabindex="-1"></a>        consistent_shape <span class="op">=</span> <span class="bu">all</span>(shape <span class="op">==</span> shapes[<span class="dv">0</span>] <span class="cf">for</span> shape <span class="kw">in</span> shapes)</span>
<span id="cb61-2348"><a href="#cb61-2348" aria-hidden="true" tabindex="-1"></a>        logger.info(<span class="ss">f"Spatial consistency: </span><span class="sc">{</span><span class="st">'✓'</span> <span class="cf">if</span> consistent_shape <span class="cf">else</span> <span class="st">'⚠'</span><span class="sc">}</span><span class="ss"> shape </span><span class="sc">{</span>shapes[<span class="dv">0</span>] <span class="cf">if</span> consistent_shape <span class="cf">else</span> <span class="st">'mixed'</span><span class="sc">}</span><span class="ss">"</span>)</span>
<span id="cb61-2349"><a href="#cb61-2349" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb61-2350"><a href="#cb61-2350" aria-hidden="true" tabindex="-1"></a>        <span class="co"># Check for reasonable spectral relationships</span></span>
<span id="cb61-2351"><a href="#cb61-2351" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> <span class="st">'B04'</span> <span class="kw">in</span> available_bands <span class="kw">and</span> <span class="st">'B08'</span> <span class="kw">in</span> available_bands:</span>
<span id="cb61-2352"><a href="#cb61-2352" aria-hidden="true" tabindex="-1"></a>            ndvi_sample <span class="op">=</span> calculate_ndvi(band_data[<span class="st">'B08'</span>][:<span class="dv">100</span>, :<span class="dv">100</span>], band_data[<span class="st">'B04'</span>][:<span class="dv">100</span>, :<span class="dv">100</span>])</span>
<span id="cb61-2353"><a href="#cb61-2353" aria-hidden="true" tabindex="-1"></a>            ndvi_mean <span class="op">=</span> np.nanmean(ndvi_sample)</span>
<span id="cb61-2354"><a href="#cb61-2354" aria-hidden="true" tabindex="-1"></a>            <span class="co"># NDVI sanity check</span></span>
<span id="cb61-2355"><a href="#cb61-2355" aria-hidden="true" tabindex="-1"></a>            <span class="cf">if</span> <span class="op">-</span><span class="dv">1</span> <span class="op">&lt;=</span> ndvi_mean <span class="op">&lt;=</span> <span class="dv">1</span>:</span>
<span id="cb61-2356"><a href="#cb61-2356" aria-hidden="true" tabindex="-1"></a>                logger.info(<span class="ss">f"NDVI validation passed: mean = </span><span class="sc">{</span>ndvi_mean<span class="sc">:.3f}</span><span class="ss">"</span>)</span>
<span id="cb61-2357"><a href="#cb61-2357" aria-hidden="true" tabindex="-1"></a>            <span class="cf">else</span>:</span>
<span id="cb61-2358"><a href="#cb61-2358" aria-hidden="true" tabindex="-1"></a>                logger.warning(<span class="ss">f"NDVI anomaly detected: mean = </span><span class="sc">{</span>ndvi_mean<span class="sc">:.3f}</span><span class="ss">"</span>)</span>
<span id="cb61-2359"><a href="#cb61-2359" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb61-2360"><a href="#cb61-2360" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Overall data readiness assessment</span></span>
<span id="cb61-2361"><a href="#cb61-2361" aria-hidden="true" tabindex="-1"></a>    readiness_score <span class="op">=</span> <span class="dv">0</span></span>
<span id="cb61-2362"><a href="#cb61-2362" aria-hidden="true" tabindex="-1"></a>    readiness_criteria <span class="op">=</span> {</span>
<span id="cb61-2363"><a href="#cb61-2363" aria-hidden="true" tabindex="-1"></a>        <span class="st">'bands_available'</span>: <span class="bu">len</span>(available_bands) <span class="op">&gt;=</span> <span class="dv">3</span>,  <span class="co"># Minimum for RGB</span></span>
<span id="cb61-2364"><a href="#cb61-2364" aria-hidden="true" tabindex="-1"></a>        <span class="st">'spatial_consistency'</span>: <span class="st">'consistent_shape'</span> <span class="kw">in</span> <span class="bu">locals</span>() <span class="kw">and</span> consistent_shape,</span>
<span id="cb61-2365"><a href="#cb61-2365" aria-hidden="true" tabindex="-1"></a>        <span class="st">'valid_pixels'</span>: <span class="bu">all</span>(stats[<span class="st">'valid_pixels'</span>] <span class="op">&gt;</span> stats[<span class="st">'total_pixels'</span>] <span class="op">*</span> <span class="fl">0.9</span> <span class="cf">for</span> stats <span class="kw">in</span> band_stats_summary.values()),</span>
<span id="cb61-2366"><a href="#cb61-2366" aria-hidden="true" tabindex="-1"></a>        <span class="st">'spectral_sanity'</span>: <span class="st">'ndvi_mean'</span> <span class="kw">in</span> <span class="bu">locals</span>() <span class="kw">and</span> <span class="op">-</span><span class="dv">1</span> <span class="op">&lt;=</span> ndvi_mean <span class="op">&lt;=</span> <span class="dv">1</span></span>
<span id="cb61-2367"><a href="#cb61-2367" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb61-2368"><a href="#cb61-2368" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb61-2369"><a href="#cb61-2369" aria-hidden="true" tabindex="-1"></a>    readiness_score <span class="op">=</span> <span class="bu">sum</span>(readiness_criteria.values())</span>
<span id="cb61-2370"><a href="#cb61-2370" aria-hidden="true" tabindex="-1"></a>    max_score <span class="op">=</span> <span class="bu">len</span>(readiness_criteria)</span>
<span id="cb61-2371"><a href="#cb61-2371" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb61-2372"><a href="#cb61-2372" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Overall data readiness assessment</span></span>
<span id="cb61-2373"><a href="#cb61-2373" aria-hidden="true" tabindex="-1"></a>    logger.info(<span class="ss">f"Data readiness: </span><span class="sc">{</span>readiness_score<span class="sc">}</span><span class="ss">/</span><span class="sc">{</span>max_score<span class="sc">}</span><span class="ss"> criteria passed"</span>)</span>
<span id="cb61-2374"><a href="#cb61-2374" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb61-2375"><a href="#cb61-2375" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> readiness_score <span class="op">&gt;=</span> max_score <span class="op">*</span> <span class="fl">0.75</span>:</span>
<span id="cb61-2376"><a href="#cb61-2376" aria-hidden="true" tabindex="-1"></a>        logger.info(<span class="st">"STATUS: READY for analysis - High quality data confirmed"</span>)</span>
<span id="cb61-2377"><a href="#cb61-2377" aria-hidden="true" tabindex="-1"></a>    <span class="cf">elif</span> readiness_score <span class="op">&gt;=</span> max_score <span class="op">*</span> <span class="fl">0.5</span>:</span>
<span id="cb61-2378"><a href="#cb61-2378" aria-hidden="true" tabindex="-1"></a>        logger.warning(<span class="st">"STATUS: PROCEED WITH CAUTION - Some quality issues detected"</span>)</span>
<span id="cb61-2379"><a href="#cb61-2379" aria-hidden="true" tabindex="-1"></a>    <span class="cf">else</span>:</span>
<span id="cb61-2380"><a href="#cb61-2380" aria-hidden="true" tabindex="-1"></a>        logger.error(<span class="st">"STATUS: QUALITY ISSUES - Consider alternative data sources"</span>)</span>
<span id="cb61-2381"><a href="#cb61-2381" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb61-2382"><a href="#cb61-2382" aria-hidden="true" tabindex="-1"></a><span class="cf">else</span>:</span>
<span id="cb61-2383"><a href="#cb61-2383" aria-hidden="true" tabindex="-1"></a>    logger.error(<span class="st">"Data validation failed - no valid satellite data available"</span>)</span>
<span id="cb61-2384"><a href="#cb61-2384" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb61-2385"><a href="#cb61-2385" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb61-2386"><a href="#cb61-2386" aria-hidden="true" tabindex="-1"></a><span class="fu">#### Creating AI-Ready Multi-Dimensional Datasets</span></span>
<span id="cb61-2387"><a href="#cb61-2387" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb61-2388"><a href="#cb61-2388" aria-hidden="true" tabindex="-1"></a>Transform loaded bands into analysis-ready xarray datasets optimized for AI/ML workflows:</span>
<span id="cb61-2389"><a href="#cb61-2389" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb61-2390"><a href="#cb61-2390" aria-hidden="true" tabindex="-1"></a>**Creating AI-Ready Multi-Dimensional Dataset:**</span>
<span id="cb61-2391"><a href="#cb61-2391" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb61-2392"><a href="#cb61-2392" aria-hidden="true" tabindex="-1"></a>This demonstrates data structuring for machine learning applications, transforming raw satellite bands into analysis-ready xarray datasets.</span>
<span id="cb61-2393"><a href="#cb61-2393" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb61-2396"><a href="#cb61-2396" aria-hidden="true" tabindex="-1"></a><span class="in">```{python}</span></span>
<span id="cb61-2397"><a href="#cb61-2397" aria-hidden="true" tabindex="-1"></a><span class="co"># Step 5D: Build AI-Ready Multi-Dimensional Dataset</span></span>
<span id="cb61-2398"><a href="#cb61-2398" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span> <span class="st">'band_data'</span> <span class="kw">in</span> <span class="bu">locals</span>() <span class="kw">and</span> band_data <span class="kw">and</span> available_bands:</span>
<span id="cb61-2399"><a href="#cb61-2399" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Get spatial dimensions from first available band</span></span>
<span id="cb61-2400"><a href="#cb61-2400" aria-hidden="true" tabindex="-1"></a>    sample_band <span class="op">=</span> band_data[available_bands[<span class="dv">0</span>]]</span>
<span id="cb61-2401"><a href="#cb61-2401" aria-hidden="true" tabindex="-1"></a>    height, width <span class="op">=</span> sample_band.shape</span>
<span id="cb61-2402"><a href="#cb61-2402" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb61-2403"><a href="#cb61-2403" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Dataset characteristics</span></span>
<span id="cb61-2404"><a href="#cb61-2404" aria-hidden="true" tabindex="-1"></a>    total_elements <span class="op">=</span> height <span class="op">*</span> width <span class="op">*</span> <span class="bu">len</span>(available_bands)</span>
<span id="cb61-2405"><a href="#cb61-2405" aria-hidden="true" tabindex="-1"></a>    logger.info(<span class="ss">f"Dataset: </span><span class="sc">{</span>height<span class="sc">}</span><span class="ss">×</span><span class="sc">{</span>width<span class="sc">}</span><span class="ss"> pixels, </span><span class="sc">{</span><span class="bu">len</span>(available_bands)<span class="sc">}</span><span class="ss"> bands, </span><span class="sc">{</span>total_elements<span class="sc">:,}</span><span class="ss"> elements"</span>)</span>
<span id="cb61-2406"><a href="#cb61-2406" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb61-2407"><a href="#cb61-2407" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Create sophisticated coordinate system</span></span>
<span id="cb61-2408"><a href="#cb61-2408" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> bounds <span class="kw">and</span> <span class="bu">len</span>(bounds) <span class="op">==</span> <span class="dv">4</span>:</span>
<span id="cb61-2409"><a href="#cb61-2409" aria-hidden="true" tabindex="-1"></a>        <span class="co"># Geographic coordinates (WGS84)</span></span>
<span id="cb61-2410"><a href="#cb61-2410" aria-hidden="true" tabindex="-1"></a>        x_coords <span class="op">=</span> np.linspace(bounds[<span class="dv">0</span>], bounds[<span class="dv">2</span>], width)   <span class="co"># Longitude</span></span>
<span id="cb61-2411"><a href="#cb61-2411" aria-hidden="true" tabindex="-1"></a>        y_coords <span class="op">=</span> np.linspace(bounds[<span class="dv">3</span>], bounds[<span class="dv">1</span>], height)  <span class="co"># Latitude (north to south)</span></span>
<span id="cb61-2412"><a href="#cb61-2412" aria-hidden="true" tabindex="-1"></a>        coord_system <span class="op">=</span> <span class="st">"geographic"</span></span>
<span id="cb61-2413"><a href="#cb61-2413" aria-hidden="true" tabindex="-1"></a>    <span class="cf">else</span>:</span>
<span id="cb61-2414"><a href="#cb61-2414" aria-hidden="true" tabindex="-1"></a>        <span class="co"># Pixel coordinates</span></span>
<span id="cb61-2415"><a href="#cb61-2415" aria-hidden="true" tabindex="-1"></a>        x_coords <span class="op">=</span> np.arange(width)</span>
<span id="cb61-2416"><a href="#cb61-2416" aria-hidden="true" tabindex="-1"></a>        y_coords <span class="op">=</span> np.arange(height)</span>
<span id="cb61-2417"><a href="#cb61-2417" aria-hidden="true" tabindex="-1"></a>        coord_system <span class="op">=</span> <span class="st">"pixel"</span></span>
<span id="cb61-2418"><a href="#cb61-2418" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb61-2419"><a href="#cb61-2419" aria-hidden="true" tabindex="-1"></a>    logger.debug(<span class="ss">f"Coordinates: </span><span class="sc">{</span>coord_system<span class="sc">}</span><span class="ss">, X: </span><span class="sc">{</span>x_coords[<span class="dv">0</span>]<span class="sc">:.4f}</span><span class="ss"> to </span><span class="sc">{</span>x_coords[<span class="op">-</span><span class="dv">1</span>]<span class="sc">:.4f}</span><span class="ss">, Y: </span><span class="sc">{</span>y_coords[<span class="dv">0</span>]<span class="sc">:.4f}</span><span class="ss"> to </span><span class="sc">{</span>y_coords[<span class="op">-</span><span class="dv">1</span>]<span class="sc">:.4f}</span><span class="ss">"</span>)</span>
<span id="cb61-2420"><a href="#cb61-2420" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb61-2421"><a href="#cb61-2421" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Build xarray DataArrays with comprehensive metadata</span></span>
<span id="cb61-2422"><a href="#cb61-2422" aria-hidden="true" tabindex="-1"></a>    data_arrays <span class="op">=</span> {}</span>
<span id="cb61-2423"><a href="#cb61-2423" aria-hidden="true" tabindex="-1"></a>    band_metadata <span class="op">=</span> {</span>
<span id="cb61-2424"><a href="#cb61-2424" aria-hidden="true" tabindex="-1"></a>        <span class="st">'B02'</span>: {<span class="st">'name'</span>: <span class="st">'blue'</span>, <span class="st">'wavelength'</span>: <span class="dv">490</span>, <span class="st">'description'</span>: <span class="st">'Blue band (coastal/aerosol)'</span>},</span>
<span id="cb61-2425"><a href="#cb61-2425" aria-hidden="true" tabindex="-1"></a>        <span class="st">'B03'</span>: {<span class="st">'name'</span>: <span class="st">'green'</span>, <span class="st">'wavelength'</span>: <span class="dv">560</span>, <span class="st">'description'</span>: <span class="st">'Green band (vegetation)'</span>},</span>
<span id="cb61-2426"><a href="#cb61-2426" aria-hidden="true" tabindex="-1"></a>        <span class="st">'B04'</span>: {<span class="st">'name'</span>: <span class="st">'red'</span>, <span class="st">'wavelength'</span>: <span class="dv">665</span>, <span class="st">'description'</span>: <span class="st">'Red band (chlorophyll absorption)'</span>},</span>
<span id="cb61-2427"><a href="#cb61-2427" aria-hidden="true" tabindex="-1"></a>        <span class="st">'B08'</span>: {<span class="st">'name'</span>: <span class="st">'nir'</span>, <span class="st">'wavelength'</span>: <span class="dv">842</span>, <span class="st">'description'</span>: <span class="st">'Near-infrared (biomass/structure)'</span>}</span>
<span id="cb61-2428"><a href="#cb61-2428" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb61-2429"><a href="#cb61-2429" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb61-2430"><a href="#cb61-2430" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Build spectral data arrays</span></span>
<span id="cb61-2431"><a href="#cb61-2431" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> band_id <span class="kw">in</span> available_bands:</span>
<span id="cb61-2432"><a href="#cb61-2432" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> band_id <span class="kw">in</span> band_metadata:</span>
<span id="cb61-2433"><a href="#cb61-2433" aria-hidden="true" tabindex="-1"></a>            metadata <span class="op">=</span> band_metadata[band_id]</span>
<span id="cb61-2434"><a href="#cb61-2434" aria-hidden="true" tabindex="-1"></a>            band_name <span class="op">=</span> metadata[<span class="st">'name'</span>]</span>
<span id="cb61-2435"><a href="#cb61-2435" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb61-2436"><a href="#cb61-2436" aria-hidden="true" tabindex="-1"></a>            <span class="co"># Create DataArray with rich metadata</span></span>
<span id="cb61-2437"><a href="#cb61-2437" aria-hidden="true" tabindex="-1"></a>            data_arrays[band_name] <span class="op">=</span> xr.DataArray(</span>
<span id="cb61-2438"><a href="#cb61-2438" aria-hidden="true" tabindex="-1"></a>                band_data[band_id],</span>
<span id="cb61-2439"><a href="#cb61-2439" aria-hidden="true" tabindex="-1"></a>                dims<span class="op">=</span>[<span class="st">'y'</span>, <span class="st">'x'</span>],</span>
<span id="cb61-2440"><a href="#cb61-2440" aria-hidden="true" tabindex="-1"></a>                coords<span class="op">=</span>{</span>
<span id="cb61-2441"><a href="#cb61-2441" aria-hidden="true" tabindex="-1"></a>                    <span class="st">'y'</span>: (<span class="st">'y'</span>, y_coords, {<span class="st">'long_name'</span>: <span class="st">'Latitude'</span> <span class="cf">if</span> coord_system <span class="op">==</span> <span class="st">'geographic'</span> <span class="cf">else</span> <span class="st">'Y coordinate'</span>,</span>
<span id="cb61-2442"><a href="#cb61-2442" aria-hidden="true" tabindex="-1"></a>                                         <span class="st">'units'</span>: <span class="st">'degrees_north'</span> <span class="cf">if</span> coord_system <span class="op">==</span> <span class="st">'geographic'</span> <span class="cf">else</span> <span class="st">'pixels'</span>}),</span>
<span id="cb61-2443"><a href="#cb61-2443" aria-hidden="true" tabindex="-1"></a>                    <span class="st">'x'</span>: (<span class="st">'x'</span>, x_coords, {<span class="st">'long_name'</span>: <span class="st">'Longitude'</span> <span class="cf">if</span> coord_system <span class="op">==</span> <span class="st">'geographic'</span> <span class="cf">else</span> <span class="st">'X coordinate'</span>,</span>
<span id="cb61-2444"><a href="#cb61-2444" aria-hidden="true" tabindex="-1"></a>                                         <span class="st">'units'</span>: <span class="st">'degrees_east'</span> <span class="cf">if</span> coord_system <span class="op">==</span> <span class="st">'geographic'</span> <span class="cf">else</span> <span class="st">'pixels'</span>})</span>
<span id="cb61-2445"><a href="#cb61-2445" aria-hidden="true" tabindex="-1"></a>                },</span>
<span id="cb61-2446"><a href="#cb61-2446" aria-hidden="true" tabindex="-1"></a>                attrs<span class="op">=</span>{</span>
<span id="cb61-2447"><a href="#cb61-2447" aria-hidden="true" tabindex="-1"></a>                    <span class="st">'band_id'</span>: band_id,</span>
<span id="cb61-2448"><a href="#cb61-2448" aria-hidden="true" tabindex="-1"></a>                    <span class="st">'long_name'</span>: metadata[<span class="st">'description'</span>],</span>
<span id="cb61-2449"><a href="#cb61-2449" aria-hidden="true" tabindex="-1"></a>                    <span class="st">'wavelength'</span>: metadata[<span class="st">'wavelength'</span>],</span>
<span id="cb61-2450"><a href="#cb61-2450" aria-hidden="true" tabindex="-1"></a>                    <span class="st">'wavelength_units'</span>: <span class="st">'nanometers'</span>,</span>
<span id="cb61-2451"><a href="#cb61-2451" aria-hidden="true" tabindex="-1"></a>                    <span class="st">'units'</span>: <span class="st">'DN'</span>,</span>
<span id="cb61-2452"><a href="#cb61-2452" aria-hidden="true" tabindex="-1"></a>                    <span class="st">'valid_range'</span>: [<span class="dv">0</span>, <span class="dv">10000</span>],</span>
<span id="cb61-2453"><a href="#cb61-2453" aria-hidden="true" tabindex="-1"></a>                    <span class="st">'scale_factor'</span>: <span class="fl">1.0</span>,</span>
<span id="cb61-2454"><a href="#cb61-2454" aria-hidden="true" tabindex="-1"></a>                    <span class="st">'add_offset'</span>: <span class="fl">0.0</span></span>
<span id="cb61-2455"><a href="#cb61-2455" aria-hidden="true" tabindex="-1"></a>                }</span>
<span id="cb61-2456"><a href="#cb61-2456" aria-hidden="true" tabindex="-1"></a>            )</span>
<span id="cb61-2457"><a href="#cb61-2457" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb61-2458"><a href="#cb61-2458" aria-hidden="true" tabindex="-1"></a>            logger.debug(<span class="ss">f"Created DataArray: </span><span class="sc">{</span>band_name<span class="sc">}</span><span class="ss"> (</span><span class="sc">{</span>metadata[<span class="st">'wavelength'</span>]<span class="sc">}</span><span class="ss">nm)"</span>)</span>
<span id="cb61-2459"><a href="#cb61-2459" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb61-2460"><a href="#cb61-2460" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Create comprehensive Dataset</span></span>
<span id="cb61-2461"><a href="#cb61-2461" aria-hidden="true" tabindex="-1"></a>    satellite_ds <span class="op">=</span> xr.Dataset(</span>
<span id="cb61-2462"><a href="#cb61-2462" aria-hidden="true" tabindex="-1"></a>        data_arrays,</span>
<span id="cb61-2463"><a href="#cb61-2463" aria-hidden="true" tabindex="-1"></a>        attrs<span class="op">=</span>{</span>
<span id="cb61-2464"><a href="#cb61-2464" aria-hidden="true" tabindex="-1"></a>            <span class="st">'title'</span>: <span class="st">'Sentinel-2 Level 2A Surface Reflectance'</span>,</span>
<span id="cb61-2465"><a href="#cb61-2465" aria-hidden="true" tabindex="-1"></a>            <span class="st">'source'</span>: <span class="ss">f'Scene: </span><span class="sc">{</span>scene_id<span class="sc">}</span><span class="ss">'</span>,</span>
<span id="cb61-2466"><a href="#cb61-2466" aria-hidden="true" tabindex="-1"></a>            <span class="st">'acquisition_date'</span>: acquisition_date,</span>
<span id="cb61-2467"><a href="#cb61-2467" aria-hidden="true" tabindex="-1"></a>            <span class="st">'processing_level'</span>: <span class="st">'L2A'</span>,</span>
<span id="cb61-2468"><a href="#cb61-2468" aria-hidden="true" tabindex="-1"></a>            <span class="st">'crs'</span>: <span class="bu">str</span>(crs) <span class="cf">if</span> crs <span class="cf">else</span> <span class="st">'WGS84 (assumed)'</span>,</span>
<span id="cb61-2469"><a href="#cb61-2469" aria-hidden="true" tabindex="-1"></a>            <span class="st">'spatial_resolution'</span>: <span class="st">'10 meters'</span>,</span>
<span id="cb61-2470"><a href="#cb61-2470" aria-hidden="true" tabindex="-1"></a>            <span class="st">'coordinate_system'</span>: coord_system,</span>
<span id="cb61-2471"><a href="#cb61-2471" aria-hidden="true" tabindex="-1"></a>            <span class="st">'creation_date'</span>: pd.Timestamp.now().isoformat(),</span>
<span id="cb61-2472"><a href="#cb61-2472" aria-hidden="true" tabindex="-1"></a>            <span class="st">'processing_software'</span>: <span class="st">'Geospatial AI Toolkit'</span>,</span>
<span id="cb61-2473"><a href="#cb61-2473" aria-hidden="true" tabindex="-1"></a>            <span class="st">'data_access'</span>: <span class="st">'Microsoft Planetary Computer via STAC'</span></span>
<span id="cb61-2474"><a href="#cb61-2474" aria-hidden="true" tabindex="-1"></a>        }</span>
<span id="cb61-2475"><a href="#cb61-2475" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb61-2476"><a href="#cb61-2476" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb61-2477"><a href="#cb61-2477" aria-hidden="true" tabindex="-1"></a>    logger.info(<span class="ss">f"Created xarray Dataset with </span><span class="sc">{</span><span class="bu">len</span>(data_arrays)<span class="sc">}</span><span class="ss"> bands: </span><span class="sc">{</span><span class="bu">list</span>(satellite_ds.data_vars)<span class="sc">}</span><span class="ss">"</span>)</span>
<span id="cb61-2478"><a href="#cb61-2478" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(satellite_ds)  <span class="co"># Display dataset structure</span></span>
<span id="cb61-2479"><a href="#cb61-2479" aria-hidden="true" tabindex="-1"></a><span class="cf">else</span>:</span>
<span id="cb61-2480"><a href="#cb61-2480" aria-hidden="true" tabindex="-1"></a>    logger.warning(<span class="st">"No band data available for xarray Dataset creation"</span>)</span>
<span id="cb61-2481"><a href="#cb61-2481" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb61-2482"><a href="#cb61-2482" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb61-2483"><a href="#cb61-2483" aria-hidden="true" tabindex="-1"></a><span class="fu">## Rasterio, Xarray, and Rioxarray</span></span>
<span id="cb61-2484"><a href="#cb61-2484" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb61-2485"><a href="#cb61-2485" aria-hidden="true" tabindex="-1"></a>Rasterio provides lower-level, direct file access and is well-suited for basic geospatial raster operations. Xarray offers a higher-level interface, making it easier to handle metadata and perform advanced analysis. Rioxarray extends xarray by adding geospatial capabilities, effectively bridging the gap between the two approaches.</span>
<span id="cb61-2486"><a href="#cb61-2486" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb61-2487"><a href="#cb61-2487" aria-hidden="true" tabindex="-1"></a>---</span>
<span id="cb61-2488"><a href="#cb61-2488" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb61-2489"><a href="#cb61-2489" aria-hidden="true" tabindex="-1"></a><span class="fu">## Step 6: Scientific Visualization and Spectral Analysis</span></span>
<span id="cb61-2490"><a href="#cb61-2490" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb61-2491"><a href="#cb61-2491" aria-hidden="true" tabindex="-1"></a><span class="fu">### Learning Objectives</span></span>
<span id="cb61-2492"><a href="#cb61-2492" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb61-2493"><a href="#cb61-2493" aria-hidden="true" tabindex="-1"></a>By the end of this section, you will be able to design publication-quality visualizations for satellite data analysis, understand the importance of perceptually uniform colormaps in scientific visualization, create informative multi-panel displays with appropriate context and interpretation, and calculate as well as visualize spectral indices for environmental monitoring.</span>
<span id="cb61-2494"><a href="#cb61-2494" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb61-2495"><a href="#cb61-2495" aria-hidden="true" tabindex="-1"></a><span class="fu">### Principles of Scientific Visualization for Remote Sensing</span></span>
<span id="cb61-2496"><a href="#cb61-2496" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb61-2497"><a href="#cb61-2497" aria-hidden="true" tabindex="-1"></a>Effective satellite data visualization requires attention to perceptual accuracy, ensuring that colors accurately represent data relationships. It is important to maximize information density to provide insight with minimal cognitive load, while also preserving spatial and temporal context. Additionally, visualizations should be accessible and interpretable by a wide range of audiences.</span>
<span id="cb61-2498"><a href="#cb61-2498" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb61-2499"><a href="#cb61-2499" aria-hidden="true" tabindex="-1"></a><span class="fu">#### Advanced Color Composite Creation</span></span>
<span id="cb61-2500"><a href="#cb61-2500" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb61-2503"><a href="#cb61-2503" aria-hidden="true" tabindex="-1"></a><span class="in">```{python}</span></span>
<span id="cb61-2504"><a href="#cb61-2504" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span> band_data <span class="kw">and</span> <span class="bu">all</span>(k <span class="kw">in</span> band_data <span class="cf">for</span> k <span class="kw">in</span> [<span class="st">'B04'</span>, <span class="st">'B03'</span>, <span class="st">'B02'</span>]):</span>
<span id="cb61-2505"><a href="#cb61-2505" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Create true color RGB composite using our helper function</span></span>
<span id="cb61-2506"><a href="#cb61-2506" aria-hidden="true" tabindex="-1"></a>    rgb_composite <span class="op">=</span> create_rgb_composite(</span>
<span id="cb61-2507"><a href="#cb61-2507" aria-hidden="true" tabindex="-1"></a>        red<span class="op">=</span>band_data[<span class="st">'B04'</span>],</span>
<span id="cb61-2508"><a href="#cb61-2508" aria-hidden="true" tabindex="-1"></a>        green<span class="op">=</span>band_data[<span class="st">'B03'</span>],</span>
<span id="cb61-2509"><a href="#cb61-2509" aria-hidden="true" tabindex="-1"></a>        blue<span class="op">=</span>band_data[<span class="st">'B02'</span>],</span>
<span id="cb61-2510"><a href="#cb61-2510" aria-hidden="true" tabindex="-1"></a>        enhance<span class="op">=</span><span class="va">True</span>  <span class="co"># Apply contrast enhancement</span></span>
<span id="cb61-2511"><a href="#cb61-2511" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb61-2512"><a href="#cb61-2512" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb61-2513"><a href="#cb61-2513" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="ss">f"   RGB composite shape: </span><span class="sc">{</span>rgb_composite<span class="sc">.</span>shape<span class="sc">}</span><span class="ss">"</span>)</span>
<span id="cb61-2514"><a href="#cb61-2514" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb61-2515"><a href="#cb61-2515" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Create false color composite if NIR band is available</span></span>
<span id="cb61-2516"><a href="#cb61-2516" aria-hidden="true" tabindex="-1"></a>    false_color_composite <span class="op">=</span> <span class="va">None</span></span>
<span id="cb61-2517"><a href="#cb61-2517" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> <span class="st">'B08'</span> <span class="kw">in</span> band_data:</span>
<span id="cb61-2518"><a href="#cb61-2518" aria-hidden="true" tabindex="-1"></a>        false_color_composite <span class="op">=</span> create_rgb_composite(</span>
<span id="cb61-2519"><a href="#cb61-2519" aria-hidden="true" tabindex="-1"></a>            red<span class="op">=</span>band_data[<span class="st">'B08'</span>],   <span class="co"># NIR in red channel</span></span>
<span id="cb61-2520"><a href="#cb61-2520" aria-hidden="true" tabindex="-1"></a>            green<span class="op">=</span>band_data[<span class="st">'B04'</span>],  <span class="co"># Red in green channel</span></span>
<span id="cb61-2521"><a href="#cb61-2521" aria-hidden="true" tabindex="-1"></a>            blue<span class="op">=</span>band_data[<span class="st">'B03'</span>],   <span class="co"># Green in blue channel</span></span>
<span id="cb61-2522"><a href="#cb61-2522" aria-hidden="true" tabindex="-1"></a>            enhance<span class="op">=</span><span class="va">True</span></span>
<span id="cb61-2523"><a href="#cb61-2523" aria-hidden="true" tabindex="-1"></a>        )</span>
<span id="cb61-2524"><a href="#cb61-2524" aria-hidden="true" tabindex="-1"></a>        <span class="bu">print</span>(<span class="ss">f"   False color composite created"</span>)</span>
<span id="cb61-2525"><a href="#cb61-2525" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb61-2526"><a href="#cb61-2526" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Visualize the composites</span></span>
<span id="cb61-2527"><a href="#cb61-2527" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> <span class="st">'B08'</span> <span class="kw">in</span> band_data:</span>
<span id="cb61-2528"><a href="#cb61-2528" aria-hidden="true" tabindex="-1"></a>        fig, (ax1, ax2) <span class="op">=</span> plt.subplots(<span class="dv">1</span>, <span class="dv">2</span>, figsize<span class="op">=</span>(<span class="dv">14</span>, <span class="dv">6</span>))</span>
<span id="cb61-2529"><a href="#cb61-2529" aria-hidden="true" tabindex="-1"></a>    <span class="cf">else</span>:</span>
<span id="cb61-2530"><a href="#cb61-2530" aria-hidden="true" tabindex="-1"></a>        fig, ax1 <span class="op">=</span> plt.subplots(<span class="dv">1</span>, <span class="dv">1</span>, figsize<span class="op">=</span>(<span class="dv">8</span>, <span class="dv">6</span>))</span>
<span id="cb61-2531"><a href="#cb61-2531" aria-hidden="true" tabindex="-1"></a>        ax2 <span class="op">=</span> <span class="va">None</span></span>
<span id="cb61-2532"><a href="#cb61-2532" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb61-2533"><a href="#cb61-2533" aria-hidden="true" tabindex="-1"></a>    <span class="co"># True color</span></span>
<span id="cb61-2534"><a href="#cb61-2534" aria-hidden="true" tabindex="-1"></a>    ax1.imshow(rgb_composite)</span>
<span id="cb61-2535"><a href="#cb61-2535" aria-hidden="true" tabindex="-1"></a>    ax1.set_title(<span class="st">'True Color (RGB)'</span>, fontsize<span class="op">=</span><span class="dv">12</span>, fontweight<span class="op">=</span><span class="st">'bold'</span>)</span>
<span id="cb61-2536"><a href="#cb61-2536" aria-hidden="true" tabindex="-1"></a>    ax1.axis(<span class="st">'off'</span>)</span>
<span id="cb61-2537"><a href="#cb61-2537" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb61-2538"><a href="#cb61-2538" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Add scale bar</span></span>
<span id="cb61-2539"><a href="#cb61-2539" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> <span class="st">'transform'</span> <span class="kw">in</span> <span class="bu">locals</span>() <span class="kw">and</span> transform:</span>
<span id="cb61-2540"><a href="#cb61-2540" aria-hidden="true" tabindex="-1"></a>        <span class="co"># Calculate pixel size in meters (approximate)</span></span>
<span id="cb61-2541"><a href="#cb61-2541" aria-hidden="true" tabindex="-1"></a>        pixel_size <span class="op">=</span> <span class="bu">abs</span>(transform.a)  <span class="co"># Assuming square pixels</span></span>
<span id="cb61-2542"><a href="#cb61-2542" aria-hidden="true" tabindex="-1"></a>        scalebar_pixels <span class="op">=</span> <span class="bu">int</span>(<span class="dv">1000</span> <span class="op">/</span> pixel_size)  <span class="co"># 1km scale bar</span></span>
<span id="cb61-2543"><a href="#cb61-2543" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> scalebar_pixels <span class="op">&lt;</span> rgb_composite.shape[<span class="dv">1</span>] <span class="op">/</span> <span class="dv">4</span>:</span>
<span id="cb61-2544"><a href="#cb61-2544" aria-hidden="true" tabindex="-1"></a>            ax1.plot([<span class="dv">10</span>, <span class="dv">10</span> <span class="op">+</span> scalebar_pixels],</span>
<span id="cb61-2545"><a href="#cb61-2545" aria-hidden="true" tabindex="-1"></a>                    [rgb_composite.shape[<span class="dv">0</span>] <span class="op">-</span> <span class="dv">20</span>, rgb_composite.shape[<span class="dv">0</span>] <span class="op">-</span> <span class="dv">20</span>],</span>
<span id="cb61-2546"><a href="#cb61-2546" aria-hidden="true" tabindex="-1"></a>                    <span class="st">'w-'</span>, linewidth<span class="op">=</span><span class="dv">3</span>)</span>
<span id="cb61-2547"><a href="#cb61-2547" aria-hidden="true" tabindex="-1"></a>            ax1.text(<span class="dv">10</span> <span class="op">+</span> scalebar_pixels<span class="op">/</span><span class="dv">2</span>, rgb_composite.shape[<span class="dv">0</span>] <span class="op">-</span> <span class="dv">30</span>,</span>
<span id="cb61-2548"><a href="#cb61-2548" aria-hidden="true" tabindex="-1"></a>                    <span class="st">'1 km'</span>, color<span class="op">=</span><span class="st">'white'</span>, ha<span class="op">=</span><span class="st">'center'</span>, fontweight<span class="op">=</span><span class="st">'bold'</span>)</span>
<span id="cb61-2549"><a href="#cb61-2549" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb61-2550"><a href="#cb61-2550" aria-hidden="true" tabindex="-1"></a>    <span class="co"># False color if available</span></span>
<span id="cb61-2551"><a href="#cb61-2551" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> ax2 <span class="kw">and</span> false_color_composite <span class="kw">is</span> <span class="kw">not</span> <span class="va">None</span>:</span>
<span id="cb61-2552"><a href="#cb61-2552" aria-hidden="true" tabindex="-1"></a>        ax2.imshow(false_color_composite)</span>
<span id="cb61-2553"><a href="#cb61-2553" aria-hidden="true" tabindex="-1"></a>        ax2.set_title(<span class="st">'False Color (NIR-R-G)'</span>, fontsize<span class="op">=</span><span class="dv">12</span>, fontweight<span class="op">=</span><span class="st">'bold'</span>)</span>
<span id="cb61-2554"><a href="#cb61-2554" aria-hidden="true" tabindex="-1"></a>        ax2.axis(<span class="st">'off'</span>)</span>
<span id="cb61-2555"><a href="#cb61-2555" aria-hidden="true" tabindex="-1"></a>        ax2.text(<span class="fl">0.02</span>, <span class="fl">0.98</span>, <span class="st">'Vegetation appears red'</span>,</span>
<span id="cb61-2556"><a href="#cb61-2556" aria-hidden="true" tabindex="-1"></a>                transform<span class="op">=</span>ax2.transAxes, color<span class="op">=</span><span class="st">'white'</span>,</span>
<span id="cb61-2557"><a href="#cb61-2557" aria-hidden="true" tabindex="-1"></a>                fontsize<span class="op">=</span><span class="dv">10</span>, va<span class="op">=</span><span class="st">'top'</span>,</span>
<span id="cb61-2558"><a href="#cb61-2558" aria-hidden="true" tabindex="-1"></a>                bbox<span class="op">=</span><span class="bu">dict</span>(boxstyle<span class="op">=</span><span class="st">'round'</span>, facecolor<span class="op">=</span><span class="st">'black'</span>, alpha<span class="op">=</span><span class="fl">0.5</span>))</span>
<span id="cb61-2559"><a href="#cb61-2559" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb61-2560"><a href="#cb61-2560" aria-hidden="true" tabindex="-1"></a>    plt.suptitle(<span class="st">'Sentinel-2 Composites'</span>, fontsize<span class="op">=</span><span class="dv">14</span>, fontweight<span class="op">=</span><span class="st">'bold'</span>, y<span class="op">=</span><span class="fl">1.02</span>)</span>
<span id="cb61-2561"><a href="#cb61-2561" aria-hidden="true" tabindex="-1"></a>    plt.tight_layout()</span>
<span id="cb61-2562"><a href="#cb61-2562" aria-hidden="true" tabindex="-1"></a>    plt.show()</span>
<span id="cb61-2563"><a href="#cb61-2563" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb61-2564"><a href="#cb61-2564" aria-hidden="true" tabindex="-1"></a>    logger.info(<span class="st">"RGB composites created successfully"</span>)</span>
<span id="cb61-2565"><a href="#cb61-2565" aria-hidden="true" tabindex="-1"></a><span class="cf">else</span>:</span>
<span id="cb61-2566"><a href="#cb61-2566" aria-hidden="true" tabindex="-1"></a>    logger.warning(<span class="st">"Insufficient bands for RGB composite"</span>)</span>
<span id="cb61-2567"><a href="#cb61-2567" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb61-2568"><a href="#cb61-2568" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb61-2569"><a href="#cb61-2569" aria-hidden="true" tabindex="-1"></a><span class="fu">### Calculate Vegetation Indices</span></span>
<span id="cb61-2570"><a href="#cb61-2570" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb61-2573"><a href="#cb61-2573" aria-hidden="true" tabindex="-1"></a><span class="in">```{python}</span></span>
<span id="cb61-2574"><a href="#cb61-2574" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span> band_data <span class="kw">and</span> <span class="st">'B08'</span> <span class="kw">in</span> band_data <span class="kw">and</span> <span class="st">'B04'</span> <span class="kw">in</span> band_data:</span>
<span id="cb61-2575"><a href="#cb61-2575" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Calculate NDVI using our helper function</span></span>
<span id="cb61-2576"><a href="#cb61-2576" aria-hidden="true" tabindex="-1"></a>    ndvi <span class="op">=</span> calculate_ndvi(</span>
<span id="cb61-2577"><a href="#cb61-2577" aria-hidden="true" tabindex="-1"></a>        nir<span class="op">=</span>band_data[<span class="st">'B08'</span>],</span>
<span id="cb61-2578"><a href="#cb61-2578" aria-hidden="true" tabindex="-1"></a>        red<span class="op">=</span>band_data[<span class="st">'B04'</span>]</span>
<span id="cb61-2579"><a href="#cb61-2579" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb61-2580"><a href="#cb61-2580" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb61-2581"><a href="#cb61-2581" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Get NDVI statistics</span></span>
<span id="cb61-2582"><a href="#cb61-2582" aria-hidden="true" tabindex="-1"></a>    ndvi_stats <span class="op">=</span> calculate_band_statistics(ndvi, <span class="st">"NDVI"</span>)</span>
<span id="cb61-2583"><a href="#cb61-2583" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb61-2584"><a href="#cb61-2584" aria-hidden="true" tabindex="-1"></a>    <span class="co"># NDVI statistics</span></span>
<span id="cb61-2585"><a href="#cb61-2585" aria-hidden="true" tabindex="-1"></a>    logger.info(<span class="ss">f"NDVI stats - Range: [</span><span class="sc">{</span>ndvi_stats[<span class="st">'min'</span>]<span class="sc">:.3f}</span><span class="ss">, </span><span class="sc">{</span>ndvi_stats[<span class="st">'max'</span>]<span class="sc">:.3f}</span><span class="ss">], Mean: </span><span class="sc">{</span>ndvi_stats[<span class="st">'mean'</span>]<span class="sc">:.3f}</span><span class="ss">"</span>)</span>
<span id="cb61-2586"><a href="#cb61-2586" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb61-2587"><a href="#cb61-2587" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Interpret NDVI values</span></span>
<span id="cb61-2588"><a href="#cb61-2588" aria-hidden="true" tabindex="-1"></a>    vegetation_pixels <span class="op">=</span> np.<span class="bu">sum</span>(ndvi <span class="op">&gt;</span> <span class="fl">0.3</span>)</span>
<span id="cb61-2589"><a href="#cb61-2589" aria-hidden="true" tabindex="-1"></a>    water_pixels <span class="op">=</span> np.<span class="bu">sum</span>(ndvi <span class="op">&lt;</span> <span class="dv">0</span>)</span>
<span id="cb61-2590"><a href="#cb61-2590" aria-hidden="true" tabindex="-1"></a>    urban_pixels <span class="op">=</span> np.<span class="bu">sum</span>((ndvi <span class="op">&gt;=</span> <span class="dv">0</span>) <span class="op">&amp;</span> (ndvi <span class="op">&lt;=</span> <span class="fl">0.2</span>))</span>
<span id="cb61-2591"><a href="#cb61-2591" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb61-2592"><a href="#cb61-2592" aria-hidden="true" tabindex="-1"></a>    total_valid <span class="op">=</span> ndvi_stats[<span class="st">'valid_pixels'</span>]</span>
<span id="cb61-2593"><a href="#cb61-2593" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Land cover interpretation</span></span>
<span id="cb61-2594"><a href="#cb61-2594" aria-hidden="true" tabindex="-1"></a>    veg_pct <span class="op">=</span> vegetation_pixels<span class="op">/</span>total_valid<span class="op">*</span><span class="dv">100</span></span>
<span id="cb61-2595"><a href="#cb61-2595" aria-hidden="true" tabindex="-1"></a>    urban_pct <span class="op">=</span> urban_pixels<span class="op">/</span>total_valid<span class="op">*</span><span class="dv">100</span></span>
<span id="cb61-2596"><a href="#cb61-2596" aria-hidden="true" tabindex="-1"></a>    water_pct <span class="op">=</span> water_pixels<span class="op">/</span>total_valid<span class="op">*</span><span class="dv">100</span></span>
<span id="cb61-2597"><a href="#cb61-2597" aria-hidden="true" tabindex="-1"></a>    logger.info(<span class="ss">f"Land cover - Vegetation: </span><span class="sc">{</span>veg_pct<span class="sc">:.1f}</span><span class="ss">%, Urban: </span><span class="sc">{</span>urban_pct<span class="sc">:.1f}</span><span class="ss">%, Water: </span><span class="sc">{</span>water_pct<span class="sc">:.1f}</span><span class="ss">%"</span>)</span>
<span id="cb61-2598"><a href="#cb61-2598" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb61-2599"><a href="#cb61-2599" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Create a detailed NDVI visualization</span></span>
<span id="cb61-2600"><a href="#cb61-2600" aria-hidden="true" tabindex="-1"></a>    fig, (ax1, ax2) <span class="op">=</span> plt.subplots(<span class="dv">1</span>, <span class="dv">2</span>, figsize<span class="op">=</span>(<span class="dv">14</span>, <span class="dv">6</span>))</span>
<span id="cb61-2601"><a href="#cb61-2601" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb61-2602"><a href="#cb61-2602" aria-hidden="true" tabindex="-1"></a>    <span class="co"># NDVI map</span></span>
<span id="cb61-2603"><a href="#cb61-2603" aria-hidden="true" tabindex="-1"></a>    im <span class="op">=</span> ax1.imshow(ndvi, cmap<span class="op">=</span><span class="st">'RdYlGn'</span>, vmin<span class="op">=-</span><span class="fl">0.5</span>, vmax<span class="op">=</span><span class="fl">1.0</span>)</span>
<span id="cb61-2604"><a href="#cb61-2604" aria-hidden="true" tabindex="-1"></a>    ax1.set_title(<span class="st">'NDVI (Normalized Difference Vegetation Index)'</span>, fontweight<span class="op">=</span><span class="st">'bold'</span>)</span>
<span id="cb61-2605"><a href="#cb61-2605" aria-hidden="true" tabindex="-1"></a>    ax1.axis(<span class="st">'off'</span>)</span>
<span id="cb61-2606"><a href="#cb61-2606" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb61-2607"><a href="#cb61-2607" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Add colorbar</span></span>
<span id="cb61-2608"><a href="#cb61-2608" aria-hidden="true" tabindex="-1"></a>    cbar <span class="op">=</span> plt.colorbar(im, ax<span class="op">=</span>ax1, shrink<span class="op">=</span><span class="fl">0.8</span>, pad<span class="op">=</span><span class="fl">0.02</span>)</span>
<span id="cb61-2609"><a href="#cb61-2609" aria-hidden="true" tabindex="-1"></a>    cbar.set_label(<span class="st">'NDVI Value'</span>, rotation<span class="op">=</span><span class="dv">270</span>, labelpad<span class="op">=</span><span class="dv">15</span>)</span>
<span id="cb61-2610"><a href="#cb61-2610" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb61-2611"><a href="#cb61-2611" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Add interpretation labels to colorbar</span></span>
<span id="cb61-2612"><a href="#cb61-2612" aria-hidden="true" tabindex="-1"></a>    cbar.ax.text(<span class="fl">1.3</span>, <span class="fl">0.8</span>, <span class="st">'Dense vegetation'</span>, transform<span class="op">=</span>cbar.ax.transAxes, fontsize<span class="op">=</span><span class="dv">9</span>)</span>
<span id="cb61-2613"><a href="#cb61-2613" aria-hidden="true" tabindex="-1"></a>    cbar.ax.text(<span class="fl">1.3</span>, <span class="fl">0.5</span>, <span class="st">'Sparse vegetation'</span>, transform<span class="op">=</span>cbar.ax.transAxes, fontsize<span class="op">=</span><span class="dv">9</span>)</span>
<span id="cb61-2614"><a href="#cb61-2614" aria-hidden="true" tabindex="-1"></a>    cbar.ax.text(<span class="fl">1.3</span>, <span class="fl">0.2</span>, <span class="st">'Bare soil/Urban'</span>, transform<span class="op">=</span>cbar.ax.transAxes, fontsize<span class="op">=</span><span class="dv">9</span>)</span>
<span id="cb61-2615"><a href="#cb61-2615" aria-hidden="true" tabindex="-1"></a>    cbar.ax.text(<span class="fl">1.3</span>, <span class="fl">0.0</span>, <span class="st">'Water/Clouds'</span>, transform<span class="op">=</span>cbar.ax.transAxes, fontsize<span class="op">=</span><span class="dv">9</span>)</span>
<span id="cb61-2616"><a href="#cb61-2616" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb61-2617"><a href="#cb61-2617" aria-hidden="true" tabindex="-1"></a>    <span class="co"># NDVI histogram</span></span>
<span id="cb61-2618"><a href="#cb61-2618" aria-hidden="true" tabindex="-1"></a>    ax2.hist(ndvi.flatten(), bins<span class="op">=</span><span class="dv">100</span>, color<span class="op">=</span><span class="st">'green'</span>, alpha<span class="op">=</span><span class="fl">0.7</span>, edgecolor<span class="op">=</span><span class="st">'black'</span>)</span>
<span id="cb61-2619"><a href="#cb61-2619" aria-hidden="true" tabindex="-1"></a>    ax2.axvline(<span class="dv">0</span>, color<span class="op">=</span><span class="st">'blue'</span>, linestyle<span class="op">=</span><span class="st">'--'</span>, alpha<span class="op">=</span><span class="fl">0.5</span>, label<span class="op">=</span><span class="st">'Water threshold'</span>)</span>
<span id="cb61-2620"><a href="#cb61-2620" aria-hidden="true" tabindex="-1"></a>    ax2.axvline(<span class="fl">0.3</span>, color<span class="op">=</span><span class="st">'green'</span>, linestyle<span class="op">=</span><span class="st">'--'</span>, alpha<span class="op">=</span><span class="fl">0.5</span>, label<span class="op">=</span><span class="st">'Vegetation threshold'</span>)</span>
<span id="cb61-2621"><a href="#cb61-2621" aria-hidden="true" tabindex="-1"></a>    ax2.set_xlabel(<span class="st">'NDVI Value'</span>)</span>
<span id="cb61-2622"><a href="#cb61-2622" aria-hidden="true" tabindex="-1"></a>    ax2.set_ylabel(<span class="st">'Pixel Count'</span>)</span>
<span id="cb61-2623"><a href="#cb61-2623" aria-hidden="true" tabindex="-1"></a>    ax2.set_title(<span class="st">'NDVI Distribution'</span>, fontweight<span class="op">=</span><span class="st">'bold'</span>)</span>
<span id="cb61-2624"><a href="#cb61-2624" aria-hidden="true" tabindex="-1"></a>    ax2.legend()</span>
<span id="cb61-2625"><a href="#cb61-2625" aria-hidden="true" tabindex="-1"></a>    ax2.grid(<span class="va">True</span>, alpha<span class="op">=</span><span class="fl">0.3</span>)</span>
<span id="cb61-2626"><a href="#cb61-2626" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb61-2627"><a href="#cb61-2627" aria-hidden="true" tabindex="-1"></a>    plt.tight_layout()</span>
<span id="cb61-2628"><a href="#cb61-2628" aria-hidden="true" tabindex="-1"></a>    plt.show()</span>
<span id="cb61-2629"><a href="#cb61-2629" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb61-2630"><a href="#cb61-2630" aria-hidden="true" tabindex="-1"></a>    logger.info(<span class="st">"NDVI analysis complete"</span>)</span>
<span id="cb61-2631"><a href="#cb61-2631" aria-hidden="true" tabindex="-1"></a><span class="cf">else</span>:</span>
<span id="cb61-2632"><a href="#cb61-2632" aria-hidden="true" tabindex="-1"></a>    logger.warning(<span class="st">"NIR and Red bands required for NDVI calculation"</span>)</span>
<span id="cb61-2633"><a href="#cb61-2633" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb61-2634"><a href="#cb61-2634" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb61-2635"><a href="#cb61-2635" aria-hidden="true" tabindex="-1"></a><span class="fu">## Understanding NDVI Values</span></span>
<span id="cb61-2636"><a href="#cb61-2636" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb61-2637"><a href="#cb61-2637" aria-hidden="true" tabindex="-1"></a>NDVI values range from -1 to 1, and different intervals correspond to various land cover types. Values from -1 to 0 typically indicate water bodies, clouds, snow, or shadows. Values between 0 and 0.2 are characteristic of bare soil, rock, urban areas, or beaches. NDVI values from 0.2 to 0.4 suggest sparse vegetation, such as grasslands or agricultural areas. Moderate vegetation, including shrublands and crops, is usually found in the 0.4 to 0.6 range. Dense vegetation, such as forests and healthy crops, is represented by NDVI values between 0.6 and 1.0.</span>
<span id="cb61-2638"><a href="#cb61-2638" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb61-2639"><a href="#cb61-2639" aria-hidden="true" tabindex="-1"></a>A common practice in environmental studies is to use NDVI values greater than 0.3 as a mask to identify vegetated areas.</span>
<span id="cb61-2640"><a href="#cb61-2640" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb61-2641"><a href="#cb61-2641" aria-hidden="true" tabindex="-1"></a>---</span>
<span id="cb61-2642"><a href="#cb61-2642" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb61-2643"><a href="#cb61-2643" aria-hidden="true" tabindex="-1"></a><span class="fu">## Step 6: Interactive Mapping and Band Analysis</span></span>
<span id="cb61-2644"><a href="#cb61-2644" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb61-2645"><a href="#cb61-2645" aria-hidden="true" tabindex="-1"></a>Let's create interactive visualizations and perform multi-band analysis.</span>
<span id="cb61-2646"><a href="#cb61-2646" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb61-2647"><a href="#cb61-2647" aria-hidden="true" tabindex="-1"></a><span class="fu">### Create Interactive Map with Results</span></span>
<span id="cb61-2648"><a href="#cb61-2648" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb61-2651"><a href="#cb61-2651" aria-hidden="true" tabindex="-1"></a><span class="in">```{python}</span></span>
<span id="cb61-2652"><a href="#cb61-2652" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span> <span class="st">'subset_bbox'</span> <span class="kw">in</span> <span class="bu">locals</span>() <span class="kw">or</span> <span class="st">'sf_bay_bbox'</span> <span class="kw">in</span> <span class="bu">locals</span>():</span>
<span id="cb61-2653"><a href="#cb61-2653" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Use subset bbox if available, otherwise use the full AOI</span></span>
<span id="cb61-2654"><a href="#cb61-2654" aria-hidden="true" tabindex="-1"></a>    map_bbox <span class="op">=</span> subset_bbox <span class="cf">if</span> <span class="st">'subset_bbox'</span> <span class="kw">in</span> <span class="bu">locals</span>() <span class="cf">else</span> sf_bay_bbox</span>
<span id="cb61-2655"><a href="#cb61-2655" aria-hidden="true" tabindex="-1"></a>    center_lat <span class="op">=</span> (map_bbox[<span class="dv">1</span>] <span class="op">+</span> map_bbox[<span class="dv">3</span>]) <span class="op">/</span> <span class="dv">2</span></span>
<span id="cb61-2656"><a href="#cb61-2656" aria-hidden="true" tabindex="-1"></a>    center_lon <span class="op">=</span> (map_bbox[<span class="dv">0</span>] <span class="op">+</span> map_bbox[<span class="dv">2</span>]) <span class="op">/</span> <span class="dv">2</span></span>
<span id="cb61-2657"><a href="#cb61-2657" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb61-2658"><a href="#cb61-2658" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Create folium map</span></span>
<span id="cb61-2659"><a href="#cb61-2659" aria-hidden="true" tabindex="-1"></a>    m <span class="op">=</span> folium.Map(</span>
<span id="cb61-2660"><a href="#cb61-2660" aria-hidden="true" tabindex="-1"></a>        location<span class="op">=</span>[center_lat, center_lon],</span>
<span id="cb61-2661"><a href="#cb61-2661" aria-hidden="true" tabindex="-1"></a>        zoom_start<span class="op">=</span><span class="dv">12</span>,</span>
<span id="cb61-2662"><a href="#cb61-2662" aria-hidden="true" tabindex="-1"></a>        tiles<span class="op">=</span><span class="st">'OpenStreetMap'</span></span>
<span id="cb61-2663"><a href="#cb61-2663" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb61-2664"><a href="#cb61-2664" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb61-2665"><a href="#cb61-2665" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Add different basemap options</span></span>
<span id="cb61-2666"><a href="#cb61-2666" aria-hidden="true" tabindex="-1"></a>    folium.TileLayer(<span class="st">'CartoDB positron'</span>, name<span class="op">=</span><span class="st">'Light Basemap'</span>).add_to(m)</span>
<span id="cb61-2667"><a href="#cb61-2667" aria-hidden="true" tabindex="-1"></a>    folium.TileLayer(<span class="st">'CartoDB dark_matter'</span>, name<span class="op">=</span><span class="st">'Dark Basemap'</span>).add_to(m)</span>
<span id="cb61-2668"><a href="#cb61-2668" aria-hidden="true" tabindex="-1"></a>    folium.TileLayer(</span>
<span id="cb61-2669"><a href="#cb61-2669" aria-hidden="true" tabindex="-1"></a>        tiles<span class="op">=</span><span class="st">'https://server.arcgisonline.com/ArcGIS/rest/services/World_Imagery/MapServer/tile/</span><span class="sc">{z}</span><span class="st">/</span><span class="sc">{y}</span><span class="st">/</span><span class="sc">{x}</span><span class="st">'</span>,</span>
<span id="cb61-2670"><a href="#cb61-2670" aria-hidden="true" tabindex="-1"></a>        attr<span class="op">=</span><span class="st">'Esri'</span>,</span>
<span id="cb61-2671"><a href="#cb61-2671" aria-hidden="true" tabindex="-1"></a>        name<span class="op">=</span><span class="st">'Satellite Basemap'</span>,</span>
<span id="cb61-2672"><a href="#cb61-2672" aria-hidden="true" tabindex="-1"></a>        overlay<span class="op">=</span><span class="va">False</span>,</span>
<span id="cb61-2673"><a href="#cb61-2673" aria-hidden="true" tabindex="-1"></a>        control<span class="op">=</span><span class="va">True</span></span>
<span id="cb61-2674"><a href="#cb61-2674" aria-hidden="true" tabindex="-1"></a>    ).add_to(m)</span>
<span id="cb61-2675"><a href="#cb61-2675" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb61-2676"><a href="#cb61-2676" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Add study area boundary</span></span>
<span id="cb61-2677"><a href="#cb61-2677" aria-hidden="true" tabindex="-1"></a>    folium.Rectangle(</span>
<span id="cb61-2678"><a href="#cb61-2678" aria-hidden="true" tabindex="-1"></a>        bounds<span class="op">=</span>[[map_bbox[<span class="dv">1</span>], map_bbox[<span class="dv">0</span>]], [map_bbox[<span class="dv">3</span>], map_bbox[<span class="dv">2</span>]]],</span>
<span id="cb61-2679"><a href="#cb61-2679" aria-hidden="true" tabindex="-1"></a>        color<span class="op">=</span><span class="st">'red'</span>,</span>
<span id="cb61-2680"><a href="#cb61-2680" aria-hidden="true" tabindex="-1"></a>        weight<span class="op">=</span><span class="dv">3</span>,</span>
<span id="cb61-2681"><a href="#cb61-2681" aria-hidden="true" tabindex="-1"></a>        fill<span class="op">=</span><span class="va">True</span>,</span>
<span id="cb61-2682"><a href="#cb61-2682" aria-hidden="true" tabindex="-1"></a>        fillOpacity<span class="op">=</span><span class="fl">0.1</span>,</span>
<span id="cb61-2683"><a href="#cb61-2683" aria-hidden="true" tabindex="-1"></a>        popup<span class="op">=</span><span class="st">'Study Area'</span>,</span>
<span id="cb61-2684"><a href="#cb61-2684" aria-hidden="true" tabindex="-1"></a>        tooltip<span class="op">=</span><span class="st">'Analysis extent'</span></span>
<span id="cb61-2685"><a href="#cb61-2685" aria-hidden="true" tabindex="-1"></a>    ).add_to(m)</span>
<span id="cb61-2686"><a href="#cb61-2686" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb61-2687"><a href="#cb61-2687" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Add scene information if available</span></span>
<span id="cb61-2688"><a href="#cb61-2688" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> <span class="st">'best_scene'</span> <span class="kw">in</span> <span class="bu">locals</span>():</span>
<span id="cb61-2689"><a href="#cb61-2689" aria-hidden="true" tabindex="-1"></a>        scene_info <span class="op">=</span> <span class="ss">f"""</span></span>
<span id="cb61-2690"><a href="#cb61-2690" aria-hidden="true" tabindex="-1"></a><span class="ss">        &lt;div style="font-family: Arial; width: 250px;"&gt;</span></span>
<span id="cb61-2691"><a href="#cb61-2691" aria-hidden="true" tabindex="-1"></a><span class="ss">        &lt;h4&gt;Sentinel-2 Scene Info&lt;/h4&gt;</span></span>
<span id="cb61-2692"><a href="#cb61-2692" aria-hidden="true" tabindex="-1"></a><span class="ss">        &lt;b&gt;Date:&lt;/b&gt; </span><span class="sc">{</span>best_scene<span class="sc">.</span>properties[<span class="st">'datetime'</span>]<span class="sc">.</span>split(<span class="st">'T'</span>)[<span class="dv">0</span>]<span class="sc">}</span><span class="ss">&lt;br&gt;</span></span>
<span id="cb61-2693"><a href="#cb61-2693" aria-hidden="true" tabindex="-1"></a><span class="ss">        &lt;b&gt;Cloud Cover:&lt;/b&gt; </span><span class="sc">{</span>best_scene<span class="sc">.</span>properties[<span class="st">'eo:cloud_cover'</span>]<span class="sc">:.1f}</span><span class="ss">%&lt;br&gt;</span></span>
<span id="cb61-2694"><a href="#cb61-2694" aria-hidden="true" tabindex="-1"></a><span class="ss">        &lt;b&gt;Tile:&lt;/b&gt; </span><span class="sc">{</span>best_scene<span class="sc">.</span>properties<span class="sc">.</span>get(<span class="st">'sentinel:utm_zone'</span>, <span class="st">'N/A'</span>)<span class="sc">}</span><span class="ss">&lt;br&gt;</span></span>
<span id="cb61-2695"><a href="#cb61-2695" aria-hidden="true" tabindex="-1"></a><span class="ss">        &lt;b&gt;Processing:&lt;/b&gt; Level 2A (Surface Reflectance)&lt;br&gt;</span></span>
<span id="cb61-2696"><a href="#cb61-2696" aria-hidden="true" tabindex="-1"></a><span class="ss">        &lt;/div&gt;</span></span>
<span id="cb61-2697"><a href="#cb61-2697" aria-hidden="true" tabindex="-1"></a><span class="ss">        """</span></span>
<span id="cb61-2698"><a href="#cb61-2698" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb61-2699"><a href="#cb61-2699" aria-hidden="true" tabindex="-1"></a>        folium.Marker(</span>
<span id="cb61-2700"><a href="#cb61-2700" aria-hidden="true" tabindex="-1"></a>            location<span class="op">=</span>[center_lat, center_lon],</span>
<span id="cb61-2701"><a href="#cb61-2701" aria-hidden="true" tabindex="-1"></a>            popup<span class="op">=</span>folium.Popup(scene_info, max_width<span class="op">=</span><span class="dv">300</span>),</span>
<span id="cb61-2702"><a href="#cb61-2702" aria-hidden="true" tabindex="-1"></a>            tooltip<span class="op">=</span><span class="st">'Click for scene details'</span>,</span>
<span id="cb61-2703"><a href="#cb61-2703" aria-hidden="true" tabindex="-1"></a>            icon<span class="op">=</span>folium.Icon(color<span class="op">=</span><span class="st">'blue'</span>, icon<span class="op">=</span><span class="st">'satellite'</span>, prefix<span class="op">=</span><span class="st">'fa'</span>)</span>
<span id="cb61-2704"><a href="#cb61-2704" aria-hidden="true" tabindex="-1"></a>        ).add_to(m)</span>
<span id="cb61-2705"><a href="#cb61-2705" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb61-2706"><a href="#cb61-2706" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Add NDVI statistics if calculated</span></span>
<span id="cb61-2707"><a href="#cb61-2707" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> <span class="st">'ndvi_stats'</span> <span class="kw">in</span> <span class="bu">locals</span>():</span>
<span id="cb61-2708"><a href="#cb61-2708" aria-hidden="true" tabindex="-1"></a>        ndvi_info <span class="op">=</span> <span class="ss">f"""</span></span>
<span id="cb61-2709"><a href="#cb61-2709" aria-hidden="true" tabindex="-1"></a><span class="ss">        &lt;div style="font-family: Arial;"&gt;</span></span>
<span id="cb61-2710"><a href="#cb61-2710" aria-hidden="true" tabindex="-1"></a><span class="ss">        &lt;h4&gt;NDVI Statistics&lt;/h4&gt;</span></span>
<span id="cb61-2711"><a href="#cb61-2711" aria-hidden="true" tabindex="-1"></a><span class="ss">        &lt;b&gt;Mean:&lt;/b&gt; </span><span class="sc">{</span>ndvi_stats[<span class="st">'mean'</span>]<span class="sc">:.3f}</span><span class="ss">&lt;br&gt;</span></span>
<span id="cb61-2712"><a href="#cb61-2712" aria-hidden="true" tabindex="-1"></a><span class="ss">        &lt;b&gt;Std Dev:&lt;/b&gt; </span><span class="sc">{</span>ndvi_stats[<span class="st">'std'</span>]<span class="sc">:.3f}</span><span class="ss">&lt;br&gt;</span></span>
<span id="cb61-2713"><a href="#cb61-2713" aria-hidden="true" tabindex="-1"></a><span class="ss">        &lt;b&gt;Min:&lt;/b&gt; </span><span class="sc">{</span>ndvi_stats[<span class="st">'min'</span>]<span class="sc">:.3f}</span><span class="ss">&lt;br&gt;</span></span>
<span id="cb61-2714"><a href="#cb61-2714" aria-hidden="true" tabindex="-1"></a><span class="ss">        &lt;b&gt;Max:&lt;/b&gt; </span><span class="sc">{</span>ndvi_stats[<span class="st">'max'</span>]<span class="sc">:.3f}</span><span class="ss">&lt;br&gt;</span></span>
<span id="cb61-2715"><a href="#cb61-2715" aria-hidden="true" tabindex="-1"></a><span class="ss">        &lt;/div&gt;</span></span>
<span id="cb61-2716"><a href="#cb61-2716" aria-hidden="true" tabindex="-1"></a><span class="ss">        """</span></span>
<span id="cb61-2717"><a href="#cb61-2717" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb61-2718"><a href="#cb61-2718" aria-hidden="true" tabindex="-1"></a>        <span class="co"># Add a marker with NDVI stats</span></span>
<span id="cb61-2719"><a href="#cb61-2719" aria-hidden="true" tabindex="-1"></a>        folium.Marker(</span>
<span id="cb61-2720"><a href="#cb61-2720" aria-hidden="true" tabindex="-1"></a>            location<span class="op">=</span>[center_lat <span class="op">+</span> <span class="fl">0.02</span>, center_lon],</span>
<span id="cb61-2721"><a href="#cb61-2721" aria-hidden="true" tabindex="-1"></a>            popup<span class="op">=</span>folium.Popup(ndvi_info, max_width<span class="op">=</span><span class="dv">200</span>),</span>
<span id="cb61-2722"><a href="#cb61-2722" aria-hidden="true" tabindex="-1"></a>            tooltip<span class="op">=</span><span class="st">'NDVI Statistics'</span>,</span>
<span id="cb61-2723"><a href="#cb61-2723" aria-hidden="true" tabindex="-1"></a>            icon<span class="op">=</span>folium.Icon(color<span class="op">=</span><span class="st">'green'</span>, icon<span class="op">=</span><span class="st">'leaf'</span>, prefix<span class="op">=</span><span class="st">'fa'</span>)</span>
<span id="cb61-2724"><a href="#cb61-2724" aria-hidden="true" tabindex="-1"></a>        ).add_to(m)</span>
<span id="cb61-2725"><a href="#cb61-2725" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb61-2726"><a href="#cb61-2726" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Add measurement tool</span></span>
<span id="cb61-2727"><a href="#cb61-2727" aria-hidden="true" tabindex="-1"></a>    <span class="im">from</span> folium.plugins <span class="im">import</span> MeasureControl</span>
<span id="cb61-2728"><a href="#cb61-2728" aria-hidden="true" tabindex="-1"></a>    m.add_child(MeasureControl())</span>
<span id="cb61-2729"><a href="#cb61-2729" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb61-2730"><a href="#cb61-2730" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Add fullscreen button</span></span>
<span id="cb61-2731"><a href="#cb61-2731" aria-hidden="true" tabindex="-1"></a>    <span class="im">from</span> folium.plugins <span class="im">import</span> Fullscreen</span>
<span id="cb61-2732"><a href="#cb61-2732" aria-hidden="true" tabindex="-1"></a>    Fullscreen().add_to(m)</span>
<span id="cb61-2733"><a href="#cb61-2733" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb61-2734"><a href="#cb61-2734" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Add layer control</span></span>
<span id="cb61-2735"><a href="#cb61-2735" aria-hidden="true" tabindex="-1"></a>    folium.LayerControl(position<span class="op">=</span><span class="st">'topright'</span>).add_to(m)</span>
<span id="cb61-2736"><a href="#cb61-2736" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb61-2737"><a href="#cb61-2737" aria-hidden="true" tabindex="-1"></a>    logger.info(<span class="st">"Interactive map created with analysis overlays"</span>)</span>
<span id="cb61-2738"><a href="#cb61-2738" aria-hidden="true" tabindex="-1"></a>    m</span>
<span id="cb61-2739"><a href="#cb61-2739" aria-hidden="true" tabindex="-1"></a><span class="cf">else</span>:</span>
<span id="cb61-2740"><a href="#cb61-2740" aria-hidden="true" tabindex="-1"></a>    logger.warning(<span class="st">"No location data available for mapping"</span>)</span>
<span id="cb61-2741"><a href="#cb61-2741" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb61-2742"><a href="#cb61-2742" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb61-2743"><a href="#cb61-2743" aria-hidden="true" tabindex="-1"></a><span class="fu">### Comprehensive Multi-band Analysis</span></span>
<span id="cb61-2744"><a href="#cb61-2744" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb61-2747"><a href="#cb61-2747" aria-hidden="true" tabindex="-1"></a><span class="in">```{python}</span></span>
<span id="cb61-2748"><a href="#cb61-2748" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span> band_data <span class="kw">and</span> <span class="st">'rgb_composite'</span> <span class="kw">in</span> <span class="bu">locals</span>():</span>
<span id="cb61-2749"><a href="#cb61-2749" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Use our helper function for visualization</span></span>
<span id="cb61-2750"><a href="#cb61-2750" aria-hidden="true" tabindex="-1"></a>    plot_band_comparison(</span>
<span id="cb61-2751"><a href="#cb61-2751" aria-hidden="true" tabindex="-1"></a>        bands<span class="op">=</span>{<span class="st">'B04'</span>: band_data.get(<span class="st">'B04'</span>), <span class="st">'B08'</span>: band_data.get(<span class="st">'B08'</span>)} <span class="cf">if</span> band_data <span class="cf">else</span> {},</span>
<span id="cb61-2752"><a href="#cb61-2752" aria-hidden="true" tabindex="-1"></a>        rgb<span class="op">=</span>rgb_composite <span class="cf">if</span> <span class="st">'rgb_composite'</span> <span class="kw">in</span> <span class="bu">locals</span>() <span class="cf">else</span> <span class="va">None</span>,</span>
<span id="cb61-2753"><a href="#cb61-2753" aria-hidden="true" tabindex="-1"></a>        ndvi<span class="op">=</span>ndvi <span class="cf">if</span> <span class="st">'ndvi'</span> <span class="kw">in</span> <span class="bu">locals</span>() <span class="cf">else</span> <span class="va">None</span>,</span>
<span id="cb61-2754"><a href="#cb61-2754" aria-hidden="true" tabindex="-1"></a>        title<span class="op">=</span><span class="st">"Sentinel-2 Multi-band Analysis"</span></span>
<span id="cb61-2755"><a href="#cb61-2755" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb61-2756"><a href="#cb61-2756" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb61-2757"><a href="#cb61-2757" aria-hidden="true" tabindex="-1"></a>    logger.info(<span class="st">"Multi-band comparison complete"</span>)</span>
<span id="cb61-2758"><a href="#cb61-2758" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb61-2759"><a href="#cb61-2759" aria-hidden="true" tabindex="-1"></a><span class="co"># Additional analysis: Band correlations</span></span>
<span id="cb61-2760"><a href="#cb61-2760" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span> band_data <span class="kw">and</span> <span class="bu">len</span>(band_data) <span class="op">&gt;</span> <span class="dv">2</span>:</span>
<span id="cb61-2761"><a href="#cb61-2761" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Calculate band correlations</span></span>
<span id="cb61-2762"><a href="#cb61-2762" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb61-2763"><a href="#cb61-2763" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Create correlation matrix</span></span>
<span id="cb61-2764"><a href="#cb61-2764" aria-hidden="true" tabindex="-1"></a>    band_names <span class="op">=</span> [k <span class="cf">for</span> k <span class="kw">in</span> [<span class="st">'B02'</span>, <span class="st">'B03'</span>, <span class="st">'B04'</span>, <span class="st">'B08'</span>] <span class="cf">if</span> k <span class="kw">in</span> band_data]</span>
<span id="cb61-2765"><a href="#cb61-2765" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> <span class="bu">len</span>(band_names) <span class="op">&gt;=</span> <span class="dv">2</span>:</span>
<span id="cb61-2766"><a href="#cb61-2766" aria-hidden="true" tabindex="-1"></a>        <span class="co"># Flatten bands and create DataFrame</span></span>
<span id="cb61-2767"><a href="#cb61-2767" aria-hidden="true" tabindex="-1"></a>        band_df <span class="op">=</span> pd.DataFrame()</span>
<span id="cb61-2768"><a href="#cb61-2768" aria-hidden="true" tabindex="-1"></a>        <span class="cf">for</span> band_name <span class="kw">in</span> band_names:</span>
<span id="cb61-2769"><a href="#cb61-2769" aria-hidden="true" tabindex="-1"></a>            band_df[band_name] <span class="op">=</span> band_data[band_name].flatten()</span>
<span id="cb61-2770"><a href="#cb61-2770" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb61-2771"><a href="#cb61-2771" aria-hidden="true" tabindex="-1"></a>        <span class="co"># Calculate correlations</span></span>
<span id="cb61-2772"><a href="#cb61-2772" aria-hidden="true" tabindex="-1"></a>        correlations <span class="op">=</span> band_df.corr()</span>
<span id="cb61-2773"><a href="#cb61-2773" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb61-2774"><a href="#cb61-2774" aria-hidden="true" tabindex="-1"></a>        <span class="co"># Plot correlation matrix</span></span>
<span id="cb61-2775"><a href="#cb61-2775" aria-hidden="true" tabindex="-1"></a>        plt.figure(figsize<span class="op">=</span>(<span class="dv">8</span>, <span class="dv">6</span>))</span>
<span id="cb61-2776"><a href="#cb61-2776" aria-hidden="true" tabindex="-1"></a>        im <span class="op">=</span> plt.imshow(correlations, cmap<span class="op">=</span><span class="st">'coolwarm'</span>, vmin<span class="op">=-</span><span class="dv">1</span>, vmax<span class="op">=</span><span class="dv">1</span>)</span>
<span id="cb61-2777"><a href="#cb61-2777" aria-hidden="true" tabindex="-1"></a>        plt.colorbar(im, label<span class="op">=</span><span class="st">'Correlation'</span>)</span>
<span id="cb61-2778"><a href="#cb61-2778" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb61-2779"><a href="#cb61-2779" aria-hidden="true" tabindex="-1"></a>        <span class="co"># Add labels</span></span>
<span id="cb61-2780"><a href="#cb61-2780" aria-hidden="true" tabindex="-1"></a>        plt.xticks(<span class="bu">range</span>(<span class="bu">len</span>(band_names)), band_names)</span>
<span id="cb61-2781"><a href="#cb61-2781" aria-hidden="true" tabindex="-1"></a>        plt.yticks(<span class="bu">range</span>(<span class="bu">len</span>(band_names)), band_names)</span>
<span id="cb61-2782"><a href="#cb61-2782" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb61-2783"><a href="#cb61-2783" aria-hidden="true" tabindex="-1"></a>        <span class="co"># Add correlation values</span></span>
<span id="cb61-2784"><a href="#cb61-2784" aria-hidden="true" tabindex="-1"></a>        <span class="cf">for</span> i <span class="kw">in</span> <span class="bu">range</span>(<span class="bu">len</span>(band_names)):</span>
<span id="cb61-2785"><a href="#cb61-2785" aria-hidden="true" tabindex="-1"></a>            <span class="cf">for</span> j <span class="kw">in</span> <span class="bu">range</span>(<span class="bu">len</span>(band_names)):</span>
<span id="cb61-2786"><a href="#cb61-2786" aria-hidden="true" tabindex="-1"></a>                plt.text(j, i, <span class="ss">f'</span><span class="sc">{</span>correlations<span class="sc">.</span>iloc[i, j]<span class="sc">:.2f}</span><span class="ss">'</span>,</span>
<span id="cb61-2787"><a href="#cb61-2787" aria-hidden="true" tabindex="-1"></a>                        ha<span class="op">=</span><span class="st">'center'</span>, va<span class="op">=</span><span class="st">'center'</span>,</span>
<span id="cb61-2788"><a href="#cb61-2788" aria-hidden="true" tabindex="-1"></a>                        color<span class="op">=</span><span class="st">'white'</span> <span class="cf">if</span> <span class="bu">abs</span>(correlations.iloc[i, j]) <span class="op">&gt;</span> <span class="fl">0.5</span> <span class="cf">else</span> <span class="st">'black'</span>)</span>
<span id="cb61-2789"><a href="#cb61-2789" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb61-2790"><a href="#cb61-2790" aria-hidden="true" tabindex="-1"></a>        plt.title(<span class="st">'Band Correlation Matrix'</span>, fontweight<span class="op">=</span><span class="st">'bold'</span>)</span>
<span id="cb61-2791"><a href="#cb61-2791" aria-hidden="true" tabindex="-1"></a>        plt.tight_layout()</span>
<span id="cb61-2792"><a href="#cb61-2792" aria-hidden="true" tabindex="-1"></a>        plt.show()</span>
<span id="cb61-2793"><a href="#cb61-2793" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb61-2794"><a href="#cb61-2794" aria-hidden="true" tabindex="-1"></a>        logger.info(<span class="st">"Band correlation analysis complete"</span>)</span>
<span id="cb61-2795"><a href="#cb61-2795" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> <span class="st">'B03'</span> <span class="kw">in</span> band_names <span class="kw">and</span> <span class="st">'B04'</span> <span class="kw">in</span> band_names:</span>
<span id="cb61-2796"><a href="#cb61-2796" aria-hidden="true" tabindex="-1"></a>            logger.info(<span class="ss">f"Highest correlation: B03-B04 = </span><span class="sc">{</span>correlations<span class="sc">.</span>loc[<span class="st">'B03'</span>, <span class="st">'B04'</span>]<span class="sc">:.3f}</span><span class="ss">"</span>)</span>
<span id="cb61-2797"><a href="#cb61-2797" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb61-2798"><a href="#cb61-2798" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb61-2799"><a href="#cb61-2799" aria-hidden="true" tabindex="-1"></a>---</span>
<span id="cb61-2800"><a href="#cb61-2800" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb61-2801"><a href="#cb61-2801" aria-hidden="true" tabindex="-1"></a><span class="fu">## Step 7: Data Export and Caching</span></span>
<span id="cb61-2802"><a href="#cb61-2802" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb61-2803"><a href="#cb61-2803" aria-hidden="true" tabindex="-1"></a>Let's save our processed data for future use and create a reusable cache.</span>
<span id="cb61-2804"><a href="#cb61-2804" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb61-2805"><a href="#cb61-2805" aria-hidden="true" tabindex="-1"></a><span class="fu">### Export Processed Data Using Helper Functions</span></span>
<span id="cb61-2806"><a href="#cb61-2806" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb61-2809"><a href="#cb61-2809" aria-hidden="true" tabindex="-1"></a><span class="in">```{python}</span></span>
<span id="cb61-2810"><a href="#cb61-2810" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> typing <span class="im">import</span> Any</span>
<span id="cb61-2811"><a href="#cb61-2811" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb61-2812"><a href="#cb61-2812" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> export_analysis_results(</span>
<span id="cb61-2813"><a href="#cb61-2813" aria-hidden="true" tabindex="-1"></a>    output_dir: <span class="bu">str</span> <span class="op">=</span> <span class="st">'week1_output'</span>,</span>
<span id="cb61-2814"><a href="#cb61-2814" aria-hidden="true" tabindex="-1"></a>    ndvi: Optional[np.ndarray] <span class="op">=</span> <span class="va">None</span>,</span>
<span id="cb61-2815"><a href="#cb61-2815" aria-hidden="true" tabindex="-1"></a>    rgb_composite: Optional[np.ndarray] <span class="op">=</span> <span class="va">None</span>,</span>
<span id="cb61-2816"><a href="#cb61-2816" aria-hidden="true" tabindex="-1"></a>    band_data: Optional[Dict[<span class="bu">str</span>, np.ndarray]] <span class="op">=</span> <span class="va">None</span>,</span>
<span id="cb61-2817"><a href="#cb61-2817" aria-hidden="true" tabindex="-1"></a>    transform: Optional[Any] <span class="op">=</span> <span class="va">None</span>,</span>
<span id="cb61-2818"><a href="#cb61-2818" aria-hidden="true" tabindex="-1"></a>    crs: Optional[Any] <span class="op">=</span> <span class="va">None</span>,</span>
<span id="cb61-2819"><a href="#cb61-2819" aria-hidden="true" tabindex="-1"></a>    scene_metadata: Optional[Dict] <span class="op">=</span> <span class="va">None</span>,</span>
<span id="cb61-2820"><a href="#cb61-2820" aria-hidden="true" tabindex="-1"></a>    ndvi_stats: Optional[Dict] <span class="op">=</span> <span class="va">None</span>,</span>
<span id="cb61-2821"><a href="#cb61-2821" aria-hidden="true" tabindex="-1"></a>    aoi_bbox: Optional[List[<span class="bu">float</span>]] <span class="op">=</span> <span class="va">None</span>,</span>
<span id="cb61-2822"><a href="#cb61-2822" aria-hidden="true" tabindex="-1"></a>    subset_bbox: Optional[List[<span class="bu">float</span>]] <span class="op">=</span> <span class="va">None</span></span>
<span id="cb61-2823"><a href="#cb61-2823" aria-hidden="true" tabindex="-1"></a>) <span class="op">-&gt;</span> Path:</span>
<span id="cb61-2824"><a href="#cb61-2824" aria-hidden="true" tabindex="-1"></a>    <span class="co">"""Export analysis results to structured output directory.</span></span>
<span id="cb61-2825"><a href="#cb61-2825" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb61-2826"><a href="#cb61-2826" aria-hidden="true" tabindex="-1"></a><span class="co">    Args:</span></span>
<span id="cb61-2827"><a href="#cb61-2827" aria-hidden="true" tabindex="-1"></a><span class="co">        output_dir: Output directory path</span></span>
<span id="cb61-2828"><a href="#cb61-2828" aria-hidden="true" tabindex="-1"></a><span class="co">        ndvi: NDVI array to export</span></span>
<span id="cb61-2829"><a href="#cb61-2829" aria-hidden="true" tabindex="-1"></a><span class="co">        rgb_composite: RGB composite array to export</span></span>
<span id="cb61-2830"><a href="#cb61-2830" aria-hidden="true" tabindex="-1"></a><span class="co">        band_data: Dictionary of band arrays to cache</span></span>
<span id="cb61-2831"><a href="#cb61-2831" aria-hidden="true" tabindex="-1"></a><span class="co">        transform: Geospatial transform</span></span>
<span id="cb61-2832"><a href="#cb61-2832" aria-hidden="true" tabindex="-1"></a><span class="co">        crs: Coordinate reference system</span></span>
<span id="cb61-2833"><a href="#cb61-2833" aria-hidden="true" tabindex="-1"></a><span class="co">        scene_metadata: Scene metadata dictionary</span></span>
<span id="cb61-2834"><a href="#cb61-2834" aria-hidden="true" tabindex="-1"></a><span class="co">        ndvi_stats: NDVI statistics dictionary</span></span>
<span id="cb61-2835"><a href="#cb61-2835" aria-hidden="true" tabindex="-1"></a><span class="co">        aoi_bbox: Area of interest bounding box</span></span>
<span id="cb61-2836"><a href="#cb61-2836" aria-hidden="true" tabindex="-1"></a><span class="co">        subset_bbox: Subset bounding box</span></span>
<span id="cb61-2837"><a href="#cb61-2837" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb61-2838"><a href="#cb61-2838" aria-hidden="true" tabindex="-1"></a><span class="co">    Returns:</span></span>
<span id="cb61-2839"><a href="#cb61-2839" aria-hidden="true" tabindex="-1"></a><span class="co">        Path to output directory</span></span>
<span id="cb61-2840"><a href="#cb61-2840" aria-hidden="true" tabindex="-1"></a><span class="co">    """</span></span>
<span id="cb61-2841"><a href="#cb61-2841" aria-hidden="true" tabindex="-1"></a>    <span class="im">from</span> pathlib <span class="im">import</span> Path</span>
<span id="cb61-2842"><a href="#cb61-2842" aria-hidden="true" tabindex="-1"></a>    <span class="im">import</span> json</span>
<span id="cb61-2843"><a href="#cb61-2843" aria-hidden="true" tabindex="-1"></a>    <span class="im">from</span> datetime <span class="im">import</span> datetime</span>
<span id="cb61-2844"><a href="#cb61-2844" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb61-2845"><a href="#cb61-2845" aria-hidden="true" tabindex="-1"></a>    output_path <span class="op">=</span> Path(output_dir)</span>
<span id="cb61-2846"><a href="#cb61-2846" aria-hidden="true" tabindex="-1"></a>    output_path.mkdir(exist_ok<span class="op">=</span><span class="va">True</span>)</span>
<span id="cb61-2847"><a href="#cb61-2847" aria-hidden="true" tabindex="-1"></a>    cache_dir <span class="op">=</span> output_path <span class="op">/</span> <span class="st">'cache'</span></span>
<span id="cb61-2848"><a href="#cb61-2848" aria-hidden="true" tabindex="-1"></a>    cache_dir.mkdir(exist_ok<span class="op">=</span><span class="va">True</span>)</span>
<span id="cb61-2849"><a href="#cb61-2849" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb61-2850"><a href="#cb61-2850" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Export NDVI if available</span></span>
<span id="cb61-2851"><a href="#cb61-2851" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> ndvi <span class="kw">is</span> <span class="kw">not</span> <span class="va">None</span> <span class="kw">and</span> transform <span class="kw">is</span> <span class="kw">not</span> <span class="va">None</span> <span class="kw">and</span> crs <span class="kw">is</span> <span class="kw">not</span> <span class="va">None</span>:</span>
<span id="cb61-2852"><a href="#cb61-2852" aria-hidden="true" tabindex="-1"></a>        ndvi_path <span class="op">=</span> output_path <span class="op">/</span> <span class="st">'ndvi.tif'</span></span>
<span id="cb61-2853"><a href="#cb61-2853" aria-hidden="true" tabindex="-1"></a>        save_geotiff(</span>
<span id="cb61-2854"><a href="#cb61-2854" aria-hidden="true" tabindex="-1"></a>            data<span class="op">=</span>ndvi,</span>
<span id="cb61-2855"><a href="#cb61-2855" aria-hidden="true" tabindex="-1"></a>            output_path<span class="op">=</span>ndvi_path,</span>
<span id="cb61-2856"><a href="#cb61-2856" aria-hidden="true" tabindex="-1"></a>            transform<span class="op">=</span>transform,</span>
<span id="cb61-2857"><a href="#cb61-2857" aria-hidden="true" tabindex="-1"></a>            crs<span class="op">=</span>crs,</span>
<span id="cb61-2858"><a href="#cb61-2858" aria-hidden="true" tabindex="-1"></a>            band_names<span class="op">=</span>[<span class="st">'NDVI'</span>]</span>
<span id="cb61-2859"><a href="#cb61-2859" aria-hidden="true" tabindex="-1"></a>        )</span>
<span id="cb61-2860"><a href="#cb61-2860" aria-hidden="true" tabindex="-1"></a>        logger.debug(<span class="ss">f"Exported NDVI to </span><span class="sc">{</span>ndvi_path<span class="sc">.</span>name<span class="sc">}</span><span class="ss">"</span>)</span>
<span id="cb61-2861"><a href="#cb61-2861" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb61-2862"><a href="#cb61-2862" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Export RGB composite if available</span></span>
<span id="cb61-2863"><a href="#cb61-2863" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> rgb_composite <span class="kw">is</span> <span class="kw">not</span> <span class="va">None</span> <span class="kw">and</span> transform <span class="kw">is</span> <span class="kw">not</span> <span class="va">None</span> <span class="kw">and</span> crs <span class="kw">is</span> <span class="kw">not</span> <span class="va">None</span>:</span>
<span id="cb61-2864"><a href="#cb61-2864" aria-hidden="true" tabindex="-1"></a>        rgb_bands <span class="op">=</span> np.transpose(rgb_composite, (<span class="dv">2</span>, <span class="dv">0</span>, <span class="dv">1</span>))  <span class="co"># HWC to CHW</span></span>
<span id="cb61-2865"><a href="#cb61-2865" aria-hidden="true" tabindex="-1"></a>        rgb_path <span class="op">=</span> output_path <span class="op">/</span> <span class="st">'rgb_composite.tif'</span></span>
<span id="cb61-2866"><a href="#cb61-2866" aria-hidden="true" tabindex="-1"></a>        save_geotiff(</span>
<span id="cb61-2867"><a href="#cb61-2867" aria-hidden="true" tabindex="-1"></a>            data<span class="op">=</span>rgb_bands,</span>
<span id="cb61-2868"><a href="#cb61-2868" aria-hidden="true" tabindex="-1"></a>            output_path<span class="op">=</span>rgb_path,</span>
<span id="cb61-2869"><a href="#cb61-2869" aria-hidden="true" tabindex="-1"></a>            transform<span class="op">=</span>transform,</span>
<span id="cb61-2870"><a href="#cb61-2870" aria-hidden="true" tabindex="-1"></a>            crs<span class="op">=</span>crs,</span>
<span id="cb61-2871"><a href="#cb61-2871" aria-hidden="true" tabindex="-1"></a>            band_names<span class="op">=</span>[<span class="st">'Red'</span>, <span class="st">'Green'</span>, <span class="st">'Blue'</span>]</span>
<span id="cb61-2872"><a href="#cb61-2872" aria-hidden="true" tabindex="-1"></a>        )</span>
<span id="cb61-2873"><a href="#cb61-2873" aria-hidden="true" tabindex="-1"></a>        logger.debug(<span class="ss">f"Exported RGB composite to </span><span class="sc">{</span>rgb_path<span class="sc">.</span>name<span class="sc">}</span><span class="ss">"</span>)</span>
<span id="cb61-2874"><a href="#cb61-2874" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb61-2875"><a href="#cb61-2875" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Cache individual bands</span></span>
<span id="cb61-2876"><a href="#cb61-2876" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> band_data:</span>
<span id="cb61-2877"><a href="#cb61-2877" aria-hidden="true" tabindex="-1"></a>        cached_bands <span class="op">=</span> []</span>
<span id="cb61-2878"><a href="#cb61-2878" aria-hidden="true" tabindex="-1"></a>        <span class="cf">for</span> band_name, band_array <span class="kw">in</span> band_data.items():</span>
<span id="cb61-2879"><a href="#cb61-2879" aria-hidden="true" tabindex="-1"></a>            <span class="cf">if</span> band_name.startswith(<span class="st">'B'</span>) <span class="kw">and</span> <span class="bu">isinstance</span>(band_array, np.ndarray):</span>
<span id="cb61-2880"><a href="#cb61-2880" aria-hidden="true" tabindex="-1"></a>                band_path <span class="op">=</span> cache_dir <span class="op">/</span> <span class="ss">f'</span><span class="sc">{</span>band_name<span class="sc">}</span><span class="ss">.npy'</span></span>
<span id="cb61-2881"><a href="#cb61-2881" aria-hidden="true" tabindex="-1"></a>                np.save(band_path, band_array)</span>
<span id="cb61-2882"><a href="#cb61-2882" aria-hidden="true" tabindex="-1"></a>                cached_bands.append(band_name)</span>
<span id="cb61-2883"><a href="#cb61-2883" aria-hidden="true" tabindex="-1"></a>        logger.debug(<span class="ss">f"Cached </span><span class="sc">{</span><span class="bu">len</span>(cached_bands)<span class="sc">}</span><span class="ss"> bands: </span><span class="sc">{</span>cached_bands<span class="sc">}</span><span class="ss">"</span>)</span>
<span id="cb61-2884"><a href="#cb61-2884" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb61-2885"><a href="#cb61-2885" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Create metadata</span></span>
<span id="cb61-2886"><a href="#cb61-2886" aria-hidden="true" tabindex="-1"></a>    metadata <span class="op">=</span> {</span>
<span id="cb61-2887"><a href="#cb61-2887" aria-hidden="true" tabindex="-1"></a>        <span class="st">'processing_date'</span>: datetime.now().isoformat(),</span>
<span id="cb61-2888"><a href="#cb61-2888" aria-hidden="true" tabindex="-1"></a>        <span class="st">'aoi_bbox'</span>: aoi_bbox,</span>
<span id="cb61-2889"><a href="#cb61-2889" aria-hidden="true" tabindex="-1"></a>        <span class="st">'subset_bbox'</span>: subset_bbox</span>
<span id="cb61-2890"><a href="#cb61-2890" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb61-2891"><a href="#cb61-2891" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb61-2892"><a href="#cb61-2892" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> scene_metadata:</span>
<span id="cb61-2893"><a href="#cb61-2893" aria-hidden="true" tabindex="-1"></a>        metadata[<span class="st">'scene'</span>] <span class="op">=</span> scene_metadata</span>
<span id="cb61-2894"><a href="#cb61-2894" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> ndvi_stats:</span>
<span id="cb61-2895"><a href="#cb61-2895" aria-hidden="true" tabindex="-1"></a>        metadata[<span class="st">'ndvi_statistics'</span>] <span class="op">=</span> ndvi_stats</span>
<span id="cb61-2896"><a href="#cb61-2896" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb61-2897"><a href="#cb61-2897" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Save metadata</span></span>
<span id="cb61-2898"><a href="#cb61-2898" aria-hidden="true" tabindex="-1"></a>    metadata_path <span class="op">=</span> output_path <span class="op">/</span> <span class="st">'metadata.json'</span></span>
<span id="cb61-2899"><a href="#cb61-2899" aria-hidden="true" tabindex="-1"></a>    <span class="cf">with</span> <span class="bu">open</span>(metadata_path, <span class="st">'w'</span>) <span class="im">as</span> f:</span>
<span id="cb61-2900"><a href="#cb61-2900" aria-hidden="true" tabindex="-1"></a>        json.dump(metadata, f, indent<span class="op">=</span><span class="dv">2</span>, default<span class="op">=</span><span class="bu">str</span>)</span>
<span id="cb61-2901"><a href="#cb61-2901" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb61-2902"><a href="#cb61-2902" aria-hidden="true" tabindex="-1"></a>    logger.info(<span class="ss">f"Analysis results exported to: </span><span class="sc">{</span>output_path<span class="sc">.</span>absolute()<span class="sc">}</span><span class="ss">"</span>)</span>
<span id="cb61-2903"><a href="#cb61-2903" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> output_path</span>
<span id="cb61-2904"><a href="#cb61-2904" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb61-2905"><a href="#cb61-2905" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> load_week1_data(output_dir: <span class="bu">str</span> <span class="op">=</span> <span class="st">"week1_output"</span>) <span class="op">-&gt;</span> Dict[<span class="bu">str</span>, Any]:</span>
<span id="cb61-2906"><a href="#cb61-2906" aria-hidden="true" tabindex="-1"></a>    <span class="co">"""Load processed data from Week 1."""</span></span>
<span id="cb61-2907"><a href="#cb61-2907" aria-hidden="true" tabindex="-1"></a>    <span class="im">from</span> pathlib <span class="im">import</span> Path</span>
<span id="cb61-2908"><a href="#cb61-2908" aria-hidden="true" tabindex="-1"></a>    <span class="im">import</span> json</span>
<span id="cb61-2909"><a href="#cb61-2909" aria-hidden="true" tabindex="-1"></a>    <span class="im">import</span> numpy <span class="im">as</span> np</span>
<span id="cb61-2910"><a href="#cb61-2910" aria-hidden="true" tabindex="-1"></a>    <span class="im">import</span> rasterio</span>
<span id="cb61-2911"><a href="#cb61-2911" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb61-2912"><a href="#cb61-2912" aria-hidden="true" tabindex="-1"></a>    output_path <span class="op">=</span> Path(output_dir)</span>
<span id="cb61-2913"><a href="#cb61-2913" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> <span class="kw">not</span> output_path.exists():</span>
<span id="cb61-2914"><a href="#cb61-2914" aria-hidden="true" tabindex="-1"></a>        <span class="cf">raise</span> <span class="pp">FileNotFoundError</span>(<span class="ss">f"Directory not found: </span><span class="sc">{</span>output_path<span class="sc">}</span><span class="ss">"</span>)</span>
<span id="cb61-2915"><a href="#cb61-2915" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb61-2916"><a href="#cb61-2916" aria-hidden="true" tabindex="-1"></a>    data <span class="op">=</span> {}</span>
<span id="cb61-2917"><a href="#cb61-2917" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb61-2918"><a href="#cb61-2918" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Load metadata</span></span>
<span id="cb61-2919"><a href="#cb61-2919" aria-hidden="true" tabindex="-1"></a>    metadata_path <span class="op">=</span> output_path <span class="op">/</span> <span class="st">"metadata.json"</span></span>
<span id="cb61-2920"><a href="#cb61-2920" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> metadata_path.exists():</span>
<span id="cb61-2921"><a href="#cb61-2921" aria-hidden="true" tabindex="-1"></a>        <span class="cf">with</span> <span class="bu">open</span>(metadata_path) <span class="im">as</span> f:</span>
<span id="cb61-2922"><a href="#cb61-2922" aria-hidden="true" tabindex="-1"></a>            data[<span class="st">"metadata"</span>] <span class="op">=</span> json.load(f)</span>
<span id="cb61-2923"><a href="#cb61-2923" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb61-2924"><a href="#cb61-2924" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Load NDVI</span></span>
<span id="cb61-2925"><a href="#cb61-2925" aria-hidden="true" tabindex="-1"></a>    ndvi_path <span class="op">=</span> output_path <span class="op">/</span> <span class="st">"ndvi.tif"</span></span>
<span id="cb61-2926"><a href="#cb61-2926" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> ndvi_path.exists():</span>
<span id="cb61-2927"><a href="#cb61-2927" aria-hidden="true" tabindex="-1"></a>        <span class="cf">with</span> rasterio.<span class="bu">open</span>(ndvi_path) <span class="im">as</span> src:</span>
<span id="cb61-2928"><a href="#cb61-2928" aria-hidden="true" tabindex="-1"></a>            data[<span class="st">"ndvi"</span>] <span class="op">=</span> src.read(<span class="dv">1</span>)</span>
<span id="cb61-2929"><a href="#cb61-2929" aria-hidden="true" tabindex="-1"></a>            data[<span class="st">"transform"</span>] <span class="op">=</span> src.transform</span>
<span id="cb61-2930"><a href="#cb61-2930" aria-hidden="true" tabindex="-1"></a>            data[<span class="st">"crs"</span>] <span class="op">=</span> src.crs</span>
<span id="cb61-2931"><a href="#cb61-2931" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb61-2932"><a href="#cb61-2932" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Load cached bands</span></span>
<span id="cb61-2933"><a href="#cb61-2933" aria-hidden="true" tabindex="-1"></a>    cache_dir <span class="op">=</span> output_path <span class="op">/</span> <span class="st">"cache"</span></span>
<span id="cb61-2934"><a href="#cb61-2934" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> cache_dir.exists():</span>
<span id="cb61-2935"><a href="#cb61-2935" aria-hidden="true" tabindex="-1"></a>        data[<span class="st">"bands"</span>] <span class="op">=</span> {}</span>
<span id="cb61-2936"><a href="#cb61-2936" aria-hidden="true" tabindex="-1"></a>        <span class="cf">for</span> band_file <span class="kw">in</span> cache_dir.glob(<span class="st">"*.npy"</span>):</span>
<span id="cb61-2937"><a href="#cb61-2937" aria-hidden="true" tabindex="-1"></a>            band_name <span class="op">=</span> band_file.stem</span>
<span id="cb61-2938"><a href="#cb61-2938" aria-hidden="true" tabindex="-1"></a>            data[<span class="st">"bands"</span>][band_name] <span class="op">=</span> np.load(band_file)</span>
<span id="cb61-2939"><a href="#cb61-2939" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb61-2940"><a href="#cb61-2940" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> data</span>
<span id="cb61-2941"><a href="#cb61-2941" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb61-2942"><a href="#cb61-2942" aria-hidden="true" tabindex="-1"></a><span class="co"># Export the analysis results</span></span>
<span id="cb61-2943"><a href="#cb61-2943" aria-hidden="true" tabindex="-1"></a>scene_meta <span class="op">=</span> <span class="va">None</span></span>
<span id="cb61-2944"><a href="#cb61-2944" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span> <span class="st">'best_scene'</span> <span class="kw">in</span> <span class="bu">locals</span>():</span>
<span id="cb61-2945"><a href="#cb61-2945" aria-hidden="true" tabindex="-1"></a>    scene_meta <span class="op">=</span> {</span>
<span id="cb61-2946"><a href="#cb61-2946" aria-hidden="true" tabindex="-1"></a>        <span class="st">'id'</span>: best_scene.<span class="bu">id</span>,</span>
<span id="cb61-2947"><a href="#cb61-2947" aria-hidden="true" tabindex="-1"></a>        <span class="st">'date'</span>: best_scene.properties[<span class="st">'datetime'</span>],</span>
<span id="cb61-2948"><a href="#cb61-2948" aria-hidden="true" tabindex="-1"></a>        <span class="st">'cloud_cover'</span>: best_scene.properties[<span class="st">'eo:cloud_cover'</span>],</span>
<span id="cb61-2949"><a href="#cb61-2949" aria-hidden="true" tabindex="-1"></a>        <span class="st">'platform'</span>: best_scene.properties.get(<span class="st">'platform'</span>, <span class="st">'Unknown'</span>)</span>
<span id="cb61-2950"><a href="#cb61-2950" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb61-2951"><a href="#cb61-2951" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb61-2952"><a href="#cb61-2952" aria-hidden="true" tabindex="-1"></a>output_dir <span class="op">=</span> export_analysis_results(</span>
<span id="cb61-2953"><a href="#cb61-2953" aria-hidden="true" tabindex="-1"></a>    ndvi<span class="op">=</span>ndvi <span class="cf">if</span> <span class="st">'ndvi'</span> <span class="kw">in</span> <span class="bu">locals</span>() <span class="cf">else</span> <span class="va">None</span>,</span>
<span id="cb61-2954"><a href="#cb61-2954" aria-hidden="true" tabindex="-1"></a>    rgb_composite<span class="op">=</span>rgb_composite <span class="cf">if</span> <span class="st">'rgb_composite'</span> <span class="kw">in</span> <span class="bu">locals</span>() <span class="cf">else</span> <span class="va">None</span>,</span>
<span id="cb61-2955"><a href="#cb61-2955" aria-hidden="true" tabindex="-1"></a>    band_data<span class="op">=</span>band_data <span class="cf">if</span> <span class="st">'band_data'</span> <span class="kw">in</span> <span class="bu">locals</span>() <span class="cf">else</span> <span class="va">None</span>,</span>
<span id="cb61-2956"><a href="#cb61-2956" aria-hidden="true" tabindex="-1"></a>    transform<span class="op">=</span>transform <span class="cf">if</span> <span class="st">'transform'</span> <span class="kw">in</span> <span class="bu">locals</span>() <span class="cf">else</span> <span class="va">None</span>,</span>
<span id="cb61-2957"><a href="#cb61-2957" aria-hidden="true" tabindex="-1"></a>    crs<span class="op">=</span>crs <span class="cf">if</span> <span class="st">'crs'</span> <span class="kw">in</span> <span class="bu">locals</span>() <span class="cf">else</span> <span class="va">None</span>,</span>
<span id="cb61-2958"><a href="#cb61-2958" aria-hidden="true" tabindex="-1"></a>    scene_metadata<span class="op">=</span>scene_meta,</span>
<span id="cb61-2959"><a href="#cb61-2959" aria-hidden="true" tabindex="-1"></a>    ndvi_stats<span class="op">=</span>ndvi_stats <span class="cf">if</span> <span class="st">'ndvi_stats'</span> <span class="kw">in</span> <span class="bu">locals</span>() <span class="cf">else</span> <span class="va">None</span>,</span>
<span id="cb61-2960"><a href="#cb61-2960" aria-hidden="true" tabindex="-1"></a>    aoi_bbox<span class="op">=</span>sf_bay_bbox <span class="cf">if</span> <span class="st">'sf_bay_bbox'</span> <span class="kw">in</span> <span class="bu">locals</span>() <span class="cf">else</span> <span class="va">None</span>,</span>
<span id="cb61-2961"><a href="#cb61-2961" aria-hidden="true" tabindex="-1"></a>    subset_bbox<span class="op">=</span>subset_bbox <span class="cf">if</span> <span class="st">'subset_bbox'</span> <span class="kw">in</span> <span class="bu">locals</span>() <span class="cf">else</span> <span class="va">None</span></span>
<span id="cb61-2962"><a href="#cb61-2962" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb61-2963"><a href="#cb61-2963" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb61-2964"><a href="#cb61-2964" aria-hidden="true" tabindex="-1"></a>logger.info(<span class="st">"Data exported - use load_week1_data() to reload"</span>)</span>
<span id="cb61-2965"><a href="#cb61-2965" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb61-2966"><a href="#cb61-2966" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb61-2967"><a href="#cb61-2967" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb61-2968"><a href="#cb61-2968" aria-hidden="true" tabindex="-1"></a>---</span>
<span id="cb61-2969"><a href="#cb61-2969" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb61-2970"><a href="#cb61-2970" aria-hidden="true" tabindex="-1"></a>---</span>
<span id="cb61-2971"><a href="#cb61-2971" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb61-2972"><a href="#cb61-2972" aria-hidden="true" tabindex="-1"></a>---</span>
<span id="cb61-2973"><a href="#cb61-2973" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb61-2974"><a href="#cb61-2974" aria-hidden="true" tabindex="-1"></a><span class="fu">## Conclusion: From Foundations to Frontiers</span></span>
<span id="cb61-2975"><a href="#cb61-2975" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb61-2976"><a href="#cb61-2976" aria-hidden="true" tabindex="-1"></a>:::{.callout-tip}</span>
<span id="cb61-2977"><a href="#cb61-2977" aria-hidden="true" tabindex="-1"></a><span class="fu">## What You've Accomplished</span></span>
<span id="cb61-2978"><a href="#cb61-2978" aria-hidden="true" tabindex="-1"></a>You've successfully built a **production-ready geospatial AI toolkit** that demonstrates both technical excellence and software engineering best practices. This foundation will serve you throughout your career in geospatial AI.</span>
<span id="cb61-2979"><a href="#cb61-2979" aria-hidden="true" tabindex="-1"></a>:::</span>
<span id="cb61-2980"><a href="#cb61-2980" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb61-2981"><a href="#cb61-2981" aria-hidden="true" tabindex="-1"></a>🎉 **Outstanding Achievement!** You've progressed from basic satellite data access to building a sophisticated, enterprise-grade geospatial analysis system.</span>
<span id="cb61-2982"><a href="#cb61-2982" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb61-2983"><a href="#cb61-2983" aria-hidden="true" tabindex="-1"></a><span class="fu">### Core Competencies Developed</span></span>
<span id="cb61-2984"><a href="#cb61-2984" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb61-2985"><a href="#cb61-2985" aria-hidden="true" tabindex="-1"></a>**Technical Mastery:**</span>
<span id="cb61-2986"><a href="#cb61-2986" aria-hidden="true" tabindex="-1"></a><span class="ss">1. </span>**🛠️ Enterprise-Grade Toolkit**: Built 13+ production-ready functions for geospatial AI workflows</span>
<span id="cb61-2987"><a href="#cb61-2987" aria-hidden="true" tabindex="-1"></a><span class="ss">2. </span>**🔐 Security-First Architecture**: Implemented robust authentication and error handling patterns</span>
<span id="cb61-2988"><a href="#cb61-2988" aria-hidden="true" tabindex="-1"></a><span class="ss">2. </span>**🌍 Mastered STAC APIs**: Connected to planetary-scale satellite data with proper authentication</span>
<span id="cb61-2989"><a href="#cb61-2989" aria-hidden="true" tabindex="-1"></a><span class="ss">3. </span>**📡 Loaded Real Satellite Data**: Worked with actual Sentinel-2 imagery, not just sample data</span>
<span id="cb61-2990"><a href="#cb61-2990" aria-hidden="true" tabindex="-1"></a><span class="ss">4. </span>**🎨 Created Publication-Quality Visuals**: RGB composites, NDVI maps, and interactive visualizations</span>
<span id="cb61-2991"><a href="#cb61-2991" aria-hidden="true" tabindex="-1"></a><span class="ss">5. </span>**📊 Performed Multi-band Analysis**: Calculated vegetation indices and band correlations</span>
<span id="cb61-2992"><a href="#cb61-2992" aria-hidden="true" tabindex="-1"></a><span class="ss">6. </span>**🗺️ Built Interactive Maps**: Folium maps with measurement tools and multiple basemaps</span>
<span id="cb61-2993"><a href="#cb61-2993" aria-hidden="true" tabindex="-1"></a><span class="ss">7. </span>**💾 Established Data Workflows**: Export functions and caching for reproducible analysis</span>
<span id="cb61-2994"><a href="#cb61-2994" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb61-2995"><a href="#cb61-2995" aria-hidden="true" tabindex="-1"></a><span class="fu">### Key Technical Skills Gained:</span></span>
<span id="cb61-2996"><a href="#cb61-2996" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb61-2997"><a href="#cb61-2997" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>**Authentication**: Planetary Computer API tokens for enterprise-level data access</span>
<span id="cb61-2998"><a href="#cb61-2998" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>**Error Handling**: Robust functions with retry logic and fallback options</span>
<span id="cb61-2999"><a href="#cb61-2999" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>**Memory Management**: Subsetting and efficient loading of large raster datasets</span>
<span id="cb61-3000"><a href="#cb61-3000" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>**Geospatial Standards**: Working with CRS transformations and GeoTIFF exports</span>
<span id="cb61-3001"><a href="#cb61-3001" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>**Code Documentation**: Well-documented functions with examples and type hints</span>
<span id="cb61-3002"><a href="#cb61-3002" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb61-3003"><a href="#cb61-3003" aria-hidden="true" tabindex="-1"></a><span class="fu">### Real-World Applications:</span></span>
<span id="cb61-3004"><a href="#cb61-3004" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb61-3005"><a href="#cb61-3005" aria-hidden="true" tabindex="-1"></a>Your helper functions are now ready for:</span>
<span id="cb61-3006"><a href="#cb61-3006" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb61-3007"><a href="#cb61-3007" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>🌱 **Environmental Monitoring**: Track deforestation, urban growth, crop health</span>
<span id="cb61-3008"><a href="#cb61-3008" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>🌊 **Disaster Response**: Flood mapping, wildfire damage assessment</span>
<span id="cb61-3009"><a href="#cb61-3009" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>📊 **Research Projects**: Time series analysis, change detection studies</span>
<span id="cb61-3010"><a href="#cb61-3010" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>🏢 **Commercial Applications**: Agricultural monitoring, real estate analysis</span>
<span id="cb61-3011"><a href="#cb61-3011" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb61-3012"><a href="#cb61-3012" aria-hidden="true" tabindex="-1"></a><span class="fu">### Week 2 Preview: Rapid Preprocessing Pipelines</span></span>
<span id="cb61-3013"><a href="#cb61-3013" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb61-3014"><a href="#cb61-3014" aria-hidden="true" tabindex="-1"></a>Next week, we'll scale up using your new toolkit:</span>
<span id="cb61-3015"><a href="#cb61-3015" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb61-3016"><a href="#cb61-3016" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>**Batch Processing**: Handle multiple scenes and time series</span>
<span id="cb61-3017"><a href="#cb61-3017" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>**Cloud Masking**: Automatically filter cloudy pixels</span>
<span id="cb61-3018"><a href="#cb61-3018" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>**Mosaicking**: Combine scenes into seamless regional datasets</span>
<span id="cb61-3019"><a href="#cb61-3019" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>**Analysis-Ready Data**: Create standardized data cubes for ML</span>
<span id="cb61-3020"><a href="#cb61-3020" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>**Performance Optimization**: Parallel processing and dask integration</span>
<span id="cb61-3021"><a href="#cb61-3021" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb61-3022"><a href="#cb61-3022" aria-hidden="true" tabindex="-1"></a><span class="fu">### Practice Assignment</span></span>
<span id="cb61-3023"><a href="#cb61-3023" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb61-3024"><a href="#cb61-3024" aria-hidden="true" tabindex="-1"></a>**Choose Your Own Adventure** - Use your helper functions to analyze a different region:</span>
<span id="cb61-3025"><a href="#cb61-3025" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb61-3026"><a href="#cb61-3026" aria-hidden="true" tabindex="-1"></a><span class="ss">1. </span>**Urban Growth**: Compare city expansion (try Phoenix, Dubai, or Shenzhen)</span>
<span id="cb61-3027"><a href="#cb61-3027" aria-hidden="true" tabindex="-1"></a><span class="ss">2. </span>**Agricultural Monitoring**: Track crop cycles in Central Valley or Iowa</span>
<span id="cb61-3028"><a href="#cb61-3028" aria-hidden="true" tabindex="-1"></a><span class="ss">3. </span>**Environmental Change**: Monitor glacial retreat in Alaska or Greenland</span>
<span id="cb61-3029"><a href="#cb61-3029" aria-hidden="true" tabindex="-1"></a><span class="ss">4. </span>**Disaster Assessment**: Recent wildfire or flood areas</span>
<span id="cb61-3030"><a href="#cb61-3030" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb61-3031"><a href="#cb61-3031" aria-hidden="true" tabindex="-1"></a>**Steps to try**:</span>
<span id="cb61-3032"><a href="#cb61-3032" aria-hidden="true" tabindex="-1"></a><span class="ss">1. </span>Modify the <span class="in">`sf_bay_bbox`</span> to your area of interest</span>
<span id="cb61-3033"><a href="#cb61-3033" aria-hidden="true" tabindex="-1"></a><span class="ss">2. </span>Use <span class="in">`search_sentinel2_scenes()`</span> to find recent imagery</span>
<span id="cb61-3034"><a href="#cb61-3034" aria-hidden="true" tabindex="-1"></a><span class="ss">3. </span>Run the complete analysis pipeline</span>
<span id="cb61-3035"><a href="#cb61-3035" aria-hidden="true" tabindex="-1"></a><span class="ss">4. </span>Export your results and compare seasonal changes</span>
<span id="cb61-3036"><a href="#cb61-3036" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb61-3037"><a href="#cb61-3037" aria-hidden="true" tabindex="-1"></a><span class="fu">## Essential Resources</span></span>
<span id="cb61-3038"><a href="#cb61-3038" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb61-3039"><a href="#cb61-3039" aria-hidden="true" tabindex="-1"></a><span class="fu">### Data Sources</span></span>
<span id="cb61-3040"><a href="#cb61-3040" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb61-3041"><a href="#cb61-3041" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span><span class="co">[</span><span class="ot">Microsoft Planetary Computer Catalog</span><span class="co">](https://planetarycomputer.microsoft.com/catalog)</span> - Free satellite data</span>
<span id="cb61-3042"><a href="#cb61-3042" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span><span class="co">[</span><span class="ot">STAC Browser</span><span class="co">](https://radiantearth.github.io/stac-browser/)</span> - Explore STAC catalogs</span>
<span id="cb61-3043"><a href="#cb61-3043" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span><span class="co">[</span><span class="ot">Earth Engine Data Catalog</span><span class="co">](https://developers.google.com/earth-engine/datasets)</span> - Alternative data source</span>
<span id="cb61-3044"><a href="#cb61-3044" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb61-3045"><a href="#cb61-3045" aria-hidden="true" tabindex="-1"></a><span class="fu">### Technical Documentation</span></span>
<span id="cb61-3046"><a href="#cb61-3046" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb61-3047"><a href="#cb61-3047" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span><span class="co">[</span><span class="ot">Rasterio Documentation</span><span class="co">](https://rasterio.readthedocs.io/)</span> - Geospatial I/O</span>
<span id="cb61-3048"><a href="#cb61-3048" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span><span class="co">[</span><span class="ot">Xarray Tutorial</span><span class="co">](https://docs.xarray.dev/en/stable/tutorials-and-videos.html)</span> - Multi-dimensional arrays</span>
<span id="cb61-3049"><a href="#cb61-3049" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span><span class="co">[</span><span class="ot">STAC Specification</span><span class="co">](https://stacspec.org/)</span> - Metadata standards</span>
<span id="cb61-3050"><a href="#cb61-3050" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span><span class="co">[</span><span class="ot">Folium Examples</span><span class="co">](https://python-visualization.github.io/folium/)</span> - Interactive mapping</span>
<span id="cb61-3051"><a href="#cb61-3051" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb61-3052"><a href="#cb61-3052" aria-hidden="true" tabindex="-1"></a><span class="fu">### Community</span></span>
<span id="cb61-3053"><a href="#cb61-3053" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb61-3054"><a href="#cb61-3054" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span><span class="co">[</span><span class="ot">Pangeo Community</span><span class="co">](https://pangeo.io/)</span> - Open source geoscience</span>
<span id="cb61-3055"><a href="#cb61-3055" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span><span class="co">[</span><span class="ot">STAC Discord</span><span class="co">](https://discord.gg/stac)</span> - STAC community support</span>
<span id="cb61-3056"><a href="#cb61-3056" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span><span class="co">[</span><span class="ot">PyData Geospatial</span><span class="co">](https://github.com/pydata/pydata-book)</span> - Python geospatial ecosystem</span>
<span id="cb61-3057"><a href="#cb61-3057" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb61-3058"><a href="#cb61-3058" aria-hidden="true" tabindex="-1"></a>**Remember**: Your helper functions are now your superpower! 🦸 Use them to explore any area on Earth with just a few lines of code.</span>
</code><button title="Copy to Clipboard" class="code-copy-button" data-in-quarto-modal=""><i class="bi"></i></button></pre></div>
</div></div></div></div></div>
</div> <!-- /content -->
<footer class="footer">
  <div class="nav-footer">
    <div class="nav-footer-left">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="../images/geog-logo.png" class="img-fluid figure-img" width="250"></p>
<figcaption>Department of Geography logo</figcaption>
</figure>
</div>
</div>   
    <div class="nav-footer-center">
      &nbsp;
    </div>
    <div class="nav-footer-right">
<p>This website is built with <a href="https://github.com/kcaylor/GEOG-288KC-geospatial-foundation-models"><i class="fa-brands fa-github" title="the github octocat logo" aria-label="github"></i></a> and <a href="https://quarto.org/">Quarto</a></p>
</div>
  </div>
</footer>




</body></html>